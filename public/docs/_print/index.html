<!doctype html>
<html itemscope itemtype="http://schema.org/WebPage" lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.123.6">

<META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">

<link rel="canonical" type="text/html" href="https://codeblind.ai/docs/">
<link rel="alternate" type="application/rss&#43;xml" href="https://codeblind.ai/docs/index.xml">


<link rel="shortcut icon" href="/favicons/favicon.ico?v=1" >
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png?v=1" sizes="180x180">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png?v=1" sizes="16x16">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png?v=1" sizes="32x32">
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png?v=1" sizes="180x180">
<title>Code Blind Documentation | </title><meta property="og:title" content="Code Blind Documentation" />
<meta property="og:description" content="Documentation and usage guides on how to develop and host dedicated game servers on top of Code Blind.
" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://codeblind.ai/docs/" /><meta property="og:site_name" content="Goldydocs" />

<meta itemprop="name" content="Code Blind Documentation">
<meta itemprop="description" content="Documentation and usage guides on how to develop and host dedicated game servers on top of Code Blind.
"><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Code Blind Documentation"/>
<meta name="twitter:description" content="Documentation and usage guides on how to develop and host dedicated game servers on top of Code Blind.
"/>



<link rel="stylesheet" href="/css/prism.css"/>






<link href="/scss/main.css" rel="stylesheet">


<link rel="stylesheet" type="text/css" href=https://codeblind.ai/css/asciinema-player.css />
<script
  src="https://code.jquery.com/jquery-3.3.1.min.js"
  integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
  crossorigin="anonymous"></script>

  </head>
  <body class="td-section">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-light  nav-shadow flex-column flex-md-row td-navbar">

	<a id="agones-top"  class="navbar-brand" href="/">
		<svg viewBox="0 -40 700 300" xmlns="http://www.w3.org/2000/svg"><g fill="#006298" fill-rule="none" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode:normal" transform="matrix(1, 0, 0, 1, 4.033676, -59.776756)"><g data-paper-data='{"isGlobalGroup":true,"bounds":{"x":65,"y":134.91096067769388,"width":420,"height":200.17807864461224}}'><g data-paper-data='{"isPrimaryText":true}' fill-rule="nonzero" transform="matrix(1.506311, 0, 0, 1.608315, -96.423798, -293.86853)" style=""><path d="M99.87138 315.5382c-1.20049 6.40261-6.57411 11.03307-12.97673 11.03307-7.14577.0-12.80523-6.00245-12.80523-13.49122.0-7.54594 5.65945-13.60555 12.80523-13.60555 4.4018.0 8.74643 2.22948 11.8334 6.80278l6.91711-4.91629c-3.83013-6.23111-10.86158-10.34708-18.80768-10.34708C74.71825 291.01391 65 300.90366 65 313.08006s9.71825 22.00898 21.89465 22.00898c11.31891.0 20.69416-8.63209 21.95182-19.55084z" data-paper-data='{"glyphName":"C","glyphIndex":0,"firstGlyphOfWord":true,"word":1}'/><path d="M134.79992 335.08904c12.1764.0 22.00898-9.88975 22.00898-22.06615s-9.83258-22.00898-22.06615-22.00898c-12.1764.0-22.00898 9.83258-22.00898 22.00898s9.83258 22.06615 22.06615 22.06615zM134.74275 299.4745c7.20294.0 12.97673 6.05962 12.97673 13.54839.0 7.6031-5.71662 13.54839-12.91956 13.54839-7.31727.0-12.97673-5.94528-12.97673-13.54839.0-7.48877 5.65945-13.54839 12.91956-13.54839z" data-paper-data='{"glyphName":"O","glyphIndex":1,"word":1}'/><path d="M163.15435 291.75707v42.58881h17.32136c12.23356.0 22.23765-9.08942 22.23765-21.32299.0-12.11923-10.00408-21.26582-22.29481-21.26582zm8.86076 34.58554v-26.58228h8.40343c7.4316.0 13.20539 5.54512 13.20539 13.26256.0 7.66027-5.77379 13.31972-13.14822 13.31972z" data-paper-data='{"glyphName":"D","glyphIndex":2,"word":1}'/><path d="M235.46958 334.34588v-8.00327h-17.55002V315.7097h16.00653v-8.00327h-16.00653v-7.9461h13.77705v-8.00327H209.0588v42.58881z" data-paper-data='{"glyphName":"E","glyphIndex":3,"word":1}'/><path d="M256.67824 334.34588c7.83177.0 15.09187-5.03062 15.09187-13.71989.0-4.11597-1.94365-7.7746-5.77379-10.40425 2.05798-1.88648 3.02981-4.2303 3.02981-7.20294.0-7.9461-5.65945-11.26174-13.54839-11.26174h-13.66272v42.58881zM250.67579 326.34261V315.3667h6.28828c3.65864.0 5.71662 2.11515 5.71662 5.54512.0 3.31564-2.05798 5.43079-5.71662 5.43079zm0-18.69334v-7.88893h4.45896c2.45815.0 4.80196.68599 4.80196 3.94447.0 1.77215-.5145 3.94447-4.80196 3.94447z" data-paper-data='{"glyphName":"B","glyphIndex":4,"word":1}'/><path d="M278.11556 291.75707v42.58881h26.01062v-8.00327h-17.14986v-34.58555z" data-paper-data='{"glyphName":"L","glyphIndex":5,"word":1}'/><path d="M317.90323 291.75707h-8.86076v42.58881h8.86076z" data-paper-data='{"glyphName":"I","glyphIndex":6,"word":1}'/><path d="M356.31891 316.3957l-30.29808-25.43895v43.38914h8.86076v-24.46713l30.29808 25.21029v-43.33197h-8.86076z" data-paper-data='{"glyphName":"N","glyphIndex":7,"word":1}'/><path d="M373.29726 291.75707v42.58881h17.32136c12.23356.0 22.23765-9.08942 22.23765-21.32299.0-12.11923-10.00408-21.26582-22.29481-21.26582zM382.15802 326.34261v-26.58228h8.40343c7.4316.0 13.20539 5.54512 13.20539 13.26256.0 7.66027-5.77379 13.31972-13.14822 13.31972z" data-paper-data='{"glyphName":"D","glyphIndex":8,"word":1}'/></g><g data-paper-data='{"fillRule":"evenodd","fillRuleOriginal":"evenodd","isIcon":true,"iconStyle":"standalone","selectedEffects":{"container":"triangle_simple_outline3","transformation":"","pattern":""},"bounds":{"x":200.4253260667158,"y":134.91096067769388,"width":149.1493478665684,"height":129.93559557606665},"widthRatioIconToContainer":0.46864262218011316,"heightRatioIconToContainer":0.5128464428206175,"relativeBoundsIconToContainer":{"top":0.1511909708697078,"left":0.00000405714571068623},"iconType":"icon","rawIconId":"22591","isDetailed":false,"blockLetter":"A","suitableAsStandaloneIcon":true}' fill-rule="evenodd" transform="matrix(0.857575, 0, 0, 0.832887, 371.420288, 37.764965)" style=""><path d="M240.08737 218.30866l-.03565-.03565.03565-.21459c0-3.26912.85904-7.02682 2.57713-11.2738 1.07363-2.36185 2.46949-4.70062 4.18758-7.01493.90657-1.24068 2.39819-2.85113 4.47346-4.83203 2.14726-1.81315 4.21134-3.26842 6.19154-4.36651 1.76562-.97857 3.99676-1.92079 6.69271-2.82736 2.19549-.71575 5.07038-1.21692 8.62538-1.5028l.85904-.03565v.03565l.07199-.03565h2.11161l.25024.03565.03565-.03565.21528.03565c2.95807.0 6.5613.69199 10.80829 2.07597 2.38631.88281 4.74815 2.02843 7.08694 3.43617 1.45527.85904 3.14959 2.11161 5.08226 3.75771 2.33878 2.21925 3.88911 3.93664 4.65239 5.15426 1.79008 2.43314 3.18594 5.04592 4.18758 7.83763 1.14562 3.4837 1.71809 6.52566 1.71809 9.12655l.03495.14259h-.03565l.03565.03565v2.2542l-.03565.03635.03565.03635c0 1.76492-.35788 4.3057-1.07363 7.62305-.66822 2.33808-1.39586 4.34205-2.18291 6.01261-.85904 1.69432-2.02773 3.51935-3.50816 5.47579-.9541 1.16939-2.19549 2.49326-3.72205 3.97299-2.4576 2.07597-4.53287 3.61511-6.22719 4.61675-.73952.38164-1.40774.57247-2.00397.57247-1.59856.0-2.67219-.78775-3.22089-2.36254-.09576-.42917-.14329-.79963-.14329-1.10928.0-1.36021 1.19316-2.66031 3.57947-3.90099.73952-.35788 1.92009-1.26515 3.54242-2.72042 2.07597-2.0522 3.51935-3.75771 4.33086-5.11791.93034-1.43151 1.70551-2.92313 2.3262-4.47346.85904-2.43314 1.28822-4.02051 1.28822-4.76003l.35858-2.29055-.07199-.03565.07199-.21528v-.32223l.03565-.03635-.03565-.03565.03565-.14329.03565-1.61045c0-7.11-2.63584-13.29036-7.90893-18.53898-1.95644-1.74185-3.39983-2.87489-4.33016-3.39983-4.86768-3.03007-10.00935-4.54545-15.42574-4.54545h-1.64609l-.21459.03565v-.03565l-.03565.03565h-.03635c-2.40937.0-5.32062.56058-8.73232 1.68244-1.81385.69199-3.63888 1.59856-5.47579 2.72042-1.16939.69199-2.79172 2.00397-4.86768 3.93664l-1.18127 1.28822c-4.55733 5.08226-6.836 10.90405-6.836 17.46535l.03565.39352h-.03635l.03565.03565v.03565c0 4.67686 1.95644 10.04501 5.86931 16.10584 3.17336 4.72439 5.51214 8.29127 7.01493 10.70135.52493.88351 1.03728 1.86068 1.53845 2.93501h-.03565c-3.19712-1.45527-6.17966-3.16147-8.94761-5.11791-2.09972-1.64609-3.80523-3.30546-5.11791-4.97462-1.5028-2.09972-2.61278-3.88911-3.32853-5.36885-.85904-1.67055-1.65868-3.75771-2.39819-6.26353-.42917-1.57479-.77517-3.2803-1.03798-5.11722l-.17894-1.96832h.03565l-.03565-.03635-.03495-1.82503v-1.00234l.03565-.03565-.03565-.03565v-.03565zm34.03601-22.7622h2.04032l.03565.07199.03635-.07199c1.59856.04753 3.65076.38164 6.15589 1.00234 2.17103.69199 3.97299 1.44339 5.40379 2.2549 1.33645.73952 2.86371 1.86138 4.58179 3.36418 2.14726 2.07597 3.53124 3.63888 4.15123 4.68874 1.16939 1.69432 2.07597 3.49558 2.72042 5.40449.52493 1.31198.89469 3.20901 1.10928 5.69038v.03565h-.03565l.03565.03565v1.32457c0 6.46554-2.67219 12.24049-8.01727 17.32206-2.4576 2.17103-4.0324 3.29288-4.72439 3.36418-.42917.19082-.89399.28588-1.39586.28588h-.07129c-1.5035.0-2.55336-.7514-3.14959-2.2549l-.17964-1.07363c0-1.57479 1.04986-2.82736 3.14959-3.75771.66822-.33481 1.44339-.93104 2.3262-1.79008 1.40844-1.47973 2.41007-2.83924 3.007-4.08063.5487-.9541 1.07363-2.28985 1.57479-4.00793.28588-1.40774.42917-2.42195.42917-3.04195h.03565l-.03565-.0727.03565-.17894v-1.93267l-.03565-.17894h.03565l-.03565-.14329c0-1.74185-.60811-3.84158-1.82503-6.29918-.59693-1.0974-1.46785-2.26679-2.61278-3.50747-1.21622-1.24068-2.24232-2.09972-3.0776-2.57713-3.38794-2.17103-6.76401-3.25724-10.12818-3.25724h-.10694l-.03635-.07199-.03565.07199h-.10764l-.03565-.07199-.03565.07199h-.39352l-.03635-.07199-.03565.07199h-.64446l-.21459.03565v-.03565c-1.5028.14329-2.67219.33411-3.50816.57247-4.00793 1.14492-7.13376 3.03007-9.37678 5.65473-1.28891 1.40774-2.29055 2.89866-3.0063 4.47346-.93034 2.17103-1.39586 4.21134-1.39586 6.12025v.7514l-.03565.03565.03565.03565v.07129c0 3.14959 1.19316 6.47812 3.57876 9.98559 6.06083 9.6389 10.72511 17.28641 13.99423 22.94114l-.03565.03565h-.03635c-4.17569-.38164-6.96741-.77517-8.37445-1.18057-5.55897-8.78056-8.67292-13.66012-9.34113-14.63729-2.95877-4.48604-4.79568-7.77892-5.51143-9.87865-.78775-2.36185-1.18127-4.80827-1.18127-7.33716.0-5.48767 1.80126-10.52241 5.40449-15.10351.5487-.71575 1.68174-1.8495 3.39983-3.39983 3.24536-2.57713 6.78777-4.28264 10.62935-5.11791 1.38467-.30685 3.0063-.52213 4.86768-.64096v.07199zM274.69654 205.06653h1.10998l.07199.07199.03565-.07199h.03565l.03635.07199.03565-.07199c1.04986.0 2.46949.25024 4.25957.7514 3.6263 1.28822 6.38236 3.67453 8.26751 7.15823 1.04986 2.17103 1.57479 4.29522 1.57479 6.37048v.21459c0 3.96111-1.7062 7.55175-5.11791 10.77264-1.43151 1.14562-2.7323 1.71809-3.90099 1.71809-1.45597.0-2.54148-.77517-3.25724-2.3262-.11883-.33411-.19012-.68011-.21459-1.03798.0-1.19246.88281-2.39749 2.64842-3.61441 1.26445-.85904 2.07597-1.8495 2.43314-2.97065.28658-.81151.42917-1.61045.42917-2.39819v-.14329c0-2.38631-1.04986-4.49792-3.14959-6.33484-1.38328-1.0261-3.10206-1.53915-5.15356-1.53915l-.28588.03565v-.03565l-.03635.03565h-.07199c-1.88444.0-3.69829.81081-5.43944 2.43314-1.40844 1.62233-2.11161 3.4837-2.11161 5.58343.0 1.78938 1.2288 4.42593 3.68641 7.90963 6.34672 9.99747 11.22628 17.88264 14.63729 23.65759-3.05383.81081-5.40379 1.21622-7.05059 1.21622-3.14959-4.5811-6.84788-10.4623-11.09487-17.64359-1.45527-2.43384-3.0776-4.95156-4.86698-7.55245-1.59856-2.48137-2.39889-5.07038-2.39889-7.76634.0-3.74582 1.37209-7.06247 4.11628-9.94925 1.47904-1.36021 2.82736-2.32689 4.04428-2.89866 2.17103-.90657 3.61511-1.36021 4.33016-1.36021.4061-.09506 1.19316-.19082 2.36254-.28588v.07199zm74.56087 55.60127c.0215.04174.0421.08398.06181.1267.01926.04277.0374.08599.05442.12966.01747.04366.03381.08771.04904.13215.01478.04448.02867.08926.04165.13436.01299.04515.02486.09058.0356.13631.0103.04573.0197.09168.02822.13785.00851.04618.0159.09253.02217.13907.00582.04653.01075.0932.01478.14001.00358.04676.00627.09361.00806.14054.00134.04694.00179.09385.00134.14074-89e-5.04694-.00291.09383-.00605.14068-.00313.04685-.00739.09358-.01277.14021-.00538.04667-.01186.09316-.01948.13947-.00761.04631-.01635.0924-.0262.13825-.00985.04591-.02083.09153-.03292.13684-.0121.04537-.0253.09038-.03964.13503-.01478.0447-.03023.08901-.04636.13295-.01657.04394-.03426.08745-.05307.13053-.01881.04304-.03852.08561-.05912.12771s-.04232.08369-.06516.12476c-.02284.04102-.0468.08147-.07188.12133-.02463.03986-.05038.07909-.07726.1177-.02642.03856-.05397.07648-.08263.11373-.02867.03722-.05822.07374-.08868.10957-.03046.03579-.06158.07081-.09338.10507-.03225.03426-.06516.06772-.09875.10037s-.06808.06445-.10346.0954c-.03538.03095-.07144.061-.10816.09015-.03673.0292-.07412.05746-.11219.08478-.03852.02736-.07748.05377-.1169.07921-.03941.02544-.0795.04989-.12025.07336-.21766.12585-.44809.22136-.69128.28652-.2432.06516-.49064.09775-.74234.09775H203.29356c-.04694.0-.09385-.00116-.14074-.00349-.04689-.00228-.0937-.00573-.14041-.01034-.04671-.00457-.09327-.0103-.13967-.0172-.04645-.0069-.09269-.01494-.13872-.02412-.04604-.00914-.09184-.01941-.13738-.03084-.04551-.01137-.09071-.02389-.13564-.03756-.04492-.01362-.08948-.02833-.13369-.04414-.04421-.01581-.08798-.03269-.13134-.05065-.0434-.01796-.08631-.03697-.12872-.05703-.04246-.02007-.08438-.04116-.12576-.06328-.04138-.02217-.0822-.0453-.12247-.0694-.04026-.02414-.07992-.04926-.11898-.07537-.03901-.02606-.07737-.05307-.11508-.08102-.03771-.028-.0747-.05686-.11098-.0866-.03628-.02979-.07182-.06044-.10661-.09197-.0348-.03153-.0688-.06389-.10198-.09707-.03319-.03319-.06554-.06718-.09707-.10198-.03153-.03475-.06217-.07029-.09191-.10661-.02979-.03628-.05867-.07327-.08666-.11098-.02795-.03771-.05495-.07607-.08102-.11508-.02611-.03905-.05121-.07871-.07531-.11898-.02414-.04022-.04727-.08104-.0694-.12247-.02213-.04138-.04324-.0833-.06335-.12576-.02007-.04241-.03908-.0853-.05703-.12865-.01796-.0434-.03484-.0872-.05065-.13141-.01581-.04416-.03052-.0887-.04414-.13362-.01366-.04492-.02618-.09015-.03756-.1357-.01142-.04555-.0217-.09134-.03084-.13738-.00918-.04604-.01722-.09226-.02412-.13866-.00685-.04645-.01259-.09302-.0172-.13974-.00462-.04671-.00806-.09352-.01034-.14041-.00233-.04689-.00349-.09381-.00349-.14074.0-.25175.03258-.4992.09775-.74234.06516-.2432.16067-.47378.28652-.69175l71.7064-124.19911c.02347-.04067.04792-.08073.07336-.12018.02544-.03946.05184-.07827.07921-.11643.02732-.03816.05558-.07563.08478-.11239.02916-.03677.0592-.0728.09015-.1081.03095-.03529.06275-.0698.0954-.10352.03265-.03372.0661-.06662.10037-.09868.03426-.03211.06929-.06335.10507-.09372.03579-.03037.07231-.05984.10957-.08841.03722-.02858.07513-.05623.11373-.08296.03861-.02669.07784-.05245.1177-.07726.03986-.02477.0803-.04855.12133-.07135.04102-.0228.08261-.04459.12476-.06536.0421-.02074.08467-.04044.12771-.05912.04308-.01867.0866-.03628.13053-.05281.04394-.01657.08823-.03202.13288-.04636.0447-.01438.08973-.02763.1351-.03977.04533-.01214.09094-.02318.13684-.03312.04586-.0099.09195-.01867.13825-.02633.04631-.00761.09278-.01411.1394-.01948.04667-.00538.09343-.00958.14027-.01263.0468-.00309.09367-.00502.14061-.00578.04694-76e-5.09387-38e-5.14081.00114.04689.00152.09374.00421.14054.00806.0468.00385.09347.00882.14001.01491.04653.00614.09289.01342.13907.02184.04618.00837.09213.01789.13785.02855.04573.01066.09116.02244.13631.03533.0451.0129.08988.02689.13436.04199.04443.01509.08848.03126.13215.0485.04366.01724.08686.03556.12959.05495.04277.01934.08503.03975.12677.0612.04178.02146.08299.04392.12361.06738.21802.1259.41604.27784.59408.45582.17798.17802.32993.37605.45582.59408l71.70627 124.19911c.02374.04062.04613.08182.06718.12361zM274.99998 143.5157l-66.73842 115.59433H341.7386z" data-paper-data='{"isPathIcon":true}'/></g></g></g></svg> <span class="text-uppercase fw-bold"></span>
	</a>

	<div class="td-navbar-nav-scroll ms-md-auto" id="main_navbar">
		<ul class="navbar-nav mt-2 mt-lg-0">
			
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				<a class="nav-link active" href="/docs/"><span class="active">Documentation</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/blog/"><span>Blog</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/community/"><span>Community</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				<a class="nav-link" href="https://github.com/josephbarnett/codeblind.ai">GitHub</a>
			</li>
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				<a class="nav-link" href="https://app.codeblind.ai/login">Login</a>
			</li>
			
		</ul>
	</div>
	<div class="navbar-nav mx-lg-2 d-none d-lg-block"></div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <main class="col-12 col-md-9 col-xl-8 ps-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This is the multi-page printable view of this section.
<a href="#" onclick="print();return false;">Click here to print</a>.
</p><p>
<a href="/docs/">Return to the regular view of this page</a>.
</p>
</div>



<h1 class="title">Code Blind Documentation</h1>
<div class="lead">Documentation and usage guides on how to develop and host dedicated game servers on top of Code Blind.</div>




    <ul>
    
  
  
  
  

  
    
    
	
<li>1: <a href="#pg-6557438925ac398717df86f494c6abb8">Overview</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>2: <a href="#pg-4934df4700679bf916824b3942c80835">Prerequisite Knowledge</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>3: <a href="#pg-6121397c9c1b82e0a74996f89313317c">Install and configure Code Blind on Kubernetes</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>3.1: <a href="#pg-6463ca879dc9c5ec43c8e77d4147e56c">Create Kubernetes Cluster</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>3.1.1: <a href="#pg-b64b5630d72ed25ece15506b5577563b">Google Kubernetes Engine</a></li>


    
  
    
    
	
<li>3.1.2: <a href="#pg-b92bbfd1ff6d688fa054f083c1f4c981">Amazon Elastic Kubernetes Service</a></li>


    
  
    
    
	
<li>3.1.3: <a href="#pg-5794c6009fa81061fd16c966496f5f31">Azure Kubernetes Service</a></li>


    
  
    
    
	
<li>3.1.4: <a href="#pg-bda448e72a77dd8564f18c2084b5c5eb">Minikube</a></li>


    
  

    </ul>
    
  
    
    
	
<li>3.2: <a href="#pg-f20510043e9f53d4f75643e9f0fd06f2">Install Code Blind</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>3.2.1: <a href="#pg-17a026f94c4ced8dd23deeb10b25eab5">Install Code Blind using YAML</a></li>


    
  
    
    
	
<li>3.2.2: <a href="#pg-3b82ee7f1edc04e876dc785596385caa">Install Code Blind using Helm</a></li>


    
  

    </ul>
    
  
    
    
	
<li>3.3: <a href="#pg-1ce1902627986754e63902ced859a973">Deploy Kubernetes cluster and install Code Blind using Terraform</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>3.3.1: <a href="#pg-4ebc8d21cb3a0bed08fa6069e0de7ccb">Installing Code Blind on Google Kubernetes Engine using Terraform</a></li>


    
  
    
    
	
<li>3.3.2: <a href="#pg-87b95dd171847daa29344497871d0251">Installing Code Blind on AWS Elastic Kubernetes Service using Terraform</a></li>


    
  
    
    
	
<li>3.3.3: <a href="#pg-bc8ff361c71609f0e8cdd22678d09ff8">Installing Code Blind on Azure Kubernetes Service using Terraform</a></li>


    
  

    </ul>
    
  
    
    
	
<li>3.4: <a href="#pg-34aceca87fb9ffae4f142749784a1ea1">Confirming Code Blind Installation</a></li>


    
  
    
    
	
<li>3.5: <a href="#pg-be3b0f3fd44e1d99c89c139c84e9d1fa">Upgrading Code Blind and Kubernetes</a></li>


    
  

    </ul>
    
  
    
    
	
<li>4: <a href="#pg-81b64e5e890a35284f3748234c4098b1">Getting Started</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>4.1: <a href="#pg-1995d0d2405f561f81a874a6a93513aa">Quickstart: Create a Game Server</a></li>


    
  
    
    
	
<li>4.2: <a href="#pg-f633728ddda1aa13c4e952cb0fffec2f">Quickstart: Create a Game Server Fleet</a></li>


    
  
    
    
	
<li>4.3: <a href="#pg-b26271778305c658b9e01a31ccaf98b4">Quickstart: Create a Fleet Autoscaler</a></li>


    
  
    
    
	
<li>4.4: <a href="#pg-41eab8b673334ca9325b8ab33261f1a3">Quickstart: Create a Fleet Autoscaler with Webhook Policy</a></li>


    
  
    
    
	
<li>4.5: <a href="#pg-968dadb4e3c831fafc44763def50a585">Quickstart: Edit a Game Server</a></li>


    
  

    </ul>
    
  
    
    
	
<li>5: <a href="#pg-5f99535ac90b3afc320b38b1cf0611f9">Guides</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>5.1: <a href="#pg-9991ac61ed3099936d3b9bbfb12d0f3e">Feature Stages</a></li>


    
  
    
    
	
<li>5.2: <a href="#pg-52398247f3240f270287eb9ac807491b">Best Practices</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>5.2.1: <a href="#pg-f726976ee94b3b66e8467a404921069b">Google Kubernetes Engine Best Practices</a></li>


    
  

    </ul>
    
  
    
    
	
<li>5.3: <a href="#pg-6f8bbe726ba7c85476067c9513fc6136">Code Blind Game Server Client SDKs</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>5.3.1: <a href="#pg-d9110a0f360a4714db35abf6ce38a140">Unreal Engine Game Server Client Plugin</a></li>


    
  
    
    
	
<li>5.3.2: <a href="#pg-cb46d2c42280b723ba5194728d8f8e48">Unity Game Server Client SDK</a></li>


    
  
    
    
	
<li>5.3.3: <a href="#pg-ea9cf494f21474538fa0638b52a8cb68">C&#43;&#43; Game Server Client SDK</a></li>


    
  
    
    
	
<li>5.3.4: <a href="#pg-63f37ca64d7de9cc29ac4ba30acbcd56">Go Game Server Client SDK</a></li>


    
  
    
    
	
<li>5.3.5: <a href="#pg-7bcee3a1d527cbfefbcd4e6a271adb91">C# Game Server Client SDK</a></li>


    
  
    
    
	
<li>5.3.6: <a href="#pg-f8485ce33aea4cc5839759a0e6cfb78e">Node.js Game Server Client SDK</a></li>


    
  
    
    
	
<li>5.3.7: <a href="#pg-24d1a13fcc983c347c4d6e93b5c781b0">Rust Game Server Client SDK</a></li>


    
  
    
    
	
<li>5.3.8: <a href="#pg-dd2771f8169b00ae8809eb9b01e73547">REST Game Server Client API</a></li>


    
  
    
    
	
<li>5.3.9: <a href="#pg-556057b2ca01a14c9507c51a6c2ec979">Local Development</a></li>


    
  

    </ul>
    
  
    
    
	
<li>5.4: <a href="#pg-5e516fa2b9ffa121bddad09db5bc4c2c">Windows Gameservers</a></li>


    
  
    
    
	
<li>5.5: <a href="#pg-02f8cd51bf4cf97802ded5bc598c3392">Fleet Updates</a></li>


    
  
    
    
	
<li>5.6: <a href="#pg-92d27aa55ec2fc72cebf70399bffad86">GameServer Health Checking</a></li>


    
  
    
    
	
<li>5.7: <a href="#pg-a08db3b081cafbd3d70d9f298bfcb5a4">Player Tracking</a></li>


    
  
    
    
	
<li>5.8: <a href="#pg-23757d70ae51993a62d84d8b6ff8f736">Local Game Server</a></li>


    
  
    
    
	
<li>5.9: <a href="#pg-d09d57ab1b4977b31173571cab22eba4">Latency Testing with Multiple Clusters</a></li>


    
  
    
    
	
<li>5.10: <a href="#pg-9346aaa1ce9cead47412256db81fcfb4">Metrics</a></li>


    
  
    
    
	
<li>5.11: <a href="#pg-35cc8c47e6283062d03d8cced1728ff8">Access Code Blind via the Kubernetes API</a></li>


    
  
    
    
	
<li>5.12: <a href="#pg-48e070a0265c9a00bbcc2563e96ed22c">Troubleshooting</a></li>


    
  

    </ul>
    
  
    
    
	
<li>6: <a href="#pg-6d2425143fef027b493bdb4e064ff1b8">Common Integration Patterns</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>6.1: <a href="#pg-4fd9de9527c6b855f671d3d36654cf69">Matchmaker requests a GameServer from a Fleet</a></li>


    
  
    
    
	
<li>6.2: <a href="#pg-86a46b984c7a9dbe801d9b640feca57f">Matchmaker requires game server process registration</a></li>


    
  
    
    
	
<li>6.3: <a href="#pg-f1a79f903a95085298e374f195e23456">Canary Testing a new Fleet</a></li>


    
  
    
    
	
<li>6.4: <a href="#pg-05d94f8163838ad613b32d32bb977c15">Reusing Allocated GameServers for more than one game session</a></li>


    
  
    
    
	
<li>6.5: <a href="#pg-62a4fdfa11ee32040369e2ca6dce6316">High Density GameServers</a></li>


    
  
    
    
	
<li>6.6: <a href="#pg-b5060da5db3ee4fca018df5aa30bf2b1">Allocating based on GameServer Player Capacity</a></li>


    
  

    </ul>
    
  
    
    
	
<li>7: <a href="#pg-68ec2370d0409cc27325be36693f9368">Tutorials</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>7.1: <a href="#pg-e43457c0d8b1ad8fc42509c38e7d0f1b">Tutorial Build and Run a Simple Gameserver (Rust)</a></li>


    
  
    
    
	
<li>7.2: <a href="#pg-20b721aa1328ed6386e53f4fb6bd7bba">Tutorial Build and Run a Simple Gameserver (node.js)</a></li>


    
  
    
    
	
<li>7.3: <a href="#pg-bc8f973cd2ecdd6bc9ff8c5a73a5fa51">Tutorial Build and Run a Simple Gameserver (C&#43;&#43;)</a></li>


    
  

    </ul>
    
  
    
    
	
<li>8: <a href="#pg-b00a88a07ceb21b1a83e5822e0c86c1d">Reference</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>8.1: <a href="#pg-822e19008f3423d8a6da51608c598d90">GameServer Specification</a></li>


    
  
    
    
	
<li>8.2: <a href="#pg-c5c1cc90b66f2081135179b33e03430a">Fleet Specification</a></li>


    
  
    
    
	
<li>8.3: <a href="#pg-73ab628c43273741615508c66fe16549">GameServerAllocation Specification</a></li>


    
  
    
    
	
<li>8.4: <a href="#pg-00ae33a4d3a44f39e3c7d65e198fc037">Fleet Autoscaler Specification</a></li>


    
  
    
    
	
<li>8.5: <a href="#pg-121f697fccaea4a701edfcac0c1c0916">Code Blind Kubernetes API</a></li>


    
  

    </ul>
    
  
    
    
	
<li>9: <a href="#pg-7eee50e5d896d8c0f7761ed471a95d89">Examples</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>10: <a href="#pg-6c4dd4bbdf2d2146d79c0c0f18f4c96a">Advanced</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>10.1: <a href="#pg-15980123edc419424a9f2df1a62f3135">Scheduling and Autoscaling</a></li>


    
  
    
    
	
<li>10.2: <a href="#pg-01cd69ca33036b349a8d47b3ee3df55d">High Availability Code Blind</a></li>


    
  
    
    
	
<li>10.3: <a href="#pg-6689fca1455445a3c7759b93ee6d69e2">Controlling Disruption</a></li>


    
  
    
    
	
<li>10.4: <a href="#pg-95571351289b80d85a0bde5b4c1a0b22">Limiting CPU &amp; Memory</a></li>


    
  
    
    
	
<li>10.5: <a href="#pg-9265a75f393211dcf8575bc3474c7ef6">Out of Cluster Dev Server</a></li>


    
  
    
    
	
<li>10.6: <a href="#pg-a147578c54e3cfc51d8c84b30bc32cc9">Allocator Service</a></li>


    
  
    
    
	
<li>10.7: <a href="#pg-522dc6497d01e5cbc17d1c3587704eec">Multi-cluster Allocation</a></li>


    
  
    
    
	
<li>10.8: <a href="#pg-cd42a2864dd477303091c6e62aeb3c51">GameServer Pod Service Accounts</a></li>


    
  

    </ul>
    
  
    
    
	
<li>11: <a href="#pg-1c91a59640f4d19bcf14ebed849a10e0">Frequently Asked Questions</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>12: <a href="#pg-fc0185d8c85360d88975558dab2d674f">Third Party Content</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>12.1: <a href="#pg-1f63813ee7821af50cf0a24cc3ebd3fa">Third Party Videos and Presentations</a></li>


    
  
    
    
	
<li>12.2: <a href="#pg-06fac025c00dda3f2d462c83673bbc2a">Third Party Examples</a></li>


    
  
    
    
	
<li>12.3: <a href="#pg-d529fc883ee4c6b16bf000a6a8fb11dc">Third Party Podcasts</a></li>


    
  
    
    
	
<li>12.4: <a href="#pg-b8eeaf002eb51635e17ef91f4641a68b">Third Party Libraries and Tools</a></li>


    
  

    </ul>
    
  
    
    
	
<li>13: <a href="#pg-3f5467eebfda1972aea4244246084123">Documentation Editing and Contribution</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  

    </ul>


<div class="content">
      <p>Release version: 1.38.0</p>
<p>These pages show you how to get up and running as quickly as possible in Code Blind.</p>
<p>If you are new to Code Blind, start with <a href="/docs/overview/">Overview</a> to get familiar with Code Blind'
features and services.</p>
<p>The <a href="/docs/installation/">Installation</a> guide will take you through creating a Kubernetes
cluster and getting Code Blind installed.</p>
<p>The <a href="/docs/getting-started/">Getting Started</a> section will have your
first <code>GameServer</code> up and running, and then have you spinning up <code>Fleets</code> after that.</p>

</div>
</div>


  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-6557438925ac398717df86f494c6abb8">1 - Overview</h1>
    <div class="lead">Code Blind is a library for hosting, running and scaling <a href="https://en.wikipedia.org/wiki/Game_server#Dedicated_server">dedicated game servers</a> on <a href="https://kubernetes.io">Kubernetes</a>.</div>
	<p><em>Agones, is derived from the Greek word agōn which roughly translates to “contest”, “competition at games” and “gathering”
(<a href="https://www.merriam-webster.com/dictionary/agones">source</a>).</em></p>
<h2 id="what-is-code-blind">What is Code Blind?</h2>
<p>Code Blind is an open source platform, for deploying, hosting, scaling, and orchestrating dedicated game servers for
large scale multiplayer games, built on top of the industry standard, distributed system platform <a href="https://kubernetes.io">Kubernetes</a>.</p>
<p>Code Blind replaces bespoke or proprietary cluster management and game server scaling solutions with an open source solution that
can be utilized and communally developed - so that you can focus on the important aspects of building a multiplayer game,
rather than developing the infrastructure to support it.</p>
<p>Built with both Cloud and on-premises infrastructure in mind, Code Blind can adjust its strategies as needed
for Fleet management, autoscaling, and more to ensure the resources being used to host dedicated game servers are
cost optimal for the environment that they are in.</p>
<h2 id="why-code-blind">Why Code Blind?</h2>
<p>Some of Code Blind&rsquo; advantages:</p>
<ul>
<li>Lower development and operational costs for hosting, scaling and orchestrating multiplayer game servers.</li>
<li>Any game server that can run on Linux can be hosted and orchestrated on Code Blind - in any language, or set of dependencies.</li>
<li>Run Code Blind anywhere Kubernetes can run - in the cloud, on premise, on your local machine or anywhere else you need it.</li>
<li>Game services and your game servers can be on the same foundational platform - simplifying your tooling and your operations knowledge.</li>
<li>By extending Kubernetes, Code Blind allows you to take advantage of the thousands of developers that have worked on the features of Kubernetes, and the ecosystem of tools that surround it.</li>
<li>Code Blind is free, open source and developed entirely in the public. Help shape its future by getting involved with the community.</li>
</ul>
<h2 id="major-features">Major Features</h2>
<p>Code Blind incorporates these abilities:</p>
<ul>
<li>Code Blind extends Kubernetes, such that it gets native abilities to create, run, manage and scale dedicated game server processes within
Kubernetes clusters using standard Kubernetes tooling and APIs.</li>
<li>Run and update Fleets of Game Servers, without worrying about having Game Servers shutdown that have active players
on them.</li>
<li>Deploy game servers inside a <a href="https://www.docker.com/resources/what-container">Docker container</a>, with any combination of dependencies or binaries.</li>
<li>Integrated game server SDK for game server lifecycle managements, including health checking, state management, configuration and more.</li>
<li>Autoscaling capabilities to ensure players always have a game server available to play on.</li>
<li>Out of the box metrics and log aggregation to track and visualise what is happening across all your game server sessions.</li>
<li>Modular architecture that can be tailored to your specific multiplayer game mechanics.</li>
<li>Game server scheduling and allocation strategies to ensure cost optimisation across cloud and on-premise environments.</li>
</ul>
<h2 id="code-of-conduct">Code of Conduct</h2>
<p>Participation in this project comes under the 
<a href="https://github.com/josephbarnett/codeblind.ai/blob/main/" target="_blank" data-proofer-ignore>Contributor Covenant Code of Conduct</a></p>
<h2 id="what-next">What Next?</h2>
<ul>
<li>Review our <a href="https://codeblind.ai/docs/prerequisite-knowledge/">Prerequisite Knowledge</a>. Especially if the above
sounds fantastic, but you aren&rsquo;t yet familiar with technology like Kubernetes or terms such as &ldquo;Game Servers&rdquo;.</li>
<li>Have a look at our <a href="https://codeblind.ai/docs/installation/">installation guides</a>, for setting up a Kubernetes cluster
and installing Code Blind on it.</li>
<li>Go through our <a href="https://codeblind.ai/docs/getting-started/">Quickstart Guides</a> to take you through setting up a simple game server on Code Blind.</li>
</ul>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-4934df4700679bf916824b3942c80835">2 - Prerequisite Knowledge</h1>
    <div class="lead">Foundational knowledge you should know before starting working with Code Blind.</div>
	<p>Code Blind is built on top of the foundation of multiple open source projects, as well as utilising
several architectural patterns across both distributed and multiplayer game systems &ndash; which can
make it complicated to get started with, if they are things you are not familiar with or have
experience with already.</p>
<p>To make getting started easier to break down and digest, this guide was written to outline what concepts and
technology that the documentation assumes that you have knowledge of, and the
depth of that knowledge, as well as providing resource to help fill those knowledge gaps.</p>
<h2 id="docker-and-containerisation">Docker and Containerisation</h2>
<p>Docker and containerisation is the technological foundation of Code Blind, so if you aren&rsquo;t familiar,
we recommend you have knowledge in the following areas before getting started with Code Blind:</p>
<ul>
<li>Containers as a concept</li>
<li>Running Docker containers</li>
<li>Building your own container</li>
<li>Registries as a concept</li>
<li>Pushing and pulling containers from a registry</li>
</ul>
<h3 id="resources">Resources</h3>
<p>The following resources are great for learning these concepts:</p>
<ul>
<li><a href="https://docs.docker.com/get-started/overview/">Docker Overview</a></li>
<li><a href="https://docs.docker.com/get-started/">Docker &ldquo;Quickstart&rdquo; guide</a></li>
</ul>
<h2 id="kubernetes">Kubernetes</h2>
<p>Kubernetes builds on top of Docker to run containers at scale, on lots of machines.
If you have yet to learn about Kubernetes, we recommend that you have knowledge in the following
areas before getting started with Code Blind:</p>
<ul>
<li>Kubernetes as a concept - you should take the <a href="https://kubernetes.io/docs/tutorials/kubernetes-basics/">basics tutorial</a></li>
<li>Pods</li>
<li>Deployments</li>
<li>Services</li>
<li>Creating a Deployment with a Service</li>
</ul>
<h3 id="mappings-in-code-blind">Mappings in Code Blind</h3>
<p>Code Blind extends the Kubernetes API to include new <a href="https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/">custom resources</a> such as <code>GameServer</code> and <code>Fleet</code>. See the <a href="https://agones.dev/docs/reference/">Reference documentation</a> for more information.</p>
<p>Code Blind creates a backing Pod with the appropriate configuration parameters for
each <code>GameServer</code> that is configured in a cluster. They both have the same name.</p>
<h3 id="resources-1">Resources</h3>
<ul>
<li><a href="https://cloud.google.com/kubernetes-engine/kubernetes-comic/">You should totally read this comic and interactive tutorial</a></li>
<li><a href="https://kubernetes.io/docs/concepts/">Kubernetes concepts, explained</a></li>
</ul>
<h2 id="dedicated-game-servers">Dedicated Game Servers</h2>
<p>Code Blind is a platform for dedicated game servers for multiplayer games. If &ldquo;dedicated game servers&rdquo; is a term that is not
something you are familiar with, we recommend checking out some of the resources below, before getting started with
Code Blind:</p>
<h3 id="resources-2">Resources</h3>
<ul>
<li><a href="https://www.youtube.com/watch?v=Nl_FIGFtYdc">Dedicated Game Servers, Drawn Badly (video)</a></li>
<li><a href="https://gafferongames.com/post/what_every_programmer_needs_to_know_about_game_networking/">What Every Programmer Needs To Know About Game Networking</a></li>
<li><a href="https://www.gabrielgambetta.com/client-server-game-architecture.html">Fast-Paced Multiplayer (Part I): Client-Server Game Architecture</a></li>
<li><a href="https://en.wikipedia.org/wiki/Game_server">Game Server (wikipedia)</a></li>
<li>
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>Example simple gameserver that responds to UDP and/or
 TCP commands</a></li>
</ul>
<h2 id="game-engine">Game Engine</h2>
<p>If you are building a multiplayer game, you will eventually need to understand how your
<a href="https://en.wikipedia.org/wiki/Game_engine">game engine</a> will integrate with Code Blind.
There are multiple possible solutions, but the engines that have out of the box SDK&rsquo;s for Code Blind are:</p>
<ul>
<li><a href="https://unity.com/">Unity</a></li>
<li><a href="https://www.unrealengine.com/">Unreal</a></li>
</ul>
<p>While you can integrate other engines with Code Blind, if you are new to developing on a game engine, you may want to
start with the above.</p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-6121397c9c1b82e0a74996f89313317c">3 - Install and configure Code Blind on Kubernetes</h1>
    <div class="lead">Instructions for creating a Kubernetes cluster and installing Code Blind.</div>
	<h2 id="usage-requirements">Usage Requirements</h2>
<ul>
<li><strong>Kubernetes cluster version 1.26, 1.27, 1.28</strong>
<ul>
<li><a href="https://cloud.google.com/kubernetes-engine/">Google Kubernetes Engine</a>,
<a href="https://azure.microsoft.com/en-us/services/kubernetes-service/">Azure Kubernetes Service</a>,
<a href="https://aws.amazon.com/eks/">Amazon EKS</a> and <a href="https://github.com/kubernetes/minikube">Minikube</a> are supported.</li>
<li>If you are creating and managing your own Kubernetes cluster, the
<a href="https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/#mutatingadmissionwebhook">MutatingAdmissionWebhook</a>, and
<a href="https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/#validatingadmissionwebhook">ValidatingAdmissionWebhook</a>
admission controllers are required.
<ul>
<li>We also recommend following the
<a href="https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/#is-there-a-recommended-set-of-admission-controllers-to-use">recommended set of admission controllers</a>.</li>
</ul>
</li>
</ul>
</li>
<li>Firewall access for the range of ports that Game Servers can be connected to in the cluster.</li>
<li>Game Servers must have the <a href="https://codeblind.ai/docs/guides/client-sdks/">game server SDK</a> integrated, to manage Game Server state, health checking, etc.</li>
</ul>


<div class="alert alert-warning" role="alert">
<h4 class="alert-heading">Warning</h4>

    This release has been tested against Kubernetes versions 1.26, 1.27, 1.28 on GKE. Other versions may work, but are unsupported. It is also likely that not all of these versions are supported by other cloud providers.

</div>

<h2 id="supported-container-architectures">Supported Container Architectures</h2>
<p>The following container operating systems and architectures can be utilised with Code Blind:</p>
<table>
<thead>
<tr>
<th>OS</th>
<th>Architecture</th>
<th>Support</th>
</tr>
</thead>
<tbody>
<tr>
<td>linux</td>
<td><code>amd64</code></td>
<td><strong>Stable</strong></td>
</tr>
<tr>
<td>linux</td>
<td><code>arm64</code></td>
<td>Alpha</td>
</tr>
<tr>
<td><a href="/docs/guides/windows-gameservers/">windows</a></td>
<td><code>amd64</code></td>
<td>Alpha</td>
</tr>
</tbody>
</table>
<p>For all the platforms in Alpha, we would appreciate testing and bug reports on any issue found.</p>
<h2 id="code-blind-and-kubernetes-supported-versions">Code Blind and Kubernetes Supported Versions</h2>
<p>Code Blind will support 3 releases of Kubernetes, targeting the newest version as being the <a href="https://cloud.google.com/kubernetes-engine/docs/release-notes#current_versions">latest available version in the GKE Rapid channel</a>. However, we will ensure that at least one of the 3 versions chosen for each Code Blind release is supported by each of the major cloud providers (EKS and AKS). The vendored version of client-go will be aligned with the middle of the three supported Kubernetes versions. When a new version of Code Blind supports new versions of Kubernetes, it is explicitly called out in the <a href="https://agones.dev/blog/releases/">release notes</a>.</p>
<p>The following table lists recent Code Blind versions and their corresponding required Kubernetes versions:</p>
<table>
<thead>
<tr>
<th>Code Blind version</th>
<th>Kubernetes version(s)</th>
</tr>
</thead>
<tbody>
<tr>
<td>1.38</td>
<td>1.26, 1.27, 1.28</td>
</tr>
<tr>
<td>1.37</td>
<td>1.26, 1.27, 1.28</td>
</tr>
<tr>
<td>1.36</td>
<td>1.26, 1.27, 1.28</td>
</tr>
<tr>
<td>1.35</td>
<td>1.25, 1.26, 1.27</td>
</tr>
<tr>
<td>1.34</td>
<td>1.25, 1.26, 1.27</td>
</tr>
<tr>
<td>1.33</td>
<td>1.25, 1.26, 1.27</td>
</tr>
<tr>
<td>1.32</td>
<td>1.24, 1.25, 1.26</td>
</tr>
<tr>
<td>1.31</td>
<td>1.24, 1.25, 1.26</td>
</tr>
<tr>
<td>1.30</td>
<td>1.23, 1.24, 1.25</td>
</tr>
<tr>
<td>1.29</td>
<td>1.24</td>
</tr>
<tr>
<td>1.28</td>
<td>1.23</td>
</tr>
<tr>
<td>1.27</td>
<td>1.23</td>
</tr>
<tr>
<td>1.26</td>
<td>1.23</td>
</tr>
<tr>
<td>1.25</td>
<td>1.22</td>
</tr>
<tr>
<td>1.24</td>
<td>1.22</td>
</tr>
<tr>
<td>1.23</td>
<td>1.22</td>
</tr>
<tr>
<td>1.22</td>
<td>1.21</td>
</tr>
<tr>
<td>1.21</td>
<td>1.21</td>
</tr>
</tbody>
</table>
<h2 id="separation-of-agones-from-gameserver-nodes">Best Practices</h2>
<!-- keep installation/#separation-of-agones-from-gameserver-nodes permalink -->
<p>For detailed guides on best practices running Code Blind in production, see <a href="/docs/guides/best-practices/">Best Practices</a>.</p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-6463ca879dc9c5ec43c8e77d4147e56c">3.1 - Create Kubernetes Cluster</h1>
    <div class="lead">Instructions for creating a Kubernetes cluster to install Code Blind on.</div>
	
</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-b64b5630d72ed25ece15506b5577563b">3.1.1 - Google Kubernetes Engine</h1>
    <div class="lead">Follow these steps to create a <a href="https://cloud.google.com/kubernetes-engine/">Google Kubernetes Engine (GKE)</a> cluster for your Code Blind install.</div>
	<h2 id="before-you-begin">Before you begin</h2>
<p>Take the following steps to enable the Kubernetes Engine API:</p>
<ol>
<li>Visit the <a href="https://console.cloud.google.com/kubernetes/list">Kubernetes Engine</a> page in the Google Cloud Platform Console.</li>
<li>Create or select a project.</li>
<li>Wait for the API and related services to be enabled. This can take several minutes.</li>
<li><a href="https://support.google.com/cloud/answer/6293499#enable-billing">Enable billing</a> for your project.</li>
</ol>
<ul>
<li>If you are not an existing GCP user, you may be able to enroll for a $300 US <a href="https://cloud.google.com/free/">Free Trial</a> credit.</li>
</ul>
<h3 id="choosing-a-shell">Choosing a shell</h3>
<p>To complete this quickstart, we can use either <a href="https://cloud.google.com/shell/">Google Cloud Shell</a> or a local shell.</p>
<p>Google Cloud Shell is a shell environment for managing resources hosted on Google Cloud Platform (GCP). Cloud Shell comes preinstalled with the <a href="https://cloud.google.com/sdk/gcloud/"><code>gcloud</code></a> and <a href="https://kubernetes.io/docs/reference/kubectl/"><code>kubectl</code></a> command-line tools. <code>gcloud</code> provides the primary command-line interface for GCP, and <code>kubectl</code> provides the command-line interface for running commands against Kubernetes clusters.</p>
<p>If you prefer using your local shell, you must install the <code>gcloud</code> and <code>kubectl</code> command-line tools in your environment.</p>
<h4 id="cloud-shell">Cloud shell</h4>
<p>To launch Cloud Shell, perform the following steps:</p>
<ol>
<li>Go to <a href="https://console.cloud.google.com/home/dashboard">Google Cloud Platform Console</a></li>
<li>From the top-right corner of the console, click the
<strong>Activate Google Cloud Shell</strong> button: <img alt="cloud shell" src="../../../../images/cloud-shell.png"></li>
<li>A Cloud Shell session opens inside a frame at the bottom of the console. Use this shell to run <code>gcloud</code> and <code>kubectl</code> commands.</li>
</ol>
<h4 id="local-shell">Local shell</h4>
<p>To install <code>gcloud</code> and <code>kubectl</code>, perform the following steps:</p>
<ol>
<li><a href="https://cloud.google.com/sdk/docs/quickstarts">Install the Google Cloud SDK</a>, which includes the <code>gcloud</code> command-line tool.</li>
<li>Initialize some default configuration by running the following command.
<ul>
<li>When asked <code>Do you want to configure a default Compute Region and Zone? (Y/n)?</code>, enter <code>Y</code> and choose a zone in your geographical region of choice.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcloud init
</span></span></code></pre></div></li>
<li>Install the <code>kubectl</code> command-line tool by running the following command:
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcloud components install kubectl
</span></span></code></pre></div></li>
</ol>
<h3 id="choosing-a-regional-or-zonal-cluster">Choosing a Regional or Zonal Cluster</h3>
<p>You will need to pick a geographical region or zone where you want to deploy your cluster, and whether to
create a <a href="https://cloud.google.com/kubernetes-engine/docs/concepts/types-of-clusters">regional or zonal cluster</a>.
We recommend using a Regional cluster, as the zonal GKE control plane can go down temporarily to adjust for cluster resizing,
<a href="https://cloud.google.com/kubernetes-engine/docs/concepts/cluster-upgrades">automatic upgrades</a> and
<a href="https://cloud.google.com/kubernetes-engine/docs/concepts/maintenance-windows-and-exclusions#repairs">repairs</a>.</p>
<p>After choosing a cluster type, <a href="https://cloud.google.com/compute/docs/regions-zones/#available">choose a region or zone</a>. The region you chose is <code>COMPUTE_REGION</code> below.
(Note that if you chose a zone, replace <code>--region=[COMPUTE_REGION]</code> with <code>--zone=[COMPUTE_ZONE]</code> in commands below.)</p>
<h3 id="choosing-a-release-channel-and-optional-version">Choosing a Release Channel and Optional Version</h3>
<p>We recommend using the <code>regular</code> release channel, which offers a balance between stability and freshness.
If you&rsquo;d like to read more, see our guide on <a href="https://codeblind.ai/docs/guides/best-practices/gke/#release-channels">Release Channels</a>.
The release channel you chose is <code>RELEASE_CHANNEL</code> below.</p>
<p>(Optional) During cluster creation, to set a specific available version in the release channel, use the <code>--cluster-version=[VERSION]</code> flag, e.g. <code>--cluster-version=1.27</code>. Be sure to choose a <a href="/docs/installation/#usage-requirements">version supported by Code Blind</a>. (If you rely on release channels, the latest Code Blind release <a href="/docs/installation/#agones-and-kubernetes-supported-versions">should be supported</a> by the default versions of all channels.)</p>
<h3 id="choosing-a-gke-cluster-mode">Choosing a GKE cluster mode</h3>
<p>A <a href="https://cloud.google.com/kubernetes-engine/docs/concepts/cluster-architecture">cluster</a> consists of at least one <em>control plane</em> machine and multiple worker machines called <em>nodes</em>. In Google Kubernetes Engine, nodes are <a href="https://cloud.google.com/compute/docs/instances/">Compute Engine virtual machine</a> instances that run the Kubernetes processes necessary to make them part of the cluster.</p>
<p>Code Blind supports both GKE Standard mode and GKE Autopilot mode.
Code Blind <code>GameServer</code> and <code>Fleet</code> manifests that work on Standard are compatible
on Autopilot with some constraints, described in the following section. We recommend
running GKE Autopilot clusters, if you meet the constraints.</p>
<p>You can&rsquo;t convert existing Standard clusters to Autopilot; create new Autopilot
clusters instead.</p>
<h4 id="code-blind-on-gke-autopilot">Code Blind on GKE Autopilot</h4>
<p>Autopilot is GKE&rsquo;s fully-managed mode. GKE configures, maintains, scales, and
upgrades nodes for you, which can reduce your maintenance and operating
overhead. You only pay for the resources requested by your running Pods, and
you don&rsquo;t pay for unused node capacity or Kubernetes system workloads.</p>
<p>This section describes the Code Blind-specific considerations in Autopilot
clusters. For a general comparison between Autopilot and Standard, refer to
<a href="https://cloud.google.com/kubernetes-engine/docs/concepts/choose-cluster-mode">Choose a GKE mode of operation</a>.</p>
<p>Autopilot nodes are, by default, optimized for most workloads. If some of your
workloads have broad compute requirements such as Arm architecture or a minimum
CPU platform, you can also choose a
<a href="https://cloud.google.com/kubernetes-engine/docs/concepts/autopilot-compute-classes">compute class</a>
that meets that requirement. However, if you have specialized hardware needs
that require fine-grained control over machine configuration, consider using
GKE Standard.</p>
<p>Code Blind on Autopilot has pre-configured opinionated constraints. Evaluate
whether these constraints impact your workloads:</p>
<ul>
<li><strong>Operating system:</strong> No Windows containers.</li>
<li><strong>Resource requests:</strong> Autopilot has pre-determined
<a href="https://cloud.google.com/kubernetes-engine/docs/concepts/autopilot-resource-requests#min-max-requests">minimum Pod resource requests</a>.
If your game servers require less than those minimums, use GKE Standard.</li>
<li><strong><a href="https://codeblind.ai/docs/advanced/scheduling-and-autoscaling/#fleet-scheduling">Scheduling strategy</a>:</strong>
<code>Packed</code> is supported, which is the Code Blind default. <code>Distributed</code> is not
supported.</li>
<li><strong><a href="https://codeblind.ai/docs/reference/agones_crd_api_reference/#agones.dev/v1.GameServerPort">Host port policy</a>:</strong> <code>Dynamic</code> is supported, which is the Code Blind default.
<code>Static</code> and <code>Passthrough</code> are not supported.</li>
<li><strong>Seccomp profile:</strong> Code Blind sets the seccomp profile to <code>Unconfined</code> to
avoid unexpected container creation delays that might occur because
Autopilot enables the
<a href="https://cloud.google.com/kubernetes-engine/docs/concepts/seccomp-in-gke"><code>RuntimeDefault</code> seccomp profile</a>.</li>
<li><strong><a href="https://codeblind.ai/docs/advanced/controlling-disruption/#eviction-api">Pod disruption policy</a>:</strong>
<code>eviction.safe: Never</code> is supported, which is the Code Blind
default. <code>eviction.safe: Always</code> is supported. <code>eviction.safe: OnUpgrade</code> is
not supported. If your game sessions exceed one hour, refer to
<a href="https://codeblind.ai/docs/advanced/controlling-disruption/#considerations-for-long-sessions">Considerations for long sessions</a>.</li>
</ul>
<h3 id="choosing-a-gcp-network">Choosing a GCP network</h3>
<p>By default, <code>gcloud</code> and the Cloud Console use the VPC named <code>default</code> for all new resources. If you
plan to create a <a href="https://cloud.google.com/kubernetes-engine/docs/how-to/alias-ips#dual-stack">dual-stack IPv4/IPv6 cluster</a> cluster, special considerations need to
be made. Dual-stack clusters require a <a href="https://cloud.google.com/vpc/docs/subnets#subnet-types">dual-stack subnet</a>, which are only supported in
<a href="https://cloud.google.com/vpc/docs/vpc#subnet-ranges"><em>custom mode</em></a> VPC networks. For a new dual-stack cluster, you can either:</p>
<ul>
<li>
<p>create a new <em>custom mode</em> VPC,</p>
</li>
<li>
<p>or if you wish to continue using the <code>default</code> network, you must <a href="https://cloud.google.com/vpc/docs/create-modify-vpc-networks#switch-network-mode">switch it to <em>custom mode</em></a>.
After switching a network to custom mode, you will need to manually manage subnets within the <code>default</code> VPC.</p>
</li>
</ul>
<p>Once you have a <em>custom mode</em> VPC, you will need to choose whether to use an existing subnet or create a
new one - read <a href="https://cloud.google.com/kubernetes-engine/docs/how-to/alias-ips#dual-stack">VPC-native guide on creating a dual-stack cluster</a>, but don&rsquo;t create the cluster
just yet - we&rsquo;ll create the cluster later in this guide. To use the network and/or subnetwork you just created,
you&rsquo;ll need to add <code>--network</code> and <code>--subnetwork</code>, and for GKE Standard, possibly <code>--stack-type</code> and
<code>--ipv6-access-type</code>, depending on whether you created the subnet simultaneously with the cluster.</p>
<h2 id="creating-the-firewall">Creating the firewall</h2>
<p>We need a firewall to allow UDP traffic to nodes tagged as <code>game-server</code> via ports 7000-8000. These firewall rules apply to cluster nodes you will create in the
next section.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcloud compute firewall-rules create game-server-firewall <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --allow udp:7000-8000 <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --target-tags game-server <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --description <span style="color:#4e9a06">&#34;Firewall to allow game server udp traffic&#34;</span>
</span></span></code></pre></div><h2 id="creating-the-cluster">Creating the cluster</h2>
<p>Create a GKE cluster in which you&rsquo;ll install Code Blind. You can use
<a href="/docs/installation/creating-cluster/gke/#create-a-standard-mode-cluster-for-agones">GKE Standard mode</a>
or <a href="/docs/installation/creating-cluster/gke/#create-an-autopilot-mode-cluster-for-agones">GKE Autopilot mode</a>.</p>
<h3 id="create-a-standard-mode-cluster-for-code-blind">Create a Standard mode cluster for Code Blind</h3>
<p>Create the cluster:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcloud container clusters create <span style="color:#ce5c00;font-weight:bold">[</span>CLUSTER_NAME<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --region<span style="color:#ce5c00;font-weight:bold">=[</span>COMPUTE_REGION<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --release-channel<span style="color:#ce5c00;font-weight:bold">=[</span>RELEASE_CHANNEL<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --tags<span style="color:#ce5c00;font-weight:bold">=</span>game-server <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --scopes<span style="color:#ce5c00;font-weight:bold">=</span>gke-default <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --num-nodes<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">4</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --enable-image-streaming <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --machine-type<span style="color:#ce5c00;font-weight:bold">=</span>e2-standard-4
</span></span></code></pre></div><p>Replace the following:</p>
<ul>
<li><code>[CLUSTER_NAME]</code>: The name of the cluster you want to create</li>
<li><code>[COMPUTE_REGION]</code>: The GCP region to create the cluster in, <a href="/docs/installation/creating-cluster/gke/#choosing-a-gke-cluster-mode">chosen above</a></li>
<li><code>[RELEASE_CHANNEL]</code>: The GKE release channel, <a href="/docs/installation/creating-cluster/gke/#choosing-a-release-channel-and-optional-version">chosen above</a></li>
</ul>
<p>Flag explanations:</p>
<ul>
<li><code>--region</code>: The compute region <a href="/docs/installation/creating-cluster/gke/#choosing-a-gke-cluster-mode">you chose above</a>.</li>
<li><code>--release-channel</code>: The release channel <a href="/docs/installation/creating-cluster/gke/#choosing-a-release-channel-and-optional-version">you chose above</a>.</li>
<li><code>--tags</code>: Defines the tags that will be attached to new nodes in the cluster. This is to grant access through ports via the <a href="/docs/installation/creating-cluster/gke/#creating-the-firewall">firewall created above</a>.</li>
<li><code>--scopes</code>: Defines the Oauth scopes required by the nodes.</li>
<li><code>--num-nodes</code>: The number of nodes to be created in each of the cluster&rsquo;s zones. Default: 4. Depending on the needs of your game, this parameter should be adjusted.</li>
<li><code>--enable-image-streaming</code>: Use <a href="https://cloud.google.com/kubernetes-engine/docs/how-to/image-streaming">Image streaming</a> to pull container images, which leads to significant improvements in initialization times. <a href="https://cloud.google.com/kubernetes-engine/docs/how-to/image-streaming#limitations">Limitations</a> apply to enable this feature.</li>
<li><code>--machine-type</code>: The type of machine to use for nodes. Default: <code>e2-standard-4</code>. Depending on the needs of your game, you may wish to <a href="https://cloud.google.com/compute/docs/machine-types">have smaller or larger machines</a>.</li>
</ul>
<h4 id="optional-creating-a-dedicated-node-pool">(Optional) Creating a dedicated node pool</h4>
<p>Create a <a href="https://cloud.google.com/kubernetes-engine/docs/concepts/node-pools">dedicated node pool</a>
for the Code Blind resources to be installed in. If you skip this step, the Code Blind controllers will
share the default node pool with your game servers, which is fine for experimentation but not
recommended for a production deployment.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcloud container node-pools create agones-system <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --cluster<span style="color:#ce5c00;font-weight:bold">=[</span>CLUSTER_NAME<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --region<span style="color:#ce5c00;font-weight:bold">=[</span>COMPUTE_REGION<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --node-taints agones.dev/agones-system<span style="color:#ce5c00;font-weight:bold">=</span>true:NoExecute <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --node-labels agones.dev/agones-system<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --num-nodes<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --machine-type<span style="color:#ce5c00;font-weight:bold">=</span>e2-standard-4
</span></span></code></pre></div><p>Replace the following:</p>
<ul>
<li><code>[CLUSTER_NAME]</code>: The name of the cluster you created</li>
<li><code>[COMPUTE_REGION]</code>: The GCP region to create the cluster in, <a href="/docs/installation/creating-cluster/gke/#choosing-a-gke-cluster-mode">chosen above</a></li>
</ul>
<p>Flag explanations:</p>
<ul>
<li><code>--cluster</code>: The name of the cluster you created.</li>
<li><code>--region</code>: The compute region <a href="/docs/installation/creating-cluster/gke/#choosing-a-gke-cluster-mode">you chose above</a>.</li>
<li><code>--node-taints</code>: The Kubernetes taints to automatically apply to nodes in this node pool.</li>
<li><code>--node-labels</code>: The Kubernetes labels to automatically apply to nodes in this node pool.</li>
<li><code>--num-nodes</code>: The number of nodes per cluster zone. For regional clusters, <code>--num-nodes=1</code> creates one node in 3 separate zones in the region, giving you faster recovery time in the event of a node failure.</li>
<li><code>--machine-type</code>: The type of machine to use for nodes. Default: <code>e2-standard-4</code>. Depending on the needs of your game, you may wish to <a href="https://cloud.google.com/compute/docs/machine-types">have smaller or larger machines</a>.</li>
</ul>
<h4 id="optional-creating-a-metrics-node-pool">(Optional) Creating a metrics node pool</h4>
<p>Create a node pool for <a href="/docs/guides/metrics/">Metrics</a> if you want to monitor the
Code Blind system using Prometheus with Grafana or Cloud Logging and Monitoring.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcloud container node-pools create agones-metrics <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --cluster<span style="color:#ce5c00;font-weight:bold">=[</span>CLUSTER_NAME<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --region<span style="color:#ce5c00;font-weight:bold">=[</span>COMPUTE_REGION<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --node-taints agones.dev/agones-metrics<span style="color:#ce5c00;font-weight:bold">=</span>true:NoExecute <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --node-labels agones.dev/agones-metrics<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --num-nodes<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --machine-type<span style="color:#ce5c00;font-weight:bold">=</span>e2-standard-4
</span></span></code></pre></div><p>Replace the following:</p>
<ul>
<li><code>[CLUSTER_NAME]</code>: The name of the cluster you created</li>
<li><code>[COMPUTE_REGION]</code>: The GCP region to create the cluster in, <a href="/docs/installation/creating-cluster/gke/#choosing-a-gke-cluster-mode">chosen above</a></li>
</ul>
<p>Flag explanations:</p>
<ul>
<li><code>--cluster</code>: The name of the cluster you created.</li>
<li><code>--region</code>: The compute region <a href="/docs/installation/creating-cluster/gke/#choosing-a-gke-cluster-mode">you chose above</a>.</li>
<li><code>--node-taints</code>: The Kubernetes taints to automatically apply to nodes in this node pool.</li>
<li><code>--node-labels</code>: The Kubernetes labels to automatically apply to nodes in this node pool.</li>
<li><code>--num-nodes</code>: The number of nodes per cluster zone. For regional clusters, <code>--num-nodes=1</code> creates one node in 3 separate zones in the region, giving you faster recovery time in the event of a node failure.</li>
<li><code>--machine-type</code>: The type of machine to use for nodes. Default: <code>e2-standard-4</code>. Depending on the needs of your game, you may wish to <a href="https://cloud.google.com/compute/docs/machine-types">have smaller or larger machines</a>.</li>
</ul>
<h4 id="optional-creating-a-node-pool-for-windows">(Optional) Creating a node pool for Windows</h4>
<p>If you run game servers on Windows, you
need to create a dedicated node pool for those servers. Windows Server 2019 (<code>WINDOWS_LTSC_CONTAINERD</code>) is the recommended image for Windows
game servers.</p>


<div class="alert alert-warning" role="alert">
<h4 class="alert-heading">Warning</h4>

    Running <code>GameServers</code> on Windows nodes is currently Alpha. Feel free to file feedback
through <a href="https://github.com/googleforgames/agones/issues">Github issues</a>.

</div>

<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcloud container node-pools create windows <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --cluster<span style="color:#ce5c00;font-weight:bold">=[</span>CLUSTER_NAME<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --region<span style="color:#ce5c00;font-weight:bold">=[</span>COMPUTE_REGION<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --image-type WINDOWS_LTSC_CONTAINERD <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --machine-type e2-standard-4 <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --num-nodes<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">4</span>
</span></span></code></pre></div><p>Replace the following:</p>
<ul>
<li><code>[CLUSTER_NAME]</code>: The name of the cluster you created</li>
<li><code>[COMPUTE_REGION]</code>: The GCP region to create the cluster in, <a href="/docs/installation/creating-cluster/gke/#choosing-a-gke-cluster-mode">chosen above</a></li>
</ul>
<p>Flag explanations:</p>
<ul>
<li><code>--cluster</code>: The name of the cluster you created.</li>
<li><code>--region</code>: The compute region <a href="/docs/installation/creating-cluster/gke/#choosing-a-gke-cluster-mode">you chose above</a>.</li>
<li><code>--image-type</code>: The image type of the instances in the node pool - <code>WINDOWS_LTSC_CONTAINERD</code> in this case.</li>
<li><code>--machine-type</code>: The type of machine to use for nodes. Default: <code>e2-standard-4</code>. Depending on the needs of your game, you may wish to <a href="https://cloud.google.com/compute/docs/machine-types">have smaller or larger machines</a>.</li>
<li><code>--num-nodes</code>: The number of nodes per cluster zone. For regional clusters, <code>--num-nodes=1</code> creates one node in 3 separate zones in the region, giving you faster recovery time in the event of a node failure.</li>
</ul>
<h3 id="create-an-autopilot-mode-cluster-for-code-blind">Create an Autopilot mode cluster for Code Blind</h3>


<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Note</h4>

    These installation instructions apply to Code Blind 1.30+

</div>

<ol>
<li>
<p>Choose a <a href="https://codeblind.ai/docs/guides/best-practices/gke/#release-channels">Release Channel</a> (Autopilot clusters must be on a Release Channel).</p>
</li>
<li>
<p>Create the cluster:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcloud container clusters create-auto <span style="color:#ce5c00;font-weight:bold">[</span>CLUSTER_NAME<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --region<span style="color:#ce5c00;font-weight:bold">=[</span>COMPUTE_REGION<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --release-channel<span style="color:#ce5c00;font-weight:bold">=[</span>RELEASE_CHANNEL<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --autoprovisioning-network-tags<span style="color:#ce5c00;font-weight:bold">=</span>game-server
</span></span></code></pre></div></li>
</ol>
<p>Replace the following:</p>
<ul>
<li><code>[CLUSTER_NAME]</code>: The name of your cluster.</li>
<li><code>[COMPUTE_REGION]</code>: the GCP region to create the cluster in.</li>
<li><code>[RELEASE_CHANNEL]</code>: one of <code>rapid</code>, <code>regular</code>, or <code>stable</code>, chosen <a href="/docs/installation/creating-cluster/gke/#choosing-a-release-channel-and-optional-version">above</a>. The default is <code>regular</code>.</li>
</ul>
<p>Flag explanations:</p>
<ul>
<li><code>--region</code>: The compute region <a href="/docs/installation/creating-cluster/gke/#choosing-a-gke-cluster-mode">you chose above</a>.</li>
<li><code>--release-channel</code>: The release channel <a href="/docs/installation/creating-cluster/gke/#choosing-a-release-channel-and-optional-version">you chose above</a>.</li>
<li><code>--autoprovisioning-network-tags</code>: Defines the tags that will be attached to new nodes in the cluster. This is to grant access through ports via the <a href="/docs/installation/creating-cluster/gke/#creating-the-firewall">firewall created above</a>.</li>
</ul>
<h2 id="setting-up-cluster-credentials">Setting up cluster credentials</h2>
<p><code>gcloud container clusters create</code> configurates credentials for <code>kubectl</code> automatically. If you ever lose those, run:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcloud container clusters get-credentials <span style="color:#ce5c00;font-weight:bold">[</span>CLUSTER_NAME<span style="color:#ce5c00;font-weight:bold">]</span> --region<span style="color:#ce5c00;font-weight:bold">=[</span>COMPUTE_REGION<span style="color:#ce5c00;font-weight:bold">]</span>
</span></span></code></pre></div><h2 id="next-steps">Next Steps</h2>
<ul>
<li>Continue to <a href="/docs/installation/install-agones/">Install Code Blind</a>.</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-b92bbfd1ff6d688fa054f083c1f4c981">3.1.2 - Amazon Elastic Kubernetes Service</h1>
    <div class="lead">Follow these steps to create an <a href="https://aws.amazon.com/eks/">Amazon Elastic Kubernetes Service (EKS)</a> cluster for your Code Blind install.</div>
	<p>Create your EKS Cluster using the <a href="https://docs.aws.amazon.com/eks/latest/userguide/getting-started.html">Getting Started Guide</a>.</p>
<p>Possible steps are the following:</p>
<ol>
<li>Create new IAM role for cluster management.</li>
<li>Run <code>aws configure</code> to authorize your <code>awscli</code> with proper <code>AWS Access Key ID</code> and <code>AWS Secret Access Key</code>.</li>
<li>Create an example cluster:</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>eksctl create cluster <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>--name prod <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>--version 1.28 <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>--nodegroup-name standard-workers <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>--node-type t3.medium <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>--nodes <span style="color:#0000cf;font-weight:bold">3</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>--nodes-min <span style="color:#0000cf;font-weight:bold">3</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>--nodes-max <span style="color:#0000cf;font-weight:bold">4</span>
</span></span></code></pre></div>

<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Note</h4>

    EKS does not use the normal Kubernetes networking since it
is <a href="https://itnext.io/kubernetes-is-hard-why-eks-makes-it-easier-for-network-and-security-architects-ea6d8b2ca965">incompatible with Amazon VPC networking</a>.

</div>

<h2 id="allowing-udp-traffic">Allowing UDP Traffic</h2>
<p>For Code Blind to work correctly, we need to allow UDP traffic to pass through to our EKS cluster worker nodes. To achieve this, we must update the workers&rsquo; nodepool SG (Security Group) with the proper rule. A simple way to do that is:</p>
<ul>
<li>Log in to the AWS Management Console</li>
<li>Go to the VPC Dashboard and select <strong>Security Groups</strong></li>
<li>Find the Security Group for the workers nodepool, which will be named something like <code>eksctl-[cluster-name]-nodegroup-[cluster-name]-workers/SG</code></li>
<li>Select <strong>Inbound Rules</strong></li>
<li><strong>Edit Rules</strong> to add a new <strong>Custom UDP Rule</strong> with a 7000-8000 port range and an appropriate <strong>Source</strong> CIDR range (<code>0.0.0.0/0</code> allows all traffic)</li>
</ul>
<h2 id="next-steps">Next Steps</h2>
<ul>
<li>Continue to <a href="/docs/installation/install-agones/">Install Code Blind</a>.</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-5794c6009fa81061fd16c966496f5f31">3.1.3 - Azure Kubernetes Service</h1>
    <div class="lead">Follow these steps to create an <a href="https://docs.microsoft.com/azure/aks/">Azure Kubernetes Service (AKS) </a> cluster  for your Code Blind install.</div>
	<h2 id="choosing-your-shell">Choosing your shell</h2>
<p>You can use either <a href="https://docs.microsoft.com/azure/cloud-shell/overview">Azure Cloud Shell</a> or install the <a href="https://docs.microsoft.com/cli/azure/?view=azure-cli-latest">Azure CLI</a> on your local shell in order to install AKS in your own Azure subscription. Cloud Shell comes preinstalled with <code>az</code> and <code>kubectl</code> utilities whereas you need to install them locally if you want to use your local shell. If you use Windows 10, you can use the <a href="https://docs.microsoft.com/windows/wsl/install-win10">WIndows Subsystem for Windows</a> as well.</p>
<h2 id="creating-the-aks-cluster">Creating the AKS cluster</h2>
<p>If you are using Azure CLI from your local shell, you need to log in to your Azure account by executing the <code>az login</code> command and following the login procedure.</p>
<p>Here are the steps you need to follow to create a new AKS cluster (additional instructions and clarifications are listed <a href="https://docs.microsoft.com/azure/aks/kubernetes-walkthrough">here</a>):</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Declare necessary variables, modify them according to your needs</span>
</span></span><span style="display:flex;"><span><span style="color:#000">AKS_RESOURCE_GROUP</span><span style="color:#ce5c00;font-weight:bold">=</span>akstestrg     <span style="color:#8f5902;font-style:italic"># Name of the resource group your AKS cluster will be created in</span>
</span></span><span style="display:flex;"><span><span style="color:#000">AKS_NAME</span><span style="color:#ce5c00;font-weight:bold">=</span>akstest                 <span style="color:#8f5902;font-style:italic"># Name of your AKS cluster</span>
</span></span><span style="display:flex;"><span><span style="color:#000">AKS_LOCATION</span><span style="color:#ce5c00;font-weight:bold">=</span>westeurope          <span style="color:#8f5902;font-style:italic"># Azure region in which you&#39;ll deploy your AKS cluster</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Create the Resource Group where your AKS resource will be installed</span>
</span></span><span style="display:flex;"><span>az group create --name <span style="color:#000">$AKS_RESOURCE_GROUP</span> --location <span style="color:#000">$AKS_LOCATION</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Create the AKS cluster - this might take some time. Type &#39;az aks create -h&#39; to see all available options</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># The following command will create a four Node AKS cluster. Node size is Standard A1 v1 and Kubernetes version is 1.28.0. Plus, SSH keys will be generated for you, use --ssh-key-value to provide your values</span>
</span></span><span style="display:flex;"><span>az aks create --resource-group <span style="color:#000">$AKS_RESOURCE_GROUP</span> --name <span style="color:#000">$AKS_NAME</span> --node-count <span style="color:#0000cf;font-weight:bold">4</span> --generate-ssh-keys --node-vm-size Standard_A4_v2 --kubernetes-version 1.28.0 --enable-node-public-ip
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Install kubectl</span>
</span></span><span style="display:flex;"><span>sudo az aks install-cli
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Get credentials for your new AKS cluster</span>
</span></span><span style="display:flex;"><span>az aks get-credentials --resource-group <span style="color:#000">$AKS_RESOURCE_GROUP</span> --name <span style="color:#000">$AKS_NAME</span>
</span></span></code></pre></div><p>Alternatively, you can use the <a href="https://portal.azure.com">Azure Portal</a> to create a new AKS cluster <a href="https://docs.microsoft.com/azure/aks/kubernetes-walkthrough-portal">(instructions)</a>.</p>
<h3 id="allowing-udp-traffic">Allowing UDP traffic</h3>
<p>For Code Blind to work correctly, we need to allow UDP traffic to pass through to our AKS cluster. To achieve this, we must update the NSG (Network Security Group) with the proper rule. A simple way to do that is:</p>
<ul>
<li>Log in to the <a href="https://portal.azure.com/">Azure Portal</a></li>
<li>Find the resource group where the AKS(Azure Kubernetes Service) resources are kept, which should have a name like <code>MC_resourceGroupName_AKSName_westeurope</code>. Alternative, you can type <code>az resource show --namespace Microsoft.ContainerService --resource-type managedClusters -g $AKS_RESOURCE_GROUP -n $AKS_NAME -o json | jq .properties.nodeResourceGroup</code></li>
<li>Find the Network Security Group object, which should have a name like <code>aks-agentpool-********-nsg</code> (ie. aks-agentpool-55978144-nsg for dns-name-prefix agones)</li>
<li>Select <strong>Inbound Security Rules</strong></li>
<li>Select <strong>Add</strong> to create a new Rule with <strong>UDP</strong> as the protocol and <strong>7000-8000</strong> as the Destination Port Ranges. Pick a proper name and leave everything else at their default values</li>
</ul>
<p>Alternatively, you can use the following command, after modifying the <code>RESOURCE_GROUP_WITH_AKS_RESOURCES</code> and <code>NSG_NAME</code> values:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>az network nsg rule create <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --resource-group RESOURCE_GROUP_WITH_AKS_RESOURCES <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --nsg-name NSG_NAME <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --name AgonesUDP <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --access Allow <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --protocol Udp <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --direction Inbound <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --priority <span style="color:#0000cf;font-weight:bold">520</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --source-port-range <span style="color:#4e9a06">&#34;*&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --destination-port-range 7000-8000
</span></span></code></pre></div><h3 id="getting-public-ips-to-nodes">Getting Public IPs to Nodes</h3>
<h4 id="kubernetes-version-prior-to-11819-11911-and-1207">Kubernetes version prior to 1.18.19, 1.19.11 and 1.20.7</h4>
<p>To find a resource&rsquo;s public IP, search for <a href="https://portal.azure.com/#blade/HubsExtension/BrowseResourceBlade/resourceType/Microsoft.Compute%2FvirtualMachineScaleSets">Virtual Machine Scale Sets</a> -&gt; click on the set name(inside  <code>MC_resourceGroupName_AKSName_westeurope</code> group) -&gt; click <code>Instances</code> -&gt; click on the instance name -&gt; view <code>Public IP address</code>.</p>
<p>To get public IP via API <a href="https://github.com/Azure/azure-libraries-for-net/issues/1185#issuecomment-747919226">look here</a>.</p>
<p>For more information on Public IPs for VM NICs, see <a href="https://docs.microsoft.com/azure/virtual-network/virtual-network-network-interface-addresses">this document</a>.</p>
<h4 id="kubernetes-version-starting-11819-11911-and-1207">Kubernetes version starting 1.18.19, 1.19.11 and 1.20.7</h4>
<p>Virtual Machines public IP is available directly in Kubernetes EXTERNAL-IP.</p>
<h2 id="next-steps">Next Steps</h2>
<ul>
<li>Continue to <a href="/docs/installation/install-agones/">Install Code Blind</a>.</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-bda448e72a77dd8564f18c2084b5c5eb">3.1.4 - Minikube</h1>
    <div class="lead">Follow these steps to create a <a href="https://github.com/kubernetes/minikube">Minikube</a> cluster for your Code Blind install.</div>
	<h2 id="installing-minikube">Installing Minikube</h2>
<p>First, <a href="https://minikube.sigs.k8s.io/docs/start/">install Minikube</a>, which may also require you to install
a virtualisation solution, such as <a href="https://www.virtualbox.org">VirtualBox</a> as well.</p>
<h2 id="starting-minikube">Starting Minikube</h2>
<p>Minikube will need to be started with the supported version of Kubernetes that is supported with Code Blind, via the
<code>--kubernetes-version</code> command line flag.</p>
<p>Optionally, we also recommend starting with an <code>agones</code> profile, using <code>-p</code> to keep this cluster separate from any other
clusters you may have running with Minikube.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>minikube start --kubernetes-version v1.27.6 -p agones
</span></span></code></pre></div><p>Check the official <a href="https://minikube.sigs.k8s.io/docs/commands/start/">minikube start</a> reference for more options that
may be required for your platform of choice.</p>


<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Note</h4>

    <p>You may need to increase the <code>--cpu</code> or <code>--memory</code> values for your minikube instance, depending on what resources are
available on the host and/or how many GameServers you wish to run locally.</p>
<p>Depending on your Operating System, you may also need to change the <code>--driver</code>
(<a href="https://minikube.sigs.k8s.io/docs/drivers/">driver list</a>) to enable <code>GameServer</code> connectivity with or without
some workarounds listed below.</p>


</div>

<h3 id="known-working-drivers">Known working drivers</h3>
<p>Other operating systems and drivers may work, but at this stage have not been verified to work with UDP connections
via Code Blind exposed ports.</p>
<p><strong>Linux (amd64)</strong></p>
<ul>
<li>Docker (default)</li>
<li>kvm2</li>
</ul>
<p><strong>Mac (amd64)</strong></p>
<ul>
<li>Docker (default)</li>
<li>Hyperkit</li>
</ul>
<p><strong>Windows (amd64)</strong></p>
<ul>
<li>hyper-v (might need
<a href="https://blog.thepolyglotprogrammer.com/setting-up-kubernetes-on-wsl-to-work-with-minikube-on-windows-10-90dac3c72fa1">this blog post</a>
and/or <a href="https://github.com/microsoft/WSL/issues/4288#issuecomment-652259640">this comment</a> for WSL support)</li>
</ul>
<p><em>If you have successfully tested with other platforms and drivers, please click &ldquo;edit this page&rdquo; in the top right hand
side and submit a pull request to let us know.</em></p>
<h2 id="local-connection-workarounds">Local connection workarounds</h2>
<p>Depending on your operating system and virtualization platform that you are using with Minikube, it may not be
possible to connect directly to a <code>GameServer</code> hosted on Code Blind as you would on a cloud hosted Kubernetes cluster.</p>
<p>If you are unable to do so, the following workarounds are available, and may work on your platform:</p>
<h3 id="minikube-ip">minikube ip</h3>
<p>Rather than using the published IP of a <code>GameServer</code> to connect, run <code>minikube ip -p agones</code> to get the local IP for
the minikube node, and connect to that address.</p>
<h3 id="create-a-service">Create a service</h3>
<p>This would only be for local development, but if none of the other workarounds work, creating a Service for the
<code>GameServer</code> you wish to connect to is a valid solution, to tunnel traffic to the appropriate GameServer container.</p>
<p>Use the following yaml:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Service</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">agones-gameserver</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">LoadBalancer</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">selector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">agones.dev/gameserver</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">${GAMESERVER_NAME}</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">ports</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">protocol</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">UDP</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">port</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">7000</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># local port</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">targetPort</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">${GAMESERVER_CONTAINER_PORT}</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>Where <code>${GAMESERVER_NAME}</code> is replaced with the GameServer you wish to connect to, and <code>${GAMESERVER_CONTAINER_PORT}</code>
is replaced with the container port GameServer exposes for connection.</p>
<p>Running <code>minikube service list -p agones</code> will show you the IP and port to connect to locally in the <code>URL</code> field.</p>
<p>To connect to a different <code>GameServer</code>, run <code>kubectl edit service agones-gameserver</code> and edit the <code>${GAMESERVER_NAME}</code>
value to point to the new <code>GameServer</code> instance and/or the <code>${GAMESERVER_CONTAINER_PORT}</code> value as appropriate.</p>


<div class="alert alert-warning" role="alert">
<h4 class="alert-heading">Warning</h4>

    <code>minikube tunnel</code> (<a href="https://minikube.sigs.k8s.io/docs/handbook/accessing/">docs</a>)
does not support UDP (<a href="https://github.com/kubernetes/minikube/issues/12362">Github Issue</a>) on some combination of
operating system, platforms and drivers, but is required when using the <code>Service</code> workaround.

</div>

<h3 id="use-a-different-driver">Use a different driver</h3>
<p>If you cannot connect through the <code>Service</code>or use other workarounds, you may want to try a different
<a href="https://minikube.sigs.k8s.io/docs/drivers/">minikube driver</a>, and if that doesn&rsquo;t work, connection via UDP may not
be possible with minikube, and you may want to try either a
<a href="https://kubernetes.io/docs/tasks/tools/">different local Kubernetes tool</a> or use a cloud hosted Kubernetes cluster.</p>
<h2 id="next-steps">Next Steps</h2>
<ul>
<li>Continue to <a href="/docs/installation/install-agones/">Install Code Blind</a>.</li>
</ul>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-f20510043e9f53d4f75643e9f0fd06f2">3.2 - Install Code Blind</h1>
    <div class="lead">Install Code Blind in your existing Kubernetes cluster.</div>
	<p>If you have not yet created a cluster, <a href="https://codeblind.ai/docs/installation/creating-cluster/">follow the instructions</a>
for the environment where you will be running Code Blind.</p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-17a026f94c4ced8dd23deeb10b25eab5">3.2.1 - Install Code Blind using YAML</h1>
    <div class="lead">We can install Code Blind to the cluster using an install.yaml file.</div>
	<h2 id="installing-code-blind">Installing Code Blind</h2>


<div class="alert alert-warning" role="alert">
<h4 class="alert-heading">Warning</h4>

    <p>Installing Code Blind with the <code>install.yaml</code> file will use pre-generated, well known TLS
certificates stored in this repository for securing Kubernetes webhooks communication.</p>
<p>For production workloads, we <strong>strongly</strong> recommend using the
<a href="/docs/installation/install-agones/helm/">helm installation</a> which allows you to generate
new, unique certificates or provide your own certificates. Alternatively,
you can use <code>helm template</code> as described <a href="/#customizing-your-install">below</a>
to generate a custom yaml installation file with unique certificates.</p>


</div>

<p>Installing Code Blind using the pre-generated <code>install.yaml</code> file is the quickest,
simplest way to get Code Blind up and running in your Kubernetes cluster:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl create namespace agones-system
</span></span><span style="display:flex;"><span>kubectl apply --server-side -f https://raw.githubusercontent.com/googleforgames/agones/release-1.38.0/install/yaml/install.yaml
</span></span></code></pre></div><p>You can also find the <code>install.yaml</code> in the latest <code>agones-install</code> zip from the <a href="https://github.com/googleforgames/agones/releases">releases</a> archive.</p>
<h3 id="customizing-your-install">Customizing your install</h3>
<p>To change the <a href="https://agones.dev/docs/installation/install-agones/helm/#configuration">configurable parameters</a>
in the <code>install.yaml</code> file, you can use <code>helm template</code> to generate a custom file locally
without needing to use helm to install Code Blind into your cluster.</p>
<p>The following example sets the <code>featureGates</code> and <code>generateTLS</code> helm parameters
and creates a customized <code>install-custom.yaml</code> file (note that the <code>pull</code>
command was introduced in Helm version 3):</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>helm pull --untar https://agones.dev/chart/stable/agones-1.38.0.tgz <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span><span style="color:#204a87">cd</span> agones <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>helm template agones-manual --namespace agones-system  . <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --set agones.controller.generateTLS<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">false</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --set agones.allocator.generateTLS<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">false</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --set agones.allocator.generateClientTLS<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">false</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --set agones.crds.cleanupOnDelete<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">false</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --set agones.featureGates<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;PlayerTracking=true&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  &gt; install-custom.yaml
</span></span></code></pre></div><h2 id="uninstalling-code-blind">Uninstalling Code Blind</h2>
<p>To uninstall/delete the <code>Code Blind</code> deployment and delete <code>agones-system</code> namespace:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl delete fleets --all --all-namespaces
</span></span><span style="display:flex;"><span>kubectl delete gameservers --all --all-namespaces
</span></span><span style="display:flex;"><span>kubectl delete -f https://raw.githubusercontent.com/googleforgames/agones/release-1.38.0/install/yaml/install.yaml
</span></span><span style="display:flex;"><span>kubectl delete namespace agones-system
</span></span></code></pre></div><p>Note: It may take a couple of minutes until all resources described in <code>install.yaml</code> file are deleted.</p>
<h2 id="next-steps">Next Steps</h2>
<ul>
<li><a href="/docs/installation/confirm/">Confirm Code Blind is up and running</a></li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-3b82ee7f1edc04e876dc785596385caa">3.2.2 - Install Code Blind using Helm</h1>
    <div class="lead">Install Code Blind on a <a href="http://kubernetes.io">Kubernetes</a> cluster using the <a href="https://helm.sh">Helm</a> package manager.</div>
	<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li><a href="https://helm.sh/">Helm</a> package manager 3.2.3+</li>
<li><a href="/docs/installation/#usage-requirements">Supported Kubernetes Cluster</a></li>
</ul>
<h2 id="helm-3">Helm 3</h2>
<h3 id="installing-the-chart">Installing the Chart</h3>
<p>To install the chart with the release name <code>my-release</code> using our stable helm repository:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>helm repo add agones https://agones.dev/chart/stable
</span></span><span style="display:flex;"><span>helm repo update
</span></span><span style="display:flex;"><span>helm install my-release --namespace agones-system --create-namespace agones/agones
</span></span></code></pre></div><p><em>We recommend installing Code Blind in its own namespaces, such as <code>agones-system</code> as shown above.
If you want to use a different namespace, you can use the helm <code>--namespace</code> parameter to specify.</em></p>
<p>When running in production, Code Blind should be scheduled on a dedicated pool of nodes, distinct from where Game Servers are scheduled for better isolation and resiliency. By default Code Blind prefers to be scheduled on nodes labeled with <code>agones.dev/agones-system=true</code> and tolerates node taint <code>agones.dev/agones-system=true:NoExecute</code>. If no dedicated nodes are available, Code Blind will
run on regular nodes, but that&rsquo;s not recommended for production use. For instructions on setting up a dedicated node
pool for Code Blind, see the <a href="/docs/installation/">Code Blind installation instructions</a> for your preferred environment.</p>
<p>The command deploys Code Blind on the Kubernetes cluster with the default configuration. The <a href="/docs/installation/install-agones/helm/#configuration">configuration</a> section lists the parameters that can be configured during installation.</p>


<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Tip</h4>

    List all releases using <code>helm list --all-namespaces</code>

</div>

<h3 id="namespaces">Namespaces</h3>
<p>By default Code Blind is configured to work with game servers deployed in the <code>default</code> namespace. If you are planning to use another namespace you can configure Code Blind via the parameter <code>gameservers.namespaces</code>.</p>
<p>For example to use <code>default</code> <strong>and</strong> <code>xbox</code> namespaces:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl create namespace xbox
</span></span><span style="display:flex;"><span>helm install my-release agones/agones --set <span style="color:#4e9a06">&#34;gameservers.namespaces={default,xbox}&#34;</span> --namespace agones-system
</span></span></code></pre></div>

<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Note</h4>

    You need to create your namespaces before installing Code Blind.

</div>

<p>If you want to add a new namespace afterward upgrade your release:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl create namespace ps4
</span></span><span style="display:flex;"><span>helm upgrade my-release agones/agones --reuse-values --set <span style="color:#4e9a06">&#34;gameservers.namespaces={default,xbox,ps4}&#34;</span> --namespace agones-system
</span></span></code></pre></div><h3 id="uninstalling-the-chart">Uninstalling the Chart</h3>
<p>To uninstall/delete the <code>my-release</code> deployment:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>helm uninstall my-release --namespace<span style="color:#ce5c00;font-weight:bold">=</span>agones-system
</span></span></code></pre></div><h2 id="rbac">RBAC</h2>
<p>By default, <code>agones.rbacEnabled</code> is set to true. This enables RBAC support in Code Blind and must be true if RBAC is enabled in your cluster.</p>
<p>The chart will take care of creating the required service accounts and roles for Code Blind.</p>
<p>If you have RBAC disabled, or to put it another way, ABAC enabled, you should set this value to <code>false</code>.</p>
<h2 id="configuration">Configuration</h2>
<p>The following tables lists the configurable parameters of the Code Blind chart and their default values.</p>
<h3 id="general">General</h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>agones.featureGates</code></td>
<td>A URL query encoded string of Flags to enable/disable e.g. <code>Example=true&amp;OtherThing=false</code>. Any value accepted by <a href="https://golang.org/pkg/strconv/#ParseBool">strconv.ParseBool(string)</a> can be used as a boolean value</td>
<td>``</td>
</tr>
<tr>
<td><code>agones.rbacEnabled</code></td>
<td>Creates RBAC resources. Must be set for any cluster configured with RBAC</td>
<td><code>true</code></td>
</tr>
<tr>
<td><code>agones.registerWebhooks</code></td>
<td>Registers the webhooks used for the admission controller</td>
<td><code>true</code></td>
</tr>
<tr>
<td><code>agones.registerApiService</code></td>
<td>Registers the apiservice(s) used for the Kubernetes API extension</td>
<td><code>true</code></td>
</tr>
<tr>
<td><code>agones.registerServiceAccounts</code></td>
<td>Attempts to create service accounts for the controllers</td>
<td><code>true</code></td>
</tr>
<tr>
<td><code>agones.createPriorityClass</code></td>
<td>Attempts to create priority classes for the controllers</td>
<td><code>true</code></td>
</tr>
<tr>
<td><code>agones.priorityClassName</code></td>
<td>Name of the priority classes to create</td>
<td><code>agones-system</code></td>
</tr>
<tr>
<td><code>agones.requireDedicatedNodes</code></td>
<td>Forces Code Blind system components to be scheduled on dedicated nodes, only applies to the GKE Standard without node auto-provisioning</td>
<td><code>false</code></td>
</tr>
</tbody>
</table>
<h3 id="custom-resource-definitions">Custom Resource Definitions</h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>agones.crds.install</code></td>
<td>Install the CRDs with this chart. Useful to disable if you want to subchart (since crd-install hook is broken), so you can copy the CRDs into your own chart.</td>
<td><code>true</code></td>
</tr>
<tr>
<td><code>agones.crds.cleanupOnDelete</code></td>
<td>Run the pre-delete hook to delete all GameServers and their backing Pods when deleting the helm chart, so that all CRDs can be removed on chart deletion</td>
<td><code>true</code></td>
</tr>
<tr>
<td><code>agones.crds.cleanupJobTTL</code></td>
<td>The number of seconds for Kubernetes to delete the associated Job and Pods of the pre-delete hook after it completes, regardless if the Job is successful or not. Set to <code>0</code> to disable cleaning up the Job or the associated Pods.</td>
<td><code>60</code></td>
</tr>
</tbody>
</table>
<h3 id="metrics">Metrics</h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>agones.metrics.prometheusServiceDiscovery</code></td>
<td>Adds annotations for Prometheus ServiceDiscovery (and also Strackdriver)</td>
<td><code>true</code></td>
</tr>
<tr>
<td><code>agones.metrics.prometheusEnabled</code></td>
<td>Enables controller metrics on port <code>8080</code> and path <code>/metrics</code></td>
<td><code>true</code></td>
</tr>
<tr>
<td><code>agones.metrics.stackdriverEnabled</code></td>
<td>Enables Stackdriver exporter of controller metrics</td>
<td><code>false</code></td>
</tr>
<tr>
<td><code>agones.metrics.stackdriverProjectID</code></td>
<td>This overrides the default gcp project id for use with stackdriver</td>
<td>``</td>
</tr>
<tr>
<td><code>agones.metrics.stackdriverLabels</code></td>
<td>A set of default labels to add to all stackdriver metrics generated in form of key value pair (<code>key=value,key2=value2</code>). By default metadata are automatically added using Kubernetes API and GCP metadata enpoint.</td>
<td>``</td>
</tr>
<tr>
<td><code>agones.metrics.serviceMonitor.interval</code></td>
<td>Default scraping interval for ServiceMonitor</td>
<td><code>30s</code></td>
</tr>
</tbody>
</table>
<h3 id="service-accounts">Service Accounts</h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>agones.serviceaccount.controller.name</code></td>
<td>Service account name for the controller</td>
<td><code>agones-controller</code></td>
</tr>
<tr>
<td><code>agones.serviceaccount.controller.annotations</code></td>
<td><a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/">Annotations</a> added to the Code Blind controller service account</td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>agones.serviceaccount.sdk.name</code></td>
<td>Service account name for the sdk</td>
<td><code>agones-sdk</code></td>
</tr>
<tr>
<td><code>agones.serviceaccount.sdk.annotations</code></td>
<td>A map of namespaces to maps of <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/">Annotations</a> added to the Code Blind SDK service account for the specified namespaces</td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>agones.serviceaccount.allocator.name</code></td>
<td>Service account name for the allocator</td>
<td><code>agones-allocator</code></td>
</tr>
<tr>
<td><code>agones.serviceaccount.allocator.annotations</code></td>
<td><a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/">Annotations</a> added to the Code Blind allocator service account</td>
<td><code>{}</code></td>
</tr>
</tbody>
</table>
<h3 id="container-images">Container Images</h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>agones.image.registry</code></td>
<td>Global image registry for all the Code Blind system images</td>
<td><code>us-docker.pkg.dev/agones-images/release</code></td>
</tr>
<tr>
<td><code>agones.image.tag</code></td>
<td>Global image tag for all images</td>
<td><code>1.38.0</code></td>
</tr>
<tr>
<td><code>agones.image.controller.name</code></td>
<td>Image name for the controller</td>
<td><code>agones-controller</code></td>
</tr>
<tr>
<td><code>agones.image.controller.pullPolicy</code></td>
<td>Image pull policy for the controller</td>
<td><code>IfNotPresent</code></td>
</tr>
<tr>
<td><code>agones.image.controller.pullSecret</code></td>
<td>Image pull secret for the controller, allocator, sdk and ping image. Should be created both in <code>agones-system</code> and <code>default</code> namespaces</td>
<td>``</td>
</tr>
<tr>
<td><code>agones.image.sdk.name</code></td>
<td>Image name for the sdk</td>
<td><code>agones-sdk</code></td>
</tr>
<tr>
<td><code>agones.image.sdk.tag</code></td>
<td>Image tag for the sdk</td>
<td>value of <code>agones.image.tag</code></td>
</tr>
<tr>
<td><code>agones.image.sdk.cpuRequest</code></td>
<td>The <a href="https://kubernetes.io/docs/tasks/administer-cluster/manage-resources/cpu-constraint-namespace/">cpu request</a> for sdk server container</td>
<td><code>30m</code></td>
</tr>
<tr>
<td><code>agones.image.sdk.cpuLimit</code></td>
<td>The <a href="https://kubernetes.io/docs/tasks/administer-cluster/manage-resources/cpu-constraint-namespace/">cpu limit</a> for the sdk server container</td>
<td><code>0</code> (none)</td>
</tr>
<tr>
<td><code>agones.image.sdk.memoryRequest</code></td>
<td>The <a href="https://kubernetes.io/docs/tasks/administer-cluster/manage-resources/memory-constraint-namespace/">memory request</a> for sdk server container</td>
<td><code>0</code> (none)</td>
</tr>
<tr>
<td><code>agones.image.sdk.memoryLimit</code></td>
<td>The <a href="https://kubernetes.io/docs/tasks/administer-cluster/manage-resources/memory-constraint-namespace/">memory limit</a> for the sdk server container</td>
<td><code>0</code> (none)</td>
</tr>
<tr>
<td><code>agones.image.sdk.alwaysPull</code></td>
<td>Tells if the sdk image should always be pulled</td>
<td><code>false</code></td>
</tr>
<tr>
<td><code>agones.image.ping.name</code></td>
<td>Image name for the ping service</td>
<td><code>agones-ping</code></td>
</tr>
<tr>
<td><code>agones.image.ping.tag</code></td>
<td>Image tag for the ping service</td>
<td>value of <code>agones.image.tag</code></td>
</tr>
<tr>
<td><code>agones.image.ping.pullPolicy</code></td>
<td>Image pull policy for the ping service</td>
<td><code>IfNotPresent</code></td>
</tr>
<tr>
<td><code>agones.image.extensions.name</code></td>
<td>Image name for extensions</td>
<td><code>agones-extensions</code></td>
</tr>
<tr>
<td><code>agones.image.extensions.pullPolicy</code></td>
<td>Image pull policy for extensions</td>
<td><code>IfNotPresent</code></td>
</tr>
</tbody>
</table>
<h3 id="code-blind-controller">Code Blind Controller</h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>agones.controller.replicas</code></td>
<td>The number of replicas to run in the <code>agones-controller</code> deployment.</td>
<td><code>2</code></td>
</tr>
<tr>
<td><code>agones.controller.pdb.minAvailable</code></td>
<td>Description of the number of pods from that set that must still be available after the eviction, even in the absence of the evicted pod. Can be either an absolute number or a percentage. Mutually Exclusive with <code>maxUnavailable</code></td>
<td><code>1</code></td>
</tr>
<tr>
<td><code>agones.controller.pdb.maxUnavailable</code></td>
<td>Description of the number of pods from that set that can be unavailable after the eviction. It can be either an absolute number or a percentage Mutually Exclusive with <code>minAvailable</code></td>
<td>``</td>
</tr>
<tr>
<td><code>agones.controller.http.port</code></td>
<td>Port to use for liveness probe service and metrics</td>
<td><code>8080</code></td>
</tr>
<tr>
<td><code>agones.controller.healthCheck.initialDelaySeconds</code></td>
<td>Initial delay before performing the first probe (in seconds)</td>
<td><code>3</code></td>
</tr>
<tr>
<td><code>agones.controller.healthCheck.periodSeconds</code></td>
<td>Seconds between every liveness probe (in seconds)</td>
<td><code>3</code></td>
</tr>
<tr>
<td><code>agones.controller.healthCheck.failureThreshold</code></td>
<td>Number of times before giving up (in seconds)</td>
<td><code>3</code></td>
</tr>
<tr>
<td><code>agones.controller.healthCheck.timeoutSeconds</code></td>
<td>Number of seconds after which the probe times out (in seconds)</td>
<td><code>1</code></td>
</tr>
<tr>
<td><code>agones.controller.resources</code></td>
<td>Controller <a href="https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/">resource requests/limit</a></td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>agones.controller.generateTLS</code></td>
<td>Set to true to generate TLS certificates or false to provide your own certificates</td>
<td><code>true</code></td>
</tr>
<tr>
<td><code>agones.controller.tlsCert</code></td>
<td>Custom TLS certificate provided as a string</td>
<td>``</td>
</tr>
<tr>
<td><code>agones.controller.tlsKey</code></td>
<td>Custom TLS private key provided as a string</td>
<td>``</td>
</tr>
<tr>
<td><code>agones.controller.nodeSelector</code></td>
<td>Controller <a href="https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#nodeselector">node labels</a> for pod assignment</td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>agones.controller.tolerations</code></td>
<td>Controller <a href="https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/">toleration</a> labels for pod assignment</td>
<td><code>[]</code></td>
</tr>
<tr>
<td><code>agones.controller.affinity</code></td>
<td>Controller <a href="https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#affinity-and-anti-affinity">affinity</a> settings for pod assignment</td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>agones.controller.annotations</code></td>
<td><a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/">Annotations</a> added to the Code Blind controller pods</td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>agones.controller.numWorkers</code></td>
<td>Number of workers to spin per resource type</td>
<td><code>100</code></td>
</tr>
<tr>
<td><code>agones.controller.apiServerQPS</code></td>
<td>Maximum sustained queries per second that controller should be making against API Server</td>
<td><code>400</code></td>
</tr>
<tr>
<td><code>agones.controller.apiServerQPSBurst</code></td>
<td>Maximum burst queries per second that controller should be making against API Server</td>
<td><code>500</code></td>
</tr>
<tr>
<td><code>agones.controller.logLevel</code></td>
<td>Code Blind Controller Log level. Log only entries with that severity and above</td>
<td><code>info</code></td>
</tr>
<tr>
<td><code>agones.controller.persistentLogs</code></td>
<td>Store Code Blind controller logs in a temporary volume attached to a container for debugging</td>
<td><code>true</code></td>
</tr>
<tr>
<td><code>agones.controller.persistentLogsSizeLimitMB</code></td>
<td>Maximum total size of all Code Blind container logs in MB</td>
<td><code>10000</code></td>
</tr>
<tr>
<td><code>agones.controller.disableSecret</code></td>
<td>Disables the creation of any allocator secrets. If true, you MUST provide the <code>{agones.releaseName}-cert</code> secrets before installation.</td>
<td><code>false</code></td>
</tr>
<tr>
<td><code>agones.controller.customCertSecretPath</code></td>
<td>Remap cert-manager path to server.crt and server.key</td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>agones.controller.allocationApiService.annotations</code></td>
<td><a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/">Annotations</a> added to the Code Blind apiregistration</td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>agones.controller.allocationApiService.disableCaBundle</code></td>
<td>Disable ca-bundle so it can be injected by cert-manager</td>
<td><code>false</code></td>
</tr>
<tr>
<td><code>agones.controller.validatingWebhook.annotations</code></td>
<td><a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/">Annotations</a> added to the Code Blind validating webhook</td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>agones.controller.validatingWebhook.disableCaBundle</code></td>
<td>Disable ca-bundle so it can be injected by cert-manager</td>
<td><code>false</code></td>
</tr>
<tr>
<td><code>agones.controller.mutatingWebhook.annotations</code></td>
<td><a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/">Annotations</a> added to the Code Blind mutating webhook</td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>agones.controller.mutatingWebhook.disableCaBundle</code></td>
<td>Disable ca-bundle so it can be injected by cert-manager</td>
<td><code>false</code></td>
</tr>
<tr>
<td><code>agones.controller.allocationBatchWaitTime</code></td>
<td>Wait time between each allocation batch when performing allocations in controller mode</td>
<td><code>500ms</code></td>
</tr>
<tr>
<td><code>agones.controller.topologySpreadConstraints</code></td>
<td>Ensures better resource utilization and high availability by evenly distributing Pods in the agones-system namespace</td>
<td><code>{}</code></td>
</tr>
</tbody>
</table>
<h3 id="ping-service">Ping Service</h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>agones.ping.install</code></td>
<td>Whether to install the <a href="https://codeblind.ai/docs/guides/ping-service/">ping service</a></td>
<td><code>true</code></td>
</tr>
<tr>
<td><code>agones.ping.replicas</code></td>
<td>The number of replicas to run in the deployment</td>
<td><code>2</code></td>
</tr>
<tr>
<td><code>agones.ping.http.expose</code></td>
<td>Expose the http ping service via a Service</td>
<td><code>true</code></td>
</tr>
<tr>
<td><code>agones.ping.http.response</code></td>
<td>The string response returned from the http service</td>
<td><code>ok</code></td>
</tr>
<tr>
<td><code>agones.ping.http.port</code></td>
<td>The port to expose on the service</td>
<td><code>80</code></td>
</tr>
<tr>
<td><code>agones.ping.http.serviceType</code></td>
<td>The <a href="https://kubernetes.io/docs/concepts/services-networking/service/">Service Type</a> of the HTTP Service</td>
<td><code>LoadBalancer</code></td>
</tr>
<tr>
<td><code>agones.ping.http.nodePort</code></td>
<td>Static node port to use for HTTP ping service. (Only applies when <code>agones.ping.http.serviceType</code> is <code>NodePort</code>.)</td>
<td><code>0</code></td>
</tr>
<tr>
<td><code>agones.ping.http.loadBalancerIP</code></td>
<td>The <a href="https://kubernetes.io/docs/concepts/services-networking/service/#loadbalancer">Load Balancer IP</a> of the HTTP Service load balancer. Only works if the Kubernetes provider supports this option.</td>
<td>``</td>
</tr>
<tr>
<td><code>agones.ping.http.loadBalancerSourceRanges</code></td>
<td>The <a href="https://kubernetes.io/docs/concepts/services-networking/service/#loadbalancer">Load Balancer SourceRanges</a> of the HTTP Service load balancer. Only works if the Kubernetes provider supports this option.</td>
<td><code>[]</code></td>
</tr>
<tr>
<td><code>agones.ping.http.annotations</code></td>
<td><a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/">Annotations</a> added to the Code Blind ping http service</td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>agones.ping.udp.expose</code></td>
<td>Expose the udp ping service via a Service</td>
<td><code>true</code></td>
</tr>
<tr>
<td><code>agones.ping.udp.rateLimit</code></td>
<td>Number of UDP packets the ping service handles per instance, per second, per sender</td>
<td><code>20</code></td>
</tr>
<tr>
<td><code>agones.ping.udp.port</code></td>
<td>The port to expose on the service</td>
<td><code>80</code></td>
</tr>
<tr>
<td><code>agones.ping.udp.serviceType</code></td>
<td>The <a href="https://kubernetes.io/docs/concepts/services-networking/service/">Service Type</a> of the UDP Service</td>
<td><code>LoadBalancer</code></td>
</tr>
<tr>
<td><code>agones.ping.udp.nodePort</code></td>
<td>Static node port to use for UDP ping service. (Only applies when <code>agones.ping.udp.serviceType</code> is <code>NodePort</code>.)</td>
<td><code>0</code></td>
</tr>
<tr>
<td><code>agones.ping.udp.loadBalancerIP</code></td>
<td>The <a href="https://kubernetes.io/docs/concepts/services-networking/service/#loadbalancer">Load Balancer IP</a> of the UDP Service load balancer. Only works if the Kubernetes provider supports this option.</td>
<td>``</td>
</tr>
<tr>
<td><code>agones.ping.udp.loadBalancerSourceRanges</code></td>
<td>The <a href="https://kubernetes.io/docs/concepts/services-networking/service/#loadbalancer">Load Balancer SourceRanges</a> of the UDP Service load balancer. Only works if the Kubernetes provider supports this option.</td>
<td><code>[]</code></td>
</tr>
<tr>
<td><code>agones.ping.udp.annotations</code></td>
<td><a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/">Annotations</a> added to the Code Blind ping udp service</td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>agones.ping.healthCheck.initialDelaySeconds</code></td>
<td>Initial delay before performing the first probe (in seconds)</td>
<td><code>3</code></td>
</tr>
<tr>
<td><code>agones.ping.healthCheck.periodSeconds</code></td>
<td>Seconds between every liveness probe (in seconds)</td>
<td><code>3</code></td>
</tr>
<tr>
<td><code>agones.ping.healthCheck.failureThreshold</code></td>
<td>Number of times before giving up (in seconds)</td>
<td><code>3</code></td>
</tr>
<tr>
<td><code>agones.ping.healthCheck.timeoutSeconds</code></td>
<td>Number of seconds after which the probe times out (in seconds)</td>
<td><code>1</code></td>
</tr>
<tr>
<td><code>agones.ping.resources</code></td>
<td>Ping pods <a href="https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/">resource requests/limit</a></td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>agones.ping.nodeSelector</code></td>
<td>Ping <a href="https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#nodeselector">node labels</a> for pod assignment</td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>agones.ping.tolerations</code></td>
<td>Ping <a href="https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/">toleration</a> labels for pod assignment</td>
<td><code>[]</code></td>
</tr>
<tr>
<td><code>agones.ping.affinity</code></td>
<td>Ping <a href="https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#affinity-and-anti-affinity">affinity</a> settings for pod assignment</td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>agones.ping.annotations</code></td>
<td><a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/">Annotations</a> added to the Code Blind ping pods</td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>agones.ping.updateStrategy</code></td>
<td>The <a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#strategy">strategy</a> to apply to the allocator deployment</td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>agones.ping.pdb.enabled</code></td>
<td>Set to <code>true</code> to enable the creation of a <a href="https://kubernetes.io/docs/tasks/run-application/configure-pdb/">PodDisruptionBudget</a> for the ping deployment</td>
<td><code>false</code></td>
</tr>
<tr>
<td><code>agones.ping.pdb.minAvailable</code></td>
<td>Description of the number of pods from that set that must still be available after the eviction, even in the absence of the evicted pod. Can be either an absolute number or a percentage. Mutually Exclusive with <code>maxUnavailable</code></td>
<td><code>1</code></td>
</tr>
<tr>
<td><code>agones.ping.pdb.maxUnavailable</code></td>
<td>Description of the number of pods from that set that can be unavailable after the eviction. It can be either an absolute number or a percentage Mutually Exclusive with <code>minAvailable</code></td>
<td>``</td>
</tr>
<tr>
<td><code>agones.ping.topologySpreadConstraints</code></td>
<td>Ensures better resource utilization and high availability by evenly distributing Pods in the agones-system namespace</td>
<td><code>{}</code></td>
</tr>
</tbody>
</table>
<h3 id="allocator-service">Allocator Service</h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>agones.allocator.apiServerQPS</code></td>
<td>Maximum sustained queries per second that an allocator should be making against API Server</td>
<td><code>400</code></td>
</tr>
<tr>
<td><code>agones.allocator.apiServerQPSBurst</code></td>
<td>Maximum burst queries per second that an allocator should be making against API Server</td>
<td><code>500</code></td>
</tr>
<tr>
<td><code>agones.allocator.remoteAllocationTimeout</code></td>
<td>Remote allocation call timeout.</td>
<td><code>10s</code></td>
</tr>
<tr>
<td><code>agones.allocator.totalRemoteAllocationTimeout</code></td>
<td>Total remote allocation timeout including retries.</td>
<td><code>30s</code></td>
</tr>
<tr>
<td><code>agones.allocator.logLevel</code></td>
<td>Code Blind Allocator Log level. Log only entries with that severity and above</td>
<td><code>info</code></td>
</tr>
<tr>
<td><code>agones.allocator.install</code></td>
<td>Whether to install the <a href="https://codeblind.ai/docs/advanced/allocator-service/">allocator service</a></td>
<td><code>true</code></td>
</tr>
<tr>
<td><code>agones.allocator.replicas</code></td>
<td>The number of replicas to run in the deployment</td>
<td><code>3</code></td>
</tr>
<tr>
<td><code>agones.allocator.service.name</code></td>
<td>Service name for the allocator</td>
<td><code>agones-allocator</code></td>
</tr>
<tr>
<td><code>agones.allocator.service.serviceType</code></td>
<td>The <a href="https://kubernetes.io/docs/concepts/services-networking/service/">Service Type</a> of the HTTP Service</td>
<td><code>LoadBalancer</code></td>
</tr>
<tr>
<td><code>agones.allocator.service.clusterIP</code></td>
<td>The <a href="https://kubernetes.io/docs/concepts/services-networking/service/#type-clusterip">Cluster IP</a> of the Code Blind allocator. If you want <a href="https://kubernetes.io/docs/concepts/services-networking/service/#headless-services">Headless Service</a> for Code Blind Allocator, you can set <code>None</code> to clusterIP.</td>
<td>``</td>
</tr>
<tr>
<td><code>agones.allocator.service.loadBalancerIP</code></td>
<td>The <a href="https://kubernetes.io/docs/concepts/services-networking/service/#loadbalancer">Load Balancer IP</a> of the Code Blind allocator load balancer. Only works if the Kubernetes provider supports this option.</td>
<td>``</td>
</tr>
<tr>
<td><code>agones.allocator.service.loadBalancerSourceRanges</code></td>
<td>The <a href="https://kubernetes.io/docs/concepts/services-networking/service/#loadbalancer">Load Balancer SourceRanges</a> of the Code Blind allocator load balancer. Only works if the Kubernetes provider supports this option.</td>
<td><code>[]</code></td>
</tr>
<tr>
<td><code>agones.allocator.service.annotations</code></td>
<td><a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/">Annotations</a> added to the Code Blind allocator service</td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>agones.allocator.service.http.enabled</code></td>
<td>If true the <a href="https://codeblind.ai/docs/advanced/allocator-service/">allocator service</a> will respond to <a href="https://codeblind.ai/docs/advanced/allocator-service/#using-rest">REST requests</a></td>
<td><code>true</code></td>
</tr>
<tr>
<td><code>agones.allocator.service.http.appProtocol</code></td>
<td>The <code>appProtocol</code> to set on the Service for the http allocation port. If left blank, no value is set.</td>
<td>``</td>
</tr>
<tr>
<td><code>agones.allocator.service.http.port</code></td>
<td>The port that is exposed externally by the <a href="https://codeblind.ai/docs/advanced/allocator-service/">allocator service</a> for <a href="https://codeblind.ai/docs/advanced/allocator-service/#using-rest">REST requests</a></td>
<td><code>443</code></td>
</tr>
<tr>
<td><code>agones.allocator.service.http.portName</code></td>
<td>The name of exposed port</td>
<td><code>http</code></td>
</tr>
<tr>
<td><code>agones.allocator.service.http.targetPort</code></td>
<td>The port that is used by the allocator pod to listen for <a href="https://codeblind.ai/docs/advanced/allocator-service/#using-rest">REST requests</a>. Note that the allocator server cannot bind to low numbered ports.</td>
<td><code>8443</code></td>
</tr>
<tr>
<td><code>agones.allocator.service.http.nodePort</code></td>
<td>If the ServiceType is set to &ldquo;NodePort&rdquo;,  this is the NodePort that the allocator http service is exposed on.</td>
<td><code>30000-32767</code></td>
</tr>
<tr>
<td><code>agones.allocator.service.grpc.enabled</code></td>
<td>If true the <a href="https://codeblind.ai/docs/advanced/allocator-service/">allocator service</a> will respond to <a href="https://codeblind.ai/docs/advanced/allocator-service/#using-grpc">gRPC requests</a></td>
<td><code>true</code></td>
</tr>
<tr>
<td><code>agones.allocator.service.grpc.port</code></td>
<td>The port that is exposed externally by the <a href="https://codeblind.ai/docs/advanced/allocator-service/">allocator service</a> for <a href="https://codeblind.ai/docs/advanced/allocator-service/#using-grpc">gRPC requests</a></td>
<td><code>443</code></td>
</tr>
<tr>
<td><code>agones.allocator.service.grpc.portName</code></td>
<td>The name of exposed port</td>
<td>``</td>
</tr>
<tr>
<td><code>agones.allocator.service.grpc.appProtocol</code></td>
<td>The <code>appProtocol</code> to set on the Service for the gRPC allocation port. If left blank, no value is set.</td>
<td>``</td>
</tr>
<tr>
<td><code>agones.allocator.service.grpc.nodePort</code></td>
<td>If the ServiceType is set to &ldquo;NodePort&rdquo;,  this is the NodePort that the allocator gRPC service is exposed on.</td>
<td><code>30000-32767</code></td>
</tr>
<tr>
<td><code>agones.allocator.service.grpc.targetPort</code></td>
<td>The port that is used by the allocator pod to listen for <a href="https://codeblind.ai/docs/advanced/allocator-service/#using-grpc">gRPC requests</a>. Note that the allocator server cannot bind to low numbered ports.</td>
<td><code>8443</code></td>
</tr>
<tr>
<td><code>agones.allocator.generateClientTLS</code></td>
<td>Set to true to generate client TLS certificates or false to provide certificates in <code>certs/allocator/allocator-client.default/*</code></td>
<td><code>true</code></td>
</tr>
<tr>
<td><code>agones.allocator.generateTLS</code></td>
<td>Set to true to generate TLS certificates or false to provide your own certificates</td>
<td><code>true</code></td>
</tr>
<tr>
<td><code>agones.allocator.disableMTLS</code></td>
<td>Turns off client cert authentication for incoming connections to the allocator.</td>
<td><code>false</code></td>
</tr>
<tr>
<td><code>agones.allocator.disableTLS</code></td>
<td>Turns off TLS security for incoming connections to the allocator.</td>
<td><code>false</code></td>
</tr>
<tr>
<td><code>agones.allocator.disableSecretCreation</code></td>
<td>Disables the creation of any allocator secrets. If true, you MUST provide the <code>allocator-tls</code>, <code>allocator-tls-ca</code>, and <code>allocator-client-ca</code> secrets before installation.</td>
<td><code>false</code></td>
</tr>
<tr>
<td><code>agones.allocator.tlsCert</code></td>
<td>Custom TLS certificate provided as a string</td>
<td>``</td>
</tr>
<tr>
<td><code>agones.allocator.tlsKey</code></td>
<td>Custom TLS private key provided as a string</td>
<td>``</td>
</tr>
<tr>
<td><code>agones.allocator.clientCAs</code></td>
<td>A map of secret key names to allowed client CA certificates provided as strings</td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>agones.allocator.tolerations</code></td>
<td>Allocator <a href="https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/">toleration</a> labels for pod assignment</td>
<td><code>[]</code></td>
</tr>
<tr>
<td><code>agones.allocator.affinity</code></td>
<td>Allocator <a href="https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#affinity-and-anti-affinity">affinity</a> settings for pod assignment</td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>agones.allocator.annotations</code></td>
<td><a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/">Annotations</a> added to the Code Blind allocator pods</td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>agones.allocator.resources</code></td>
<td>Allocator pods <a href="https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/">resource requests/limit</a></td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>agones.allocator.labels</code></td>
<td><a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/">Labels</a> Added to the Code Blind Allocator pods</td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>agones.allocator.readiness.initialDelaySeconds</code></td>
<td>Initial delay before performing the first probe (in seconds)</td>
<td><code>3</code></td>
</tr>
<tr>
<td><code>agones.allocator.readiness.periodSeconds</code></td>
<td>Seconds between every liveness probe (in seconds)</td>
<td><code>3</code></td>
</tr>
<tr>
<td><code>agones.allocator.readiness.failureThreshold</code></td>
<td>Number of times before giving up (in seconds)</td>
<td><code>3</code></td>
</tr>
<tr>
<td><code>agones.allocator.nodeSelector</code></td>
<td>Allocator <a href="https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#nodeselector">node labels</a> for pod assignment</td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>agones.allocator.serviceMetrics.name</code></td>
<td>Second Service name for the allocator</td>
<td><code>agones-allocator-metrics-service</code></td>
</tr>
<tr>
<td><code>agones.allocator.serviceMetrics.annotations</code></td>
<td><a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/">Annotations</a> added to the Code Blind allocator second Service</td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>agones.allocator.serviceMetrics.http.port</code></td>
<td>The port that is exposed within cluster by the <a href="https://codeblind.ai/docs/advanced/allocator-service/">allocator service</a> for http requests</td>
<td><code>8080</code></td>
</tr>
<tr>
<td><code>agones.allocator.serviceMetrics.http.portName</code></td>
<td>The name of exposed port</td>
<td><code>http</code></td>
</tr>
<tr>
<td><code>agones.allocator.allocationBatchWaitTime</code></td>
<td>Wait time between each allocation batch when performing allocations in allocator mode</td>
<td><code>500ms</code></td>
</tr>
<tr>
<td><code>agones.allocator.updateStrategy</code></td>
<td>The <a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#strategy">strategy</a> to apply to the ping deployment</td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>agones.allocator.pdb.enabled</code></td>
<td>Set to <code>true</code> to enable the creation of a <a href="https://kubernetes.io/docs/tasks/run-application/configure-pdb/">PodDisruptionBudget</a> for the allocator deployment</td>
<td><code>false</code></td>
</tr>
<tr>
<td><code>agones.allocator.pdb.minAvailable</code></td>
<td>Description of the number of pods from that set that must still be available after the eviction, even in the absence of the evicted pod. Can be either an absolute number or a percentage. Mutually Exclusive with <code>maxUnavailable</code></td>
<td><code>1</code></td>
</tr>
<tr>
<td><code>agones.allocator.pdb.maxUnavailable</code></td>
<td>Description of the number of pods from that set that can be unavailable after the eviction. It can be either an absolute number or a percentage. Mutually Exclusive with <code>minAvailable</code></td>
<td>``</td>
</tr>
<tr>
<td><code>agones.allocator.topologySpreadConstraints</code></td>
<td>Ensures better resource utilization and high availability by evenly distributing Pods in the agones-system namespace</td>
<td><code>{}</code></td>
</tr>
</tbody>
</table>
<h3 id="extensions">Extensions</h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>agones.extensions.http.port</code></td>
<td>Port to use for liveness probe service and metrics</td>
<td><code>8080</code></td>
</tr>
<tr>
<td><code>agones.extensions.healthCheck.initialDelaySeconds</code></td>
<td>Initial delay before performing the first probe (in seconds)</td>
<td><code>3</code></td>
</tr>
<tr>
<td><code>agones.extensions.healthCheck.periodSeconds</code></td>
<td>Seconds between every liveness probe (in seconds)</td>
<td><code>3</code></td>
</tr>
<tr>
<td><code>agones.extensions.healthCheck.failureThreshold</code></td>
<td>Number of times before giving up (in seconds)</td>
<td><code>3</code></td>
</tr>
<tr>
<td><code>agones.extensions.healthCheck.timeoutSeconds</code></td>
<td>Number of seconds after which the probe times out (in seconds)</td>
<td><code>1</code></td>
</tr>
<tr>
<td><code>agones.extensions.resources</code></td>
<td>Extensions <a href="https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/">resource requests/limit</a></td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>agones.extensions.generateTLS</code></td>
<td>Set to true to generate TLS certificates or false to provide your own certificates</td>
<td><code>true</code></td>
</tr>
<tr>
<td><code>agones.extensions.tlsCert</code></td>
<td>Custom TLS certificate provided as a string</td>
<td>``</td>
</tr>
<tr>
<td><code>agones.extensions.tlsKey</code></td>
<td>Custom TLS private key provided as a string</td>
<td>``</td>
</tr>
<tr>
<td><code>agones.extensions.nodeSelector</code></td>
<td>Extensions <a href="https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#nodeselector">node labels</a> for pod assignment</td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>agones.extensions.tolerations</code></td>
<td>Extensions <a href="https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/">toleration</a> labels for pod assignment</td>
<td><code>[]</code></td>
</tr>
<tr>
<td><code>agones.extensions.affinity</code></td>
<td>Extensions <a href="https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#affinity-and-anti-affinity">affinity</a> settings for pod assignment</td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>agones.extensions.annotations</code></td>
<td><a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/">Annotations</a> added to the Code Blind extensions pods</td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>agones.extensions.numWorkers</code></td>
<td>Number of workers to spin per resource type</td>
<td><code>100</code></td>
</tr>
<tr>
<td><code>agones.extensions.apiServerQPS</code></td>
<td>Maximum sustained queries per second that extensions should be making against API Server</td>
<td><code>400</code></td>
</tr>
<tr>
<td><code>agones.extensions.apiServerQPSBurst</code></td>
<td>Maximum burst queries per second that extensions should be making against API Server</td>
<td><code>500</code></td>
</tr>
<tr>
<td><code>agones.extensions.logLevel</code></td>
<td>Code Blind Extensions Log level. Log only entries with that severity and above</td>
<td><code>info</code></td>
</tr>
<tr>
<td><code>agones.extensions.persistentLogs</code></td>
<td>Store Code Blind extensions logs in a temporary volume attached to a container for debugging</td>
<td><code>true</code></td>
</tr>
<tr>
<td><code>agones.extensions.persistentLogsSizeLimitMB</code></td>
<td>Maximum total size of all Code Blind container logs in MB</td>
<td><code>10000</code></td>
</tr>
<tr>
<td><code>agones.extensions.disableSecret</code></td>
<td>Disables the creation of any allocator secrets. If true, you MUST provide the <code>{agones.releaseName}-cert</code> secrets before installation.</td>
<td><code>false</code></td>
</tr>
<tr>
<td><code>agones.extensions.customCertSecretPath</code></td>
<td>Remap cert-manager path to server.crt and server.key</td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>agones.extensions.allocationApiService.annotations</code></td>
<td><a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/">Annotations</a> added to the Code Blind apiregistration</td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>agones.extensions.allocationApiService.disableCaBundle</code></td>
<td>Disable ca-bundle so it can be injected by cert-manager</td>
<td><code>false</code></td>
</tr>
<tr>
<td><code>agones.extensions.validatingWebhook.annotations</code></td>
<td><a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/">Annotations</a> added to the Code Blind validating webhook</td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>agones.extensions.validatingWebhook.disableCaBundle</code></td>
<td>Disable ca-bundle so it can be injected by cert-manager</td>
<td><code>false</code></td>
</tr>
<tr>
<td><code>agones.extensions.mutatingWebhook.annotations</code></td>
<td><a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/">Annotations</a> added to the Code Blind mutating webhook</td>
<td><code>{}</code></td>
</tr>
<tr>
<td><code>agones.extensions.mutatingWebhook.disableCaBundle</code></td>
<td>Disable ca-bundle so it can be injected by cert-manager</td>
<td><code>false</code></td>
</tr>
<tr>
<td><code>agones.extensions.allocationBatchWaitTime</code></td>
<td>Wait time between each allocation batch when performing allocations in controller mode</td>
<td><code>500ms</code></td>
</tr>
<tr>
<td><code>agones.extensions.pdb.minAvailable</code></td>
<td>Description of the number of pods from that set that must still be available after the eviction, even in the absence of the evicted pod. Can be either an absolute number or a percentage. Mutually Exclusive with maxUnavailable</td>
<td><code>1</code></td>
</tr>
<tr>
<td><code>agones.extensions.pdb.maxUnavailable</code></td>
<td>Description of the number of pods from that set that can be unavailable after the eviction. It can be either an absolute number or a percentage Mutually Exclusive with <code>minAvailable</code></td>
<td>``</td>
</tr>
<tr>
<td><code>agones.extensions.replicas</code></td>
<td>The number of replicas to run in the deployment</td>
<td><code>2</code></td>
</tr>
<tr>
<td><code>agones.extensions.topologySpreadConstraints</code></td>
<td>Ensures better resource utilization and high availability by evenly distributing Pods in the agones-system namespace</td>
<td><code>{}</code></td>
</tr>
</tbody>
</table>
<h3 id="gameservers">GameServers</h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>gameservers.namespaces</code></td>
<td>a list of namespaces you are planning to use to deploy game servers</td>
<td><code>[&quot;default&quot;]</code></td>
</tr>
<tr>
<td><code>gameservers.minPort</code></td>
<td>Minimum port to use for dynamic port allocation</td>
<td><code>7000</code></td>
</tr>
<tr>
<td><code>gameservers.maxPort</code></td>
<td>Maximum port to use for dynamic port allocation</td>
<td><code>8000</code></td>
</tr>
<tr>
<td><code>gameservers.podPreserveUnknownFields</code></td>
<td>Disable <a href="https://kubernetes.io/docs/tasks/extend-kubernetes/custom-resources/custom-resource-definitions/#field-pruning">field pruning</a> and schema validation on the Pod template for a <a href="https://codeblind.ai/docs/reference/gameserver/">GameServer</a> definition</td>
<td><code>false</code></td>
</tr>
</tbody>
</table>
<h3 id="helm-installation">Helm Installation</h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>helm.installTests</code></td>
<td>Add an ability to run <code>helm test agones</code> to verify the installation</td>
<td><code>false</code></td>
</tr>
</tbody>
</table>
<p>Specify each parameter using the <code>--set key=value[,key=value]</code> argument to <code>helm install</code>. For example,</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>helm install my-release --namespace agones-system <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --set gameservers.minPort<span style="color:#ce5c00;font-weight:bold">=</span>1000,gameservers.maxPort<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">5000</span> agones
</span></span></code></pre></div><p>The above command will deploy Code Blind controllers to <code>agones-system</code> namespace. Additionally Code Blind will use a dynamic GameServers&rsquo; port allocation range of 1000-5000.</p>
<p>Alternatively, a YAML file that specifies the values for the parameters can be provided while installing the chart. For example,</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>helm install my-release --namespace agones-system -f values.yaml agones/agones
</span></span></code></pre></div>

<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Tip</h4>

    You can use the default
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>values.yaml</a>

</div>

<h2 id="helm-test">Helm test</h2>
<p>This test would create a <code>GameServer</code> resource and delete it afterwards.</p>


<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Tip</h4>

    In order to use <code>helm test</code> command described in this section you need to set <code>helm.installTests</code> helm parameter to <code>true</code>.

</div>

<p>Check the Code Blind installation by running the following command:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>helm <span style="color:#204a87">test</span> my-release -n agones-system
</span></span></code></pre></div><p>You should see a successful output similar to this :</p>
<pre tabindex="0"><code>NAME: my-release
LAST DEPLOYED: Wed Mar 29 06:13:23 2023
NAMESPACE: agones-system
STATUS: deployed
REVISION: 4
TEST SUITE:     my-release-test
Last Started:   Wed Mar 29 06:17:52 2023
Last Completed: Wed Mar 29 06:18:10 2023
Phase:          Succeeded
</code></pre><h2 id="controller-tls-certificates">Controller TLS Certificates</h2>
<p>By default agones chart generates tls certificates used by the admission controller, while this is handy, it requires the agones controller to restart on each <code>helm upgrade</code> command.</p>
<h3 id="manual">Manual</h3>
<p>For most use cases the controller would have required a restart anyway (eg: controller image updated). However if you really need to avoid restarts we suggest that you turn off tls automatic generation (<code>agones.controller.generateTLS</code> to <code>false</code>) and provide your own certificates (<code>certs/server.crt</code>,<code>certs/server.key</code>).</p>


<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Tip</h4>

    You can use our script located at
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>cert.sh</a> to generate them.

</div>

<h3 id="cert-manager">Cert-Manager</h3>
<p>Another approach is to use <a href="https://cert-manager.io/">cert-manager.io</a> solution for cluster level certificate management.</p>
<p>In order to use the cert-manager solution, first <a href="https://cert-manager.io/docs/installation/kubernetes/">install cert-manager</a> on the cluster.
Then, <a href="https://cert-manager.io/docs/configuration/">configure</a> an <code>Issuer</code>/<code>ClusterIssuer</code> resource and
last <a href="https://cert-manager.io/docs/usage/certificate/">configure</a> a <code>Certificate</code> resource to manage controller <code>Secret</code>.
Make sure to configure the <code>Certificate</code> based on your system&rsquo;s requirements, including the validity <code>duration</code>.</p>
<p>Here is an example of using a self-signed <code>ClusterIssuer</code> for configuring controller <code>Secret</code> where secret name is <code>my-release-cert</code> or <code>{{ template &quot;agones.fullname&quot; . }}-cert</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#8f5902;font-style:italic"># Create a self-signed ClusterIssuer</span>
</span></span><span style="display:flex;"><span>cat <span style="color:#4e9a06">&lt;&lt;EOF | kubectl apply -f -
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">apiVersion: cert-manager.io/v1
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">kind: ClusterIssuer
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  name: selfsigned
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">spec:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  selfSigned: {}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Create a Certificate with IP for the my-release-cert )</span>
</span></span><span style="display:flex;"><span>cat <span style="color:#4e9a06">&lt;&lt;EOF | kubectl apply -f -
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">apiVersion: cert-manager.io/v1
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">kind: Certificate
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  name: my-release-agones-cert
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  namespace: agones-system
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">spec:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  dnsNames:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    - agones-controller-service.agones-system.svc
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  secretName: my-release-agones-cert
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  issuerRef:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    name: selfsigned
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    kind: ClusterIssuer
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">EOF</span>
</span></span></code></pre></div><p>After the certificates are generated, we will want to <a href="https://cert-manager.io/docs/concepts/ca-injector/">inject caBundle</a> into the controller and extensions webhook and disable the controller and extensions secret creation through the following values.yaml file.:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">agones</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">controller</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">disableSecret</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">customCertSecretPath</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ca.crt</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">path</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ca.crt</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">tls.crt</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">path</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">server.crt</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">tls.key</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">path</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">server.key</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">allocationApiService</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">annotations</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">cert-manager.io/inject-ca-from</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">agones-system/my-release-agones-cert</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">disableCaBundle</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">validatingWebhook</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">annotations</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">cert-manager.io/inject-ca-from</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">agones-system/my-release-agones-cert</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">disableCaBundle</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">mutatingWebhook</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">annotations</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">cert-manager.io/inject-ca-from</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">agones-system/my-release-agones-cert</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">disableCaBundle</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">extensions</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">disableSecret</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">customCertSecretPath</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ca.crt</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">path</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ca.crt</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">tls.crt</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">path</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">server.crt</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">tls.key</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">path</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">server.key</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">allocationApiService</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">annotations</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">cert-manager.io/inject-ca-from</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">agones-system/my-release-agones-cert</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">disableCaBundle</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">validatingWebhook</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">annotations</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">cert-manager.io/inject-ca-from</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">agones-system/my-release-agones-cert</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">disableCaBundle</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">mutatingWebhook</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">annotations</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">cert-manager.io/inject-ca-from</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">agones-system/my-release-agones-cert</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">disableCaBundle</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>After copying the above yaml into a <code>values.yaml</code> file, use below command to install Code Blind:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>helm install my-release --namespace agones-system --create-namespace --values values.yaml agones/agones
</span></span></code></pre></div><h2 id="reserved-allocator-load-balancer-ip">Reserved Allocator Load Balancer IP</h2>
<p>In order to reuse the existing load balancer IP on upgrade or install the <code>agones-allocator</code> service as a <code>LoadBalancer</code> using a reserved static IP, a user can specify the load balancer&rsquo;s IP with the <code>agones.allocator.http.loadBalancerIP</code> helm configuration parameter value. By setting the <code>loadBalancerIP</code> value:</p>
<ol>
<li>The <code>LoadBalancer</code> is created with the specified IP, if supported by the cloud provider.</li>
<li>A self-signed server TLS certificate is generated for the IP, used by the <code>agones-allocator</code> service.</li>
</ol>
<h2 id="next-steps">Next Steps</h2>
<ul>
<li><a href="/docs/installation/confirm/">Confirm Code Blind is up and running</a></li>
</ul>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-1ce1902627986754e63902ced859a973">3.3 - Deploy Kubernetes cluster and install Code Blind using Terraform</h1>
    <div class="lead">Install a <a href="http://kubernetes.io">Kubernetes</a> cluster and Code Blind declaratively using Terraform.</div>
	<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li><a href="https://www.terraform.io/">Terraform</a> v1.0.8</li>
<li>Access to the the Kubernetes hosting provider you are using (e.g. <code>gcloud</code>,
<code>awscli</code>, or <code>az</code> utility installed)</li>
<li>Git</li>
</ul>


<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Note</h4>

    <p>All our Terraform modules and examples use a
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>Helm 3 Module</a>.</p>
<p>The last Code Blind release to include a Helm 2 module was <a href="https://agones.dev/blog/2020/09/29/1.9.0-kubernetes-1.16-nuget-and-tcp-udp/">1.9.0</a>.</p>


</div>


</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-4ebc8d21cb3a0bed08fa6069e0de7ccb">3.3.1 - Installing Code Blind on Google Kubernetes Engine using Terraform</h1>
    <div class="lead">You can use Terraform to provision a GKE cluster and install Code Blind on it.</div>
	<h2 id="before-you-begin">Before you begin</h2>
<p>Take the following steps to enable the Kubernetes Engine API:</p>
<ol>
<li>Visit the <a href="https://console.cloud.google.com/kubernetes/list">Kubernetes Engine</a> page in the Google Cloud Platform Console.</li>
<li>Create or select a project.</li>
<li>Wait for the API and related services to be enabled. This can take several minutes.</li>
<li><a href="https://support.google.com/cloud/answer/6293499#enable-billing">Enable billing</a> for your project.</li>
</ol>
<ul>
<li>If you are not an existing GCP user, you may be able to enroll for a $300 US <a href="https://cloud.google.com/free/">Free Trial</a> credit.</li>
</ul>
<h3 id="choosing-a-shell">Choosing a shell</h3>
<p>To complete this quickstart, we can use either <a href="https://cloud.google.com/shell/">Google Cloud Shell</a> or a local shell.</p>
<p>Google Cloud Shell is a shell environment for managing resources hosted on Google Cloud Platform (GCP). Cloud Shell comes preinstalled with the <a href="https://cloud.google.com/sdk/gcloud/">gcloud</a> and <a href="https://kubernetes.io/docs/reference/kubectl/">kubectl</a> command-line tools. <code>gcloud</code> provides the primary command-line interface for GCP, and <code>kubectl</code> provides the command-line interface for running commands against Kubernetes clusters.</p>
<p>If you prefer using your local shell, you must install the gcloud and kubectl command-line tools in your environment.</p>
<h4 id="cloud-shell">Cloud shell</h4>
<p>To launch Cloud Shell, perform the following steps:</p>
<ol>
<li>Go to <a href="https://console.cloud.google.com/home/dashboard">Google Cloud Platform Console</a></li>
<li>From the top-right corner of the console, click the
<strong>Activate Google Cloud Shell</strong> button: <img alt="cloud shell" src="../../../../images/cloud-shell.png"></li>
<li>A Cloud Shell session opens inside a frame at the bottom of the console. Use this shell to run <code>gcloud</code> and <code>kubectl</code> commands.</li>
<li>Set a compute zone in your geographical region with the following command. The compute zone will be something like <code>us-west1-a</code>. A full list can be found <a href="https://cloud.google.com/compute/docs/regions-zones/#available">here</a>.
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcloud config <span style="color:#204a87">set</span> compute/zone <span style="color:#ce5c00;font-weight:bold">[</span>COMPUTE_ZONE<span style="color:#ce5c00;font-weight:bold">]</span>
</span></span></code></pre></div></li>
</ol>
<h4 id="local-shell">Local shell</h4>
<p>To install <code>gcloud</code> and <code>kubectl</code>, perform the following steps:</p>
<ol>
<li><a href="https://cloud.google.com/sdk/docs/quickstarts">Install the Google Cloud SDK</a>, which includes the <code>gcloud</code> command-line tool.</li>
<li>Initialize some default configuration by running the following command.
<ul>
<li>When asked <code>Do you want to configure a default Compute Region and Zone? (Y/n)?</code>, enter <code>Y</code> and choose a zone in your geographical region of choice.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcloud init
</span></span></code></pre></div></li>
<li>Install the <code>kubectl</code> command-line tool by running the following command:
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcloud components install kubectl
</span></span></code></pre></div></li>
</ol>
<h2 id="installation">Installation</h2>
<p>An example configuration can be found here:

<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>Terraform configuration with Code Blind submodule</a>.</p>
<p>Copy this file into a local directory where you will execute the terraform commands.</p>
<p>The GKE cluster created from the example configuration will contain 3 Node Pools:</p>
<ul>
<li><code>&quot;default&quot;</code> node pool with <code>&quot;game-server&quot;</code> tag, containing 4 nodes.</li>
<li><code>&quot;agones-system&quot;</code> node pool for Code Blind Controller.</li>
<li><code>&quot;agones-metrics&quot;</code> for monitoring and metrics collecting purpose.</li>
</ul>
<p>Configurable parameters:</p>
<ul>
<li>project - your Google Cloud Project ID (required)</li>
<li>name - the name of the GKE cluster (default is &ldquo;agones-terraform-example&rdquo;)</li>
<li>agones_version - the version of agones to install (an empty string, which is the default, is the latest version from the <a href="https://agones.dev/chart/stable">Helm repository</a>)</li>
<li>machine_type - machine type for hosting game servers (default is &ldquo;e2-standard-4&rdquo;)</li>
<li>node_count - count of game server nodes for the default node pool (default is &ldquo;4&rdquo;)</li>
<li>enable_image_streaming - whether or not to enable image streaming for the <code>&quot;default&quot;</code> node pool (default is true)</li>
<li>zone - (Deprecated, use location) the name of the <a href="https://cloud.google.com/compute/docs/regions-zones">zone</a> you want your cluster to be
created in (default is &ldquo;us-west1-c&rdquo;)</li>
<li>network - the name of the VPC network you want your cluster and firewall rules to be connected to (default is &ldquo;default&rdquo;)</li>
<li>subnetwork - the name of the subnetwork in which the cluster&rsquo;s instances are launched. (required when using non default network)</li>
<li>log_level - possible values: Fatal, Error, Warn, Info, Debug (default is &ldquo;info&rdquo;)</li>
<li>feature_gates - a list of alpha and beta version features to enable. For example, &ldquo;PlayerTracking=true&amp;ContainerPortAllocation=true&rdquo;</li>
<li>gameserver_minPort - the lower bound of the port range which gameservers will listen on (default is &ldquo;7000&rdquo;)</li>
<li>gameserver_maxPort - the upper bound of the port range which gameservers will listen on (default is &ldquo;8000&rdquo;)</li>
<li>gameserver_namespaces - a list of namespaces which will be used to run gameservers (default is <code>[&quot;default&quot;]</code>). For example <code>[&quot;default&quot;, &quot;xbox-gameservers&quot;, &quot;mobile-gameservers&quot;]</code></li>
<li>force_update - whether or not to force the replacement/update of resource (default is true, false may be required to prevent immutability errors when updating the configuration)</li>
<li>location - the name of the <a href="https://cloud.google.com/compute/docs/regions-zones">location</a> you want your cluster  to be created in (default is &ldquo;us-west1-c&rdquo;)</li>
<li>autoscale - whether you want to enable autoscale for the gameserver nodepool (default is false)</li>
<li>min_node_count - the minimum number of nodes for a nodepool when autoscale is enabled (default is &ldquo;1&rdquo;)</li>
<li>max_node_count - the maximum number of nodes for a nodepool when autoscale is enabled (default is &ldquo;5&rdquo;)</li>
</ul>


<div class="alert alert-warning" role="alert">
<h4 class="alert-heading">Warning</h4>

    <p>On the lines that read <code>source = &quot;git::https://github.com/googleforgames/agones.git//install/terraform/modules/gke/?ref=main&quot;</code>
make sure to change <code>?ref=main</code> to match your targeted Code Blind release, as Terraform modules can change between
releases.</p>
<p>For example, if you are targeting release-1.38.0, then you will want to have
<code>source = &quot;git::https://github.com/googleforgames/agones.git//install/terraform/modules/gke/?ref=release-1.38.0&quot;</code>
as your source.</p>


</div>

<h3 id="creating-the-cluster">Creating the cluster</h3>
<p>In the directory where you created <code>module.tf</code>, run:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>terraform init
</span></span></code></pre></div><p>This will cause terraform to clone the Code Blind repository and use the <code>./install/terraform</code> folder as the starting point of
the Code Blind submodule, which contains all necessary Terraform configuration files.</p>
<p>Next, make sure that you can authenticate using gcloud:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcloud auth application-default login
</span></span></code></pre></div><h4 id="option-1-creating-the-cluster-in-the-default-vpc">Option 1: Creating the cluster in the default VPC</h4>
<p>To create your GKE cluster in the default VPC just specify the project variable.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>terraform apply -var <span style="color:#000">project</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;&lt;YOUR_GCP_ProjectID&gt;&#34;</span>
</span></span></code></pre></div><h4 id="option-2-creating-the-cluster-in-a-custom-vpc">Option 2: Creating the cluster in a custom VPC</h4>
<p>To create the cluster in a custom VPC you must specify the project, network and subnetwork variables.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>terraform apply -var <span style="color:#000">project</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;&lt;YOUR_GCP_ProjectID&gt;&#34;</span> -var <span style="color:#000">network</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;&lt;YOUR_NETWORK_NAME&gt;&#34;</span> -var <span style="color:#000">subnetwork</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;&lt;YOUR_SUBNETWORK_NAME&gt;&#34;</span>
</span></span></code></pre></div><p>To verify that the cluster was created successfully, set up your kubectl credentials:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcloud container clusters get-credentials --zone us-west1-c agones-terraform-example
</span></span></code></pre></div><p>Then check that you have access to the Kubernetes cluster:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl get nodes
</span></span></code></pre></div><p>You should have 6 nodes in <code>Ready</code> state.</p>
<h3 id="uninstall-the-code-blind-and-delete-gke-cluster">Uninstall the Code Blind and delete GKE cluster</h3>
<p>To delete all resources provisioned by Terraform:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>terraform destroy -var <span style="color:#000">project</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;&lt;YOUR_GCP_ProjectID&gt;&#34;</span>
</span></span></code></pre></div><h2 id="next-steps">Next Steps</h2>
<ul>
<li><a href="/docs/installation/confirm/">Confirm Code Blind is up and running</a></li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-87b95dd171847daa29344497871d0251">3.3.2 - Installing Code Blind on AWS Elastic Kubernetes Service using Terraform</h1>
    <div class="lead">You can use Terraform to provision an EKS cluster and install Code Blind on it.</div>
	<h2 id="installation">Installation</h2>
<p>You can use Terraform to provision your Amazon EKS (Elastic Kubernetes Service) cluster and install Code Blind on it using the Helm Terraform provider.</p>
<p>An example of the EKS submodule config file can be found here:

<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>Terraform configuration with Code Blind submodule</a></p>
<p>Copy this file into a separate folder.</p>
<p>Configure your AWS CLI tool <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-configure.html">CLI configure</a>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>aws configure
</span></span></code></pre></div><p>Initialise your terraform:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>terraform init
</span></span></code></pre></div><h3 id="creating-cluster">Creating Cluster</h3>
<p>By editing <code>modules.tf</code> you can change the parameters that you need to. For instance, the - <code>machine_type</code> variable.</p>
<p>Configurable parameters:</p>
<ul>
<li>cluster_name - the name of the EKS cluster (default is &ldquo;agones-terraform-example&rdquo;)</li>
<li>agones_version - the version of agones to install (an empty string, which is the default, is the latest version from the <a href="https://agones.dev/chart/stable">Helm repository</a>)</li>
<li>machine_type - EC2 instance type for hosting game servers (default is &ldquo;t2.large&rdquo;)</li>
<li>region - the location of the cluster (default is &ldquo;us-west-2&rdquo;)</li>
<li>node_count - count of game server nodes for the default node pool (default is &ldquo;4&rdquo;)</li>
<li>log_level - possible values: Fatal, Error, Warn, Info, Debug (default is &ldquo;info&rdquo;)</li>
<li>feature_gates - a list of alpha and beta version features to enable. For example, &ldquo;PlayerTracking=true&amp;ContainerPortAllocation=true&rdquo;</li>
<li>gameserver_minPort - the lower bound of the port range which gameservers will listen on (default is &ldquo;7000&rdquo;)</li>
<li>gameserver_maxPort - the upper bound of the port range which gameservers will listen on (default is &ldquo;8000&rdquo;)</li>
<li>gameserver_namespaces - a list of namespaces which will be used to run gameservers (default is <code>[&quot;default&quot;]</code>). For example <code>[&quot;default&quot;, &quot;xbox-gameservers&quot;, &quot;mobile-gameservers&quot;]</code></li>
<li>force_update - whether or not to force the replacement/update of resource (default is true, false may be required to prevent immutability errors when updating the configuration)</li>
</ul>
<p>Now you can create an EKS cluster and deploy Code Blind on EKS:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>terraform apply <span style="color:#ce5c00;font-weight:bold">[</span>-var <span style="color:#000">agones_version</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;1.38.0&#34;</span><span style="color:#ce5c00;font-weight:bold">]</span>
</span></span></code></pre></div><p>After deploying the cluster with Code Blind, you can get or update your kubeconfig by using:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>aws eks --region us-west-2 update-kubeconfig --name agones-cluster
</span></span></code></pre></div><p>With the following output:</p>
<pre tabindex="0"><code>Added new context arn:aws:eks:us-west-2:601646756426:cluster/agones-cluster to /Users/user/.kube/config
</code></pre><p>Switch <code>kubectl</code> context to the recently created one:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl config use-context arn:aws:eks:us-west-2:601646756426:cluster/agones-cluster
</span></span></code></pre></div><p>Check that you are authenticated against the recently created Kubernetes cluster:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl get nodes
</span></span></code></pre></div><h3 id="uninstall-the-code-blind-and-delete-eks-cluster">Uninstall the Code Blind and delete EKS cluster</h3>
<p>Run the following commands to delete all Terraform provisioned resources:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>terraform destroy -target module.helm_agones.helm_release.agones -auto-approve <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> sleep <span style="color:#0000cf;font-weight:bold">60</span>
</span></span><span style="display:flex;"><span>terraform destroy
</span></span></code></pre></div>

<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Note</h4>

    There is an issue with the AWS Terraform provider:
<a href="https://github.com/terraform-providers/terraform-provider-aws/issues/9101">https://github.com/terraform-providers/terraform-provider-aws/issues/9101</a>
Due to this issue you should remove helm release first (as stated above),
otherwise <code>terraform destroy</code> will timeout and never succeed.
Remove all created resources manually in that case, namely: 3 Auto Scaling groups, EKS cluster, and a VPC with all dependent resources.

</div>


</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-bc8ff361c71609f0e8cdd22678d09ff8">3.3.3 - Installing Code Blind on Azure Kubernetes Service using Terraform</h1>
    <div class="lead">You can use Terraform to provision an AKS cluster and install Code Blind on it.</div>
	<h2 id="installation">Installation</h2>
<p>Install <code>az</code> utility by following <a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest">these instructions</a>.</p>
<p>The example of AKS submodule configuration could be found here:

<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>Terraform configuration with Code Blind submodule</a></p>
<p>Copy <code>module.tf</code> file into a separate folder.</p>
<p>Log in to Azure CLI:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>az login
</span></span></code></pre></div><p>Configure your terraform:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>terraform init
</span></span></code></pre></div><p>Create a service principal and configure its access to Azure resources:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>az ad sp create-for-rbac
</span></span></code></pre></div><p>Now you can deploy your cluster (use values from the above command output):</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>terraform apply -var <span style="color:#000">client_id</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;&lt;appId&gt;&#34;</span> -var <span style="color:#000">client_secret</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;&lt;password&gt;&#34;</span>
</span></span></code></pre></div><p>Once you created all resources on AKS you can get the credentials so that you can use <code>kubectl</code> to configure your cluster:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>az aks get-credentials --resource-group agonesRG --name test-cluster
</span></span></code></pre></div><p>Check that you have access to the Kubernetes cluster:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl get nodes
</span></span></code></pre></div><p>Configurable parameters:</p>
<ul>
<li>log_level - possible values: Fatal, Error, Warn, Info, Debug (default is &ldquo;info&rdquo;)</li>
<li>cluster_name - the name of the AKS cluster (default is &ldquo;agones-terraform-example&rdquo;)</li>
<li>agones_version - the version of agones to install (an empty string, which is the default, is the latest version from the <a href="https://agones.dev/chart/stable">Helm repository</a>)</li>
<li>machine_type - node machine type for hosting game servers (default is &ldquo;Standard_D2_v2&rdquo;)</li>
<li>disk_size - disk size of the node</li>
<li>region - the location of the cluster</li>
<li>node_count - count of game server nodes for the default node pool (default is &ldquo;4&rdquo;)</li>
<li>feature_gates - a list of alpha and beta version features to enable. For example, &ldquo;PlayerTracking=true&amp;ContainerPortAllocation=true&rdquo;</li>
<li>gameserver_minPort - the lower bound of the port range which gameservers will listen on (default is &ldquo;7000&rdquo;)</li>
<li>gameserver_maxPort - the upper bound of the port range which gameservers will listen on (default is &ldquo;8000&rdquo;)</li>
<li>gameserver_namespaces - a list of namespaces which will be used to run gameservers (default is <code>[&quot;default&quot;]</code>). For example <code>[&quot;default&quot;, &quot;xbox-gameservers&quot;, &quot;mobile-gameservers&quot;]</code></li>
<li>force_update - whether or not to force the replacement/update of resource (default is true, false may be required to prevent immutability errors when updating the configuration)</li>
</ul>
<h2 id="uninstall-the-code-blind-and-delete-aks-cluster">Uninstall the Code Blind and delete AKS cluster</h2>
<p>Run next command to delete all Terraform provisioned resources:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>terraform destroy
</span></span></code></pre></div><h2 id="reference">Reference</h2>
<p>Details on how you can authenticate your AKS terraform provider using official <a href="https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/guides/service_principal_client_secret">instructions</a>.</p>
<h2 id="next-steps">Next Steps</h2>
<ul>
<li><a href="/docs/installation/confirm/">Confirm Code Blind is up and running</a></li>
</ul>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-34aceca87fb9ffae4f142749784a1ea1">3.4 - Confirming Code Blind Installation</h1>
    <div class="lead">Verify Code Blind is installed and has started successfully.</div>
	<p>To confirm Code Blind is up and running, run the following command:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl describe --namespace agones-system pods
</span></span></code></pre></div><p>It should describe six pods created in the <code>agones-system</code> namespace, with no error messages or status. All <code>Conditions</code> sections should look like this:</p>
<pre tabindex="0"><code>Conditions:
  Type              Status
  Initialized       True
  Ready             True
  ContainersReady   True
  PodScheduled      True
</code></pre><p>All this pods should be in a <code>RUNNING</code> state:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl get pods --namespace agones-system
</span></span></code></pre></div><pre tabindex="0"><code>NAME                                 READY   STATUS    RESTARTS   AGE
agones-allocator-5c988b7b8d-cgtbs    1/1     Running   0          8m47s
agones-allocator-5c988b7b8d-hhhr5    1/1     Running   0          8m47s
agones-allocator-5c988b7b8d-pv577    1/1     Running   0          8m47s
agones-controller-7db45966db-56l66   1/1     Running   0          8m44s
agones-ping-84c64f6c9d-bdlzh         1/1     Running   0          8m37s
agones-ping-84c64f6c9d-sjgzz         1/1     Running   0          8m47s
</code></pre><p>That&rsquo;s it!</p>
<p>Now with Code Blind installed, you can utilise its <a href="https://kubernetes.io/docs/concepts/api-extension/custom-resources/">Custom Resource Definitions</a> to create
resources of type <code>GameServer</code>, <code>Fleet</code> and more!</p>
<h2 id="whats-next">What&rsquo;s next</h2>
<ul>
<li>Go through the <a href="https://codeblind.ai/docs/getting-started/create-gameserver/">Create a Game Server Quickstart</a></li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-be3b0f3fd44e1d99c89c139c84e9d1fa">3.5 - Upgrading Code Blind and Kubernetes</h1>
    <div class="lead">Strategies and techniques for managing Code Blind and Kubernetes upgrades in a safe manner.</div>
	

<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Note</h4>

    Whichever approach you take to upgrading Code Blind, make sure to test it in your development environment
before applying it to production.

</div>

<h2 id="upgrading-code-blind">Upgrading Code Blind</h2>
<p>The following are strategies for safely upgrading Code Blind from one version to another. They may require adjustment to
your particular game architecture but should provide a solid foundation for updating Code Blind safely.</p>
<p>The recommended approach is to use <a href="/docs/installation/upgrading/#upgrading-agones-multiple-clusters">multiple clusters</a>, such that the upgrade can be tested
gradually with production load and easily rolled back if the need arises.</p>


<div class="alert alert-warning" role="alert">
<h4 class="alert-heading">Warning</h4>

    Changing <a href="https://codeblind.ai/docs/guides/feature-stages/#feature-gates">Feature Gates</a> within your Code Blind install
can constitute an &ldquo;upgrade&rdquo; as it may create or remove functionality
in the Code Blind installation that may not be forward or backward compatible with installed resources in an existing
installation.

</div>

<h3 id="upgrading-code-blind-multiple-clusters">Upgrading Code Blind: Multiple Clusters</h3>
<p>We essentially want to transition our GameServer allocations from a cluster with the old version of Code Blind,
to a cluster with the upgraded version of Code Blind while ensuring nothing surprising
happens during this process.</p>
<p>This also allows easy rollback to the previous infrastructure that we already know to be working in production, with
minimal interruptions to player experience.</p>
<p>The following are steps to implement this:</p>
<ol>
<li>Create a new cluster of the same size or smaller as the current cluster.</li>
<li>Install the new version of Code Blind on the new cluster.</li>
<li>Deploy the same set of Fleets, GameServers and FleetAutoscalers from the old cluster into the new cluster.</li>
<li>With your matchmaker, start sending a small percentage of your matched players&rsquo; game sessions to the new cluster.</li>
<li>Assuming everything is working successfully on the new cluster, slowly increase the percentage of matched sessions to the new cluster, until you reach 100%.</li>
<li>Once you are comfortable with the stability of the new cluster with the new Code Blind version, shut down the old cluster.</li>
<li>Congratulations - you have now upgraded to a new version of Code Blind! 👍</li>
</ol>
<h3 id="upgrading-code-blind-single-cluster">Upgrading Code Blind: Single Cluster</h3>
<p>If you are upgrading a single cluster, we recommend creating a maintenance window, in which your game goes offline
for the period of your upgrade, as there will be a short period in which Code Blind will be non-responsive during the upgrade.</p>
<h4 id="installation-with-installyaml">Installation with install.yaml</h4>
<p>If you installed <a href="/docs/installation/install-agones/yaml/">Code Blind with install.yaml</a>, then you will need to delete
the previous installation of Code Blind before upgrading to the new version, as we need to remove all of Code Blind before installing
the new version.</p>
<ol>
<li>Start your maintenance window.</li>
<li>Delete the current set of Fleets, GameServers and FleetAutoscalers in your cluster.</li>
<li>Make sure to delete the same version of Code Blind that was previously installed, for example:
<code>kubectl delete -f https://raw.githubusercontent.com/googleforgames/agones/&lt;old-release-version&gt;/install/yaml/install.yaml</code></li>
<li>Install Code Blind <a href="/docs/installation/install-agones/yaml/">with install.yaml</a>.</li>
<li>Deploy the same set of Fleets, GameServers and FleetAutoscalers back into the cluster.</li>
<li>Run any other tests to ensure the Code Blind installation is working as expected.</li>
<li>Close your maintenance window.</li>
<li>Congratulations - you have now upgraded to a new version of Code Blind! 👍</li>
</ol>
<h4 id="installation-with-helm">Installation with Helm</h4>
<p>Helm features capabilities for upgrading to newer versions of Code Blind without having to uninstall Code Blind completely.</p>
<p>For details on how to use Helm for upgrades, see the <a href="https://v2.helm.sh/docs/helm/#helm-upgrade">helm upgrade</a> documentation.</p>
<p>Given the above, the steps for upgrade are simpler:</p>
<ol>
<li>Start your maintenance window.</li>
<li>Delete the current set of Fleets, GameServers and FleetAutoscalers in your cluster.</li>
<li>Run <code>helm upgrade</code> with the appropriate arguments, such a <code>--version</code>, for your specific upgrade</li>
<li>Deploy the same set of Fleets, GameServers and FleetAutoscalers back into the cluster.</li>
<li>Run any other tests to ensure the Code Blind installation is working as expected.</li>
<li>Close your maintenance window.</li>
<li>Congratulations - you have now upgraded to a new version of Code Blind! 👍</li>
</ol>
<h2 id="upgrading-kubernetes">Upgrading Kubernetes</h2>
<p>The following are strategies for safely upgrading the underlying Kubernetes cluster from one version to another.
They may require adjustment to your particular game architecture but should provide a solid foundation for updating your cluster safely.</p>
<p>The recommended approach is to use <a href="/docs/installation/upgrading/#multiple-clusters">multiple clusters</a>, such that the upgrade can be tested
gradually with production load and easily rolled back if the need arises.</p>
<p>Code Blind has <a href="/docs/installation/#agones-and-kubernetes-supported-versions">multiple supported Kubernetes versions</a> for each version. You can stick with a minor Kubernetes version until it is not supported by Code Blind, but it is recommended to do supported minor (e.g. 1.12.1 ➡ 1.13.2) Kubernetes version upgrades at the same time as a matching Code Blind upgrades.</p>
<p>Patch upgrades (e.g. 1.12.1 ➡ 1.12.3) within the same minor version of Kubernetes can be done at any time.</p>
<h3 id="multiple-clusters">Multiple Clusters</h3>
<p>This process is very similar to the <a href="/docs/installation/upgrading/#upgrading-agones-multiple-clusters">Upgrading Code Blind: Multiple Clusters</a> approach above.</p>
<p>We essentially want to transition our GameServer allocations from a cluster with the old version of Kubernetes,
to a cluster with the upgraded version of Kubernetes while ensuring nothing surprising
happens during this process.</p>
<p>This also allows easy rollback to the previous infrastructure that we already know to be working in production, with
minimal interruptions to player experience.</p>
<p>The following are steps to implement this:</p>
<ol>
<li>Create a new cluster of the same size or smaller as the current cluster, with the new version of Kubernetes</li>
<li>Install the same version of Code Blind on the new cluster, as you have on the previous cluster.</li>
<li>Deploy the same set of Fleets and/or GameServers from the old cluster into the new cluster.</li>
<li>With your matchmaker, start sending a small percentage of your matched players&rsquo; game sessions to the new cluster.</li>
<li>Assuming everything is working successfully on the new cluster, slowly increase the percentage of matched sessions to the new cluster, until you reach 100%.</li>
<li>Once you are comfortable with the stability of the new cluster with the new Kubernetes version, shut down the old cluster.</li>
<li>Congratulations - you have now upgraded to a new version of Kubernetes! 👍</li>
</ol>
<h3 id="single-cluster">Single Cluster</h3>
<p>If you are upgrading a single cluster, we recommend creating a maintenance window, in which your game goes offline
for the period of your upgrade, as there will be a short period in which Code Blind will be non-responsive during the node
upgrades.</p>
<ol>
<li>Start your maintenance window.</li>
<li>Scale your Fleets down to 0 and/or delete your GameServers. This is a good safety measure so there aren&rsquo;t race conditions
between the Code Blind controller being recreated and GameServers being deleted doesn&rsquo;t occur, and GameServers can end up stuck in erroneous states.</li>
<li>Start and complete your control plane upgrade(s).</li>
<li>Start and complete your node upgrades.</li>
<li>Scale your Fleets back up and/or recreate your GameServers.</li>
<li>Run any other tests to ensure the Code Blind installation is still working as expected.</li>
<li>Close your maintenance window.</li>
<li>Congratulations - you have now upgraded to a new version of Kubernetes! 👍</li>
</ol>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-81b64e5e890a35284f3748234c4098b1">4 - Getting Started</h1>
    <div class="lead">Quickstarts for getting up and running with Code Blind</div>
	
</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-1995d0d2405f561f81a874a6a93513aa">4.1 - Quickstart: Create a Game Server</h1>
    <div class="lead">This guide covers how you can quickly get started using Code Blind to create GameServers.</div>
	<h2 id="prerequisites">Prerequisites</h2>

<p>The following prerequisites are required to create a GameServer:</p>
<ol>
<li>A Kubernetes cluster with the UDP port range 7000-8000 open on each node.</li>
<li>Code Blind controller installed in the targeted cluster</li>
<li>kubectl properly configured</li>
<li>Netcat which is already installed on most Linux/macOS distributions, for windows you can use <a href="https://docs.microsoft.com/en-us/windows/wsl/install-win10">WSL</a>.</li>
</ol>
<p>If you don’t have a Kubernetes cluster you can follow <a href="/docs/installation/">these instructions</a> to create a cluster on Google Kubernetes Engine (GKE), Minikube or Azure Kubernetes Service (AKS), and install Code Blind.</p>
<p>For the purpose of this guide we’re going to use the
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/examples/simple-game-server/" target="_blank" data-proofer-ignore>simple-game-server</a>
 example as the GameServer container. This example is a very simple UDP server written in Go. Don’t hesitate to look at the code of this example for more information.</p>


<h2 id="objectives">Objectives</h2>
<ul>
<li>Create a GameServer in Kubernetes using Code Blind custom resource.</li>
<li>Get information about the GameServer such as IP address, port and state.</li>
<li>Connect to the GameServer.</li>
</ul>
<h3 id="1-create-a-gameserver">1. Create a GameServer</h3>
<p>Let&rsquo;s create a GameServer using the following command :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl create -f https://raw.githubusercontent.com/googleforgames/agones/release-1.38.0/examples/simple-game-server/gameserver.yaml
</span></span></code></pre></div><p>You should see a successful output similar to this :</p>
<pre tabindex="0"><code>gameserver.agones.dev/simple-game-server-4ss4j created
</code></pre><p>This has created a GameServer record inside Kubernetes, which has also created a backing <a href="https://kubernetes.io/docs/concepts/workloads/pods/pod/">Pod</a> to run our simple udp game server code in.
If you want to see all your running GameServers you can run:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl get gameservers
</span></span></code></pre></div><p>It should look something like this:</p>
<pre tabindex="0"><code>NAME                       STATE     ADDRESS       PORT   NODE     AGE
simple-game-server-7pjrq   Ready   35.233.183.43   7190   agones   3m
</code></pre><p>You can also see the <a href="https://kubernetes.io/docs/concepts/workloads/pods/pod/">Pod</a> that got created by running <code>kubectl get pods</code>, the Pod will be prefixed by <code>simple-game-server</code>.</p>
<pre tabindex="0"><code>NAME                        READY     STATUS    RESTARTS   AGE
simple-game-server-7pjrq    2/2       Running   0          5m
</code></pre><p>As you can see above it says <code>READY: 2/2</code> this means there are two containers running in this Pod, this is because Code Blind injected the <a href="https://agones.dev/docs/guides/troubleshooting/#how-do-i-see-the-logs-for-agones">SDK sidecar</a> for readiness
and health checking of your Game Server.</p>
<p>For the full details of the YAML file head to the <a href="https://codeblind.ai/docs/reference/gameserver/">GameServer Specification Guide</a></p>
<h3 id="2-fetch-the-gameserver-status">2. Fetch the GameServer Status</h3>
<p>Let&rsquo;s wait for the GameServer state to become <code>Ready</code>. You can use the <code>watch</code>
tool to see the state change. If your operating system does not have <code>watch</code>,
manually run <code>kubectl describe gameserver</code> until the state changes.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>watch kubectl describe gameserver
</span></span></code></pre></div><pre tabindex="0"><code>Name:         simple-game-server-7pjrq
Namespace:    default
Labels:       &lt;none&gt;
Annotations:  agones.dev/sdk-version: 0.9.0-764fa53
API Version:  agones.dev/v1
Kind:         GameServer
Metadata:
  Creation Timestamp:  2019-02-27T15:06:20Z
  Finalizers:
    agones.dev
  Generate Name:     simple-game-server-
  Generation:        1
  Resource Version:  30377
  Self Link:         /apis/agones.dev/v1/namespaces/default/gameservers/simple-game-server-7pjrq
  UID:               3d7ac3e1-3aa1-11e9-a4f5-42010a8a0019
Spec:
  Container:  simple-game-server
  Health:
    Failure Threshold:      3
    Initial Delay Seconds:  5
    Period Seconds:         5
  Ports:
    Container Port:  7654
    Host Port:       7190
    Name:            default
    Port Policy:     Dynamic
    Protocol:        UDP
  Scheduling:        Packed
  Template:
    Metadata:
      Creation Timestamp:  &lt;nil&gt;
    Spec:
      Containers:
        Image:  us-docker.pkg.dev/codeblind/examples/simple-server:0.27
        Name:   simple-game-server
        Resources:
          Limits:
            Cpu:     20m
            Memory:  32Mi
          Requests:
            Cpu:     20m
            Memory:  32Mi
Status:
  Address:    35.233.183.43
  Node Name:  agones
  Ports:
    Name:  default
    Port:  7190
  State:   Ready
Events:
  Type    Reason          Age   From                   Message
  ----    ------          ----  ----                   -------
  Normal  PortAllocation  34s   gameserver-controller  Port allocated
  Normal  Creating        34s   gameserver-controller  Pod simple-game-server-7pjrq created
  Normal  Scheduled       34s   gameserver-controller  Address and port populated
  Normal  Ready           27s   gameserver-controller  SDK.Ready() executed
</code></pre><p>If you look towards the bottom, you can see there is a <code>Status &gt; State</code> value. We are waiting for it to move to <code>Ready</code>, which means that the game server is ready to accept connections.</p>
<p>You might also be interested to see the <code>Events</code> section, which outlines when various lifecycle events of the <code>GameServer</code> occur. We can also see when the <code>GameServer</code> is ready on the event stream as well - at which time the <code>Status &gt; Address</code> and <code>Status &gt; Ports &gt; Port</code> have also been populated, letting us know what IP and port our client can now connect to!</p>
<p>Let&rsquo;s retrieve the IP address and the allocated port of your Game Server :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl get gs
</span></span></code></pre></div><p>This should output your Game Server IP address and ports, eg:</p>
<pre tabindex="0"><code>NAME                       STATE   ADDRESS         PORT   NODE     AGE
simple-game-server-7pjrq   Ready   35.233.183.43   7190   agones   4m
</code></pre>

<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Note</h4>

    If you have Code Blind installed on minikube, or other local Kubernetes tooling, and you are having issues connecting
to the <code>GameServer</code>, please check the
<a href="https://codeblind.ai/docs/installation/creating-cluster/minikube/#local-connection-workarounds">Minikube local connection workarounds</a>.

</div>

<h3 id="3-connect-to-the-gameserver">3. Connect to the GameServer</h3>


<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Note</h4>

    If you have Code Blind installed on Google Kubernetes Engine, and are using
Cloud Shell for your terminal, UDP is blocked. For this step, we recommend
SSH&rsquo;ing into a running VM in your project, such as a Kubernetes node.
You can click the &lsquo;SSH&rsquo; button on the <a href="https://console.cloud.google.com/compute/instances">Google Compute Engine Instances</a>
page to do this.
Run <code>toolbox</code> on GKE Node to run docker container with tools and then <code>nc</code> command would be available.

</div>

<p>You can now communicate with the Game Server :</p>


<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Note</h4>

    <p>If you do not have netcat installed
(i.e. you get a response of <code>nc: command not found</code>),
you can install netcat by running <code>sudo apt install netcat</code>.</p>
<p>If you are on Windows, you can alternatively install netcat on
<a href="https://docs.microsoft.com/en-us/windows/wsl/install-win10">WSL</a>,
or download a version of netcat for Windows from <a href="https://nmap.org/ncat/">nmap.org</a>.</p>


</div>

<pre tabindex="0"><code>nc -u {IP} {PORT}
Hello World !
ACK: Hello World !
EXIT
</code></pre><p>You can finally type <code>EXIT</code> which tells the SDK to run the <a href="https://codeblind.ai/docs/guides/client-sdks/#shutdown">Shutdown command</a>, and therefore shuts down the <code>GameServer</code>.</p>
<p>If you run <code>kubectl describe gameserver</code> again - either the GameServer will be gone completely, or it will be in <code>Shutdown</code> state, on the way to being deleted.</p>
<h2 id="next-step">Next Step</h2>
<p>If you want to use your own GameServer container make sure you have properly integrated the <a href="https://codeblind.ai/docs/guides/client-sdks/">Code Blind SDK</a>.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-f633728ddda1aa13c4e952cb0fffec2f">4.2 - Quickstart: Create a Game Server Fleet</h1>
    <div class="lead">This guide covers how you can quickly get started using Code Blind to create a Fleet of warm GameServers ready for you to allocate out of and play on!</div>
	<h2 id="prerequisites">Prerequisites</h2>

<p>The following prerequisites are required to create a GameServer:</p>
<ol>
<li>A Kubernetes cluster with the UDP port range 7000-8000 open on each node.</li>
<li>Code Blind controller installed in the targeted cluster</li>
<li>kubectl properly configured</li>
<li>Netcat which is already installed on most Linux/macOS distributions, for windows you can use <a href="https://docs.microsoft.com/en-us/windows/wsl/install-win10">WSL</a>.</li>
</ol>
<p>If you don’t have a Kubernetes cluster you can follow <a href="/docs/installation/">these instructions</a> to create a cluster on Google Kubernetes Engine (GKE), Minikube or Azure Kubernetes Service (AKS), and install Code Blind.</p>
<p>For the purpose of this guide we’re going to use the
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/examples/simple-game-server/" target="_blank" data-proofer-ignore>simple-game-server</a>
 example as the GameServer container. This example is a very simple UDP server written in Go. Don’t hesitate to look at the code of this example for more information.</p>


<p>While not required, you may wish to go through the <a href="/docs/getting-started/create-gameserver/">Create a Game Server</a> quickstart before this one.</p>
<h2 id="objectives">Objectives</h2>
<ul>
<li>Create a <a href="https://agones.dev/docs/reference/fleet/">Fleet</a> in Kubernetes using an Code Blind custom resource.</li>
<li>Scale the Fleet up from its initial configuration.</li>
<li>Request a GameServer allocation from the Fleet to play on.</li>
<li>Connect to the allocated GameServer.</li>
<li>Deploy a new GameServer configuration to the Fleet.</li>
</ul>
<h3 id="1-create-a-fleet">1. Create a Fleet</h3>
<p>Let&rsquo;s create a Fleet using the following command:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl apply -f https://raw.githubusercontent.com/googleforgames/agones/release-1.38.0/examples/simple-game-server/fleet.yaml
</span></span></code></pre></div><p>You should see a successful output similar to this :</p>
<pre tabindex="0"><code>fleet.agones.dev/simple-game-server created
</code></pre><p>This has created a Fleet record inside Kubernetes, which in turn creates two warm <a href="https://codeblind.ai/docs/reference/gameserver/">GameServers</a>
that are available to be allocated for a game session.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl get fleet
</span></span></code></pre></div><p>It should look something like this:</p>
<pre tabindex="0"><code>NAME                 SCHEDULING   DESIRED   CURRENT   ALLOCATED   READY     AGE
simple-game-server   Packed       2         3         0           2         9m
</code></pre><p>You can also see the GameServers that have been created by the Fleet by running <code>kubectl get gameservers</code>,
the GameServer will be prefixed by <code>simple-game-server</code>.</p>
<pre tabindex="0"><code>NAME                             STATE     ADDRESS            PORT   NODE      AGE
simple-game-server-llg4x-rx6rc   Ready     192.168.122.205    7752   minikube   9m
simple-game-server-llg4x-v6g2r   Ready     192.168.122.205    7623   minikube   9m
</code></pre><p>For the full details of the YAML file head to the <a href="https://codeblind.ai/docs/reference/fleet/">Fleet Specification Guide</a></p>


<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Note</h4>

    The game servers deployed from a <code>Fleet</code> resource will be deployed in the same namespace. The above example omits specifying a namespace, which implies both the <code>Fleet</code> and the associated <code>GameServer</code> resources will be deployed to the <code>default</code> namespace.

</div>

<h3 id="2-fetch-the-fleet-status">2. Fetch the Fleet status</h3>
<p>Let&rsquo;s wait for the two <code>GameServers</code> to become ready.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>watch kubectl describe fleet simple-game-server
</span></span></code></pre></div><pre tabindex="0"><code>Name:         simple-game-server
Namespace:    default
Labels:       &lt;none&gt;
Annotations:  kubectl.kubernetes.io/last-applied-configuration={&#34;apiVersion&#34;:&#34;agones.dev/v1&#34;,&#34;kind&#34;:&#34;Fleet&#34;,&#34;metadata&#34;:{&#34;annotations&#34;:{},&#34;name&#34;:&#34;simple-game-server&#34;,&#34;namespace&#34;:&#34;default&#34;},&#34;spec&#34;:{&#34;replicas&#34;:2,...
API Version:  agones.dev/v1
Kind:         Fleet
Metadata:
  Cluster Name:
  Creation Timestamp:  2018-07-01T18:55:35Z
  Generation:          1
  Resource Version:    24685
  Self Link:           /apis/agones.dev/v1/namespaces/default/fleets/simple-game-server
  UID:                 56710a91-7d60-11e8-b2dd-08002703ef08
Spec:
  Replicas:  2
  Strategy:
    Rolling Update:
      Max Surge:        25%
      Max Unavailable:  25%
    Type:               RollingUpdate
  Template:
    Metadata:
      Creation Timestamp:  &lt;nil&gt;
    Spec:
      Health:
      Ports:
        Container Port:  7654
        Name:            default
        Port Policy:     Dynamic
      Template:
        Metadata:
          Creation Timestamp:  &lt;nil&gt;
        Spec:
          Containers:
            Image:  us-docker.pkg.dev/codeblind/examples/simple-server:0.27
            Name:   simple-game-server
            Resources:
Status:
  Allocated Replicas:  0
  Ready Replicas:      2
  Replicas:            2
Events:
  Type    Reason                 Age   From              Message
  ----    ------                 ----  ----              -------
  Normal  CreatingGameServerSet  13s   fleet-controller  Created GameServerSet simple-game-server-wlqnd
</code></pre><p>If you look towards the bottom, you can see there is a section of <code>Status &gt; Ready Replicas</code> which will tell you
how many <code>GameServers</code> are currently in a Ready state. After a short period, there should be 2 <code>Ready Replicas</code>.</p>
<h3 id="3-scale-up-the-fleet">3. Scale up the Fleet</h3>
<p>Let&rsquo;s scale up the <code>Fleet</code> from 2 <code>replicates</code> to 5.</p>
<p>Run <code>kubectl scale fleet simple-game-server --replicas=5</code> to change Replicas count from 2 to 5.</p>
<p>If we now run <code>kubectl get gameservers</code> we should see 5 <code>GameServers</code> prefixed by <code>simple-game-server</code>.</p>
<pre tabindex="0"><code>NAME                             STATE    ADDRESS           PORT    NODE       AGE
simple-game-server-sdhzn-kcmh6   Ready    192.168.122.205   7191    minikube   52m
simple-game-server-sdhzn-pdpk5   Ready    192.168.122.205   7752    minikube   53m
simple-game-server-sdhzn-r4d6x   Ready    192.168.122.205   7623    minikube   52m
simple-game-server-sdhzn-wng5k   Ready    192.168.122.205   7709    minikube   53m
simple-game-server-sdhzn-wnhsw   Ready    192.168.122.205   7478    minikube   52m
</code></pre><h3 id="4-allocate-a-game-server-from-the-fleet">4. Allocate a Game Server from the Fleet</h3>
<p>Since we have a fleet of warm gameservers, we need a way to request one of them for usage, and mark that it has
players accessing it (and therefore, it should not be deleted until they are finished with it).</p>


<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Note</h4>

    In production, you would likely do the following through a <a href="https://codeblind.ai/docs/guides/access-api/">Kubernetes API call</a>, but we can also
do this through <code>kubectl</code> as well, and ask it to return the response in yaml so that we can see what has happened.

</div>

<p>We can do the allocation of a GameServer for usage through a <code>GameServerAllocation</code>, which will both
return to us the details of a <code>GameServer</code> (assuming one is available), and also move it to the <code>Allocated</code> state,
which demarcates that it has players on it, and should not be removed until <code>SDK.Shutdown()</code> is called, or it is manually deleted.</p>
<p>It is worth noting that there is nothing specific that ties a <code>GameServerAllocation</code> to a fleet.
A <code>GameServerAllocation</code> uses a <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/">label selector</a>
to determine what group of <code>GameServers</code> it will attempt to allocate out of. That being said, a <code>Fleet</code> and <code>GameServerAllocation</code>
are often used in conjunction.</p>
<p>
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>This example</a> uses the label selector to specifically target the <code>simple-game-server</code> fleet that we just created.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl create -f https://raw.githubusercontent.com/googleforgames/agones/release-1.38.0/examples/simple-game-server/gameserverallocation.yaml -o yaml
</span></span></code></pre></div><p>For the full details of the YAML file head to the <a href="https://codeblind.ai/docs/reference/gameserverallocation/">GameServerAllocation Specification Guide</a></p>
<p>You should get back a response that looks like the following:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">allocation.agones.dev/v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">GameServerAllocation</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">creationTimestamp</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">2019-02-19T02:13:12Z</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">simple-game-server-dph9b-hfk24</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">namespace</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">default</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">required</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">matchLabels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">agones.dev/fleet</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">simple-game-server</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">scheduling</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Packed</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">status</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">address</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">192.168.122.152</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">gameServerName</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">simple-game-server-dph9b-hfk24</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">nodeName</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minikube</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">ports</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">default</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">port</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">7714</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">state</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Allocated</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>If you look at the <code>status</code> section, there are several things to take note of. The <code>state</code> value will tell if
a <code>GameServer</code> was allocated or not. If a <code>GameServer</code> could not be found, this will be set to <code>UnAllocated</code>.
If there are too many concurrent requests overwhelmed the system, <code>state</code> will be set to
<code>Contention</code> even though there are available <code>GameServers</code>.</p>
<p>However, we see that the <code>status.state</code> value was set to <code>Allocated</code>.
This means you have been successfully allocated a <code>GameServer</code> out of the fleet, and you can now connect your players to it!</p>
<p>You can see various immutable details of the <code>GameServer</code> in the status - the <code>address</code>, <code>ports</code> and the name
of the <code>GameServer</code>, in case you want to use it to retrieve more details.</p>
<p>We can also check to see how many <code>GameServers</code> you have <code>Allocated</code> vs <code>Ready</code> with the following command
(&ldquo;gs&rdquo; is shorthand for &ldquo;gameserver&rdquo;).</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl get gs
</span></span></code></pre></div><p>This will get you a list of all the current <code>GameServers</code> and their <code>Status.State</code>.</p>
<pre tabindex="0"><code>NAME                             STATE       ADDRESS           PORT   NODE      AGE
simple-game-server-sdhzn-kcmh6   Ready       192.168.122.205   7191   minikube  52m
simple-game-server-sdhzn-pdpk5   Ready       192.168.122.205   7752   minikube  53m
simple-game-server-sdhzn-r4d6x   Allocated   192.168.122.205   7623   minikube  52m
simple-game-server-sdhzn-wng5k   Ready       192.168.122.205   7709   minikube  53m
simple-game-server-sdhzn-wnhsw   Ready       192.168.122.205   7478   minikube  52m
</code></pre>

<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Note</h4>

    <code>GameServerAllocations</code> are create only and not stored for performance reasons, so you won&rsquo;t be able to list
them after they have been created - but you can see their effects on <code>GameServers</code>

</div>

<p>A handy trick for checking to see how many <code>GameServers</code> you have <code>Allocated</code> vs <code>Ready</code>, run the following:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl get gs
</span></span></code></pre></div><p>This will get you a list of all the current <code>GameServers</code> and their <code>Status &gt; State</code>.</p>
<pre tabindex="0"><code>NAME                             STATE       ADDRESS          PORT   NODE        AGE
simple-game-server-tfqn7-c9tqz   Ready       192.168.39.150   7136   minikube    52m
simple-game-server-tfqn7-g8fhq   Allocated   192.168.39.150   7148   minikube    53m
simple-game-server-tfqn7-p8wnl   Ready       192.168.39.150   7453   minikube    52m
simple-game-server-tfqn7-t6bwp   Ready       192.168.39.150   7228   minikube    53m
simple-game-server-tfqn7-wkb7b   Ready       192.168.39.150   7226   minikube    52m
</code></pre><h3 id="5-scale-down-the-fleet">5. Scale down the Fleet</h3>
<p>Not only can we scale our fleet up, but we can scale it down as well.</p>
<p>The nice thing about Code Blind is that it is smart enough to know when <code>GameServers</code> have been moved to <code>Allocated</code>
and will automatically leave them running on scale down &ndash; as we assume that players are playing on this game server,
and we shouldn&rsquo;t disconnect them!</p>
<p>Let&rsquo;s scale down our Fleet to 0 (yep! you can do that!), and watch what happens.</p>
<p>Run <code>kubectl scale fleet simple-game-server --replicas=0</code> to change Replicas count from 5 to 0.</p>
<p>It may take a moment for all the <code>GameServers</code> to shut down, so let&rsquo;s watch them all and see what happens:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>watch kubectl get gs
</span></span></code></pre></div><p>Eventually, one by one they will be removed from the list, and you should simply see:</p>
<pre tabindex="0"><code>NAME                             STATUS      ADDRESS          PORT    NODE       AGE
simple-game-server-tfqn7-g8fhq   Allocated   192.168.39.150   7148    minikube   55m
</code></pre><p>That lone <code>Allocated</code> <code>GameServer</code> is left all alone, but still running!</p>
<p>If you would like, try editing the <code>Fleet</code> configuration <code>replicas</code> field and watch the list of <code>GameServers</code>
grow and shrink.</p>
<h3 id="6-connect-to-the-gameserver">6. Connect to the GameServer</h3>
<p>Since we&rsquo;ve only got one allocation, we&rsquo;ll just grab the details of the IP and port of the
only allocated <code>GameServer</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl get gameservers <span style="color:#000;font-weight:bold">|</span> grep Allocated <span style="color:#000;font-weight:bold">|</span> awk <span style="color:#4e9a06">&#39;{print $3&#34;:&#34;$4 }&#39;</span>
</span></span></code></pre></div><p>This should output your Game Server IP address and port. (eg <code>10.130.65.208:7936</code>)</p>
<p>You can now communicate with the <code>GameServer</code>:</p>
<pre tabindex="0"><code>nc -u {IP} {PORT}
Hello World !
ACK: Hello World !
EXIT
</code></pre><p>You can finally type <code>EXIT</code> which tells the SDK to run the <a href="https://codeblind.ai/docs/guides/client-sdks/#shutdown">Shutdown command</a>, and therefore shuts down the <code>GameServer</code>.</p>
<p>If you run <code>kubectl describe gs | grep State</code> again - either the GameServer will be replaced with a new, <code>Ready</code> <code>GameServer</code>
, or it will be in <code>Shutdown</code> state, on the way to being deleted.</p>
<p>Since we are running a <code>Fleet</code>, Code Blind will always do it&rsquo;s best to ensure there are always the configured number
of <code>GameServers</code> in the pool in either a <code>Ready</code> or <code>Allocated</code> state.</p>
<h3 id="7-deploy-a-new-version-of-the-gameserver-on-the-fleet">7. Deploy a new version of the GameServer on the Fleet</h3>
<p>We can also change the configuration of the <code>GameServer</code> of the running <code>Fleet</code>, and have the changes
roll out, without interrupting the currently <code>Allocated</code> <code>GameServers</code>.</p>
<p>Let&rsquo;s take this for a spin! Run <code>kubectl scale fleet simple-game-server --replicas=5</code> to return Replicas count back to 5.</p>
<p>Let&rsquo;s also allocate ourselves a <code>GameServer</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl create -f https://raw.githubusercontent.com/googleforgames/agones/release-1.38.0/examples/simple-game-server/gameserverallocation.yaml -o yaml
</span></span></code></pre></div><p>We should now have four <code>Ready</code> <code>GameServers</code> and one <code>Allocated</code>.</p>
<p>We can check this by running <code>kubectl get gs</code>.</p>
<pre tabindex="0"><code>NAME                             STATE       ADDRESS          PORT   NODE       AGE
simple-game-server-tfqn7-c9tz7   Ready       192.168.39.150   7136   minikube   5m
simple-game-server-tfqn7-g8fhq   Allocated   192.168.39.150   7148   minikube   5m
simple-game-server-tfqn7-n0wnl   Ready       192.168.39.150   7453   minikube   5m
simple-game-server-tfqn7-hiiwp   Ready       192.168.39.150   7228   minikube   5m
simple-game-server-tfqn7-w8z7b   Ready       192.168.39.150   7226   minikube   5m
</code></pre><p>In production, we&rsquo;d likely be changing a <code>containers &gt; image</code> configuration to update our <code>Fleet</code>
to run a new game server process, but to make this example simple, change <code>containerPort</code> from <code>7654</code>
to <code>6000</code>.</p>
<p>Run <code>kubectl edit fleet simple-game-server</code>, and make the necessary changes, and then save and exit your editor.</p>
<p>This will start the deployment of a new set of <code>GameServers</code> running
with a Container Port of <code>6000</code>.</p>


<div class="alert alert-warning" role="alert">
<h4 class="alert-heading">Warning</h4>

    This will make it such that you can no longer connect to the simple-game-server game server.

</div>

<p>Run <code>kubectl describe gs | grep &quot;Container Port&quot;</code>
until you can see that there is
one with a containerPort of <code>7654</code>, which is the <code>Allocated</code> <code>GameServer</code>, and four instances with a containerPort of <code>6000</code> which
is the new configuration. You can also run <code>kubectl get gs</code> and look at the <strong>Age</strong> column to see that one <code>GameServer</code> is much
older than the other four.</p>
<p>You have now deployed a new version of your game!</p>
<h2 id="next-steps">Next Steps</h2>
<ul>
<li>Have a look at the <a href="https://codeblind.ai/docs/reference/gameserverallocation/">GameServerAllocation specification</a>, and see
how the extra functionality can enable smoke testing, server information communication, and more.</li>
<li>You can now create a fleet autoscaler to automatically resize your fleet based on the actual usage.
See <a href="/docs/getting-started/create-fleetautoscaler/">Create a Fleet Autoscaler</a>.</li>
<li>Have a look at the <a href="https://codeblind.ai/docs/integration-patterns/">GameServer Integration Patterns</a>,
to give you a set of examples on how all the pieces fit together with your matchmaker and other systems.</li>
<li>Or if you want to try to use your own GameServer container make sure you have properly integrated the <a href="https://codeblind.ai/docs/guides/client-sdks/">Code Blind SDK</a>.</li>
<li>If you would like to learn how to programmatically allocate a Game Server from the fleet, see how to <a href="/docs/guides/access-api/">Access Code Blind via the Kubernetes API</a> or alternatively use the <a href="/docs/advanced/allocator-service/">Allocator Service</a>, depending on your needs.</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-b26271778305c658b9e01a31ccaf98b4">4.3 - Quickstart: Create a Fleet Autoscaler</h1>
    <div class="lead">This guide covers how you can quickly get started using Code Blind to create a Fleet  Autoscaler to manage your fleet size automatically, based on actual load.</div>
	<h2 id="prerequisites">Prerequisites</h2>
<p>It is assumed that you have followed the instructions to <a href="https://codeblind.ai/docs/getting-started/create-fleet/">Create a Game Server Fleet</a>
and you have a running fleet of game servers.</p>
<h2 id="objectives">Objectives</h2>
<ul>
<li>Create a Fleet Autoscaler in Kubernetes using Code Blind custom resource.</li>
<li>Watch the Fleet scale up when allocating GameServers</li>
<li>Watch the Fleet scale down when shutting down allocated GameServers</li>
<li>Edit the autoscaler specification to apply live changes</li>
</ul>
<h3 id="1-create-a-fleet-autoscaler">1. Create a Fleet Autoscaler</h3>
<p>Let&rsquo;s create a Fleet Autoscaler using the following command :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl apply -f https://raw.githubusercontent.com/googleforgames/agones/release-1.38.0/examples/simple-game-server/fleetautoscaler.yaml
</span></span></code></pre></div><p>You should see a successful output similar to this :</p>
<pre tabindex="0"><code>fleetautoscaler.autoscaling.agones.dev/simple-game-server-autoscaler created
</code></pre><p>This has created a FleetAutoscaler record inside Kubernetes.</p>
<h3 id="2-see-the-autoscaler-status">2. See the autoscaler status.</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl describe fleetautoscaler simple-game-server-autoscaler
</span></span></code></pre></div><p>It should look something like this:</p>
<pre tabindex="0"><code>Name:         simple-game-server-autoscaler
Namespace:    default
Labels:       &lt;none&gt;
Annotations:  kubectl.kubernetes.io/last-applied-configuration={&#34;apiVersion&#34;:&#34;au
toscaling.agones.dev/v1&#34;,&#34;kind&#34;:&#34;FleetAutoscaler&#34;,&#34;metadata&#34;:{&#34;annotations&#34;:{},
&#34;name&#34;:&#34;simple-game-server-autoscaler&#34;,&#34;namespace&#34;:&#34;default&#34;},...
API Version:  autoscaling.agones.dev/v1
Kind:         FleetAutoscaler
Metadata:
  Cluster Name:
  Creation Timestamp:  2018-10-02T15:19:58Z
  Generation:          1
  Owner References:
    API Version:           autoscaling.agones.dev/v1
    Block Owner Deletion:  true
    Controller:            true
    Kind:                  Fleet
    Name:                  simple-game-server
    UID:                   9960762e-c656-11e8-933e-fa163e07a1d4
  Resource Version:        6123197
  Self Link:               /apis/autoscaling.agones.dev/v1/namespaces/default/fleetautoscalers/simple-game-server-autoscaler
  UID:                     9fd0efa1-c656-11e8-933e-fa163e07a1d4
Spec:
  Fleet Name:  simple-game-server
  Policy:
    Buffer:
      Buffer Size:   2
      Max Replicas:  10
      Min Replicas:  2
    Type:            Buffer
Status:
  Able To Scale:     true
  Current Replicas:  2
  Desired Replicas:  2
  Last Scale Time:   &lt;nil&gt;
  Scaling Limited:   false
Events:              &lt;none&gt;
</code></pre><p>You can see the status (able to scale, not limited), the last time the fleet was scaled (nil for never)
and the current and desired fleet size.</p>
<p>The autoscaler works by changing the desired size, and the fleet creates/deletes game server instances
to achieve that number. The convergence is achieved in time, which is usually measured in seconds.</p>
<h3 id="3-allocate-a-game-server-from-the-fleet">3. Allocate a Game Server from the Fleet</h3>
<p>If you&rsquo;re interested in more details for game server allocation, you should consult the <a href="https://codeblind.ai/docs/getting-started/create-fleet/">Create a Game Server Fleet</a> page.
In here we are only interested in triggering allocations to see the autoscaler in action.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl create -f https://raw.githubusercontent.com/googleforgames/agones/release-1.38.0/examples/simple-game-server/gameserverallocation.yaml -o yaml
</span></span></code></pre></div><p>You should get in return the allocated game server details, which should end with something like:</p>
<pre tabindex="0"><code>status:
  address: 34.94.118.237
  gameServerName: simple-game-server-v6jwb-6bzkz
  nodeName: gke-test-cluster-default-f11755a7-5km3
  ports:
  - name: default
    port: 7832
  state: Allocated
</code></pre><p>Note the address and port, you might need them later to connect to the server.</p>
<h3 id="4-see-the-autoscaler-in-action">4. See the autoscaler in action</h3>
<p>Now let&rsquo;s wait a few seconds to allow the autoscaler to detect the change in the fleet and check again its status</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl describe fleetautoscaler simple-game-server-autoscaler
</span></span></code></pre></div><p>The last part should look something like this:</p>
<pre tabindex="0"><code>Spec:
  Fleet Name:  simple-game-server
  Policy:
    Buffer:
      Buffer Size:   2
      Max Replicas:  10
      Min Replicas:  2
    Type:            Buffer
Status:
  Able To Scale:     true
  Current Replicas:  3
  Desired Replicas:  3
  Last Scale Time:   2018-10-02T16:00:02Z
  Scaling Limited:   false
Events:
  Type    Reason            Age   From                        Message
  ----    ------            ----  ----                        -------
  Normal  AutoScalingFleet  2m    fleetautoscaler-controller  Scaling fleet simple-game-server from 2 to 3
</code></pre><p>You can see that the fleet size has increased, the autoscaler having compensated for the allocated instance.
Last Scale Time has been updated, and a scaling event has been logged.</p>
<p>Double-check the actual number of game server instances and status by running</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl get gs
</span></span></code></pre></div><p>This will get you a list of all the current <code>GameServers</code> and their <code>Status &gt; State</code>.</p>
<pre tabindex="0"><code>NAME                             STATE       ADDRESS        PORT     NODE        AGE
simple-game-server-mzhrl-hz8wk   Allocated   10.30.64.99    7131     minikube    5m
simple-game-server-mzhrl-k6jg5   Ready       10.30.64.100   7243     minikube    5m  
simple-game-server-mzhrl-n2sk2   Ready       10.30.64.168   7658     minikube    5m
</code></pre><h3 id="5-shut-the-allocated-instance-down">5. Shut the allocated instance down</h3>
<p>Since we&rsquo;ve only got one allocation, we&rsquo;ll just grab the details of the IP and port of the
only allocated <code>GameServer</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl get gameservers <span style="color:#000;font-weight:bold">|</span> grep Allocated <span style="color:#000;font-weight:bold">|</span> awk <span style="color:#4e9a06">&#39;{print $3&#34;:&#34;$4 }&#39;</span>
</span></span></code></pre></div><p>This should output your Game Server IP address and port. (eg <code>10.130.65.208:7936</code>)</p>
<p>You can now communicate with the <code>GameServer</code>:</p>
<pre tabindex="0"><code>nc -u {IP} {PORT}
Hello World !
ACK: Hello World !
EXIT
</code></pre><p>You can finally type <code>EXIT</code> which tells the SDK to run the <a href="https://codeblind.ai/docs/guides/client-sdks/#shutdown">Shutdown command</a>, and therefore shuts down the <code>GameServer</code>.</p>
<h3 id="6-see-the-fleet-scaling-down">6. See the fleet scaling down</h3>
<p>Now let&rsquo;s wait a few seconds to allow the autoscaler to detect the change in the fleet and check again its status</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl describe fleetautoscaler simple-game-server-autoscaler
</span></span></code></pre></div><p>It should look something like this:</p>
<pre tabindex="0"><code>Spec:
  Fleet Name:  simple-game-server
  Policy:
    Buffer:
      Buffer Size:   2
      Max Replicas:  10
      Min Replicas:  2
    Type:            Buffer
Status:
  Able To Scale:     true
  Current Replicas:  3
  Desired Replicas:  2
  Last Scale Time:   2018-10-02T16:09:02Z
  Scaling Limited:   false
Events:
  Type    Reason            Age   From                        Message
  ----    ------            ----  ----                        -------
  Normal  AutoScalingFleet  9m    fleetautoscaler-controller  Scaling fleet simple-game-server from 2 to 3
  Normal  AutoScalingFleet  45s   fleetautoscaler-controller  Scaling fleet simple-game-server from 3 to 2
</code></pre><p>You can see that the fleet size has decreased, the autoscaler adjusting to game server instance being de-allocated,
the Last Scale Time and the events have been updated. Note that simple-game-server game server instance you just closed earlier
might stay a bit in &lsquo;Unhealthy&rsquo; state (and its pod in &lsquo;Terminating&rsquo; until it gets removed.</p>
<p>Double-check the actual number of game server instances and status by running</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl get gs
</span></span></code></pre></div><p>This will get you a list of all the current <code>GameServers</code> and their <code>Status &gt; State</code>.</p>
<pre tabindex="0"><code>NAME                             STATE     ADDRESS        PORT    NODE       AGE
simple-game-server-mzhrl-k6jg5   Ready     10.30.64.100   7243    minikube   5m
simple-game-server-mzhrl-t7944   Ready     10.30.64.168   7561    minikube   5m
</code></pre><h3 id="7-change-autoscaling-parameters">7. Change autoscaling parameters</h3>
<p>We can also change the configuration of the <code>FleetAutoscaler</code> of the running <code>Fleet</code>, and have the changes
applied live, without interruptions of service.</p>
<p>Run <code>kubectl edit fleetautoscaler simple-game-server-autoscaler</code> and set the <code>bufferSize</code> field to <code>5</code>.</p>
<p>Let&rsquo;s look at the list of game servers again. Run <code>watch kubectl get gs</code>
until you can see that are 5 ready server instances:</p>
<pre tabindex="0"><code>NAME                             STATE     ADDRESS        PORT    NODE         AGE
simple-game-server-mzhrl-7jpkp   Ready     10.30.64.100   7019    minikube     5m
simple-game-server-mzhrl-czt8v   Ready     10.30.64.168   7556    minikube     5m
simple-game-server-mzhrl-k6jg5   Ready     10.30.64.100   7243    minikube     5m
simple-game-server-mzhrl-nb8h2   Ready     10.30.64.168   7357    minikube     5m
simple-game-server-mzhrl-qspb6   Ready     10.30.64.99    7859    minikube     5m
simple-game-server-mzhrl-zg9rq   Ready     10.30.64.99    7745    minikube     5m
</code></pre>

<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Note</h4>

    <p>If you want to update a <code>Fleet</code> which has <code>RollingUpdate</code> replacement strategy and is controlled by a <code>FleetAutoscaler</code>:</p>
<ol>
<li>With <code>kubectl apply</code>: you should omit <code>replicas</code> parameter in a <code>Fleet</code> Spec before re-applying the <code>Fleet</code> configuration.</li>
<li>With <code>kubectl edit</code>: you should not change the <code>replicas</code> parameter in the <code>Fleet</code> Spec when updating other field parameters.</li>
</ol>
<p>If you follow the rules above, then the <code>maxSurge</code> and <code>maxUnavailable</code> parameters will be used as the RollingUpdate strategy updates your Fleet.
Otherwise the Fleet would be scaled according to Fleet <code>replicas</code> parameter first and only after a certain amount of time it would be rescaled to fit <code>FleetAutoscaler</code> <code>BufferSize</code> parameter.</p>
<p>You could also check the behaviour of the Fleet with Fleetautoscaler on a test <code>Fleet</code> to preview what would occur in your production environment.</p>


</div>

<h2 id="next-steps">Next Steps</h2>
<p>Read the advanced <a href="/docs/advanced/scheduling-and-autoscaling/">Scheduling and Autoscaling</a> guide, for more details on autoscaling.</p>
<p>If you want to use your own GameServer container make sure you have properly integrated the <a href="https://codeblind.ai/docs/guides/client-sdks/">Code Blind SDK</a>.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-41eab8b673334ca9325b8ab33261f1a3">4.4 - Quickstart: Create a Fleet Autoscaler with Webhook Policy</h1>
    <div class="lead">This guide covers how you can create a webhook fleet autoscaler policy.</div>
	<p>In some cases, your game servers may need to use custom logic for scaling your fleet that is more complex than what
can be expressed using the Buffer policy in the fleetautoscaler. This guide shows how you can extend Code Blind
with an autoscaler webhook to implement a custom autoscaling policy.</p>
<p>When you use an autoscaler webhook the logic computing the number of target replicas is delegated to an external
HTTP/S endpoint, such as one provided by a Kubernetes deployment and service in the same cluster (as shown in the
examples below). The fleetautoscaler will send a request to the webhook autoscaler&rsquo;s <code>/scale</code> endpoint every sync
period (currently 30s) with a JSON body, and scale the target fleet based on the data that is returned.</p>
<h2 id="chapter-1-configuring-http-fleetautoscaler-webhook">Chapter 1 Configuring HTTP fleetautoscaler webhook</h2>
<h3 id="prerequisites">Prerequisites</h3>
<p>It is assumed that you have completed the instructions to <a href="/docs/getting-started/create-fleet/">Create a Game Server Fleet</a> and have a running fleet of game servers.</p>
<h3 id="objectives">Objectives</h3>
<ul>
<li>Run a fleet</li>
<li>Deploy the Webhook Pod and service for autoscaling</li>
<li>Create a Fleet Autoscaler with Webhook policy type in Kubernetes using Code Blind custom resource</li>
<li>Watch the Fleet scales up when allocating GameServers</li>
<li>Watch the Fleet scales down after GameServer shutdown</li>
</ul>
<h4 id="1-deploy-the-fleet">1. Deploy the fleet</h4>
<p>Run a fleet in a cluster:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl apply -f https://raw.githubusercontent.com/googleforgames/agones/release-1.38.0/examples/simple-game-server/fleet.yaml
</span></span></code></pre></div><h4 id="2-deploy-a-webhook-service-for-autoscaling">2. Deploy a Webhook service for autoscaling</h4>
<p>In this step we would deploy an example webhook that will control the size of the fleet based on allocated gameservers
portion in a fleet. You can see the source code for this example webhook server 
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>here</a>.
The fleetautoscaler would trigger this endpoint every 30 seconds. More details could be found 
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>also here</a>.
We need to create a pod which will handle HTTP requests with json payload
<a href="/docs/reference/fleetautoscaler/#webhook-endpoint-specification"><code>FleetAutoscaleReview</code></a> and return back it
with <a href="/docs/reference/fleetautoscaler/#webhook-endpoint-specification"><code>FleetAutoscaleResponse</code></a> populated.</p>
<p>The <code>Scale</code> flag and <code>Replicas</code> values returned in the <code>FleetAutoscaleResponse</code> tells the FleetAutoscaler what target size the backing Fleet should be scaled up or down to. If <code>Scale</code> is false - no scaling occurs.</p>
<p>Run next command to create a service and a Webhook pod in a cluster:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl apply -f https://raw.githubusercontent.com/googleforgames/agones/release-1.38.0/examples/autoscaler-webhook/autoscaler-service.yaml
</span></span></code></pre></div><p>To check that it is running and liveness probe is fine:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl describe pod autoscaler-webhook
</span></span></code></pre></div><pre tabindex="0"><code>Name:           autoscaler-webhook-86944884c4-sdtqh
Namespace:      default
Node:           gke-test-cluster-default-1c5dec79-h0tq/10.138.0.2
...
Status:         Running
</code></pre><h4 id="3-create-a-fleet-autoscaler">3. Create a Fleet Autoscaler</h4>
<p>Let&rsquo;s create a Fleet Autoscaler using the following command:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl apply -f https://raw.githubusercontent.com/googleforgames/agones/release-1.38.0/examples/webhookfleetautoscaler.yaml
</span></span></code></pre></div><p>You should see a successful output similar to this:</p>
<pre tabindex="0"><code>fleetautoscaler.autoscaling.agones.dev &#34;webhook-fleet-autoscaler&#34; created
</code></pre><p>This has created a FleetAutoscaler record inside Kubernetes.
It has the link to Webhook service we deployed above.</p>
<h4 id="4-see-the-fleet-and-autoscaler-status">4. See the fleet and autoscaler status.</h4>
<p>In order to track the list of gameservers which run in your fleet you can run this command in a separate terminal tab:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> watch <span style="color:#4e9a06">&#34;kubectl get gs -n default&#34;</span>
</span></span></code></pre></div><p>In order to get autoscaler status use the following command:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl describe fleetautoscaler webhook-fleet-autoscaler
</span></span></code></pre></div><p>It should look something like this:</p>
<pre tabindex="0"><code>Name:         webhook-fleet-autoscaler
Namespace:    default
Labels:       &lt;none&gt;
Annotations:  kubectl.kubernetes.io/last-applied-configuration={&#34;apiVersion&#34;:
&#34;autoscaling.agones.dev/v1&#34;,&#34;kind&#34;:&#34;FleetAutoscaler&#34;,&#34;metadata&#34;:{&#34;annotations&#34;
:{},&#34;name&#34;:&#34;webhook-fleet-autoscaler&#34;,&#34;namespace&#34;:&#34;default...
API Version:  autoscaling.agones.dev/v1
Kind:         FleetAutoscaler
etadata:
  Cluster Name:
  Creation Timestamp:  2018-12-22T12:52:23Z
  Generation:          1
  Resource Version:    2274579
  Self Link:           /apis/autoscaling.agones.dev/v1/namespaces/default/fleet
autoscalers/webhook-fleet-autoscaler
  UID:                 6d03eae4-05e8-11e9-84c2-42010a8a01c9
Spec:
  Fleet Name:  simple-game-server
  Policy:
    Type:  Webhook
    Webhook:
      Service:
        Name:       autoscaler-webhook-service
        Namespace:  default
        Path:       scale
      URL:
Status:
  Able To Scale:     true
  Current Replicas:  2
  Desired Replicas:  2
  Last Scale Time:   &lt;nil&gt;
  Scaling Limited:   false
Events:              &lt;none&gt;
</code></pre><p>You can see the status (able to scale, not limited), the last time the fleet was scaled (nil for never), current and desired fleet size.</p>
<p>The autoscaler makes a query to a webhoook service deployed on step 1 and on response changing the target Replica size, and the fleet creates/deletes game server instances
to achieve that number. The convergence is achieved in time, which is usually measured in seconds.</p>
<h4 id="5-allocate-game-servers-from-the-fleet-to-trigger-scale-up">5. Allocate Game Servers from the Fleet to trigger scale up</h4>
<p>If you&rsquo;re interested in more details for game server allocation, you should consult the <a href="/docs/getting-started/create-fleet/">Create a Game Server Fleet</a> page.
Here we only interested in triggering allocations to see the autoscaler in action.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl create -f https://raw.githubusercontent.com/googleforgames/agones/release-1.38.0/examples/simple-game-server/gameserverallocation.yaml -o yaml
</span></span></code></pre></div><p>You should get in return the allocated game server details, which should end with something like:</p>
<pre tabindex="0"><code>status:
  address: 34.94.118.237
  gameServerName: simple-game-server-v6jwb-6bzkz
  nodeName: gke-test-cluster-default-f11755a7-5km3
  ports:
  - name: default
    port: 7832
  state: Allocated
</code></pre><p>Note the address and port, you might need them later to connect to the server.</p>
<p>Run the kubectl command one more time so that we have both servers allocated:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl create -f https://raw.githubusercontent.com/googleforgames/agones/release-1.38.0/examples/simple-game-server/gameserverallocation.yaml -o yaml
</span></span></code></pre></div><h4 id="6-check-new-autoscaler-and-fleet-status">6. Check new Autoscaler and Fleet status</h4>
<p>Now let&rsquo;s wait a few seconds to allow the autoscaler to detect the change in the fleet and check again its status</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl describe fleetautoscaler webhook-fleet-autoscaler
</span></span></code></pre></div><p>The last part should look similar to this:</p>
<pre tabindex="0"><code>Spec:
  Fleet Name:  simple-game-server
  Policy:
    Type:  Webhook
    Webhook:
      Service:
        Name:       autoscaler-webhook-service
        Namespace:  default
        Path:       scale
      URL:
Status:
  Able To Scale:     true
  Current Replicas:  4
  Desired Replicas:  4
  Last Scale Time:   2018-12-22T12:53:47Z
  Scaling Limited:   false
Events:
  Type    Reason            Age   From                        Message
  ----    ------            ----  ----                        -------
  Normal  AutoScalingFleet  35s   fleetautoscaler-controller  Scaling fleet simple-game-server from 2 to 4
</code></pre><p>You can see that the fleet size has increased in particular case doubled to 4 gameservers (based on our custom logic in our webhook), the autoscaler having compensated for the two allocated instances.
Last Scale Time has been updated and a scaling event has been logged.</p>
<p>Double-check the actual number of game server instances and status by running:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> kubectl get gs -n default
</span></span></code></pre></div><p>This will get you a list of all the current <code>GameServers</code> and their <code>Status &gt; State</code>.</p>
<pre tabindex="0"><code>NAME                     STATE       ADDRESS         PORT     NODE        AGE
simple-game-server-dmkp4-8pkk2   Ready       35.247.13.175   7386     minikube     5m
simple-game-server-dmkp4-b7x87   Allocated   35.247.13.175   7219     minikube     5m
simple-game-server-dmkp4-r4qtt   Allocated   35.247.13.175   7220     minikube     5m
simple-game-server-dmkp4-rsr6n   Ready       35.247.13.175   7297     minikube     5m
</code></pre><h4 id="7-check-downscaling-using-webhook-autoscaler-policy">7. Check downscaling using Webhook Autoscaler policy</h4>
<p>Based on our custom webhook deployed earlier, if the fraction of allocated replicas in whole Replicas count would be less than threshold (0.3) then the fleet would scale down by scaleFactor, in our example by 2.</p>
<p>Note that the example webhook server has a limitation that it would not decrease fleet replica count under <code>minReplicasCount</code>, which is equal to 2.</p>
<p>We need to run EXIT command on one gameserver (Use IP address and port of the allocated gameserver from the previous step) in order to decrease the number of allocated gameservers in a fleet (&lt;0.3).</p>
<pre tabindex="0"><code>nc -u 35.247.13.175 7220
EXIT
</code></pre><p>Server would be in shutdown state.
Wait about 30 seconds.
Then you should see scaling down event in the output of next command:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl describe fleetautoscaler webhook-fleet-autoscaler
</span></span></code></pre></div><p>You should see these lines in events:</p>
<pre tabindex="0"><code>  Normal   AutoScalingFleet  11m                fleetautoscaler-controller  Scaling fleet simple-game-server from 2 to 4
  Normal   AutoScalingFleet  1m                 fleetautoscaler-controller  Scaling fleet simple-game-server from 4 to 2
</code></pre><p>And get gameservers command output:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl get gs -n default
</span></span></code></pre></div><pre tabindex="0"><code>NAME                             STATUS      ADDRESS          PORT     NODE       AGE
simple-game-server-884fg-6q5sk   Ready       35.247.117.202   7373     minikube   5m
simple-game-server-884fg-b7l58   Allocated   35.247.117.202   7766     minikube   5m
</code></pre><h4 id="8-cleanup">8. Cleanup</h4>
<p>You can delete the autoscaler service and associated resources with the following commands.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl delete -f https://raw.githubusercontent.com/googleforgames/agones/release-1.38.0/examples/autoscaler-webhook/autoscaler-service.yaml
</span></span></code></pre></div><p>Removing the fleet:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl delete -f https://raw.githubusercontent.com/googleforgames/agones/release-1.38.0/examples/simple-game-server/fleet.yaml
</span></span></code></pre></div><h2 id="chapter-2-configuring-https-fleetautoscaler-webhook-with-ca-bundle">Chapter 2 Configuring HTTPS fleetautoscaler webhook with CA Bundle</h2>
<h3 id="objectives-1">Objectives</h3>
<p>Using TLS and a certificate authority (CA) bundle we can establish trusted communication between Fleetautoscaler and
an HTTPS server running the autoscaling webhook that controls the size of the fleet (Replicas count). The certificate of the
autoscaling webhook must be signed by the CA provided in fleetautoscaler yaml configuration file. Using TLS eliminates
the possibility of a man-in-the-middle attack between the fleetautoscaler and the autoscaling webhook.</p>
<h4 id="1-deploy-the-fleet-1">1. Deploy the fleet</h4>
<p>Run a fleet in a cluster:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl apply -f https://raw.githubusercontent.com/googleforgames/agones/release-1.38.0/examples/simple-game-server/fleet.yaml
</span></span></code></pre></div><h4 id="2-create-x509-root-and-webhook-certificates">2. Create X509 Root and Webhook certificates</h4>
<p>The procedure of generating a Self-signed CA certificate is as follows:</p>
<p>The first step is to create the private root key:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>openssl genrsa -out rootCA.key <span style="color:#0000cf;font-weight:bold">2048</span>
</span></span></code></pre></div><p>The next step is to self-sign this certificate:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>openssl req -x509 -new -nodes -key rootCA.key -sha256 -days <span style="color:#0000cf;font-weight:bold">1024</span> -out rootCA.pem
</span></span></code></pre></div><p>This will start an interactive script that will ask you for various bits of information. Fill it out as you see fit.</p>
<p>Every webhook that you wish to install a trusted certificate will need to go through this process. First, just like with the root CA step, you’ll need to create a private key (different from the root CA):</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>openssl genrsa -out webhook.key <span style="color:#0000cf;font-weight:bold">2048</span>
</span></span></code></pre></div><p>Next create configuration file <code>cert.conf</code> for the certificate signing request:</p>
<pre tabindex="0"><code class="language-none" data-lang="none">[req]
distinguished_name = req_distinguished_name
req_extensions = v3_req
prompt = no
[req_distinguished_name]
CN = autoscaler-tls-service.default.svc
[v3_req]
keyUsage = digitalSignature
extendedKeyUsage = serverAuth
subjectAltName = @alt_names
[alt_names]
DNS.1 = autoscaler-tls-service.default.svc
</code></pre><p>Generate the certificate signing request, use valid hostname which in this case will be <code>autoscaler-tls-service.default.svc</code> as <code>Common Name (eg, fully qualified host name)</code> as well as <code>DNS.1</code> in the <code>alt_names</code> section of the config file.</p>
<p>Check the <a href="https://kubernetes.io/docs/concepts/services-networking/dns-pod-service/#a-aaaa-records">Kubernetes documentation</a> to see how Services get assigned DNS entries.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>openssl req -new -out webhook.csr -key webhook.key -config cert.conf
</span></span></code></pre></div><p>Once that’s done, you’ll sign the CSR, which requires the CA root key:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>openssl x509 -req -in webhook.csr -CA rootCA.pem -CAkey rootCA.key -CAcreateserial -out webhook.crt -days <span style="color:#0000cf;font-weight:bold">500</span> -sha256 -extfile cert.conf -extensions v3_req
</span></span></code></pre></div><p>This would generate webhook.crt certificate</p>
<p>Add secret which later would be mounted to autoscaler-webhook-tls pod.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl create secret tls autoscalersecret --cert<span style="color:#ce5c00;font-weight:bold">=</span>webhook.crt --key<span style="color:#ce5c00;font-weight:bold">=</span>webhook.key
</span></span></code></pre></div><p>You need to put Base64-encoded string into caBundle field in your fleetautoscaler yaml configuration:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>base64 -i ./rootCA.pem
</span></span></code></pre></div><p>Copy the output of the command above and replace the caBundle field in your text editor (say vim) with the new value:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>wget https://raw.githubusercontent.com/googleforgames/agones/release-1.38.0/examples/webhookfleetautoscalertls.yaml
</span></span><span style="display:flex;"><span>vim ./webhookfleetautoscalertls.yaml
</span></span></code></pre></div><h4 id="3-deploy-a-webhook-service-for-autoscaling">3. Deploy a Webhook service for autoscaling</h4>
<p>Run next command to create a service and a Webhook pod in a cluster:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl apply -f https://raw.githubusercontent.com/googleforgames/agones/release-1.38.0/examples/autoscaler-webhook/autoscaler-service-tls.yaml
</span></span></code></pre></div><p>To check that it is running and liveness probe is fine:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl describe pod autoscaler-webhook-tls
</span></span></code></pre></div><p>Wait for the Running status results:</p>
<pre tabindex="0"><code>Name:               autoscaler-webhook-tls-f74c9bff7-ssrsc
Namespace:          default
...
Status:         Running
</code></pre><h4 id="4-create-a-fleet-autoscaler">4. Create a Fleet Autoscaler</h4>
<p>Let&rsquo;s create a Fleet Autoscaler using the following command (caBundle should be set properly on Step 2):</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl apply -f ./webhookfleetautoscalertls.yaml
</span></span></code></pre></div><h4 id="5-see-the-fleet-and-autoscaler-status">5. See the fleet and autoscaler status.</h4>
<p>In order to track the list of gameservers which run in your fleet you can run this command in a separate terminal tab:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> watch <span style="color:#4e9a06">&#34;kubectl get gs -n default&#34;</span>
</span></span></code></pre></div><h4 id="6-allocate-two-game-servers-from-the-fleet-to-trigger-scale-up">6. Allocate two Game Servers from the Fleet to trigger scale up</h4>
<p>If you&rsquo;re interested in more details for game server allocation, you should consult the <a href="/docs/getting-started/create-fleet/">Create a Game Server Fleet</a> page.
Here we only interested in triggering allocations to see the autoscaler in action.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">for</span> i in <span style="color:#ce5c00;font-weight:bold">{</span>0..1<span style="color:#ce5c00;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">;</span> <span style="color:#204a87;font-weight:bold">do</span> kubectl create -f https://raw.githubusercontent.com/googleforgames/agones/release-1.38.0/examples/simple-game-server/gameserverallocation.yaml -o yaml <span style="color:#000;font-weight:bold">;</span> <span style="color:#204a87;font-weight:bold">done</span>
</span></span></code></pre></div><h4 id="7-check-new-autoscaler-and-fleet-status">7. Check new Autoscaler and Fleet status</h4>
<p>Now let&rsquo;s wait a few seconds to allow the autoscaler to detect the change in the fleet and check again its status</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl describe fleetautoscaler  webhook-fleetautoscaler-tls
</span></span></code></pre></div><p>The last part should look similar to this:</p>
<pre tabindex="0"><code>Spec:
  Fleet Name:  simple-game-server
  Policy:
    Type:  Webhook
    Webhook:
      Ca Bundle:  LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUN1RENDQWFBQ0NRQ29kcEFNbTlTd0pqQU5CZ2txaGtpRzl3MEJBUXNGQURBZU1Rc3dDUVlEVlFRR0V3SlYKVXpFUE1BMEdBMVVFQ3d3R1FXZHZibVZ6TUI0WERURTVNREV3TkRFeE5URTBORm9YRFRJeE1UQXlOREV4TlRFMApORm93SGpFTE1Ba0dBMVVFQmhNQ1ZWTXhEekFOQmdOVkJBc01Ca0ZuYjI1bGN6Q0NBU0l3RFFZSktvWklodmNOCkFRRUJCUUFEZ2dFUEFEQ0NBUW9DZ2dFQkFOQ0h5dndDOTZwZDlTdkFhMUIvRWg2ekcxeDBLS1dPaVhtNzhJcngKKzZ5WHd5YVpsMVo1cVExbUZoOThMSGVZUmQwWVgzRTJnelZ5bFpvUlUra1ZESzRUc0VzV0tNUFVpdVo0MUVrdApwbythbEN6alAyaXZzRGZaOGEvdnByL3dZZ2FrWGtWalBUaGpKUk9xTnFIdWROMjZVcUFJYnNOTVpoUkxkOVFFCnFLSjRPNmFHNVMxTVNqZFRGVHFlbHJiZitDcXNKaHltZEIzZmxGRUVvdXExSmoxS0RoQjRXWlNTbS9VSnpCNkcKNHUzY3BlQm1jTFVRR202ZlFHb2JFQSt5SlpMaEVXcXBrd3ZVZ2dCNmRzWE8xZFNIZXhhZmlDOUVUWGxVdFRhZwo1U2JOeTVoYWRWUVV3Z253U0J2djR2R0t1UUxXcWdXc0JyazB5Wll4Sk5Bb0V5RUNBd0VBQVRBTkJna3Foa2lHCjl3MEJBUXNGQUFPQ0FRRUFRMkgzaWJRcWYzQTNES2l1eGJISURkbll6TlZ2Z0dhRFpwaVZyM25ocm55dmxlNVgKR09hRm0rMjdRRjRWV29FMzZDTGhYZHpEWlM4bEpIY09YUW5KOU83Y2pPYzkxVmh1S2NmSHgwS09hU1oweVNrVAp2bEtXazlBNFdoNGE0QXFZSlc3Z3BUVHR1UFpydnc4VGsvbjFaWEZOYVdBeDd5RU5OdVdiODhoNGRBRDVaTzRzCkc5SHJIdlpuTTNXQzFBUXA0Q3laRjVyQ1I2dkVFOWRkUmlKb3IzM3pLZTRoRkJvN0JFTklZZXNzZVlxRStkcDMKK0g4TW5LODRXeDFUZ1N5Vkp5OHlMbXFpdTJ1aThjaDFIZnh0OFpjcHg3dXA2SEZLRlRsTjlBeXZUaXYxYTBYLwpEVTk1eTEwdi9oTlc0WHpuMDJHNGhrcjhzaUduSEcrUEprT3hBdz09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
      Service:    &lt;nil&gt;
      URL:        https://autoscaler-tls-service.default.svc:8000/scale
Events:
  Type    Reason            Age   From                        Message
  ----    ------            ----  ----                        -------
  Normal  AutoScalingFleet  5s   fleetautoscaler-controller  Scaling fleet simple-game-server from 2 to 4
</code></pre><p>You can see that the fleet size has increased in particular case doubled to 4 gameservers (based on our custom logic in our webhook), the autoscaler having compensated for the two allocated instances.
Last Scale Time has been updated and a scaling event has been logged.</p>
<p>Double-check the actual number of game server instances and status by running:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> kubectl get gs -n default
</span></span></code></pre></div><p>This will get you a list of all the current <code>GameServers</code> and their <code>Status &gt; State</code>.</p>
<pre tabindex="0"><code>NAME                     STATE       ADDRESS         PORT      NODE      AGE
simple-game-server-njmr7-2t4nx   Ready       35.203.159.68   7330      minikube   1m
simple-game-server-njmr7-65rp6   Allocated   35.203.159.68   7294      minikube   4m
</code></pre><h4 id="8-cleanup-1">8. Cleanup</h4>
<p>You can delete the autoscaler service and associated resources with the following commands.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl delete -f https://raw.githubusercontent.com/googleforgames/agones/release-1.38.0/examples/autoscaler-webhook/autoscaler-service-tls.yaml
</span></span></code></pre></div><p>Removing x509 key secret:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl delete secret autoscalersecret
</span></span></code></pre></div><p>Removing the fleet:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl delete -f https://raw.githubusercontent.com/googleforgames/agones/release-1.38.0/examples/simple-game-server/fleet.yaml
</span></span></code></pre></div><h3 id="comments">Comments</h3>
<p>Note that secure communication has been established and we can trust that communication between the fleetautoscaler and
the autoscaling webhook. If you need to run the autoscaling webhook outside of the Kubernetes cluster, you can use
another root certificate authority as long as you put it into the caBundle parameter in fleetautoscaler configuration
(in pem format, base64-encoded).</p>
<h2 id="troubleshooting-guide">Troubleshooting Guide</h2>
<p>If you run into problems with the configuration of your fleetautoscaler and webhook service the easiest way to debug
them is to run:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl describe fleetautoscaler &lt;FleetAutoScalerName&gt;
</span></span></code></pre></div><p>and inspect the events at the bottom of the output.</p>
<h3 id="common-error-messages">Common error messages.</h3>
<p>If you have configured the wrong service Path for the FleetAutoscaler you will see a message like</p>
<pre tabindex="0"><code>Error calculating desired fleet size on FleetAutoscaler simple-fleet-r7fdv-autoscaler. Error: bad status code 404 from the server: https://autoscaler-tls-service.default.svc:8000/scale
</code></pre><p>If you are using a hostname other than <code>autoscaler-tls-service.default.svc</code> as the
<code>Common Name (eg, fully qualified host name)</code> when creating a certificate using <code>openssl</code> tool you will see a
message like</p>
<pre tabindex="0"><code>Post https://autoscaler-tls-service.default.svc:8000/scale: x509: certificate is not valid for any names, but wanted to match autoscaler-tls-service.default.svc
</code></pre><p>If you see errors like the following in <code>autoscaler-webhook-tls</code> pod logs:</p>
<pre tabindex="0"><code>http: TLS handshake error from 10.48.3.125:33374: remote error: tls: bad certificate
</code></pre><p>Then there could be an issue with your <code>./rootCA.pem</code>.</p>
<p>You can repeat the process from step 2, in order to fix your certificates setup.</p>
<h2 id="next-steps">Next Steps</h2>
<p>Read the advanced <a href="/docs/advanced/scheduling-and-autoscaling/">Scheduling and Autoscaling</a> guide, for more details on autoscaling.</p>
<p>If you want to use your own GameServer container make sure you have properly integrated the <a href="/docs/guides/client-sdks/">Code Blind SDK</a>.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-968dadb4e3c831fafc44763def50a585">4.5 - Quickstart: Edit a Game Server</h1>
    <div class="lead">The following guide is for developers without Docker or Kubernetes experience, that want to use the simple-game-server example as a starting point for a custom game server.</div>
	<p>This guide addresses Google Kubernetes Engine and Minikube.  We would welcome a Pull Request to expand this to include other platforms as well.</p>
<h2 id="prerequisites">Prerequisites</h2>
<ol>
<li>A <a href="https://golang.org/dl/">Go</a> environment</li>
<li><a href="https://www.docker.com/get-started/">Docker</a></li>
<li>Code Blind installed on GKE or Minikube</li>
<li>kubectl properly configured</li>
</ol>
<p>To install on GKE, follow the install instructions (if you haven&rsquo;t already) at
<a href="https://codeblind.ai/docs/installation/creating-cluster/gke/">Setting up a Google Kubernetes Engine (GKE) cluster</a>.
Also complete the &ldquo;Enabling creation of RBAC resources&rdquo; and &ldquo;Installing Code Blind&rdquo; sets of instructions on the same page.</p>
<p>To install locally on Minikube, read <a href="https://codeblind.ai/docs/installation/creating-cluster/minikube/">Setting up a Minikube cluster</a>.
Also complete the &ldquo;Enabling creation of RBAC resources&rdquo; and &ldquo;Installing Code Blind&rdquo; sets of instructions on the same page.</p>
<h2 id="modify-the-code-and-push-another-new-image">Modify the code and push another new image</h2>
<h3 id="modify-the-simple-game-server-example-source-code">Modify the simple-game-server example source code</h3>
<p>Modify the 
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>main.go</a> file. For example:</p>
<p>Change the following line in <code>main.go</code>:</p>
<p>From:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#000">respond</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">conn</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">sender</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;ACK: &#34;</span><span style="color:#ce5c00;font-weight:bold">+</span><span style="color:#000">txt</span><span style="color:#ce5c00;font-weight:bold">+</span><span style="color:#4e9a06">&#34;\n&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>To:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#000">respond</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">conn</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">sender</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;ACK: Echo says &#34;</span><span style="color:#ce5c00;font-weight:bold">+</span><span style="color:#000">txt</span><span style="color:#ce5c00;font-weight:bold">+</span><span style="color:#4e9a06">&#34;\n&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><h3 id="build-server">Build Server</h3>
<p>Since Docker image is using Alpine Linux, the &ldquo;go build&rdquo; command has to include few more environment variables.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>go get agones.dev/agones/pkg/sdk
</span></span><span style="display:flex;"><span><span style="color:#000">GOOS</span><span style="color:#ce5c00;font-weight:bold">=</span>linux <span style="color:#000">GOARCH</span><span style="color:#ce5c00;font-weight:bold">=</span>amd64 <span style="color:#000">CGO_ENABLED</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">0</span> go build -o bin/server -a -v main.go
</span></span></code></pre></div><h2 id="using-docker-file">Using Docker File</h2>
<h3 id="create-a-new-docker-image">Create a new docker image</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker build -t gcr.io/<span style="color:#ce5c00;font-weight:bold">[</span>PROJECT_ID<span style="color:#ce5c00;font-weight:bold">]</span>/agones-simple-game-server:modified .
</span></span></code></pre></div><p>Note: you can change the image name &ldquo;agones-simple-game-server&rdquo; to something else.</p>
<h3 id="if-using-gke-push-the-image-to-gcp-registry">If using GKE, push the image to GCP Registry</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker push gcr.io/<span style="color:#ce5c00;font-weight:bold">[</span>PROJECT_ID<span style="color:#ce5c00;font-weight:bold">]</span>/agones-simple-game-server:modified
</span></span></code></pre></div><p>Note: Review <a href="https://cloud.google.com/container-registry/docs/advanced-authentication">Authentication Methods</a>
for additional information regarding use of gcloud as a Docker credential helper
and advanced authentication methods to the Google Container Registry.</p>
<h3 id="if-using-minikube-load-the-image-into-minikube">If using Minikube, load the image into Minikube</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>minikube cache add gcr.io/<span style="color:#ce5c00;font-weight:bold">[</span>PROJECT_ID<span style="color:#ce5c00;font-weight:bold">]</span>/agones-agones-simple-game-server:modified
</span></span></code></pre></div><h3 id="modify-gameserveryaml">Modify gameserver.yaml</h3>
<p>Modify the following line from gameserver.yaml to use the new configuration.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">containers</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">agones-simple-game-server</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">image</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">gcr.io/[PROJECT_ID]/agones-simple-game-server:modified</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h3 id="if-using-gke-deploy-server-to-gke">If using GKE, deploy Server to GKE</h3>
<p>Apply the latest settings to the Kubernetes container.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcloud config <span style="color:#204a87">set</span> container/cluster <span style="color:#ce5c00;font-weight:bold">[</span>CLUSTER_NAME<span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span>gcloud container clusters get-credentials <span style="color:#ce5c00;font-weight:bold">[</span>CLUSTER_NAME<span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span>kubectl apply -f gameserver.yaml
</span></span></code></pre></div><h3 id="if-using-minikube-deploy-the-server-to-minikube">If using Minikube, deploy the Server to Minikube</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl apply -f gameserver.yaml
</span></span></code></pre></div><h3 id="check-the-gameserver-status">Check the GameServer Status</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl describe gameserver
</span></span></code></pre></div><h3 id="verify">Verify</h3>
<p>Let&rsquo;s retrieve the IP address and the allocated port of your Game Server:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl get gs simple-game-server -o <span style="color:#000">jsonpath</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;{.status.address}:{.status.ports[0].port}&#39;</span>
</span></span></code></pre></div><p>You can now communicate with the Game Server :</p>


<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Note</h4>

    If you do not have netcat installed
(i.e. you get a response of <code>nc: command not found</code>),
you can install netcat by running <code>sudo apt install netcat</code>.

</div>

<pre tabindex="0"><code>nc -u {IP} {PORT}
Hello World!
ACK:  Echo says  Hello World!
EXIT
</code></pre><p>You can finally type <code>EXIT</code> which tells the SDK to run the <a href="https://codeblind.ai/docs/guides/client-sdks/#shutdown">Shutdown command</a>, and therefore shuts down the <code>GameServer</code>.</p>
<p>If you run <code>kubectl describe gameserver</code> again - either the GameServer will be gone completely, or it will be in <code>Shutdown</code> state, on the way to being deleted.</p>
<h2 id="next-steps">Next Steps</h2>
<p>If you want to perform rolling updates of modified game servers, see <a href="/docs/getting-started/create-fleet/">Quickstart Create a Game Server Fleet</a>.</p>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-5f99535ac90b3afc320b38b1cf0611f9">5 - Guides</h1>
    <div class="lead">Guides for deeper integrations with Code Blind</div>
	
</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-9991ac61ed3099936d3b9bbfb12d0f3e">5.1 - Feature Stages</h1>
    <div class="lead">This page provides a description of the various stages that Code Blind features can be in, and the relative maturity and support level expected for each level.</div>
	<h2 id="supported-versions">Supported Versions</h2>
<p>Code Blind versions are expressed as x.y.z, where x is the major version, y is the minor version, and z is the patch version
following <a href="http://semver.org/">Semantic Versioning</a> terminology.</p>
<h2 id="code-blind-features">Code Blind Features</h2>
<p>A feature within Code Blind can be in <code>Alpha</code>, <code>Beta</code> or <code>Stable</code> stage.</p>
<h2 id="feature-gates">Feature Gates</h2>
<p><code>Alpha</code> and <code>Beta</code> features can be enabled or disabled through the <code>agones.featureGates</code> configuration option
that can be found in the <a href="https://codeblind.ai/docs/installation/install-agones/helm/#configuration">Helm configuration</a> documentation.</p>
<p>The current set of <code>alpha</code> and <code>beta</code> feature gates:</p>
<table>
<thead>
<tr>
<th>Feature Name</th>
<th>Gate</th>
<th>Default</th>
<th>Stage</th>
<th>Since</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="/docs/guides/fleet-updates/#notifying-gameservers-on-fleet-updatedownscale">Allocated GameServers are notified on relevant Fleet Updates</a></td>
<td><code>FleetAllocationOverflow</code></td>
<td>Enabled</td>
<td><code>Beta</code></td>
<td>1.37.0</td>
</tr>
<tr>
<td><a href="https://github.com/googleforgames/agones/issues/2716">CountsAndLists</a></td>
<td><code>CountsAndLists</code></td>
<td>Disabled</td>
<td><code>Alpha</code></td>
<td>1.37.0</td>
</tr>
<tr>
<td><a href="https://github.com/googleforgames/agones/issues/1239">GameServer player capacity filtering on GameServerAllocations</a></td>
<td><code>PlayerAllocationFilter</code></td>
<td>Disabled</td>
<td><code>Alpha</code></td>
<td>1.14.0</td>
</tr>
<tr>
<td><a href="https://codeblind.ai/docs/guides/player-tracking/">Player Tracking</a></td>
<td><code>PlayerTracking</code></td>
<td>Disabled</td>
<td><code>Alpha</code></td>
<td>1.6.0</td>
</tr>
<tr>
<td><a href="https://github.com/googleforgames/agones/issues/3377">DisableResyncOnSDKServer</a></td>
<td><code>DisableResyncOnSDKServer</code></td>
<td>Disabled</td>
<td><code>Alpha</code></td>
<td>1.37.0</td>
</tr>
<tr>
<td>Example Gate (not in use)</td>
<td><code>Example</code></td>
<td>Disabled</td>
<td>None</td>
<td>0.13.0</td>
</tr>
</tbody>
</table>


<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Note</h4>

    If you aren&rsquo;t sure if Feature Flags have been set correctly, have a look at the
<em><a href="/docs/guides/troubleshooting/#the-feature-flag-i-enableddisabled-isnt-working-as-expected">The Feature Flag I enabled/disabled isn&rsquo;t working as expected</a></em>
troubleshooting section.

</div>

<h2 id="description-of-stages">Description of Stages</h2>
<h3 id="alpha">Alpha</h3>
<p>An <code>Alpha</code> feature means:</p>
<ul>
<li>Disabled by default.</li>
<li>Might be buggy. Enabling the feature may expose bugs.</li>
<li>Support for this feature may be dropped at any time without notice.</li>
<li>The API may change in incompatible ways in a later software release without notice.</li>
<li>Recommended for use only in short-lived testing clusters, due to increased risk of bugs and lack of long-term support.</li>
</ul>


<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Note</h4>

    Please do try <code>Alpha</code> features and give feedback on them. This is important to ensure less breaking changes
through the <code>Beta</code> period.

</div>

<h3 id="beta">Beta</h3>
<p>A <code>Beta</code> feature means:</p>
<ul>
<li>Enabled by default, but able to be disabled through a feature gate.</li>
<li>The feature is well tested. Enabling the feature is considered safe.</li>
<li>Support for the overall feature will not be dropped, though details may change.</li>
<li>The schema and/or semantics of objects may change in incompatible ways in a subsequent beta or stable releases. When
this happens, we will provide instructions for migrating to the next version. This may require deleting, editing,
and re-creating API objects. The editing process may require some thought. This may require downtime for
applications that rely on the feature.</li>
<li>Recommended for only non-business-critical uses because of potential for incompatible changes in subsequent releases.
If you have multiple clusters that can be upgraded independently, you may be able to relax this restriction.</li>
</ul>


<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Note</h4>

    Note: Please do try <code>Beta</code> features and give feedback on them! After they exit beta, it may not be practical for us
to make more changes.

</div>

<h3 id="stable">Stable</h3>
<p>A <code>Stable</code> feature means:</p>
<ul>
<li>The feature is enabled and the corresponding feature gate no longer exists.</li>
<li>Stable versions of features will appear in released software for many subsequent versions.</li>
</ul>
<h2 id="feature-stage-indicators">Feature Stage Indicators</h2>
<p>There are a variety of features with Code Blind, how can we determine what stage each feature is in?</p>
<p>Below are indicators for each type of functionality that can be used to determine the feature stage for a given aspect
of Code Blind.</p>
<h3 id="custom-resource-definitions-crds">Custom Resource Definitions (CRDs)</h3>
<p>This refers to Kubernetes resource for Code Blind, such as <code>GameServer</code>, <code>Fleet</code> and <code>GameServerAllocation</code>.</p>
<h4 id="new-crds">New CRDs</h4>
<p>For new resources, the stage of the resource will be indicated by the <code>apiVersion</code> of the resource.</p>
<p>For example: <code>apiVersion: &quot;agones.dev/v1&quot;</code> is a <code>stable</code> resource, <code>apiVersion: &quot;agones.dev/v1beta1&quot;</code> is a <code>beta</code>
stage resource, and <code>apiVersion: &quot;agones.dev/v1alpha1&quot;</code> is an <code>alpha</code> stage resource.</p>
<h4 id="new-crd-attributes">New CRD attributes</h4>
<p>When <code>alpha</code> and <code>beta</code> attributes are added to an existing stable Code Blind CRD, we will follow the Kubernetes <a href="https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api_changes.md#adding-unstable-features-to-stable-versions"><em>Adding
Unstable Features to Stable Versions</em></a>
Guide to optimise on the least amount of breaking changes for users as attributes progress through feature stages.</p>
<p><code>alpha</code> and <code>beta</code> attributes will be added to the existing CRD as <code>optional</code> and documented with their feature stage.
Attempting to populate these <code>alpha</code> and <code>beta</code> attributes on an Code Blind CRD will return a validation error if their
accompanying Feature Flag is not enabled.</p>
<p><code>alpha</code> and <code>beta</code> attributes can be subject to change of name and structure, and will result in breaking changes
before moving to a <code>stable</code> stage. These changes will be outlined in release notes and feature documentation.</p>
<h3 id="code-blind-game-server-sdk">Code Blind Game Server SDK</h3>
<p>Any <code>alpha</code> or <code>beta</code> Game Server SDK functionality will be a subpackage of the <code>sdk</code> package. For example
, functionality found in a <code>sdk.alphav1</code> package should be considered at the <code>alpha</code> feature stage.</p>
<p>Only experimental functionality will be found in any <code>alpha</code> and <code>beta</code> SDK packages, and as such may change as
development occurs.</p>
<p>As SDK features move to through feature stages towards <code>stable</code>, the previous version of the SDK API
will remain for at least one release to enable easy migration to the more stable feature stage (i.e. from <code>alpha </code> -&gt; <code>beta</code>, <code>beta</code> -&gt; <code>stable</code>)</p>
<p>Any other SDK functionality not marked as <code>alpha</code> or <code>beta</code> is assumed to be <code>stable</code>.</p>
<h3 id="rest--grpc-apis">REST &amp; gRPC APIs</h3>
<p>REST and gRPC API will have versioned paths where appropriate to indicate their feature stage.</p>
<p>For example, a REST API with a prefix of <code>v1alpha1</code> is an <code>alpha</code> stage feature:
<code>http://api.example.com/v1alpha1/exampleaction</code>.</p>
<p>Similar to the SDK, any <code>alpha</code> or <code>beta</code> gRPC functionality will be a subpackage of the main API package.
For example, functionality found in a <code>api.alphav1</code> package should be considered at the <code>alpha</code> feature stage.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-52398247f3240f270287eb9ac807491b">5.2 - Best Practices</h1>
    <div class="lead">Best practices for running Code Blind in production.</div>
	<h2 id="overview">Overview</h2>
<p>Running Code Blind in production takes consideration, from planning your launch to figuring
out the best course of action for cluster and Code Blind upgrades. On this page, we&rsquo;ve collected
some general best practices. We also have cloud specific pages for:</p>
<ul>
<li><a href="/docs/guides/best-practices/gke/">Google Kubernetes Engine (GKE)</a></li>
</ul>
<p>If you are interested in submitting best practices for your cloud prodiver / on-prem, <a href="/docs/contribute/">please contribute!</a></p>
<h2 id="separation-of-code-blind-from-gameserver-nodes">Separation of Code Blind from GameServer nodes</h2>
<p>When running in production, Code Blind should be scheduled on a dedicated pool of nodes, distinct from where Game Servers
are scheduled for better isolation and resiliency. By default Code Blind prefers to be scheduled on nodes labeled with
<code>agones.dev/agones-system=true</code> and tolerates the node taint <code>agones.dev/agones-system=true:NoExecute</code>.
If no dedicated nodes are available, Code Blind will run on regular nodes. See <a href="https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/">taints and tolerations</a>
for more information about Kubernetes taints and tolerations.</p>
<p>If you are collecting <a href="/docs/guides/metrics/">Metrics</a> using our standard Prometheus installation, see
<a href="/docs/guides/metrics/#prometheus-installation">the installation guide</a> for instructions on configuring a separate node pool for the <code>agones.dev/agones-metrics=true</code> taint.</p>
<p>See <a href="/docs/installation/creating-cluster/">Creating a Cluster</a> for initial set up on your cloud provider.</p>
<h2 id="redundant-clusters">Redundant Clusters</h2>
<h3 id="allocate-across-clusters">Allocate Across Clusters</h3>
<p>Code Blind supports <a href="/docs/advanced/multi-cluster-allocation/">Multi-cluster Allocation</a>, allowing you to allocate from a set of clusters, versus a single point of potential failure. There are several other options for multi-cluster allocation:</p>
<ul>
<li><a href="https://cloud.google.com/anthos/service-mesh">Anthos Service Mesh</a> can be used to route allocation traffic to different clusters based on arbitrary criteria. See <a href="https://github.com/googleforgames/global-multiplayer-demo">Global Multiplayer Demo</a> for an example where the match maker influences which cluster the allocation is routed to.</li>
<li><a href="https://github.com/googleforgames/agones/tree/main/examples/allocation-endpoint">Allocation Endpoint</a> can be used in Cloud Run to proxy allocation requests.</li>
<li>Or peruse the <a href="/docs/third-party-content/libraries-tools/#allocation">Third Party Examples</a></li>
</ul>
<h3 id="spread">Spread</h3>
<p>You should consider spreading your game servers in two ways:</p>
<ul>
<li><strong>Across geographic fault domains</strong> (<a href="https://cloud.google.com/compute/docs/regions-zones">GCP regions</a>, <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-regions-availability-zones.html">AWS availability zones</a>, separate datacenters, etc.): This is desirable for geographic fault isolation, but also for optimizing client latency to the game server.</li>
<li><strong>Within a fault domain</strong>: Kubernetes Clusters are single points of failure. A single misconfigured RBAC rule, an overloaded Kubernetes Control Plane, etc. can prevent new game server allocations, or worse, disrupt existing sessions. Running multiple clusters within a fault domain also allows for <a href="/docs/installation/upgrading/#upgrading-agones-multiple-clusters">easier upgrades</a>.</li>
</ul>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-f726976ee94b3b66e8467a404921069b">5.2.1 - Google Kubernetes Engine Best Practices</h1>
    <div class="lead">Best practices for running Code Blind on Google Kubernetes Engine (GKE).</div>
	<h2 id="overview">Overview</h2>
<p>On this page, we&rsquo;ve collected several <a href="https://cloud.google.com/kubernetes-engine/">Google Kubernetes Engine (GKE)</a> best practices.</p>
<h2 id="release-channels">Release Channels</h2>
<h3 id="why">Why?</h3>
<p>We recommned using <a href="https://cloud.google.com/kubernetes-engine/docs/concepts/release-channels">Release Channels</a> for all GKE clusters. Using Release Channels has several advantages:</p>
<ul>
<li>Google automatically manages the version and upgrade cadence for your Kubernetes Control Plane and its nodes.</li>
<li>Clusters on a Release Channel are allowed to use the <code>No minor upgrades</code> and <code>No minor or node upgrades</code> <a href="https://cloud.google.com/kubernetes-engine/docs/concepts/maintenance-windows-and-exclusions#limitations-maint-exclusions">scope of maintenance exclusions</a> - in other words, enrolling a cluster in a Release Channel gives you <em>more control</em> over node upgrades.</li>
<li>Clusters enrolled in <code>rapid</code> channel have access to the newest Kubernetes version first. Code Blind strives to <a href="/docs/installation/#agones-and-kubernetes-supported-versions">support the newest release in <code>rapid</code> channel</a> to allow you to test the newest Kubernetes soon after it&rsquo;s available in GKE.</li>
</ul>


<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Note</h4>

    GKE Autopilot clusters must be on Release Channels.

</div>

<h3 id="what-channel-should-i-use">What channel should I use?</h3>
<p>We recommend the <code>regular</code> channel, which offers a balance between stability and freshness. See <a href="https://cloud.google.com/kubernetes-engine/docs/concepts/release-channels#what_channel_should_i_use">this guide</a> for more discussion.</p>
<p>If you need to disallow minor version upgrades for more than 6 months, consider choosing the freshest Kubernetes version possible: Choosing the freshest version on <code>rapid</code> or <code>regular</code> will extend the amount of time before your cluster reaches <a href="https://cloud.google.com/kubernetes-engine/docs/release-schedule#schedule-for-release-channels">end of life</a>.</p>
<h3 id="what-versions-are-available-on-a-given-channel">What versions are available on a given channel?</h3>
<p>You can query the versions available across different channels using <code>gcloud</code>:</p>
<pre tabindex="0"><code>gcloud container get-server-config \
  --region=[COMPUTE_REGION] \
  --flatten=&#34;channels&#34; \
  --format=&#34;yaml(channels)&#34;
</code></pre><p>Replace the following:</p>
<ul>
<li><strong>COMPUTE_REGION</strong>: the
<a href="https://cloud.google.com/compute/docs/regions-zones#available">Google Cloud region</a>
where you will create the cluster.</li>
</ul>
<h2 id="managing-game-server-disruption-on-gke">Managing Game Server Disruption on GKE</h2>
<p>If your game session length is less than an hour, use the <code>eviction</code> API to configure your game servers appropriately - see <a href="/docs/advanced/controlling-disruption/">Controlling Disruption</a>.</p>
<p>For sessions longer than an hour, there are currently two possible approaches to manage disruption:</p>
<ul>
<li>
<p>(GKE Standard/Autopilot) <a href="https://martinfowler.com/bliki/BlueGreenDeployment.html">Blue/green deployment</a> at the cluster level: If you are using an automated deployment process, you can:</p>
<ul>
<li>create a new, <code>green</code> cluster within a release channel e.g. every week,</li>
<li>use <a href="https://cloud.google.com/kubernetes-engine/docs/concepts/maintenance-windows-and-exclusions#exclusions">maintenance exclusions</a> to prevent node upgrades for 30d, and</li>
<li>scale the <code>Fleet</code> on the old, <code>blue</code> cluster down to 0, and</li>
<li>use <a href="/docs/advanced/multi-cluster-allocation/">multi-cluster allocation</a> on Code Blind, which will then direct new allocations to the new <code>green</code> cluster (since <code>blue</code> has 0 desired), then</li>
<li>delete the old, <code>blue</code> cluster when the <code>Fleet</code> successfully scales down.</li>
</ul>
</li>
<li>
<p>(GKE Standard only) Use <a href="https://cloud.google.com/kubernetes-engine/docs/concepts/node-pool-upgrade-strategies#blue-green-upgrade-strategy">node pool blue/green upgrades</a></p>
</li>
</ul>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-6f8bbe726ba7c85476067c9513fc6136">5.3 - Code Blind Game Server Client SDKs</h1>
    <div class="lead">The SDKs are integration points for game servers with Code Blind itself.</div>
	<h2 id="overview">Overview</h2>
<p>The client SDKs are required for a game server to work with Code Blind.</p>
<p>The current supported SDKs are:</p>
<ul>
<li><a href="/docs/guides/client-sdks/unreal/">Unreal Engine</a></li>
<li><a href="/docs/guides/client-sdks/unity/">Unity</a></li>
<li><a href="/docs/guides/client-sdks/cpp/">C++</a></li>
<li><a href="/docs/guides/client-sdks/csharp/">C#</a></li>
<li><a href="/docs/guides/client-sdks/nodejs/">Node.js</a></li>
<li><a href="/docs/guides/client-sdks/go/">Go</a></li>
<li><a href="/docs/guides/client-sdks/rust/">Rust</a></li>
<li><a href="/docs/guides/client-sdks/rest/">REST</a></li>
</ul>
<p>You can also find some externally supported SDKs in our
<a href="https://codeblind.ai/docs/third-party-content/libraries-tools/#client-sdks">Third Party Content</a>.</p>
<p>The SDKs are relatively thin wrappers around <a href="https://grpc.io">gRPC</a> generated clients,
or an implementation of the REST API (exposed via <a href="https://github.com/grpc-ecosystem/grpc-gateway">grpc-gateway</a>),
where gRPC client generation and compilation isn&rsquo;t well supported.</p>
<p>They connect to a small process that Code Blind coordinates to run alongside the Game Server
in a Kubernetes <a href="https://kubernetes.io/docs/concepts/workloads/pods/pod-overview/"><code>Pod</code></a>.
This means that more languages can be supported in the future with minimal effort
(but pull requests are welcome! 😊 ).</p>
<p>There is also <a href="/docs/guides/client-sdks/local/">local development tooling</a> for working against the SDK locally,
without having to spin up an entire Kubernetes infrastructure.</p>
<h2 id="connecting-to-the-sdk-server">Connecting to the SDK Server</h2>
<p>Starting with Code Blind 1.1.0, the port that the SDK Server listens on for incoming gRPC or HTTP requests is
configurable. This provides flexibility in cases where the default port conflicts with a port that is needed
by the game server.</p>
<p>Code Blind will automatically set the following environment variables on all game server containers:</p>
<ul>
<li><code>AGONES_SDK_GRPC_PORT</code>: The port where the gRPC server is listening (defaults to 9357)</li>
<li><code>AGONES_SDK_HTTP_PORT</code>: The port where the grpc-gateway is listening (defaults to 9358)</li>
</ul>
<p>The SDKs will automatically discover and connect to the gRPC port specified in the environment variable.</p>
<p>If your game server requires using a REST client, it is advised to use the port from the environment variable,
otherwise your game server will not be able to contact the SDK server if it is configured to use a non-default port.</p>
<h2 id="function-reference">Function Reference</h2>
<p>While each of the SDKs are canonical to their languages, they all have the following
functions that implement the core responsibilities of the SDK.</p>
<p>For language specific documentation, have a look at the respective source (linked above),
and the 
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>examples</a>.</p>
<p>Calling any of state changing functions mentioned below does not guarantee that GameServer Custom Resource object would actually change its state right after the call. For instance, it could be moved to the <code>Shutdown</code> state elsewhere (for example, when a fleet scales down), which leads to no changes in <code>GameServer</code> object. You can verify the result of this call by waiting for the desired state in a callback to WatchGameServer() function.</p>
<p>Functions which changes GameServer state or settings are:</p>
<ol>
<li>Ready()</li>
<li>Shutdown()</li>
<li>SetLabel()</li>
<li>SetAnnotation()</li>
<li>Allocate()</li>
<li>Reserve()</li>
<li>Alpha().SetCapacity()</li>
<li>Alpha().PlayerConnect()</li>
<li>Alpha().PlayerDisconnect()</li>
<li>Alpha().SetCounterCount()</li>
<li>Alpha().IncrementCounter()</li>
<li>Alpha().DecrementCounter()</li>
<li>Alpha().SetCounterCapacity()</li>
<li>Alpha().AppendListValue()</li>
<li>Alpha().DeleteListValue()</li>
<li>Alpha().SetListCapacity()</li>
</ol>
<h3 id="lifecycle-management">Lifecycle Management</h3>
<h4 id="ready">Ready()</h4>
<p>This tells Code Blind that the Game Server is ready to take player connections.
Once a Game Server has specified that it is <code>Ready</code>, then the Kubernetes
GameServer record will be moved to the <code>Ready</code> state, and the details
for its public address and connection port will be populated.</p>
<p>While Code Blind prefers that <code>Shutdown()</code> is run once a game has completed to delete the <code>GameServer</code> instance,
if you want or need to move an <code>Allocated</code> <code>GameServer</code> back to <code>Ready</code> to be reused, you can call this SDK method again to do
this.</p>
<h4 id="health">Health()</h4>
<p>This sends a single ping to designate that the Game Server is alive and
healthy. Failure to send pings within the configured thresholds will result
in the GameServer being marked as <code>Unhealthy</code>.</p>
<p>See the 
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>gameserver.yaml</a> for all health checking
configurations.</p>
<h4 id="reserveseconds">Reserve(seconds)</h4>
<p>With some matchmaking scenarios and systems it is important to be able to ensure that a <code>GameServer</code> is unable to be deleted,
but doesn&rsquo;t trigger a FleetAutoscaler scale up. This is where <code>Reserve(seconds)</code> is useful.</p>
<p><code>Reserve(seconds)</code> will move the <code>GameServer</code> into the Reserved state for the specified number of seconds (0 is forever), and then it will be
moved back to <code>Ready</code> state. While in <code>Reserved</code> state, the <code>GameServer</code> will not be deleted on scale down or <code>Fleet</code> update,
and also it could not be Allocated using <a href="https://codeblind.ai/docs/reference/gameserverallocation/">GameServerAllocation</a>.</p>
<p>This is often used when a game server process must register itself with an external system, such as a matchmaker,
that requires it to designate itself as available for a game session for a certain period. Once a game session has started,
it should call <code>SDK.Allocate()</code> to designate that players are currently active on it.</p>
<p>Calling other state changing SDK commands such as <code>Ready</code> or <code>Allocate</code> will turn off the timer to reset the <code>GameServer</code> back
to the <code>Ready</code> state or to promote it to an <code>Allocated</code> state accordingly.</p>
<h4 id="allocate">Allocate()</h4>
<p>With some matchmakers and game matching strategies, it can be important for game servers to mark themselves as <code>Allocated</code>.
For those scenarios, this SDK functionality exists.</p>
<p>There is a chance that GameServer does not actually become <code>Allocated</code> after this call. Please refer to the general note in <a href="/docs/guides/client-sdks/#function-reference">Function Reference</a> above.</p>
<p>The <code>agones.dev/last-allocated</code> annotation will be set on the GameServer to an RFC3339 formatted timestamp of the time of allocation, even if the GameServer was already in an <code>Allocated</code> state.</p>
<p>Note that if using <code>SDK.Allocate()</code> in combination with <a href="https://codeblind.ai/docs/reference/gameserverallocation/">GameServerAllocation</a>s, it&rsquo;s possible for the <code>agones.dev/last-allocated</code> timestamp to move backwards if clocks are not synchronized between the Code Blind controller and the GameServer pod.</p>


<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Note</h4>

    Using a <a href="https://codeblind.ai/docs/reference/gameserverallocation/">GameServerAllocation</a> is preferred in all other scenarios,
as it gives Code Blind control over how packed <code>GameServers</code> are scheduled within a cluster, whereas with <code>Allocate()</code> you
relinquish control to an external service which likely doesn&rsquo;t have as much information as Code Blind.

</div>

<h4 id="shutdown">Shutdown()</h4>
<p>This tells Code Blind to shut down the currently running game server. The GameServer state will be set <code>Shutdown</code> and the
backing Pod will be Terminated.</p>
<p>It&rsquo;s worth reading the <a href="https://kubernetes.io/docs/concepts/workloads/pods/pod-lifecycle/#pod-termination">Termination of Pods</a>
Kubernetes documentation, to understand the termination process, and the related configuration options.</p>
<p>As a rule of thumb, implement a graceful shutdown in your game sever process when it receives the TERM signal
from Kubernetes when the backing Pod goes into Termination state.</p>
<p>Be aware that if you use a variation of <code>System.exit(0)</code> after calling SDK.Shutdown(), your game server container may
restart for a brief period, inline with our <a href="https://codeblind.ai/docs/guides/health-checking/#health-failure-strategy">Health Checking</a> policies.</p>
<p>If the SDK server receives a TERM signal before calling SDK.Shutdown(),
the SDK server will stay alive for the period of the <code>terminationGracePeriodSeconds</code> until <code>SDK.Shutdown()</code> has been called.</p>
<h3 id="configuration-retrieval">Configuration Retrieval</h3>
<h4 id="gameserver">GameServer()</h4>
<p>This returns most of the backing GameServer configuration and Status. This can be useful
for instances where you may want to know Health check configuration, or the IP and Port
the GameServer is currently allocated to.</p>
<p>Since the GameServer contains an entire <a href="https://kubernetes.io/docs/concepts/workloads/pods/pod-overview/#pod-templates">PodTemplate</a>
the returned object is limited to that configuration that was deemed useful. If there are
areas that you feel are missing, please <a href="https://github.com/googleforgames/agones/issues">file an issue</a> or pull request.</p>
<p>The easiest way to see what is exposed, is to check
the
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore><code>sdk.proto</code></a>, specifically at
the <code>message GameServer</code>.</p>
<p>For language specific documentation, have a look at the respective source (linked above),
and the 
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>examples</a>.</p>
<h4 id="watchgameserverfunctiongameserver">WatchGameServer(function(gameserver){&hellip;})</h4>
<p>This executes the passed in callback with the current <code>GameServer</code> details whenever the underlying <code>GameServer</code> configuration is updated.
This can be useful to track <code>GameServer &gt; Status &gt; State</code> changes, <code>metadata</code> changes, such as labels and annotations, and more.</p>
<p>In combination with this SDK, manipulating <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/">Annotations</a> and
<a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/">Labels</a> can also be a useful way to communicate information through to running game server processes from outside those processes.
This is especially useful when combined with <code>GameServerAllocation</code> <a href="https://codeblind.ai/docs/reference/gameserverallocation/">applied metadata</a>.</p>
<p>Since the GameServer contains an entire <a href="https://kubernetes.io/docs/concepts/workloads/pods/pod-overview/#pod-templates">PodTemplate</a>
the returned object is limited to that configuration that was deemed useful. If there are
areas that you feel are missing, please <a href="https://github.com/googleforgames/agones/issues">file an issue</a> or pull request.</p>
<p>The easiest way to see what is exposed, is to check
the
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore><code>sdk.proto</code></a>, specifically at
the <code>message GameServer</code>.</p>
<p>For language specific documentation, have a look at the respective source (linked above),
and the 
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>examples</a>.</p>
<h3 id="metadata-management">Metadata Management</h3>
<h4 id="setlabelkey-value">SetLabel(key, value)</h4>
<p>This will set a <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/">Label</a> value on the backing <code>GameServer</code>
record that is stored in Kubernetes.</p>
<p>To maintain isolation, the <code>key</code> value is automatically prefixed with the value <strong>&ldquo;agones.dev/sdk-&rdquo;</strong>. This is done for
two main reasons:</p>
<ul>
<li>The prefix allows the developer to always know if they are accessing or reading a value that could have come, or
may be changed by the client SDK. Much like <code>private</code> vs <code>public</code> scope in a programming language, the Code Blind
SDK only gives you access to write to part of the set of labels and annotations that exist on a GameServer.</li>
<li>The prefix allows for a smaller attack surface if the GameServer container gets compromised. Since the
game container is generally externally exposed, and the Code Blind project doesn&rsquo;t control the binary that is
run within it, limiting exposure if the game server becomes compromised is worth the extra
development friction that comes with having this prefix in place.</li>
</ul>


<div class="alert alert-warning" role="alert">
<h4 class="alert-heading">Warning</h4>

    <p>There are limits on the characters that be used for label keys and values. Details are <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/#syntax-and-character-set">here</a>.</p>
<p>You will need to take them into account when combined with the label prefix above.</p>


</div>

<p>Setting <code>GameServer</code> labels can be useful if you want information from your running game server process to be
observable or searchable through the Kubernetes API.</p>
<h4 id="setannotationkey-value">SetAnnotation(key, value)</h4>
<p>This will set an <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/">Annotation</a> value
on the backing <code>GameServer</code> record that is stored in Kubernetes.</p>
<p>To maintain isolation, the <code>key</code> value is automatically prefixed with <strong>&ldquo;agones.dev/sdk-&rdquo;</strong> for the same reasons as
in <a href="/docs/guides/client-sdks/#setlabelkey-value">SetLabel(&hellip;)</a> above. The isolation is also important as Code Blind uses annotations on the
<code>GameServer</code> as part of its internal processing.</p>
<p>Setting <code>GameServer</code> annotations can be useful if you want information from your running game server process to be
observable through the Kubernetes API.</p>
<h3 id="counters-and-lists">Counters And Lists</h3>

<div class="alert alert-warning" role="alert">
    <h4 class="alert-heading">Warning</h4>
    <p>The Counters And Lists feature is currently <strong><a href="https://codeblind.ai/docs/guides/feature-stages/#alpha">Alpha</a></strong>,
        not enabled by default, and may change in the future.</p>
<p>Use the FeatureGate  <code>CountsAndLists</code>
to enable and test this feature.</p>
    <p>See the <a href="https://codeblind.ai/docs/guides/feature-stages/#feature-gates">Feature Gate documentation</a> for details on how to enable features.</p>
</div>

<p>The <code>Counters</code> and <code>Lists</code> features in the SDK offer a flexible configuration for tracking various entities like
players, rooms, and sessions.</p>
<p>Declared keys and default values for Counters and Lists are specified in
<a href="https://codeblind.ai/docs/reference/agones_crd_api_reference/#agones.dev/v1.GameServerSpec"><code>GameServer.Spec.Counters</code> and <code>GameServer.Spec.Lists</code></a> respectively.</p>
<p>Modified Counter and List values and capacities will be updated
in <a href="https://codeblind.ai/docs/reference/agones_crd_api_reference/#agones.dev/v1.GameServerStatus"><code>GameServer.Status.Counters</code> and <code>GameServer.Status.Lists</code></a> respectively.</p>


<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Note</h4>

    <p>The SDK batches mutation operations every 1 second for performance reasons. However, changes made and subsequently
retrieved through the SDK will be atomically accurate through the SDK, as those values are tracked within the
SDK Server sidecar process.</p>
<p>Changes made through Allocation or the Kubernetes API to
<a href="https://codeblind.ai/docs/reference/agones_crd_api_reference/#agones.dev/v1.GameServerSpec"><code>GameServer.Spec.Counters</code> and <code>GameServer.Spec.Lists</code></a>
will be eventually consistent when being retrieved through the SDK.</p>
<p>Since the Code Blind SDK server batches the update operations of
<a href="https://codeblind.ai/docs/reference/agones_crd_api_reference/#agones.dev/v1.GameServerStatus"><code>GameServer.Status.Counters</code> and <code>GameServer.Status.Lists</code></a>
asynchronously, this means that if you update
<a href="https://codeblind.ai/docs/reference/agones_crd_api_reference/#agones.dev/v1.GameServerStatus"><code>GameServer.status</code></a> values
through both the SDK and the Allocation/Kubernetes API, the batch processing may silently truncate some of those values
to the capacity of that Counter or List.</p>


</div>

<h4 id="counters">Counters</h4>
<p>All functions will return an error if the specified <code>key</code> is not predefined in the
<a href="https://codeblind.ai/docs/reference/agones_crd_api_reference/#agones.dev/v1.GameServerSpec"><code>GameServer.Spec.Counters</code></a> resource configuration.</p>
<p><strong>Note:</strong> For Counters, the default setting for the capacity is preset to 1000. It is recommended to avoid configuring the capacity to max(int64), as doing so could cause problems with <a href="https://github.com/googleforgames/agones/issues/3636">JSON Patch operations</a>.</p>
<h5 id="alphagetcountercountkey">Alpha().GetCounterCount(key)</h5>
<p>This function retrieves either the <a href="https://codeblind.ai/docs/reference/agones_crd_api_reference/#agones.dev/v1.GameServerStatus"><code>GameServer.Status.Counters[key].Count</code></a> or the SDK awaiting-batch
value for a given key, whichever is most up to date.</p>
<h5 id="alphasetcountercountkey-amount">Alpha().SetCounterCount(key, amount)</h5>
<p>This function sets the value of <a href="https://codeblind.ai/docs/reference/agones_crd_api_reference/#agones.dev/v1.GameServerStatus"><code>GameServer.Status.Counters[key].Count</code></a> for the given key to the
passed in amount. This operation overwrites any previous values and the new value cannot exceed the Counter&rsquo;s capacity.</p>
<h5 id="alphaincrementcounterkey-amount">Alpha().IncrementCounter(key, amount)</h5>
<p>This function increments <a href="https://codeblind.ai/docs/reference/agones_crd_api_reference/#agones.dev/v1.GameServerStatus"><code>GameServer.Status.Counters[key].Count</code></a> for the given key by the passed in
non-negative amount. The function returns an error if the Counter is already at capacity (at time of operation),
indicating no increment will occur.</p>
<h5 id="alphadecrementcounterkey-amount">Alpha().DecrementCounter(key, amount)</h5>
<p>This function decreases <a href="https://codeblind.ai/docs/reference/agones_crd_api_reference/#agones.dev/v1.GameServerStatus"><code>GameServer.Status.Counters[key].Count</code></a> for the given key by the passed in
non-negative amount. It returns an error if the Counter&rsquo;s count is already at zero.</p>
<h5 id="alphasetcountercapacitykey-amount">Alpha().SetCounterCapacity(key, amount)</h5>
<p>This function sets the maximum <a href="https://codeblind.ai/docs/reference/agones_crd_api_reference/#agones.dev/v1.GameServerStatus"><code>GameServer.Status.Counters[key].Capacity</code></a> for the given key by the
passed in non-negative amount. A capacity value of 0 indicates no capacity limit.</p>
<h5 id="alphagetcountercapacitykey">Alpha().GetCounterCapacity(key)</h5>
<p>This function retrieves either the <a href="https://codeblind.ai/docs/reference/agones_crd_api_reference/#agones.dev/v1.GameServerStatus"><code>GameServer.Status.Counters[key].Capacity</code></a> or the SDK
awaiting-batch value for the given key, whichever is most up to date.</p>
<h4 id="lists">Lists</h4>
<p>All functions will return an error if the specified <code>key</code> is not predefined in the
<a href="https://codeblind.ai/docs/reference/agones_crd_api_reference/#agones.dev/v1.GameServerSpec"><code>GameServer.Spec.Lists</code></a> resource configuration.</p>
<h5 id="alphaappendlistvaluekey-value">Alpha().AppendListValue(key, value)</h5>
<p>This function appends the specified string value to the List
in <a href="https://codeblind.ai/docs/reference/agones_crd_api_reference/#agones.dev/v1.GameServerStatus"><code>GameServer.Status.Lists[key].Values</code></a>.</p>
<p>An error is returned if the string already exists in the list or if the list is at capacity.</p>
<h5 id="alphadeletelistvaluekey-value">Alpha().DeleteListValue(key, value)</h5>
<p>This function removes the specified string value from the List
in <a href="https://codeblind.ai/docs/reference/agones_crd_api_reference/#agones.dev/v1.GameServerStatus"><code>GameServer.Status.Lists[key].Values</code></a>.</p>
<p>An error is returned if the string does not exist in the list.</p>
<h5 id="alphasetlistcapacitykey-amount">Alpha().SetListCapacity(key, amount)</h5>
<p>This function sets the maximum capacity for the List at <a href="https://codeblind.ai/docs/reference/agones_crd_api_reference/#agones.dev/v1.GameServerStatus"><code>GameServer.Status.Lists[key].Capacity</code></a>.</p>
<p>The capacity value is required to be between 0 and 1000.</p>
<h5 id="alphagetlistcapacitykey">Alpha().GetListCapacity(key)</h5>
<p>This function retrieves either the <a href="https://codeblind.ai/docs/reference/agones_crd_api_reference/#agones.dev/v1.GameServerStatus"><code>GameServer.Status.Lists[key].Capacity</code></a> or the SDK
awaiting-batch value for the given key, whichever is most up to date.</p>
<h5 id="alphagetlistvalueskey">Alpha().GetListValues(key)</h5>
<p>This function retrieves either the <a href="https://codeblind.ai/docs/reference/agones_crd_api_reference/#agones.dev/v1.GameServerStatus"><code>GameServer.Status.Lists[key].Values</code></a> or the SDK
awaiting-batch values array for the given key, whichever is most up to date.</p>
<h5 id="alphalistcontainskey-value">Alpha().ListContains(key, value)</h5>
<p>Convenience function, which returns if the specific string value exists in the results
of <a href="/docs/guides/client-sdks/#alphagetlistvalueskey"><code>Alpha().GetListValues(key)</code></a>.</p>
<h5 id="alphagetlistlengthkey">Alpha().GetListLength(key)</h5>
<p>Convenience function, which retrieves the length of the results of <a href="/docs/guides/client-sdks/#alphagetlistvalueskey"><code>Alpha().GetListValues(key)</code></a>.</p>
<h3 id="player-tracking">Player Tracking</h3>

<div class="alert alert-warning" role="alert">
    <h4 class="alert-heading">Warning</h4>
    <p>The Player Tracking feature is currently <strong><a href="https://codeblind.ai/docs/guides/feature-stages/#alpha">Alpha</a></strong>,
        not enabled by default, and may change in the future.</p>
<p>Use the FeatureGate  <code>PlayerTracking</code>
to enable and test this feature.</p>
    <p>See the <a href="https://codeblind.ai/docs/guides/feature-stages/#feature-gates">Feature Gate documentation</a> for details on how to enable features.</p>
</div>



<div class="alert alert-warning" role="alert">
<h4 class="alert-heading">Warning</h4>

    <a href="/#counters-and-lists">Counters and Lists</a> will eventually replace the Alpha functionality of Player Tracking, which will subsequently be
removed from Code Blind. If you are currently using this Alpha feature, we would love for you to test (and ideally migrate
to!) this new functionality to ensure it will meet all your needs.

</div>

<h4 id="alphaplayerconnectplayerid">Alpha().PlayerConnect(playerID)</h4>
<p>This function increases the SDK’s stored player count by one, and appends this playerID to
<code>GameServer.Status.Players.IDs</code>.</p>
<p><a href="https://codeblind.ai/docs/reference/agones_crd_api_reference/#agones.dev/v1.PlayerStatus"><code>GameServer.Status.Players.Count</code> and <code>GameServer.Status.Players.IDs</code></a>
are then set to update the player count and id list a second from now,
unless there is already an update pending, in which case the update joins that batch operation.</p>
<p><code>PlayerConnect()</code> returns true and adds the playerID to the list of playerIDs if this playerID was not already in the
list of connected playerIDs.</p>
<p>If the playerID exists within the list of connected playerIDs, <code>PlayerConnect()</code> will return false, and the list of
connected playerIDs will be left unchanged.</p>
<p>An error will be returned if the playerID was not already in the list of connected playerIDs but the player capacity for
the server has been reached. The playerID will not be added to the list of playerIDs.</p>


<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Note</h4>

    Do not use this method if you are manually managing <code>GameServer.Status.Players.IDs</code> and <code>GameServer.Status.Players.Count</code>
through the Kubernetes API, as indeterminate results will occur.

</div>

<h4 id="alphaplayerdisconnectplayerid">Alpha().PlayerDisconnect(playerID)</h4>
<p>This function decreases the SDK’s stored player count by one, and removes the playerID from
<a href="https://codeblind.ai/docs/reference/agones_crd_api_reference/#agones.dev/v1.PlayerStatus"><code>GameServer.Status.Players.IDs</code></a>.</p>
<p><code>GameServer.Status.Players.Count</code> and <code>GameServer.Status.Players.IDs</code> are then set to
update the player count and id list a second from now,
unless there is already an update pending, in which case the update joins that batch operation.</p>
<p><code>PlayerDisconnect()</code> will return true and remove the supplied playerID from the list of connected playerIDs if the
playerID value exists within the list.</p>
<p>If the playerID was not in the list of connected playerIDs, the call will return false, and the connected playerID list
will be left unchanged.</p>


<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Note</h4>

    Do not use this method if you are manually managing <code>GameServer.Status.Players.IDs</code> and <code>GameServer.Status.Players.Count</code>
through the Kubernetes API, as indeterminate results will occur.

</div>

<h4 id="alphasetplayercapacitycount">Alpha().SetPlayerCapacity(count)</h4>
<p>Update the <a href="https://codeblind.ai/docs/reference/agones_crd_api_reference/#agones.dev/v1.PlayerStatus"><code>GameServer.Status.Players.Capacity</code></a> value with a new capacity.</p>
<h4 id="alphagetplayercapacity">Alpha().GetPlayerCapacity()</h4>
<p>This function retrieves the current player capacity. This is always accurate from what has been set through this SDK,
even if the value has yet to be updated on the GameServer status resource.</p>


<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Note</h4>

    If <code>GameServer.Status.Players.Capacity</code> is set manually through the Kubernetes API, use <code>SDK.GameServer()</code> or
<code>SDK.WatchGameServer()</code> instead to view this value.

</div>

<h4 id="alphagetplayercount">Alpha().GetPlayerCount()</h4>
<p>This function retrieves the current player count.
This is always accurate from what has been set through this SDK, even if the value has yet to be updated on the
GameServer status resource.</p>


<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Note</h4>

    If <code>GameServer.Status.Players.IDs</code> is set manually through the Kubernetes API, use SDK.GameServer()
or SDK.WatchGameServer() instead to retrieve the current player count.

</div>

<h4 id="alphaisplayerconnectedplayerid">Alpha().IsPlayerConnected(playerID)</h4>
<p>This function returns if the playerID is currently connected to the GameServer. This is always accurate from what has
been set through this SDK,
even if the value has yet to be updated on the GameServer status resource.</p>


<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Note</h4>

    If <code>GameServer.Status.Players.IDs</code> is set manually through the Kubernetes API, use SDK.GameServer()
or SDK.WatchGameServer() instead to determine connected status.

</div>

<h4 id="alphagetconnectedplayers">Alpha().GetConnectedPlayers()</h4>
<p>This function returns the list of the currently connected player ids. This is always accurate from what has been set
through this SDK, even if the value has yet to be updated on the GameServer status resource.</p>


<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Note</h4>

    If <code>GameServer.Status.Players.IDs</code> is set manually through the Kubernetes API, use SDK.GameServer()
or SDK.WatchGameServer() instead to list the connected players.

</div>

<h2 id="writing-your-own-sdk">Writing your own SDK</h2>
<p>If there isn&rsquo;t an SDK for the language and platform you are looking for, you have several options:</p>
<h3 id="grpc-client-generation">gRPC Client Generation</h3>
<p>If client generation is well supported by <a href="https://grpc.io/docs/">gRPC</a>, then generate client(s) from
the proto files found in the
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore><code>proto/sdk</code></a>,
directory and look at the current 
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>sdks</a> to see how the wrappers are
implemented to make interaction with the SDK server simpler for the user.</p>
<h3 id="rest-api-implementation">REST API Implementation</h3>
<p>If client generation is not well supported by gRPC, or if there are other complicating factors, implement the SDK through
the <a href="/docs/guides/client-sdks/rest/">REST</a> HTTP+JSON interface. This could be written by hand, or potentially generated from
the 
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>Swagger/OpenAPI Specifications</a>.</p>
<p>Finally, if you build something that would be usable by the community, please submit a pull request!</p>
<h2 id="sdk-conformance-test">SDK Conformance Test</h2>
<p>There is a tool <code>SDK server Conformance</code> checker which will run Local SDK server and record all requests your client is performing.</p>
<p>In order to check that SDK is working properly you should write simple SDK test client which would use all methods of your SDK.</p>
<p>Also to test that SDK client is receiving valid Gameserver data, your binary should set the same <code>Label</code> value as creation timestamp which you will receive as a result of GameServer() call and <code>Annotation</code> value same as gameserver UID received by Watch gameserver callback.</p>
<p>Complete list of endpoints which should be called by your test client is the following:</p>
<pre tabindex="0"><code>ready,allocate,setlabel,setannotation,gameserver,health,shutdown,watch
</code></pre><p>In order to run this test SDK server locally use:</p>
<pre tabindex="0"><code>SECONDS=30 make run-sdk-conformance-local
</code></pre><p>Docker container would timeout in 30 seconds and give your the comparison of received requests and expected requests</p>
<p>For instance you could run Go SDK conformance test and see how the process goes:</p>
<pre tabindex="0"><code>SDK_FOLDER=go make run-sdk-conformance-test
</code></pre><p>In order to add test client for your SDK, write <code>sdktest.sh</code> and <code>Dockerfile</code>. Refer to 
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>Golang SDK Conformance testing directory structure</a>.</p>
<h2 id="building-the-tools">Building the Tools</h2>
<p>If you wish to build the binaries from source
the <code>make</code> target <code>build-agones-sdk-binary</code> will compile the necessary binaries
for all supported operating systems (64 bit windows, linux and osx).</p>
<p>You can find the binaries in the <code>bin</code> folder in 
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>`cmd/sdk-server`</a>
once compilation is complete.</p>
<p>See 
<a href="https://github.com/josephbarnett/codeblind.ai/blob/main/" target="_blank" data-proofer-ignore>Developing, Testing and Building Code Blind</a> for more details.</p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-d9110a0f360a4714db35abf6ce38a140">5.3.1 - Unreal Engine Game Server Client Plugin</h1>
    <div class="lead">This is the Unreal Engine Code Blind Game Server Client Plugin.</div>
	<p>Check the <a href="/docs/guides/client-sdks/">Client SDK Documentation</a> for more details on each of the SDK functions and how to run the SDK locally.</p>
<h2 id="sdk-functionality">SDK Functionality</h2>
<table>
<thead>
<tr>
<th>Area</th>
<th>Action</th>
<th>Implemented</th>
</tr>
</thead>
<tbody>
<tr>
<td>Lifecycle</td>
<td>Ready</td>
<td>✔️</td>
</tr>
<tr>
<td>Lifecycle</td>
<td>Health</td>
<td>✔️</td>
</tr>
<tr>
<td>Lifecycle</td>
<td>Reserve</td>
<td>✔️</td>
</tr>
<tr>
<td>Lifecycle</td>
<td>Allocate</td>
<td>✔️</td>
</tr>
<tr>
<td>Lifecycle</td>
<td>Shutdown</td>
<td>✔️</td>
</tr>
<tr>
<td>Configuration</td>
<td>GameServer</td>
<td>✔️</td>
</tr>
<tr>
<td>Configuration</td>
<td>Watch</td>
<td>✔️</td>
</tr>
<tr>
<td>Metadata</td>
<td>SetAnnotation</td>
<td>✔️</td>
</tr>
<tr>
<td>Metadata</td>
<td>SetLabel</td>
<td>✔️</td>
</tr>
<tr>
<td>Counters</td>
<td>GetCounterCount</td>
<td>❌</td>
</tr>
<tr>
<td>Counters</td>
<td>SetCounterCount</td>
<td>❌</td>
</tr>
<tr>
<td>Counters</td>
<td>IncrementCounter</td>
<td>❌</td>
</tr>
<tr>
<td>Counters</td>
<td>DecrementCounter</td>
<td>❌</td>
</tr>
<tr>
<td>Counters</td>
<td>SetCounterCapacity</td>
<td>❌</td>
</tr>
<tr>
<td>Counters</td>
<td>GetCounterCapacity</td>
<td>❌</td>
</tr>
<tr>
<td>Lists</td>
<td>AppendListValue</td>
<td>❌</td>
</tr>
<tr>
<td>Lists</td>
<td>DeleteListValue</td>
<td>❌</td>
</tr>
<tr>
<td>Lists</td>
<td>SetListCapacity</td>
<td>❌</td>
</tr>
<tr>
<td>Lists</td>
<td>GetListCapacity</td>
<td>❌</td>
</tr>
<tr>
<td>Lists</td>
<td>ListContains</td>
<td>❌</td>
</tr>
<tr>
<td>Lists</td>
<td>GetListLength</td>
<td>❌</td>
</tr>
<tr>
<td>Lists</td>
<td>GetListValues</td>
<td>❌</td>
</tr>
<tr>
<td>Player Tracking</td>
<td>GetConnectedPlayers</td>
<td>✔️</td>
</tr>
<tr>
<td>Player Tracking</td>
<td>GetPlayerCapacity</td>
<td>✔️</td>
</tr>
<tr>
<td>Player Tracking</td>
<td>GetPlayerCount</td>
<td>✔️</td>
</tr>
<tr>
<td>Player Tracking</td>
<td>IsPlayerConnected</td>
<td>✔️</td>
</tr>
<tr>
<td>Player Tracking</td>
<td>PlayerConnect</td>
<td>✔️</td>
</tr>
<tr>
<td>Player Tracking</td>
<td>PlayerDisconnect</td>
<td>✔️</td>
</tr>
<tr>
<td>Player Tracking</td>
<td>SetPlayerCapacity</td>
<td>✔️</td>
</tr>
</tbody>
</table>
<p>Additional methods have been added for ease of use (both of which are enabled by default):</p>
<ul>
<li>Connect
<ul>
<li>will call <code>/gameserver</code> till a succesful response is returned and then call <code>/ready</code>.</li>
<li>disabled by setting <code>bDisableAutoConnect</code> to <code>true</code>.</li>
<li>An event is broadcast with the <code>GameServer</code> data once the <code>/gameserver</code> call succeeds.</li>
</ul>
</li>
<li>Health
<ul>
<li>calls <code>/health</code> endpoint on supplied rate</li>
<li>enabled by default with 10 second rate</li>
<li>disabled by default by setting <code>HealthRateSeconds</code> to <code>0</code>.</li>
</ul>
</li>
</ul>
<p>Both of the above are automatically kicked off in the <code>BeginPlay</code> of the component.</p>
<h2 id="download">Download</h2>
<p>Download the source from the <a href="https://github.com/googleforgames/agones/releases">Releases Page</a>
or 
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>directly from GitHub</a>.</p>
<h2 id="resources">Resources</h2>
<p><a href="https://www.unrealengine.com/">Unreal</a> is a <a href="https://en.wikipedia.org/wiki/Game_engine">game engine</a> that is used by anyone from hobbyists all the way through to huge AAA Game Stuidos.</p>
<p>With this in mind there is a vast amount to learn to run a production game using Unreal, even before you get to learning how it integrates with Code Blind. If you want to kick the tires with a starter project you will probably be fine with one of the starter projects out of the box.</p>
<p>However as your Unreal/Code Blind project gets more advanced you will want to understand more about the engine itself and how it can be used to integrate with this project. There will be different ways of interacting via in Play In Editor (PIE) versus running as an actual dedicated game server packaged into a container.</p>
<p>There are few helpful links for latest Unreal Engine 5:</p>
<ul>
<li><a href="https://docs.unrealengine.com/en-US/">UE5 Documentation Site</a></li>
<li><a href="https://docs.unrealengine.com/en-US/setting-up-dedicated-servers-in-unreal-engine/">UE5 Dedicated Servers</a>
<ul>
<li>useful guide to getting started with dedicated servers in Unreal</li>
</ul>
</li>
<li><a href="https://docs.unrealengine.com/en-US/game-mode-and-game-state-in-unreal-engine/">UE5 Game Mode and Game State</a></li>
<li><a href="https://docs.unrealengine.com/en-US/API/Runtime/Engine/GameFramework/AGameMode/">UE5 Game Mode API Reference</a>
<ul>
<li>useful for hooking up calls to Code Blind</li>
</ul>
</li>
<li><a href="https://docs.unrealengine.com/en-US/API/Runtime/Engine/GameFramework/AGameSession/">UE5 Game Session API Reference</a>
<ul>
<li>as above there are hooks in Game Session that can be used to call into Code Blind</li>
</ul>
</li>
<li><a href="https://docs.unrealengine.com/en-US/build-operations-cooking-packaging-deploying-and-running-projects-in-unreal-engine/">UE5 Building &amp; Packaging Games</a>
<ul>
<li>only building out Unreal game servers / clients, will also need to package into a container</li>
</ul>
</li>
</ul>
<p>If you use Unreal Engine 4, There are few helpful links for it:</p>
<ul>
<li><a href="https://docs.unrealengine.com/4.27/en-US/index.html">UE4 Documentation Site</a></li>
<li><a href="https://docs.unrealengine.com/4.27/en-US/Gameplay/Networking/HowTo/DedicatedServers/index.html">UE4 Dedicated Servers</a></li>
<li><a href="https://docs.unrealengine.com/4.27/en-US/InteractiveExperiences/Framework/GameFlow/">UE4 Game Flow</a></li>
<li><a href="https://docs.unrealengine.com/4.27/en-US/API/Runtime/Engine/GameFramework/AGameMode/index.html">UE4 Game Mode</a></li>
<li><a href="https://docs.unrealengine.com/4.27/en-US/API/Runtime/Engine/GameFramework/AGameSession/index.html">UE4 Game Session</a></li>
<li><a href="https://docs.unrealengine.com/4.27/en-US/Engine/Deployment/BuildOperations/index.html">UE4 Building &amp; Packaging Games</a></li>
</ul>
<h2 id="getting-started">Getting Started</h2>
<p>This is a SDK inspired by the REST API to the Code Blind sidecars that allows engineers to communicate with the sidecar from either C++ or Blueprints.</p>
<h3 id="getting-the-code">Getting the Code</h3>
<p>Easiest way to get this code is to clone the repository and drop the entire plugin folder into your own <code>Plugins</code> folder. This runs the plugin as a Project plugin rather than an engine plugin.</p>
<p>We could however turn this into a marketplace plugin that can be retrived from the marketplace directly into the UE editor.</p>
<h4 id="using-c-ue5ue4">Using C++ (UE5/UE4)</h4>
<ul>
<li>Add Plugin (in your own <code>.uproject</code> file)</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>  <span style="color:#4e9a06">&#34;Plugins&#34;</span><span style="color:#a40000">:</span> <span style="color:#000;font-weight:bold">[</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;Enabled&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">true</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;Name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Code Blind&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">]</span><span style="color:#a40000">,</span>
</span></span></code></pre></div><ul>
<li>Add Plugin (in your own <code>*.Build.cs</code>)</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#a40000">PublicDependencyModuleNames.AddRange(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a40000">new</span><span style="color:#000;font-weight:bold">[]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">&#34;Code Blind&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span><span style="color:#a40000">);</span>
</span></span></code></pre></div><ul>
<li>Add component in header</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#include</span> <span style="color:#8f5902;font-style:italic">&#34;AgonesComponent.h&#34;</span><span style="color:#8f5902;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#000">UPROPERTY</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">EditAnywhere</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">BlueprintReadWrite</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">UAgonesComponent</span><span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">AgonesSDK</span><span style="color:#000;font-weight:bold">;</span>
</span></span></code></pre></div><ul>
<li>Initialize component in GameMode</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#include</span> <span style="color:#8f5902;font-style:italic">&#34;AgonesComponent.h&#34;</span><span style="color:#8f5902;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#include</span> <span style="color:#8f5902;font-style:italic">&#34;Classes.h&#34;</span><span style="color:#8f5902;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#000">ATestGameMode</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">ATestGameMode</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">AgonesSDK</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">CreateDefaultSubobject</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">UAgonesComponent</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">TEXT</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;AgonesSDK&#34;</span><span style="color:#000;font-weight:bold">));</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><ul>
<li>Use the Code Blind component to call PlayerReady</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">void</span> <span style="color:#000">APlatformGameSession</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">PostLogin</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">APlayerController</span><span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">NewPlayer</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#8f5902;font-style:italic">// Empty brances are for callbacks on success and errror.
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>  <span style="color:#000">AgonesSDK</span><span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">PlayerConnect</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;netspeak-player&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">{},</span> <span style="color:#000;font-weight:bold">{});</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h4 id="using-blueprints-ue5">Using Blueprints (UE5)</h4>
<ul>
<li>
<p>Add Component to your Blueprint GameMode
<img alt="component" src="../../../../images/unreal5_bp_component.png"></p>
</li>
<li>
<p>This will automatically call <code>/health</code> every 10 seconds and once <code>/gameserver</code> calls are succesful it will call <code>/ready</code>.</p>
</li>
<li>
<p>Accessing other functionality of Code Blind can be done via adding a node in Blueprints.
<img alt="actions" src="../../../../images/unreal5_bp_actions.png"></p>
</li>
</ul>
<h4 id="using-blueprints-ue4">Using Blueprints (UE4)</h4>
<ul>
<li>
<p>Add Component to your Blueprint GameMode
<img alt="component" src="../../../../images/unreal_bp_component.png"></p>
</li>
<li>
<p>This will automatically call <code>/health</code> every 10 seconds and once <code>/gameserver</code> calls are succesful it will call <code>/ready</code>.</p>
</li>
<li>
<p>Accessing other functionality of Code Blind can be done via adding a node in Blueprints.
<img alt="actions" src="../../../../images/unreal_bp_actions.png"></p>
</li>
</ul>
<h2 id="configuration-options">Configuration Options</h2>
<p>A number of options can be altered via config files in Unreal these are supplied via <code>Game</code> configuration eg. <code>DefaultGame.ini</code>.</p>
<pre tabindex="0"><code>[/Script/Code Blind.AgonesComponent]
HttpPort=1337
HealthRateSeconds=5.0
bDisableAutoConnect=true
</code></pre><h2 id="unreal-hooks">Unreal Hooks</h2>
<p>Within the Unreal <a href="https://docs.unrealengine.com/en-US/API/Runtime/Engine/GameFramework/AGameMode/index.html">GameMode</a> and <a href="https://docs.unrealengine.com/en-US/API/Runtime/Engine/GameFramework/AGameSession/index.html">GameSession</a> exist a number of useful existing
funtions that can be used to fit in with making calls out to Code Blind.</p>
<p>A few examples are:</p>
<ul>
<li><code>RegisterServer</code> to call <code>SetLabel</code>, <code>SetPlayerCapacity</code></li>
<li><code>PostLogin</code> to call <code>PlayerConnect</code></li>
<li><code>NotifyLogout</code> to call <code>PlayerDisconnect</code></li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-cb46d2c42280b723ba5194728d8f8e48">5.3.2 - Unity Game Server Client SDK</h1>
    <div class="lead">This is the Unity version of the Code Blind Game Server Client SDK.</div>
	<p>Check the <a href="/docs/guides/client-sdks/">Client SDK Documentation</a> for more details on each of the SDK functions and how to run the SDK locally.</p>
<h2 id="sdk-functionality">SDK Functionality</h2>
<table>
<thead>
<tr>
<th>Area</th>
<th>Action</th>
<th>Implemented</th>
</tr>
</thead>
<tbody>
<tr>
<td>Lifecycle</td>
<td>Ready</td>
<td>✔️</td>
</tr>
<tr>
<td>Lifecycle</td>
<td>Health</td>
<td>✔️</td>
</tr>
<tr>
<td>Lifecycle</td>
<td>Reserve</td>
<td>✔️</td>
</tr>
<tr>
<td>Lifecycle</td>
<td>Allocate</td>
<td>✔️</td>
</tr>
<tr>
<td>Lifecycle</td>
<td>Shutdown</td>
<td>✔️</td>
</tr>
<tr>
<td>Configuration</td>
<td>GameServer</td>
<td>✔️</td>
</tr>
<tr>
<td>Configuration</td>
<td>Watch</td>
<td>✔️</td>
</tr>
<tr>
<td>Metadata</td>
<td>SetAnnotation</td>
<td>✔️</td>
</tr>
<tr>
<td>Metadata</td>
<td>SetLabel</td>
<td>✔️</td>
</tr>
<tr>
<td>Counters</td>
<td>GetCounterCount</td>
<td>❌</td>
</tr>
<tr>
<td>Counters</td>
<td>SetCounterCount</td>
<td>❌</td>
</tr>
<tr>
<td>Counters</td>
<td>IncrementCounter</td>
<td>❌</td>
</tr>
<tr>
<td>Counters</td>
<td>DecrementCounter</td>
<td>❌</td>
</tr>
<tr>
<td>Counters</td>
<td>SetCounterCapacity</td>
<td>❌</td>
</tr>
<tr>
<td>Counters</td>
<td>GetCounterCapacity</td>
<td>❌</td>
</tr>
<tr>
<td>Lists</td>
<td>AppendListValue</td>
<td>❌</td>
</tr>
<tr>
<td>Lists</td>
<td>DeleteListValue</td>
<td>❌</td>
</tr>
<tr>
<td>Lists</td>
<td>SetListCapacity</td>
<td>❌</td>
</tr>
<tr>
<td>Lists</td>
<td>GetListCapacity</td>
<td>❌</td>
</tr>
<tr>
<td>Lists</td>
<td>ListContains</td>
<td>❌</td>
</tr>
<tr>
<td>Lists</td>
<td>GetListLength</td>
<td>❌</td>
</tr>
<tr>
<td>Lists</td>
<td>GetListValues</td>
<td>❌</td>
</tr>
<tr>
<td>Player Tracking</td>
<td>GetConnectedPlayers</td>
<td>✔️</td>
</tr>
<tr>
<td>Player Tracking</td>
<td>GetPlayerCapacity</td>
<td>✔️</td>
</tr>
<tr>
<td>Player Tracking</td>
<td>GetPlayerCount</td>
<td>✔️</td>
</tr>
<tr>
<td>Player Tracking</td>
<td>IsPlayerConnected</td>
<td>✔️</td>
</tr>
<tr>
<td>Player Tracking</td>
<td>PlayerConnect</td>
<td>✔️</td>
</tr>
<tr>
<td>Player Tracking</td>
<td>PlayerDisconnect</td>
<td>✔️</td>
</tr>
<tr>
<td>Player Tracking</td>
<td>SetPlayerCapacity</td>
<td>✔️</td>
</tr>
</tbody>
</table>
<p>Additional methods have been added for ease of use:</p>
<ul>
<li>Connect</li>
</ul>
<h2 id="installation">Installation</h2>
<p>The client SDK code can be manually downloaded and added to your project hierarchy.</p>
<p>It can also be imported into your project via the Unity Package Manager (UPM). To do that, open your project&rsquo;s <code>manifest.json</code> file, and add the following line to the dependencies section:</p>
<pre tabindex="0"><code>{
  &#34;dependencies&#34;: {
        &#34;com.googleforgames.agones&#34;: &#34;https://github.com/googleforgames/agones.git?path=/sdks/unity&#34;,
...
</code></pre><p>If you want a specific release, the dependency can be pinned to that version. For example:</p>
<p><code>&quot;com.googleforgames.agones&quot;: &quot;https://github.com/googleforgames/agones.git?path=/sdks/unity#v1.38.0&quot;,</code></p>
<h2 id="download">Download</h2>
<p>Download the source 
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>directly from GitHub</a>.</p>
<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li>Unity &gt;= 2018.x (.NET 4.x)</li>
</ul>
<h2 id="usage">Usage</h2>
<p>Import this script to your unity project and attach it to GameObject.</p>
<p>To begin working with the SDK, get an instance of it.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">var</span> <span style="color:#000">agones</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#000">agonesGameObject</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">GetComponent</span><span style="color:#000;font-weight:bold">&lt;</span><span style="color:#000">Code</span> <span style="color:#000">Blind</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">AgonesSdk</span><span style="color:#000;font-weight:bold">&gt;();</span>
</span></span></code></pre></div><p>To connect to the SDK server, either local or when running on Code Blind, run the async <code>Connect()</code> method.
This will wait for up to 30 seconds if the SDK server has not yet started and the connection cannot be made,
and will return <code>false</code> if there was an issue connecting.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">bool</span> <span style="color:#000">ok</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">agones</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Connect</span><span style="color:#000;font-weight:bold">();</span>
</span></span></code></pre></div><p>To mark the game server as <a href="/docs/guides/client-sdks/#ready">ready to receive player connections</a>, call the async method <code>Ready()</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">void</span> <span style="color:#000">SomeMethod</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">bool</span> <span style="color:#000">ok</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">agones</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Ready</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>To get the details on the <a href="/docs/guides/client-sdks/#gameserver">backing <code>GameServer</code></a> call <code>GameServer()</code>.</p>
<p>Will return <code>null</code> if there is an error in retrieving the <code>GameServer</code> record.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">var</span> <span style="color:#000">gameserver</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">agones</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">GameServer</span><span style="color:#000;font-weight:bold">();</span>
</span></span></code></pre></div><p>To mark the GameServer as <a href="/docs/guides/client-sdks/#reserveseconds">Reserved</a> for a duration call
<code>Reserve(TimeSpan duration)</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#000">ok</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">agones</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Reserve</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">duration</span><span style="color:#000;font-weight:bold">);</span>
</span></span></code></pre></div><p>To mark that the <a href="/docs/guides/client-sdks/#shutdown">game session is completed</a> and the game server should be shut down call <code>Shutdown()</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">bool</span> <span style="color:#000">ok</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">agones</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Shutdown</span><span style="color:#000;font-weight:bold">();</span>
</span></span></code></pre></div><p>Similarly <code>SetAnnotation(string key, string value)</code> and <code>SetLabel(string key, string value)</code> are async methods that perform an action.</p>
<p>And there is no need to call <code>Health()</code>, it is automatically called.</p>
<p>To watch when
<a href="/docs/guides/client-sdks/#watchgameserverfunctiongameserver">the backing <code>GameServer</code> configuration changes</a>
call <code>WatchGameServer(callback)</code>, where the delegate function <code>callback</code> will be executed every time the <code>GameServer</code>
configuration changes.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#000">agones</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">WatchGameServer</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">gameServer</span> <span style="color:#000;font-weight:bold">=&gt;</span> <span style="color:#000">Debug</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Log</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">$&#34;Server - Watch {gameServer}&#34;</span><span style="color:#000;font-weight:bold">));</span>
</span></span></code></pre></div><h2 id="player-tracking">Player Tracking</h2>

<div class="alert alert-warning" role="alert">
    <h4 class="alert-heading">Warning</h4>
    <p>The Player Tracking feature is currently <strong><a href="https://codeblind.ai/docs/guides/feature-stages/#alpha">Alpha</a></strong>,
        not enabled by default, and may change in the future.</p>
<p>Use the FeatureGate  <code>PlayerTracking</code>
to enable and test this feature.</p>
    <p>See the <a href="https://codeblind.ai/docs/guides/feature-stages/#feature-gates">Feature Gate documentation</a> for details on how to enable features.</p>
</div>

<p>To use alpha features use the AgonesAlphaSDK class.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">var</span> <span style="color:#000">agones</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#000">agonesGameObject</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">GetComponent</span><span style="color:#000;font-weight:bold">&lt;</span><span style="color:#000">Code</span> <span style="color:#000">Blind</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">AgonesAlphaSdk</span><span style="color:#000;font-weight:bold">&gt;();</span>
</span></span></code></pre></div><h3 id="alpha-playerconnect">Alpha: PlayerConnect</h3>
<p>This method increases the SDK’s stored player count by one, and appends this playerID to GameServer.Status.Players.IDs.
Returns true and adds the playerID to the list of playerIDs if the playerIDs was not already in the list of connected playerIDs.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">bool</span> <span style="color:#000">ok</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">agones</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">PlayerConnect</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">playerId</span><span style="color:#000;font-weight:bold">);</span>
</span></span></code></pre></div><h3 id="alpha-playerdisconnect">Alpha: PlayerDisconnect</h3>
<p>This function decreases the SDK’s stored player count by one, and removes the playerID from GameServer.Status.Players.IDs.
Will return true and remove the supplied playerID from the list of connected playerIDs if the playerID value exists within the list.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">bool</span> <span style="color:#000">ok</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">agones</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">PlayerDisconnect</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">playerId</span><span style="color:#000;font-weight:bold">);</span>
</span></span></code></pre></div><h3 id="alpha-setplayercapacity">Alpha: SetPlayerCapacity</h3>
<p>Update the <code>GameServer.Status.Players.Capacity</code> value with a new capacity.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">var</span> <span style="color:#000">capacity</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">100</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">bool</span> <span style="color:#000">ok</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">agones</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">SetPlayerCapacity</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">capacity</span><span style="color:#000;font-weight:bold">);</span>
</span></span></code></pre></div><h3 id="alpha-getplayercapacity">Alpha: GetPlayerCapacity</h3>
<p>This function retrieves the current player capacity <code>GameServer.Status.Players.Capacity</code>.
This is always accurate from what has been set through this SDK, even if the value has yet to be updated on the GameServer status resource.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">long</span> <span style="color:#000">capacity</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">agones</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">GetPlayerCapacity</span><span style="color:#000;font-weight:bold">();</span>
</span></span></code></pre></div><h3 id="alpha-getplayercount">Alpha: GetPlayerCount</h3>
<p>Returns the current player count</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">long</span> <span style="color:#000">count</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">agones</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">GetPlayerCount</span><span style="color:#000;font-weight:bold">();</span>
</span></span></code></pre></div><h3 id="alpha-isplayerconnected">Alpha: IsPlayerConnected</h3>
<p>This returns if the playerID is currently connected to the GameServer.
This is always accurate, even if the value hasn’t been updated to the GameServer status yet.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">bool</span> <span style="color:#000">isConnected</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">agones</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">IsPlayerConnected</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">playerId</span><span style="color:#000;font-weight:bold">);</span>
</span></span></code></pre></div><h3 id="alpha-getconnectedplayers">Alpha: GetConnectedPlayers</h3>
<p>This returns a list of the playerIDs that are currently connected to the GameServer.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#000">List</span><span style="color:#000;font-weight:bold">&lt;</span><span style="color:#204a87;font-weight:bold">string</span><span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#000">players</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">agones</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">GetConnectedPlayers</span><span style="color:#000;font-weight:bold">();</span>
</span></span></code></pre></div>

<div class="alert alert-warning" role="alert">
<h4 class="alert-heading">Warning</h4>

    <p>The following code causes deadlock. Do not use a <code>Wait</code> method with the returned Task.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">void</span> <span style="color:#000">Deadlock</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">Task</span><span style="color:#000;font-weight:bold">&lt;</span><span style="color:#204a87;font-weight:bold">bool</span><span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#000">t</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#000">agones</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Shutdown</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">t</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Wait</span><span style="color:#000;font-weight:bold">();</span> <span style="color:#8f5902;font-style:italic">// deadlock!!!</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div>

</div>

<h2 id="settings">Settings</h2>
<p>The properties for the Unity Code Blind SDK can be found in the Inspector.</p>
<ul>
<li>Health Interval Second
<ul>
<li>Interval of the server sending a health ping to the Code Blind sidecar. (default: <code>5</code>)</li>
</ul>
</li>
<li>Health Enabled
<ul>
<li>Whether the server sends a health ping to the Code Blind sidecar. (default: <code>true</code>)</li>
</ul>
</li>
<li>Log Enabled
<ul>
<li>Debug Logging Enabled. Debug logging for development of this Plugin. (default: <code>false</code>)</li>
</ul>
</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-ea9cf494f21474538fa0638b52a8cb68">5.3.3 - C&#43;&#43; Game Server Client SDK</h1>
    <div class="lead">This is the C++ version of the Code Blind Game Server Client SDK.</div>
	<p>Check the <a href="/docs/guides/client-sdks/">Client SDK Documentation</a> for more details on each of the SDK functions and how to run the SDK locally.</p>
<h2 id="sdk-functionality">SDK Functionality</h2>
<table>
<thead>
<tr>
<th>Area</th>
<th>Action</th>
<th>Implemented</th>
</tr>
</thead>
<tbody>
<tr>
<td>Lifecycle</td>
<td>Ready</td>
<td>✔️</td>
</tr>
<tr>
<td>Lifecycle</td>
<td>Health</td>
<td>✔️</td>
</tr>
<tr>
<td>Lifecycle</td>
<td>Reserve</td>
<td>✔️</td>
</tr>
<tr>
<td>Lifecycle</td>
<td>Allocate</td>
<td>✔️</td>
</tr>
<tr>
<td>Lifecycle</td>
<td>Shutdown</td>
<td>✔️</td>
</tr>
<tr>
<td>Configuration</td>
<td>GameServer</td>
<td>✔️</td>
</tr>
<tr>
<td>Configuration</td>
<td>WatchGameServer</td>
<td>✔️</td>
</tr>
<tr>
<td>Metadata</td>
<td>SetAnnotation</td>
<td>✔️</td>
</tr>
<tr>
<td>Metadata</td>
<td>SetLabel</td>
<td>✔️</td>
</tr>
<tr>
<td>Counters</td>
<td>GetCounterCount</td>
<td>❌</td>
</tr>
<tr>
<td>Counters</td>
<td>SetCounterCount</td>
<td>❌</td>
</tr>
<tr>
<td>Counters</td>
<td>IncrementCounter</td>
<td>❌</td>
</tr>
<tr>
<td>Counters</td>
<td>DecrementCounter</td>
<td>❌</td>
</tr>
<tr>
<td>Counters</td>
<td>SetCounterCapacity</td>
<td>❌</td>
</tr>
<tr>
<td>Counters</td>
<td>GetCounterCapacity</td>
<td>❌</td>
</tr>
<tr>
<td>Lists</td>
<td>AppendListValue</td>
<td>❌</td>
</tr>
<tr>
<td>Lists</td>
<td>DeleteListValue</td>
<td>❌</td>
</tr>
<tr>
<td>Lists</td>
<td>SetListCapacity</td>
<td>❌</td>
</tr>
<tr>
<td>Lists</td>
<td>GetListCapacity</td>
<td>❌</td>
</tr>
<tr>
<td>Lists</td>
<td>ListContains</td>
<td>❌</td>
</tr>
<tr>
<td>Lists</td>
<td>GetListLength</td>
<td>❌</td>
</tr>
<tr>
<td>Lists</td>
<td>GetListValues</td>
<td>❌</td>
</tr>
</tbody>
</table>
<h2 id="installation">Installation</h2>
<h3 id="download">Download</h3>
<p>Download the source from the <a href="https://github.com/googleforgames/agones/releases">Releases Page</a> or 
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>directly from GitHub</a>.</p>
<h3 id="building-the-libraries-from-source">Building the Libraries from source</h3>
<p>CMake is used to build SDK for all supported platforms (Linux/Window/macOS).</p>
<h3 id="prerequisites">Prerequisites</h3>
<ul>
<li>CMake &gt;= 3.15.0</li>
<li>Git</li>
<li>C++17 compiler</li>
</ul>
<h3 id="dependencies">Dependencies</h3>
<p>Code Blind SDK only depends on the <a href="https://grpc.io/">gRPC</a> library.</p>

<p>If CMake cannot find gRPC with find_package(), it downloads and builds gRPC.
There are some extra prerequisites for OpenSSL on Windows, see <a href="https://github.com/openssl/openssl/blob/OpenSSL_1_1_1-stable/NOTES.WIN">documentation</a>:</p>
<ul>
<li>Perl</li>
<li>NASM</li>
</ul>
<p>Note that OpenSSL is not used in Code Blind SDK, but it is required to have a successful build of gRPC.</p>
<h2 id="options">Options</h2>
<p>Following options are available:</p>
<ul>
<li><strong>AGONES_THIRDPARTY_INSTALL_PATH</strong> (default is CMAKE_INSTALL_PREFIX) - installation path for Code Blind prerequisites (used only if gRPC and Protobuf are not found by find_package)</li>
<li><strong>AGONES_ZLIB_STATIC</strong> (default is ON) - use static version of zlib for gRPC</li>
</ul>
<p>(Windows only):</p>
<ul>
<li><strong>AGONES_BUILD_THIRDPARTY_DEBUG</strong> (default is OFF) - build both debug and release versions of SDK&rsquo;s prerequisites. Option is not used if you already have built gRPC.</li>
<li><strong>AGONES_OPENSSL_CONFIG_STRING</strong> (default is VC-WIN64A) - arguments to configure OpenSSL build (<a href="https://github.com/openssl/openssl/blob/OpenSSL_1_1_1-stable/INSTALL">documentation</a>). Used only if OpenSSL and gRPC is built by Code Blind.</li>
</ul>
<h2 id="linux--macos">Linux / MacOS</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mkdir -p .build
</span></span><span style="display:flex;"><span><span style="color:#204a87">cd</span> .build
</span></span><span style="display:flex;"><span>cmake .. -DCMAKE_BUILD_TYPE<span style="color:#ce5c00;font-weight:bold">=</span>Release -G <span style="color:#4e9a06">&#34;Unix Makefiles&#34;</span> -DCMAKE_INSTALL_PREFIX<span style="color:#ce5c00;font-weight:bold">=</span>./install
</span></span><span style="display:flex;"><span>cmake --build . --target install
</span></span></code></pre></div><h2 id="windows">Windows</h2>
<p>Building with Visual Studio:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>md .build
</span></span><span style="display:flex;"><span><span style="color:#204a87">cd</span> .build
</span></span><span style="display:flex;"><span>cmake .. -G <span style="color:#4e9a06">&#34;Visual Studio 15 2017 Win64&#34;</span> -DCMAKE_INSTALL_PREFIX<span style="color:#ce5c00;font-weight:bold">=</span>./install
</span></span><span style="display:flex;"><span>cmake --build . --config Release --target install
</span></span></code></pre></div><p>Building with NMake</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>md .build
</span></span><span style="display:flex;"><span><span style="color:#204a87">cd</span> .build
</span></span><span style="display:flex;"><span>cmake .. -G <span style="color:#4e9a06">&#34;NMake Makefiles&#34;</span> -DCMAKE_BUILD_TYPE<span style="color:#ce5c00;font-weight:bold">=</span>Release -DCMAKE_INSTALL_PREFIX<span style="color:#ce5c00;font-weight:bold">=</span>./install
</span></span><span style="display:flex;"><span>cmake --build . --target install
</span></span></code></pre></div><p><strong>CMAKE_INSTALL_PREFIX</strong> may be skipped if it is OK to install Code Blind SDK to a default location (usually /usr/local or c:/Program Files/Code Blind).</p>
<p>CMake option <code>-Wno-dev</code> is specified to suppress <a href="https://cmake.org/cmake/help/v3.13/policy/CMP0048.html">CMP0048</a> deprecation warning for gRPC build.</p>
<p>If <strong>AGONES_ZLIB_STATIC</strong> is set to OFF, ensure that you have installed zlib. For Windows, it&rsquo;s enough to copy zlib.dll near to gameserver executable. For Linux/Mac usually no actions are needed.</p>
<h2 id="usage">Usage</h2>
<h3 id="using-sdk">Using SDK</h3>
<p>In CMake-based projects it&rsquo;s enough to specify a folder where SDK is installed with <code>CMAKE_PREFIX_PATH</code> and use <code>find_package(agones CONFIG REQUIRED)</code> command. For example: 
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>cpp-simple</a>.
It may be useful to disable some <a href="https://github.com/protocolbuffers/protobuf/blob/master/cmake/README.md#notes-on-compiler-warnings">protobuf warnings</a> in your project.</p>
<h2 id="usage-1">Usage</h2>
<p>The C++ SDK is specifically designed to be as simple as possible, and deliberately doesn&rsquo;t include any kind
of singleton management, or threading/asynchronous processing to allow developers to manage these aspects as they deem
appropriate for their system.</p>
<p>We may consider these types of features in the future, depending on demand.</p>
<p>To begin working with the SDK, create an instance of it:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#000">agones</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">SDK</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">sdk</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">agones</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">SDK</span><span style="color:#000;font-weight:bold">();</span>
</span></span></code></pre></div><p>To connect to the SDK server, either local or when running on Code Blind, run the <code>sdk-&gt;Connect()</code> method.
This will block for up to 30 seconds if the SDK server has not yet started and the connection cannot be made,
and will return <code>false</code> if there was an issue connecting.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">bool</span> <span style="color:#000">ok</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">sdk</span><span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">Connect</span><span style="color:#000;font-weight:bold">();</span>
</span></span></code></pre></div><p>To send a <a href="/docs/guides/client-sdks/#health">health check</a> call <code>sdk-&gt;Health()</code>. This is a synchronous request that will
return <code>false</code> if it has failed in any way. Read <a href="/docs/guides/health-checking/">GameServer Health Checking</a> for more
details on the game server health checking strategy.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">bool</span> <span style="color:#000">ok</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">sdk</span><span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">Health</span><span style="color:#000;font-weight:bold">();</span>
</span></span></code></pre></div><p>To mark the game server as <a href="/docs/guides/client-sdks/#ready">ready to receive player connections</a>, call <code>sdk-&gt;Ready()</code>.
This will return a grpc::Status object, from which we can call <code>status.ok()</code> to determine
if the function completed successfully.</p>
<p>For more information you can also look at the <a href="https://grpc.io/grpc/cpp/classgrpc_1_1_status.html">gRPC Status reference</a>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#000">grpc</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">Status</span> <span style="color:#000">status</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">sdk</span><span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">Ready</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">!</span><span style="color:#000">status</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">ok</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#000;font-weight:bold">...</span> <span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>To mark the game server as <a href="/docs/guides/client-sdks/#allocate">allocated</a>, call <code>sdk-&gt;Allocate()</code>.
This will return a grpc::Status object, from which we can call <code>status.ok()</code> to determine
if the function completed successfully.</p>
<p>For more information you can also look at the <a href="https://grpc.io/grpc/cpp/classgrpc_1_1_status.html">gRPC Status reference</a>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#000">grpc</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">Status</span> <span style="color:#000">status</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">sdk</span><span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">Allocate</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">!</span><span style="color:#000">status</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">ok</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#000;font-weight:bold">...</span> <span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>To mark the game server as <a href="/docs/guides/client-sdks/#reserveseconds">reserved</a>, call
<code>sdk-&gt;Reserve(seconds)</code>. This will return a grpc::Status object, from which we can call <code>status.ok()</code> to determine
if the function completed successfully.</p>
<p>For more information you can also look at the <a href="https://grpc.io/grpc/cpp/classgrpc_1_1_status.html">gRPC Status reference</a>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#000">grpc</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">Status</span> <span style="color:#000">status</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">sdk</span><span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">Reserve</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">std</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">chrono</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">seconds</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">N</span><span style="color:#000;font-weight:bold">));</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">!</span><span style="color:#000">status</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">ok</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#000;font-weight:bold">...</span> <span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>To mark that the <a href="/docs/guides/client-sdks/#shutdown">game session is completed</a> and the game server should be shut down call <code>sdk-&gt;Shutdown()</code>.
This will return a grpc::Status object, from which we can call <code>status.ok()</code> to determine
if the function completed successfully.</p>
<p>For more information you can also look at the <a href="https://grpc.io/grpc/cpp/classgrpc_1_1_status.html">gRPC Status reference</a>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#000">grpc</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">Status</span> <span style="color:#000">status</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">sdk</span><span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">Shutdown</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">!</span><span style="color:#000">status</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">ok</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#000;font-weight:bold">...</span> <span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>To <a href="/docs/guides/client-sdks/#setlabelkey-value">set a Label</a> on the backing <code>GameServer</code> call
<code>sdk-&gt;SetLabel(key, value)</code>.
This will return a grpc::Status object, from which we can call <code>status.ok()</code> to determine
if the function completed successfully.</p>
<p>For more information you can also look at the <a href="https://grpc.io/grpc/cpp/classgrpc_1_1_status.html">gRPC Status reference</a>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#000">grpc</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">Status</span> <span style="color:#000">status</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">sdk</span><span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">SetLabel</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;test-label&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;test-value&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">!</span><span style="color:#000">status</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">ok</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#000;font-weight:bold">...</span> <span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>To <a href="/docs/guides/client-sdks/#setannotationkey-value">set an Annotation</a> on the backing <code>GameServer</code> call
<code>sdk-&gt;SetAnnotation(key, value)</code>.
This will return a grpc::Status object, from which we can call <code>status.ok()</code> to determine
if the function completed successfully.</p>
<p>For more information you can also look at the <a href="https://grpc.io/grpc/cpp/classgrpc_1_1_status.html">gRPC Status reference</a>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#000">status</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">sdk</span><span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">SetAnnotation</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;test-annotation&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;test value&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">!</span><span style="color:#000">status</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">ok</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#000;font-weight:bold">...</span> <span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>To get the details on the <a href="/docs/guides/client-sdks/#gameserver">backing <code>GameServer</code></a> call <code>sdk-&gt;GameServer(&amp;gameserver)</code>,
passing in a <code>agones::dev::sdk::GameServer*</code> to push the results of the <code>GameServer</code> configuration into.</p>
<p>This function will return a grpc::Status object, from which we can call <code>status.ok()</code> to determine
if the function completed successfully.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#000">agones</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">dev</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">sdk</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">GameServer</span> <span style="color:#000">gameserver</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">grpc</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">Status</span> <span style="color:#000">status</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">sdk</span><span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">GameServer</span><span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">&amp;</span><span style="color:#000">gameserver</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">!</span><span style="color:#000">status</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">ok</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#000;font-weight:bold">{...}</span>
</span></span></code></pre></div><p>To get <a href="/docs/guides/client-sdks/#watchgameserverfunctiongameserver">updates on the backing <code>GameServer</code></a> as they happen,
call <code>sdk-&gt;WatchGameServer([](const agones::dev::sdk::GameServer&amp; gameserver){...})</code>.</p>
<p>This will call the passed in <code>std::function</code>
synchronously (this is a blocking function, so you may want to run it in its own thread) whenever the backing <code>GameServer</code>
is updated.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#000">sdk</span><span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">WatchGameServer</span><span style="color:#000;font-weight:bold">([](</span><span style="color:#204a87;font-weight:bold">const</span> <span style="color:#000">agones</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">dev</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">sdk</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">GameServer</span><span style="color:#ce5c00;font-weight:bold">&amp;</span> <span style="color:#000">gameserver</span><span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">std</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">cout</span> <span style="color:#ce5c00;font-weight:bold">&lt;&lt;</span> <span style="color:#4e9a06">&#34;GameServer Update:</span><span style="color:#4e9a06">\n</span><span style="color:#4e9a06">&#34;</span>                                 <span style="color:#8f5902;font-style:italic">//
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>            <span style="color:#ce5c00;font-weight:bold">&lt;&lt;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">\t</span><span style="color:#4e9a06">name: &#34;</span> <span style="color:#ce5c00;font-weight:bold">&lt;&lt;</span> <span style="color:#000">gameserver</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">object_meta</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">name</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">&lt;&lt;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">\n</span><span style="color:#4e9a06">&#34;</span>  <span style="color:#8f5902;font-style:italic">//
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>            <span style="color:#ce5c00;font-weight:bold">&lt;&lt;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">\t</span><span style="color:#4e9a06">state: &#34;</span> <span style="color:#ce5c00;font-weight:bold">&lt;&lt;</span> <span style="color:#000">gameserver</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">status</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">state</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">&lt;&lt;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">\n</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">&lt;&lt;</span> <span style="color:#000">std</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">flush</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">});</span>
</span></span></code></pre></div><h2 id="next-steps">Next Steps</h2>
<ul>
<li>Read the <a href="/docs/guides/client-sdks/">SDK Overview</a> to review all SDK functionality</li>
<li>Look at the 
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>C++ example for a full build template</a>.</li>
<li>Check out 
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>sdk.h</a>.</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-63f37ca64d7de9cc29ac4ba30acbcd56">5.3.4 - Go Game Server Client SDK</h1>
    <div class="lead">This is the Go version of the Code Blind Game Server Client SDK.</div>
	<p>Check the <a href="/docs/guides/client-sdks/">Client SDK Documentation</a> for more details on each of the SDK functions and how to run the SDK locally.</p>
<h2 id="sdk-functionality">SDK Functionality</h2>
<table>
<thead>
<tr>
<th>Area</th>
<th>Action</th>
<th>Implemented</th>
</tr>
</thead>
<tbody>
<tr>
<td>Lifecycle</td>
<td>Ready</td>
<td>✔️</td>
</tr>
<tr>
<td>Lifecycle</td>
<td>Health</td>
<td>✔️</td>
</tr>
<tr>
<td>Lifecycle</td>
<td>Reserve</td>
<td>✔️</td>
</tr>
<tr>
<td>Lifecycle</td>
<td>Allocate</td>
<td>✔️</td>
</tr>
<tr>
<td>Lifecycle</td>
<td>Shutdown</td>
<td>✔️</td>
</tr>
<tr>
<td>Configuration</td>
<td>GameServer</td>
<td>✔️</td>
</tr>
<tr>
<td>Configuration</td>
<td>Watch</td>
<td>✔️</td>
</tr>
<tr>
<td>Metadata</td>
<td>SetAnnotation</td>
<td>✔️</td>
</tr>
<tr>
<td>Metadata</td>
<td>SetLabel</td>
<td>✔️</td>
</tr>
<tr>
<td>Counters</td>
<td>GetCounterCount</td>
<td>✔️</td>
</tr>
<tr>
<td>Counters</td>
<td>SetCounterCount</td>
<td>✔️</td>
</tr>
<tr>
<td>Counters</td>
<td>IncrementCounter</td>
<td>✔️</td>
</tr>
<tr>
<td>Counters</td>
<td>DecrementCounter</td>
<td>✔️</td>
</tr>
<tr>
<td>Counters</td>
<td>SetCounterCapacity</td>
<td>✔️</td>
</tr>
<tr>
<td>Counters</td>
<td>GetCounterCapacity</td>
<td>✔️</td>
</tr>
<tr>
<td>Lists</td>
<td>AppendListValue</td>
<td>✔️</td>
</tr>
<tr>
<td>Lists</td>
<td>DeleteListValue</td>
<td>✔️</td>
</tr>
<tr>
<td>Lists</td>
<td>SetListCapacity</td>
<td>✔️</td>
</tr>
<tr>
<td>Lists</td>
<td>GetListCapacity</td>
<td>✔️</td>
</tr>
<tr>
<td>Lists</td>
<td>ListContains</td>
<td>✔️</td>
</tr>
<tr>
<td>Lists</td>
<td>GetListLength</td>
<td>✔️</td>
</tr>
<tr>
<td>Lists</td>
<td>GetListValues</td>
<td>✔️</td>
</tr>
<tr>
<td>Player Tracking</td>
<td>GetConnectedPlayers</td>
<td>✔️</td>
</tr>
<tr>
<td>Player Tracking</td>
<td>GetPlayerCapacity</td>
<td>✔️</td>
</tr>
<tr>
<td>Player Tracking</td>
<td>GetPlayerCount</td>
<td>✔️</td>
</tr>
<tr>
<td>Player Tracking</td>
<td>IsPlayerConnected</td>
<td>✔️</td>
</tr>
<tr>
<td>Player Tracking</td>
<td>PlayerConnect</td>
<td>✔️</td>
</tr>
<tr>
<td>Player Tracking</td>
<td>PlayerDisconnect</td>
<td>✔️</td>
</tr>
<tr>
<td>Player Tracking</td>
<td>SetPlayerCapacity</td>
<td>✔️</td>
</tr>
</tbody>
</table>
<h2 id="installation">Installation</h2>
<p><code>go get</code> the source, 
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>directly from GitHub</a></p>
<h2 id="usage">Usage</h2>
<p>Review the <a href="https://pkg.go.dev/agones.dev/agones/sdks/go">GoDoc</a> for usage instructions</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-7bcee3a1d527cbfefbcd4e6a271adb91">5.3.5 - C# Game Server Client SDK</h1>
    <div class="lead">This is the C# version of the Code Blind Game Server Client SDK.</div>
	<p>Check the <a href="/docs/guides/client-sdks/">Client SDK Documentation</a> for more details on each of the SDK functions and how to run the SDK locally.</p>
<h2 id="sdk-functionality">SDK Functionality</h2>
<table>
<thead>
<tr>
<th>Area</th>
<th>Action</th>
<th>Implemented</th>
</tr>
</thead>
<tbody>
<tr>
<td>Lifecycle</td>
<td>Ready</td>
<td>✔️</td>
</tr>
<tr>
<td>Lifecycle</td>
<td>Health</td>
<td>✔️</td>
</tr>
<tr>
<td>Lifecycle</td>
<td>Reserve</td>
<td>✔️</td>
</tr>
<tr>
<td>Lifecycle</td>
<td>Allocate</td>
<td>✔️</td>
</tr>
<tr>
<td>Lifecycle</td>
<td>Shutdown</td>
<td>✔️</td>
</tr>
<tr>
<td>Configuration</td>
<td>GetGameServer</td>
<td>✔️</td>
</tr>
<tr>
<td>Configuration</td>
<td>WatchGameServer</td>
<td>✔️</td>
</tr>
<tr>
<td>Metadata</td>
<td>SetAnnotation</td>
<td>✔️</td>
</tr>
<tr>
<td>Metadata</td>
<td>SetLabel</td>
<td>✔️</td>
</tr>
<tr>
<td>Counters</td>
<td>GetCounterCount</td>
<td>❌</td>
</tr>
<tr>
<td>Counters</td>
<td>SetCounterCount</td>
<td>❌</td>
</tr>
<tr>
<td>Counters</td>
<td>IncrementCounter</td>
<td>❌</td>
</tr>
<tr>
<td>Counters</td>
<td>DecrementCounter</td>
<td>❌</td>
</tr>
<tr>
<td>Counters</td>
<td>SetCounterCapacity</td>
<td>❌</td>
</tr>
<tr>
<td>Counters</td>
<td>GetCounterCapacity</td>
<td>❌</td>
</tr>
<tr>
<td>Lists</td>
<td>AppendListValue</td>
<td>❌</td>
</tr>
<tr>
<td>Lists</td>
<td>DeleteListValue</td>
<td>❌</td>
</tr>
<tr>
<td>Lists</td>
<td>SetListCapacity</td>
<td>❌</td>
</tr>
<tr>
<td>Lists</td>
<td>GetListCapacity</td>
<td>❌</td>
</tr>
<tr>
<td>Lists</td>
<td>ListContains</td>
<td>❌</td>
</tr>
<tr>
<td>Lists</td>
<td>GetListLength</td>
<td>❌</td>
</tr>
<tr>
<td>Lists</td>
<td>GetListValues</td>
<td>❌</td>
</tr>
<tr>
<td>Player Tracking</td>
<td>GetConnectedPlayers</td>
<td>✔️</td>
</tr>
<tr>
<td>Player Tracking</td>
<td>GetPlayerCapacity</td>
<td>✔️</td>
</tr>
<tr>
<td>Player Tracking</td>
<td>GetPlayerCount</td>
<td>✔️</td>
</tr>
<tr>
<td>Player Tracking</td>
<td>IsPlayerConnected</td>
<td>✔️</td>
</tr>
<tr>
<td>Player Tracking</td>
<td>PlayerConnect</td>
<td>✔️</td>
</tr>
<tr>
<td>Player Tracking</td>
<td>PlayerDisconnect</td>
<td>✔️</td>
</tr>
<tr>
<td>Player Tracking</td>
<td>SetPlayerCapacity</td>
<td>✔️</td>
</tr>
</tbody>
</table>
<h2 id="download">Download</h2>
<p>Download the source 
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>directly from GitHub</a>.</p>
<h2 id="install-using-nuget">Install using NuGet</h2>
<ul>
<li>Download the nuget package <a href="https://www.nuget.org/packages/AgonesSDK/">directly</a></li>
<li>Install the latest version using the Package Manager: <code>Install-Package AgonesSDK</code></li>
<li>Install the latest version using the .NET CLI: <code>dotnet add package AgonesSDK</code></li>
</ul>
<p>To select a specific version, append <code>--version</code>, for example: <code>--version 1.8.0</code> to either commands.</p>
<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li>.Net Standard 2.0 compliant framework.</li>
</ul>
<h2 id="usage">Usage</h2>
<p>Reference the SDK in your project &amp; create a new instance of the SDK wrapper:</p>
<h3 id="initialization">Initialization</h3>
<p>To use the AgonesSDK, you will need to import the namespace by adding <code>using Code Blind;</code> at the beginning of your relevant files.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">var</span> <span style="color:#000">agones</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">AgonesSDK</span><span style="color:#000;font-weight:bold">();</span>
</span></span></code></pre></div><h3 id="connection">Connection</h3>
<p>To connect to the SDK server, either locally or when running on Code Blind, run the <code>ConnectAsync()</code> method.
This will wait for up to 30 seconds if the SDK server has not yet started and the connection cannot be made,
and will return <code>false</code> if there was an issue connecting.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">bool</span> <span style="color:#000">ok</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">agones</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">ConnectAsync</span><span style="color:#000;font-weight:bold">();</span>
</span></span></code></pre></div><h3 id="ready">Ready</h3>
<p>To mark the game server as <a href="/docs/guides/client-sdks/#ready">ready to receive player connections</a>, call the async method <code>ReadyAsync()</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">void</span> <span style="color:#000">SomeMethod</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">var</span> <span style="color:#000">status</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">agones</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">ReadyAsync</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h3 id="health">Health</h3>
<p>To send <code>Health</code> pings, call the async method <code>HealthAsync()</code></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">agones</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">HealthAsync</span><span style="color:#000;font-weight:bold">();</span>
</span></span></code></pre></div><h3 id="getgameserver">GetGameServer</h3>
<p>To get the details on the <a href="/docs/guides/client-sdks/#gameserver">backing <code>GameServer</code></a> call <code>GetGameServerAsync()</code>.</p>
<p>Will return <code>null</code> if there is an error in retrieving the <code>GameServer</code> record.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">var</span> <span style="color:#000">gameserver</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">agones</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">GetGameServerAsync</span><span style="color:#000;font-weight:bold">();</span>
</span></span></code></pre></div><h3 id="reserve">Reserve</h3>
<p>To mark the GameServer as <a href="/docs/guides/client-sdks/#reserveseconds">Reserved</a> for a duration call
<code>ReserveAsync(long duration)</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">long</span> <span style="color:#000">duration</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">30</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">var</span> <span style="color:#000">status</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">agones</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">ReserveAsync</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">duration</span><span style="color:#000;font-weight:bold">);</span>
</span></span></code></pre></div><h3 id="shutdown">ShutDown</h3>
<p>To mark that the <a href="/docs/guides/client-sdks/#shutdown">game session is completed</a> and the game server should be shut down call <code>ShutdownAsync()</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">var</span> <span style="color:#000">status</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">agones</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">ShutdownAsync</span><span style="color:#000;font-weight:bold">();</span>
</span></span></code></pre></div><h3 id="setannotation---setlabel">SetAnnotation &amp;  SetLabel</h3>
<p>Similarly <code>SetAnnotation(string key, string value)</code> and <code>SetLabel(string key, string value)</code> are async methods that perform an action &amp; return a <code>Status</code> object.</p>
<h3 id="watchgameserver">WatchGameServer</h3>
<p>To watch when
<a href="/docs/guides/client-sdks/#watchgameserverfunctiongameserver">the backing <code>GameServer</code> configuration changes</a>
call <code>WatchGameServer(callback)</code>, where the delegate function <code>callback</code> of type <code>Action&lt;GameServer&gt;</code> will be executed every time the <code>GameServer</code>
configuration changes.
This process is non-blocking internally.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#000">agonesSDK</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">WatchGameServer</span><span style="color:#000;font-weight:bold">((</span><span style="color:#000">gameServer</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">=&gt;</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#000">Console</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">WriteLine</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">$&#34;Server - Watch {gameServer}&#34;</span><span style="color:#000;font-weight:bold">);});</span>
</span></span></code></pre></div><h2 id="player-tracking">Player Tracking</h2>

<div class="alert alert-warning" role="alert">
    <h4 class="alert-heading">Warning</h4>
    <p>The Player Tracking feature is currently <strong><a href="https://codeblind.ai/docs/guides/feature-stages/#alpha">Alpha</a></strong>,
        not enabled by default, and may change in the future.</p>
<p>Use the FeatureGate  <code>PlayerTracking</code>
to enable and test this feature.</p>
    <p>See the <a href="https://codeblind.ai/docs/guides/feature-stages/#feature-gates">Feature Gate documentation</a> for details on how to enable features.</p>
</div>

<h3 id="alpha-playerconnect">Alpha: PlayerConnect</h3>
<p>This method increases the SDK’s stored player count by one, and appends this playerID to GameServer.Status.Players.IDs.
Returns true and adds the playerID to the list of playerIDs if the playerIDs was not already in the list of connected playerIDs.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">bool</span> <span style="color:#000">ok</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">agones</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Alpha</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">PlayerConnectAsync</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">playerId</span><span style="color:#000;font-weight:bold">);</span>
</span></span></code></pre></div><h3 id="alpha-playerdisconnect">Alpha: PlayerDisconnect</h3>
<p>This function decreases the SDK’s stored player count by one, and removes the playerID from GameServer.Status.Players.IDs.
Will return true and remove the supplied playerID from the list of connected playerIDs if the playerID value exists within the list.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">bool</span> <span style="color:#000">ok</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">agones</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Alpha</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">PlayerDisconnectAsync</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">playerId</span><span style="color:#000;font-weight:bold">);</span>
</span></span></code></pre></div><h3 id="alpha-setplayercapacity">Alpha: SetPlayerCapacity</h3>
<p>Update the <code>GameServer.Status.Players.Capacity</code> value with a new capacity.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">var</span> <span style="color:#000">capacity</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">100</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">var</span> <span style="color:#000">status</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">agones</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Alpha</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">SetPlayerCapacityAsync</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">capacity</span><span style="color:#000;font-weight:bold">);</span>
</span></span></code></pre></div><h3 id="alpha-getplayercapacity">Alpha: GetPlayerCapacity</h3>
<p>This function retrieves the current player capacity <code>GameServer.Status.Players.Capacity</code>.
This is always accurate from what has been set through this SDK, even if the value has yet to be updated on the GameServer status resource.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">long</span> <span style="color:#000">cap</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">agones</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Alpha</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">GetPlayerCapacityAsync</span><span style="color:#000;font-weight:bold">();</span>
</span></span></code></pre></div><h3 id="alpha-getplayercount">Alpha: GetPlayerCount</h3>
<p>Returns the current player count</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">long</span> <span style="color:#000">count</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">agones</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Alpha</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">GetPlayerCountAsync</span><span style="color:#000;font-weight:bold">();</span>
</span></span></code></pre></div><h3 id="alpha-isplayerconnected">Alpha: IsPlayerConnected</h3>
<p>This returns if the playerID is currently connected to the GameServer.
This is always accurate, even if the value hasn’t been updated to the GameServer status yet.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">var</span> <span style="color:#000">playerId</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;player1&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">bool</span> <span style="color:#000">isConnected</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">agones</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Alpha</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">IsPlayerConnectedAsync</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">playerId</span><span style="color:#000;font-weight:bold">);</span>
</span></span></code></pre></div><h2 id="remarks">Remarks</h2>
<ul>
<li>All requests other than <code>ConnectAsync</code> will wait for up to 15 seconds before giving up, time to wait can also be set in the constructor.</li>
<li>Default host &amp; port are <code>localhost:9357</code></li>
<li>Methods that do not return a data object such as <code>GameServer</code> will return a gRPC <code>Grpc.Core.Status</code> object. To check the state of the request, check <code>Status.StatusCode</code> &amp; <code>Status.Detail</code>.
Ex:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">if</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">status</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">StatusCode</span> <span style="color:#000;font-weight:bold">==</span> <span style="color:#000">StatusCode</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">OK</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">//do stuff</span>
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-f8485ce33aea4cc5839759a0e6cfb78e">5.3.6 - Node.js Game Server Client SDK</h1>
    <div class="lead">This is the Node.js version of the Code Blind Game Server Client SDK.</div>
	<p>Check the <a href="/docs/guides/client-sdks/">Client SDK Documentation</a> for more details on each of the SDK functions and how to run the SDK locally.</p>
<h2 id="sdk-functionality">SDK Functionality</h2>
<table>
<thead>
<tr>
<th>Area</th>
<th>Action</th>
<th>Implemented</th>
</tr>
</thead>
<tbody>
<tr>
<td>Lifecycle</td>
<td>Ready</td>
<td>✔️</td>
</tr>
<tr>
<td>Lifecycle</td>
<td>Health</td>
<td>✔️</td>
</tr>
<tr>
<td>Lifecycle</td>
<td>Reserve</td>
<td>✔️</td>
</tr>
<tr>
<td>Lifecycle</td>
<td>Allocate</td>
<td>✔️</td>
</tr>
<tr>
<td>Lifecycle</td>
<td>Shutdown</td>
<td>✔️</td>
</tr>
<tr>
<td>Configuration</td>
<td>GetGameServer</td>
<td>✔️</td>
</tr>
<tr>
<td>Configuration</td>
<td>WatchGameServer</td>
<td>✔️</td>
</tr>
<tr>
<td>Metadata</td>
<td>SetAnnotation</td>
<td>✔️</td>
</tr>
<tr>
<td>Metadata</td>
<td>SetLabel</td>
<td>✔️</td>
</tr>
<tr>
<td>Counters</td>
<td>GetCounterCount</td>
<td>❌</td>
</tr>
<tr>
<td>Counters</td>
<td>SetCounterCount</td>
<td>❌</td>
</tr>
<tr>
<td>Counters</td>
<td>IncrementCounter</td>
<td>❌</td>
</tr>
<tr>
<td>Counters</td>
<td>DecrementCounter</td>
<td>❌</td>
</tr>
<tr>
<td>Counters</td>
<td>SetCounterCapacity</td>
<td>❌</td>
</tr>
<tr>
<td>Counters</td>
<td>GetCounterCapacity</td>
<td>❌</td>
</tr>
<tr>
<td>Lists</td>
<td>AppendListValue</td>
<td>❌</td>
</tr>
<tr>
<td>Lists</td>
<td>DeleteListValue</td>
<td>❌</td>
</tr>
<tr>
<td>Lists</td>
<td>SetListCapacity</td>
<td>❌</td>
</tr>
<tr>
<td>Lists</td>
<td>GetListCapacity</td>
<td>❌</td>
</tr>
<tr>
<td>Lists</td>
<td>ListContains</td>
<td>❌</td>
</tr>
<tr>
<td>Lists</td>
<td>GetListLength</td>
<td>❌</td>
</tr>
<tr>
<td>Lists</td>
<td>GetListValues</td>
<td>❌</td>
</tr>
<tr>
<td>Player Tracking</td>
<td>GetConnectedPlayers</td>
<td>✔️</td>
</tr>
<tr>
<td>Player Tracking</td>
<td>GetPlayerCapacity</td>
<td>✔️</td>
</tr>
<tr>
<td>Player Tracking</td>
<td>GetPlayerCount</td>
<td>✔️</td>
</tr>
<tr>
<td>Player Tracking</td>
<td>IsPlayerConnected</td>
<td>✔️</td>
</tr>
<tr>
<td>Player Tracking</td>
<td>PlayerConnect</td>
<td>✔️</td>
</tr>
<tr>
<td>Player Tracking</td>
<td>PlayerDisconnect</td>
<td>✔️</td>
</tr>
<tr>
<td>Player Tracking</td>
<td>SetPlayerCapacity</td>
<td>✔️</td>
</tr>
</tbody>
</table>
<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li>Node.js &gt;= 10.13.0</li>
</ul>
<h2 id="usage">Usage</h2>
<p>Add the agones dependency to your project:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>npm install @google-cloud/agones-sdk
</span></span></code></pre></div><p>If you need to download the source, rather than install from NPM, you can find it on

<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>GitHub</a>.</p>
<p>To begin working with the SDK, create an instance of it.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">const</span> <span style="color:#000">AgonesSDK</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">require</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;@google-cloud/agones-sdk&#39;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">let</span> <span style="color:#000">agonesSDK</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">AgonesSDK</span><span style="color:#000;font-weight:bold">();</span>
</span></span></code></pre></div><p>To connect to the SDK server, either local or when running on Code Blind, run the <code>async</code> method <code>sdk.connect()</code>, which will
<code>resolve</code> once connected or <code>reject</code> on error or if no connection can be made after 30 seconds.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">agonesSDK</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">connect</span><span style="color:#000;font-weight:bold">();</span>
</span></span></code></pre></div><p>To send a <a href="/docs/guides/client-sdks/#health">health check</a> ping call <code>health(errorCallback)</code>. The error callback is optional and if provided will receive an error whenever emitted from the health check stream.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#000">agonesSDK</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">health</span><span style="color:#000;font-weight:bold">((</span><span style="color:#000">error</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">=&gt;</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">console</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">error</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;error&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">error</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">});</span>
</span></span></code></pre></div><p>To mark the game server as <a href="/docs/guides/client-sdks/#ready">ready to receive player connections</a>, call the async method <code>ready()</code>. The result will be an empty object in this case.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">let</span> <span style="color:#000">result</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">agonesSDK</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">ready</span><span style="color:#000;font-weight:bold">();</span>
</span></span></code></pre></div><p>Similarly <code>shutdown()</code>, <code>allocate()</code>, <code>setAnnotation(key, value)</code> and <code>setLabel(key, value)</code> are async methods that perform an action and return an empty result.</p>
<p>To get <a href="/docs/guides/client-sdks/#gameserver">details of the backing GameServer</a> call the async method
<code>getGameServer()</code>. The result will be an object representing <code>GameServer</code> defined
in 
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>`sdk.proto`</a>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">let</span> <span style="color:#000">result</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">agonesSDK</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">getGameServer</span><span style="color:#000;font-weight:bold">();</span>
</span></span></code></pre></div><p>To get <a href="/docs/guides/client-sdks/#watchgameserverfunctiongameserver">updates on the backing GameServer</a> as they happen, call <code>watchGameServer(callback, errorCallback)</code>. The callback will be called with a parameter matching the result of <code>getGameServer()</code>. The error callback is optional and if provided will receive an error whenever emitted from the watch stream.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#000">agonesSDK</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">watchGameServer</span><span style="color:#000;font-weight:bold">((</span><span style="color:#000">result</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">=&gt;</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">console</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">log</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;watch&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">result</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">},</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">error</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">=&gt;</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">console</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">error</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;error&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">error</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">});</span>
</span></span></code></pre></div><p>To mark the game server as <a href="/docs/guides/client-sdks/#reserveseconds">reserved</a> for a period of time, call the async method <code>reserve(seconds)</code>. The result will be an empty object.</p>
<p>For more information, please read the <a href="/docs/guides/client-sdks/">SDK Overview</a>, check out 
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>agonesSDK.js</a> and also look at the 
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>Node.js example</a>.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-24d1a13fcc983c347c4d6e93b5c781b0">5.3.7 - Rust Game Server Client SDK</h1>
    <div class="lead">This is the Rust version of the Code Blind Game Server Client SDK.</div>
	<p>Check the <a href="/docs/guides/client-sdks/">Client SDK Documentation</a> for more details on each of the SDK functions and how to run the SDK locally.</p>
<h2 id="sdk-functionality">SDK Functionality</h2>
<table>
<thead>
<tr>
<th>Area</th>
<th>Action</th>
<th>Implemented</th>
</tr>
</thead>
<tbody>
<tr>
<td>Lifecycle</td>
<td>Ready</td>
<td>✔️</td>
</tr>
<tr>
<td>Lifecycle</td>
<td>Health</td>
<td>✔️</td>
</tr>
<tr>
<td>Lifecycle</td>
<td>Reserve</td>
<td>✔️</td>
</tr>
<tr>
<td>Lifecycle</td>
<td>Allocate</td>
<td>✔️</td>
</tr>
<tr>
<td>Lifecycle</td>
<td>Shutdown</td>
<td>✔️</td>
</tr>
<tr>
<td>Configuration</td>
<td>GameServer</td>
<td>✔️</td>
</tr>
<tr>
<td>Configuration</td>
<td>Watch</td>
<td>✔️</td>
</tr>
<tr>
<td>Metadata</td>
<td>SetAnnotation</td>
<td>✔️</td>
</tr>
<tr>
<td>Metadata</td>
<td>SetLabel</td>
<td>✔️</td>
</tr>
<tr>
<td>Counters</td>
<td>GetCounterCount</td>
<td>❌</td>
</tr>
<tr>
<td>Counters</td>
<td>SetCounterCount</td>
<td>❌</td>
</tr>
<tr>
<td>Counters</td>
<td>IncrementCounter</td>
<td>❌</td>
</tr>
<tr>
<td>Counters</td>
<td>DecrementCounter</td>
<td>❌</td>
</tr>
<tr>
<td>Counters</td>
<td>SetCounterCapacity</td>
<td>❌</td>
</tr>
<tr>
<td>Counters</td>
<td>GetCounterCapacity</td>
<td>❌</td>
</tr>
<tr>
<td>Lists</td>
<td>AppendListValue</td>
<td>❌</td>
</tr>
<tr>
<td>Lists</td>
<td>DeleteListValue</td>
<td>❌</td>
</tr>
<tr>
<td>Lists</td>
<td>SetListCapacity</td>
<td>❌</td>
</tr>
<tr>
<td>Lists</td>
<td>GetListCapacity</td>
<td>❌</td>
</tr>
<tr>
<td>Lists</td>
<td>ListContains</td>
<td>❌</td>
</tr>
<tr>
<td>Lists</td>
<td>GetListLength</td>
<td>❌</td>
</tr>
<tr>
<td>Lists</td>
<td>GetListValues</td>
<td>❌</td>
</tr>
<tr>
<td>Player Tracking</td>
<td>GetConnectedPlayers</td>
<td>✔️</td>
</tr>
<tr>
<td>Player Tracking</td>
<td>GetPlayerCapacity</td>
<td>✔️</td>
</tr>
<tr>
<td>Player Tracking</td>
<td>GetPlayerCount</td>
<td>✔️</td>
</tr>
<tr>
<td>Player Tracking</td>
<td>IsPlayerConnected</td>
<td>✔️</td>
</tr>
<tr>
<td>Player Tracking</td>
<td>PlayerConnect</td>
<td>✔️</td>
</tr>
<tr>
<td>Player Tracking</td>
<td>PlayerDisconnect</td>
<td>✔️</td>
</tr>
<tr>
<td>Player Tracking</td>
<td>SetPlayerCapacity</td>
<td>✔️</td>
</tr>
</tbody>
</table>
<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li><a href="https://www.rust-lang.org/tools/install">Rust &gt;= 1.50</a></li>
</ul>
<h2 id="usage">Usage</h2>
<p>Add <a href="https://crates.io/crates/agones" data-proofer-ignore>this crate</a> to <code>dependencies</code> section in your Cargo.toml.</p>
<p>Also note that the SDK is <a href="https://doc.rust-lang.org/std/keyword.async.html"><code>async</code></a> only, so you will need an async runtime to execute the futures exposed by the SDK. It is recommended to use <a href="https://docs.rs/tokio">tokio</a> as the SDK already depends on tokio due to its choice of gRPC library, <a href="https://docs.rs/tonic">tonic</a>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-toml" data-lang="toml"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">dependencies</span><span style="color:#000;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span><span style="color:#000">agones</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;1.34.0&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">tokio</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#000">version</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;1.32.0&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">features</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;macros&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;sync&#34;</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>To begin working with the SDK, create an instance of it.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">use</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">std</span>::<span style="color:#000">time</span>::<span style="color:#000">Duration</span><span style="color:#000;font-weight:bold">;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic">#[tokio::main]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">async</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">fn</span> <span style="color:#000">main</span><span style="color:#000;font-weight:bold">()</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">{</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">let</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">mut</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">sdk</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">agones</span>::<span style="color:#000">Sdk</span>::<span style="color:#000">new</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">None</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic">/* default port */</span><span style="color:#000;font-weight:bold">,</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87">None</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic">/* keep_alive */</span><span style="color:#000;font-weight:bold">)</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#000;font-weight:bold">.</span><span style="color:#204a87;font-weight:bold">await</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">expect</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;failed to connect to SDK server&#34;</span><span style="color:#000;font-weight:bold">);</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#000;font-weight:bold">}</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>To send <a href="/docs/guides/client-sdks/#health">health checks</a>, call <code>sdk.health_check</code>, which will return a <a href="https://docs.rs/tokio/1.7.0/tokio/sync/mpsc/struct.Sender.html"><code>tokio::sync::mpsc::Sender::&lt;()&gt;</code></a> which will send a health check every time a message is posted to the channel.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">let</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">health</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">sdk</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">health_check</span><span style="color:#000;font-weight:bold">();</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">if</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">health</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">send</span><span style="color:#000;font-weight:bold">(()).</span><span style="color:#204a87;font-weight:bold">await</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">is_err</span><span style="color:#000;font-weight:bold">()</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">{</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">eprintln!</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;the health receiver was closed&#34;</span><span style="color:#000;font-weight:bold">);</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#000;font-weight:bold">}</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>To mark the <a href="/docs/guides/client-sdks/#ready">game session as ready</a> call <code>sdk.ready()</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#000">sdk</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">ready</span><span style="color:#000;font-weight:bold">().</span><span style="color:#204a87;font-weight:bold">await</span><span style="color:#ce5c00;font-weight:bold">?</span><span style="color:#000;font-weight:bold">;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>To mark the game server as <a href="/docs/guides/client-sdks/#reserveseconds">reserved</a> for a period of time, call <code>sdk.reserve(duration)</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#000">sdk</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">reserve</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Duration</span>::<span style="color:#000">new</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">,</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">)).</span><span style="color:#204a87;font-weight:bold">await</span><span style="color:#ce5c00;font-weight:bold">?</span><span style="color:#000;font-weight:bold">;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>To mark that the <a href="/docs/guides/client-sdks/#shutdown">game session is completed</a> and the game server should be shut down call <code>sdk.shutdown()</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">if</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">let</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87">Err</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">e</span><span style="color:#000;font-weight:bold">)</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">sdk</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">shutdown</span><span style="color:#000;font-weight:bold">().</span><span style="color:#204a87;font-weight:bold">await</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">{</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">eprintln!</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Could not run Shutdown: </span><span style="color:#4e9a06">{}</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">e</span><span style="color:#000;font-weight:bold">);</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#000;font-weight:bold">}</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>To <a href="/docs/guides/client-sdks/#setlabelkey-value">set a Label</a> on the backing <code>GameServer</code> call <code>sdk.set_label(key, value)</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#000">sdk</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">set_label</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;test-label&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;test-value&#34;</span><span style="color:#000;font-weight:bold">).</span><span style="color:#204a87;font-weight:bold">await</span><span style="color:#ce5c00;font-weight:bold">?</span><span style="color:#000;font-weight:bold">;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>To <a href="/docs/guides/client-sdks/#setannotationkey-value">set an Annotation</a> on the backing <code>GameServer</code> call <code>sdk.set_annotation(key, value)</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#000">sdk</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">set_annotation</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;test-annotation&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;test value&#34;</span><span style="color:#000;font-weight:bold">).</span><span style="color:#204a87;font-weight:bold">await</span><span style="color:#ce5c00;font-weight:bold">?</span><span style="color:#000;font-weight:bold">;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>To get <a href="/docs/guides/client-sdks/#gameserver">details of the backing <code>GameServer</code></a> call <code>sdk.get_gameserver()</code>.</p>
<p>The function will return an instance of <code>agones::types::GameServer</code> including <code>GameServer</code> configuration info.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">let</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">gameserver</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">sdk</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">get_gameserver</span><span style="color:#000;font-weight:bold">().</span><span style="color:#204a87;font-weight:bold">await</span><span style="color:#ce5c00;font-weight:bold">?</span><span style="color:#000;font-weight:bold">;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>To get <a href="/docs/guides/client-sdks/#watchgameserverfunctiongameserver">updates on the backing <code>GameServer</code></a> as they happen, call <code>sdk.watch_gameserver</code>.</p>
<p>This will stream updates and endlessly until the stream is closed, so it is recommended to push this into its own async task.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">let</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">_watch</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">{</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic">// We need to clone the SDK as we are moving it to another task
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">let</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">mut</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">watch_client</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">sdk</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">clone</span><span style="color:#000;font-weight:bold">();</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic">// We use a simple oneshot to signal to the task when we want it to shutdown
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic">// and stop watching the gameserver update stream
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">let</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">tx</span><span style="color:#000;font-weight:bold">,</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">mut</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">rx</span><span style="color:#000;font-weight:bold">)</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">tokio</span>::<span style="color:#000">sync</span>::<span style="color:#000">oneshot</span>::<span style="color:#000">channel</span>::<span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000;font-weight:bold">()</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">();</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">tokio</span>::<span style="color:#000">task</span>::<span style="color:#000">spawn</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">async</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">move</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">{</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#000">println!</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Starting to watch GameServer updates...&#34;</span><span style="color:#000;font-weight:bold">);</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">match</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">watch_client</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">watch_gameserver</span><span style="color:#000;font-weight:bold">().</span><span style="color:#204a87;font-weight:bold">await</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">{</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87">Err</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">e</span><span style="color:#000;font-weight:bold">)</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#ce5c00;font-weight:bold">=&gt;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">eprintln!</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Failed to watch for GameServer updates: </span><span style="color:#4e9a06">{}</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">e</span><span style="color:#000;font-weight:bold">),</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87">Ok</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">mut</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">stream</span><span style="color:#000;font-weight:bold">)</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#ce5c00;font-weight:bold">=&gt;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">loop</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">{</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#000">tokio</span>::<span style="color:#000">select!</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">{</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                    </span><span style="color:#8f5902;font-style:italic">// We&#39;ve received a new update, or the stream is shutting down
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#f8f8f8;text-decoration:underline">                    </span><span style="color:#000">gs</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">stream</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">message</span><span style="color:#000;font-weight:bold">()</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#ce5c00;font-weight:bold">=&gt;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">{</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                        </span><span style="color:#204a87;font-weight:bold">match</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">gs</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">{</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                            </span><span style="color:#204a87">Ok</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">Some</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">gs</span><span style="color:#000;font-weight:bold">))</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#ce5c00;font-weight:bold">=&gt;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">{</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                                </span><span style="color:#000">println!</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;GameServer Update, name: </span><span style="color:#4e9a06">{}</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">gs</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">object_meta</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">unwrap</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">name</span><span style="color:#000;font-weight:bold">);</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                                </span><span style="color:#000">println!</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;GameServer Update, state: </span><span style="color:#4e9a06">{}</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">gs</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">status</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">unwrap</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">state</span><span style="color:#000;font-weight:bold">);</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                            </span><span style="color:#000;font-weight:bold">}</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                            </span><span style="color:#204a87">Ok</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">None</span><span style="color:#000;font-weight:bold">)</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#ce5c00;font-weight:bold">=&gt;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">{</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                                </span><span style="color:#000">println!</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Server closed the GameServer watch stream&#34;</span><span style="color:#000;font-weight:bold">);</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                                </span><span style="color:#204a87;font-weight:bold">break</span><span style="color:#000;font-weight:bold">;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                            </span><span style="color:#000;font-weight:bold">}</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                            </span><span style="color:#204a87">Err</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">e</span><span style="color:#000;font-weight:bold">)</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#ce5c00;font-weight:bold">=&gt;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">{</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                                </span><span style="color:#000">eprintln!</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;GameServer Update stream encountered an error: </span><span style="color:#4e9a06">{}</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">e</span><span style="color:#000;font-weight:bold">);</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                            </span><span style="color:#000;font-weight:bold">}</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                        </span><span style="color:#000;font-weight:bold">}</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                    </span><span style="color:#000;font-weight:bold">}</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                    </span><span style="color:#8f5902;font-style:italic">// The watch is being dropped so we&#39;re going to shutdown the task
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#f8f8f8;text-decoration:underline">                    </span><span style="color:#8f5902;font-style:italic">// and the watch stream
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#f8f8f8;text-decoration:underline">                    </span><span style="color:#000">_</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#ce5c00;font-weight:bold">&amp;</span><span style="color:#204a87;font-weight:bold">mut</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">rx</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#ce5c00;font-weight:bold">=&gt;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">{</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                        </span><span style="color:#000">println!</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Shutting down GameServer watch loop&#34;</span><span style="color:#000;font-weight:bold">);</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                        </span><span style="color:#204a87;font-weight:bold">break</span><span style="color:#000;font-weight:bold">;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                    </span><span style="color:#000;font-weight:bold">}</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#000;font-weight:bold">}</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#000;font-weight:bold">},</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#000;font-weight:bold">}</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000;font-weight:bold">});</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">tx</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#000;font-weight:bold">};</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>For more information, please read the <a href="/docs/guides/client-sdks/">SDK Overview</a>, check out 
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>agones sdk implementation</a> and also look at the 
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>Rust example</a>.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-dd2771f8169b00ae8809eb9b01e73547">5.3.8 - REST Game Server Client API</h1>
    <div class="lead">This is the REST version of the Code Blind Game Server Client SDK.</div>
	<p>Check the <a href="/docs/guides/client-sdks/">Client SDK Documentation</a> for more details on each of the SDK functions and how to run the SDK locally.</p>
<h2 id="sdk-functionality">SDK Functionality</h2>
<table>
<thead>
<tr>
<th>Area</th>
<th>Action</th>
<th>Implemented</th>
</tr>
</thead>
<tbody>
<tr>
<td>Lifecycle</td>
<td>Ready</td>
<td>✔️</td>
</tr>
<tr>
<td>Lifecycle</td>
<td>Health</td>
<td>✔️</td>
</tr>
<tr>
<td>Lifecycle</td>
<td>Reserve</td>
<td>✔️</td>
</tr>
<tr>
<td>Lifecycle</td>
<td>Allocate</td>
<td>✔️</td>
</tr>
<tr>
<td>Lifecycle</td>
<td>Shutdown</td>
<td>✔️</td>
</tr>
<tr>
<td>Configuration</td>
<td>GetGameServer</td>
<td>✔️</td>
</tr>
<tr>
<td>Configuration</td>
<td>WatchGameServer</td>
<td>✔️</td>
</tr>
<tr>
<td>Metadata</td>
<td>SetAnnotation</td>
<td>✔️</td>
</tr>
<tr>
<td>Metadata</td>
<td>SetLabel</td>
<td>✔️</td>
</tr>
<tr>
<td>Counters</td>
<td>GetCounter</td>
<td>✔️</td>
</tr>
<tr>
<td>Counters</td>
<td>UpdateCounter</td>
<td>✔️</td>
</tr>
<tr>
<td>Lists</td>
<td>GetList</td>
<td>✔️</td>
</tr>
<tr>
<td>Lists</td>
<td>UpdateList</td>
<td>✔️</td>
</tr>
<tr>
<td>Lists</td>
<td>AddListValue</td>
<td>✔️</td>
</tr>
<tr>
<td>Lists</td>
<td>RemoveListValue</td>
<td>✔️</td>
</tr>
<tr>
<td>Player Tracking</td>
<td>GetPlayerCapacity</td>
<td>✔️</td>
</tr>
<tr>
<td>Player Tracking</td>
<td>SetPlayerCapacity</td>
<td>✔️</td>
</tr>
<tr>
<td>Player Tracking</td>
<td>PlayerConnect</td>
<td>✔️</td>
</tr>
<tr>
<td>Player Tracking</td>
<td>GetConnectedPlayers</td>
<td>✔️</td>
</tr>
<tr>
<td>Player Tracking</td>
<td>IsPlayerConnected</td>
<td>✔️</td>
</tr>
<tr>
<td>Player Tracking</td>
<td>GetPlayerCount</td>
<td>✔️</td>
</tr>
<tr>
<td>Player Tracking</td>
<td>PlayerDisconnect</td>
<td>✔️</td>
</tr>
</tbody>
</table>
<p>The REST API can be accessed from <code>http://localhost:${AGONES_SDK_HTTP_PORT}/</code> from the game server process.
<code>AGONES_SDK_HTTP_PORT</code> is an environment variable automatically set for the game server process by Code Blind to
support binding the REST API to a dynamic port. It is advised to use the environment variable rather than a
hard coded port; otherwise your game server will not be able to contact the SDK server if it is configured to
use a non-default port.</p>
<p>Generally the REST interface gets used if gRPC isn&rsquo;t well supported for a given language or platform.</p>


<div class="alert alert-warning" role="alert">
<h4 class="alert-heading">Warning</h4>

    The SDK Server sidecar process may startup after your game server binary. So your REST SDK API calls should
contain some retry logic to take this into account.

</div>

<h2 id="generating-clients">Generating clients</h2>
<p>While you can hand write REST integrations, we also have a set
of 
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>generated OpenAPI/Swagger definitions</a> available.
This means you can use OpenAPI/Swagger tooling to generate clients as well, if you need them.</p>
<p>For example, to create a cpp client for the stable sdk endpoints (to be run in the <code>agones</code> home directory):</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker run --rm -v <span style="color:#4e9a06">${</span><span style="color:#000">PWD</span><span style="color:#4e9a06">}</span>:/local swaggerapi/swagger-codegen-cli generate -i /local/sdks/swagger/sdk.swagger.json  -l cpprest -o /local/out/cpp
</span></span></code></pre></div><p>The same could be run for <code>alpha.swagger.json</code> and <code>beta.swagger.json</code> as required.</p>
<p>You can read more about OpenAPI/Swagger code generation in their <a href="https://swagger.io/docs/open-source-tools/swagger-codegen/">Command Line Tool Documentation</a></p>
<h2 id="reference">Reference</h2>
<h3 id="lifecycle-management">Lifecycle Management</h3>
<h4 id="ready">Ready</h4>
<p>Call when the GameServer is ready to accept connections</p>
<ul>
<li>Path: <code>/ready</code></li>
<li>Method: <code>POST</code></li>
<li>Body: <code>{}</code></li>
</ul>
<h5 id="example">Example</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -d <span style="color:#4e9a06">&#34;{}&#34;</span> -H <span style="color:#4e9a06">&#34;Content-Type: application/json&#34;</span> -X POST http://localhost:<span style="color:#4e9a06">${</span><span style="color:#000">AGONES_SDK_HTTP_PORT</span><span style="color:#4e9a06">}</span>/ready
</span></span></code></pre></div><h4 id="health">Health</h4>
<p>Send a Empty every d Duration to declare that this GameServer is healthy</p>
<ul>
<li>Path: <code>/health</code></li>
<li>Method: <code>POST</code></li>
<li>Body: <code>{}</code></li>
</ul>
<h5 id="example-1">Example</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -d <span style="color:#4e9a06">&#34;{}&#34;</span> -H <span style="color:#4e9a06">&#34;Content-Type: application/json&#34;</span> -X POST http://localhost:<span style="color:#4e9a06">${</span><span style="color:#000">AGONES_SDK_HTTP_PORT</span><span style="color:#4e9a06">}</span>/health
</span></span></code></pre></div><h4 id="reserve">Reserve</h4>
<p>Move Gameserver into a Reserved state for a certain amount of seconds for the future allocation.</p>
<ul>
<li>Path: <code>/reserve</code></li>
<li>Method: <code>POST</code></li>
<li>Body: <code>{&quot;seconds&quot;: &quot;5&quot;}</code></li>
</ul>
<h5 id="example-2">Example</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -d <span style="color:#4e9a06">&#39;{&#34;seconds&#34;: &#34;5&#34;}&#39;</span> -H <span style="color:#4e9a06">&#34;Content-Type: application/json&#34;</span> -X POST http://localhost:<span style="color:#4e9a06">${</span><span style="color:#000">AGONES_SDK_HTTP_PORT</span><span style="color:#4e9a06">}</span>/reserve
</span></span></code></pre></div><h4 id="allocate">Allocate</h4>
<p>With some matchmakers and game matching strategies, it can be important for game servers to mark themselves as <code>Allocated</code>.
For those scenarios, this SDK functionality exists.</p>


<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Note</h4>

    Using a <a href="https://codeblind.ai/docs/reference/gameserverallocation/">GameServerAllocation</a> is preferred in all other scenarios,
as it gives Code Blind control over how packed <code>GameServers</code> are scheduled within a cluster, whereas with <code>Allocate()</code> you
relinquish control to an external service which likely doesn&rsquo;t have as much information as Code Blind.

</div>

<h5 id="example-3">Example</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -d <span style="color:#4e9a06">&#34;{}&#34;</span> -H <span style="color:#4e9a06">&#34;Content-Type: application/json&#34;</span> -X POST http://localhost:<span style="color:#4e9a06">${</span><span style="color:#000">AGONES_SDK_HTTP_PORT</span><span style="color:#4e9a06">}</span>/allocate
</span></span></code></pre></div><h4 id="shutdown">Shutdown</h4>
<p>Call when the GameServer session is over and it&rsquo;s time to shut down</p>
<ul>
<li>Path: <code>/shutdown</code></li>
<li>Method: <code>POST</code></li>
<li>Body: <code>{}</code></li>
</ul>
<h5 id="example-4">Example</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -d <span style="color:#4e9a06">&#34;{}&#34;</span> -H <span style="color:#4e9a06">&#34;Content-Type: application/json&#34;</span> -X POST http://localhost:<span style="color:#4e9a06">${</span><span style="color:#000">AGONES_SDK_HTTP_PORT</span><span style="color:#4e9a06">}</span>/shutdown
</span></span></code></pre></div><h3 id="configuration-retrieval">Configuration Retrieval</h3>
<h4 id="gameserver">GameServer</h4>
<p>Call when you want to retrieve the backing <code>GameServer</code> configuration details</p>
<ul>
<li>Path: <code>/gameserver</code></li>
<li>Method: <code>GET</code></li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -H <span style="color:#4e9a06">&#34;Content-Type: application/json&#34;</span> -X GET http://localhost:<span style="color:#4e9a06">${</span><span style="color:#000">AGONES_SDK_HTTP_PORT</span><span style="color:#4e9a06">}</span>/gameserver
</span></span></code></pre></div><p>Response:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">&#34;object_meta&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">&#34;name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;local&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">&#34;namespace&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;default&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">&#34;uid&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;1234&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">&#34;resource_version&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;v1&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">&#34;generation&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;1&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">&#34;creation_timestamp&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;1531795395&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">&#34;annotations&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">&#34;annotation&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;true&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">},</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">&#34;labels&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">&#34;islocal&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;true&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">},</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">&#34;status&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">&#34;state&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Ready&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">&#34;address&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;127.0.0.1&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">&#34;ports&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#204a87;font-weight:bold">&#34;name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;default&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>                <span style="color:#204a87;font-weight:bold">&#34;port&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">7777</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h4 id="watch-gameserver">Watch GameServer</h4>
<p>Call this when you want to get updates of when the backing <code>GameServer</code> configuration is updated.</p>
<p>These updates will come as newline delimited JSON, send on each update. To that end, you will
want to keep the http connection open, and read lines from the result stream and and process as they
come in.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -H <span style="color:#4e9a06">&#34;Content-Type: application/json&#34;</span> -X GET http://localhost:<span style="color:#4e9a06">${</span><span style="color:#000">AGONES_SDK_HTTP_PORT</span><span style="color:#4e9a06">}</span>/watch/gameserver
</span></span></code></pre></div><p>Response:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span><span style="color:#204a87;font-weight:bold">&#34;result&#34;</span><span style="color:#000;font-weight:bold">:{</span><span style="color:#204a87;font-weight:bold">&#34;object_meta&#34;</span><span style="color:#000;font-weight:bold">:{</span><span style="color:#204a87;font-weight:bold">&#34;name&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;local&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#204a87;font-weight:bold">&#34;namespace&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;default&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#204a87;font-weight:bold">&#34;uid&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;1234&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#204a87;font-weight:bold">&#34;resource_version&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;v1&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#204a87;font-weight:bold">&#34;generation&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;1&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#204a87;font-weight:bold">&#34;creation_timestamp&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;1533766607&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#204a87;font-weight:bold">&#34;annotations&#34;</span><span style="color:#000;font-weight:bold">:{</span><span style="color:#204a87;font-weight:bold">&#34;annotation&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;true&#34;</span><span style="color:#000;font-weight:bold">},</span><span style="color:#204a87;font-weight:bold">&#34;labels&#34;</span><span style="color:#000;font-weight:bold">:{</span><span style="color:#204a87;font-weight:bold">&#34;islocal&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;true&#34;</span><span style="color:#000;font-weight:bold">}},</span><span style="color:#204a87;font-weight:bold">&#34;status&#34;</span><span style="color:#000;font-weight:bold">:{</span><span style="color:#204a87;font-weight:bold">&#34;state&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;Ready&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#204a87;font-weight:bold">&#34;address&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;127.0.0.1&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#204a87;font-weight:bold">&#34;ports&#34;</span><span style="color:#000;font-weight:bold">:[{</span><span style="color:#204a87;font-weight:bold">&#34;name&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;default&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#204a87;font-weight:bold">&#34;port&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#0000cf;font-weight:bold">7777</span><span style="color:#000;font-weight:bold">}]}}}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span><span style="color:#204a87;font-weight:bold">&#34;result&#34;</span><span style="color:#000;font-weight:bold">:{</span><span style="color:#204a87;font-weight:bold">&#34;object_meta&#34;</span><span style="color:#000;font-weight:bold">:{</span><span style="color:#204a87;font-weight:bold">&#34;name&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;local&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#204a87;font-weight:bold">&#34;namespace&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;default&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#204a87;font-weight:bold">&#34;uid&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;1234&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#204a87;font-weight:bold">&#34;resource_version&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;v1&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#204a87;font-weight:bold">&#34;generation&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;1&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#204a87;font-weight:bold">&#34;creation_timestamp&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;1533766607&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#204a87;font-weight:bold">&#34;annotations&#34;</span><span style="color:#000;font-weight:bold">:{</span><span style="color:#204a87;font-weight:bold">&#34;annotation&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;true&#34;</span><span style="color:#000;font-weight:bold">},</span><span style="color:#204a87;font-weight:bold">&#34;labels&#34;</span><span style="color:#000;font-weight:bold">:{</span><span style="color:#204a87;font-weight:bold">&#34;islocal&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;true&#34;</span><span style="color:#000;font-weight:bold">}},</span><span style="color:#204a87;font-weight:bold">&#34;status&#34;</span><span style="color:#000;font-weight:bold">:{</span><span style="color:#204a87;font-weight:bold">&#34;state&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;Ready&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#204a87;font-weight:bold">&#34;address&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;127.0.0.1&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#204a87;font-weight:bold">&#34;ports&#34;</span><span style="color:#000;font-weight:bold">:[{</span><span style="color:#204a87;font-weight:bold">&#34;name&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;default&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#204a87;font-weight:bold">&#34;port&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#0000cf;font-weight:bold">7777</span><span style="color:#000;font-weight:bold">}]}}}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span><span style="color:#204a87;font-weight:bold">&#34;result&#34;</span><span style="color:#000;font-weight:bold">:{</span><span style="color:#204a87;font-weight:bold">&#34;object_meta&#34;</span><span style="color:#000;font-weight:bold">:{</span><span style="color:#204a87;font-weight:bold">&#34;name&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;local&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#204a87;font-weight:bold">&#34;namespace&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;default&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#204a87;font-weight:bold">&#34;uid&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;1234&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#204a87;font-weight:bold">&#34;resource_version&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;v1&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#204a87;font-weight:bold">&#34;generation&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;1&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#204a87;font-weight:bold">&#34;creation_timestamp&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;1533766607&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#204a87;font-weight:bold">&#34;annotations&#34;</span><span style="color:#000;font-weight:bold">:{</span><span style="color:#204a87;font-weight:bold">&#34;annotation&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;true&#34;</span><span style="color:#000;font-weight:bold">},</span><span style="color:#204a87;font-weight:bold">&#34;labels&#34;</span><span style="color:#000;font-weight:bold">:{</span><span style="color:#204a87;font-weight:bold">&#34;islocal&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;true&#34;</span><span style="color:#000;font-weight:bold">}},</span><span style="color:#204a87;font-weight:bold">&#34;status&#34;</span><span style="color:#000;font-weight:bold">:{</span><span style="color:#204a87;font-weight:bold">&#34;state&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;Ready&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#204a87;font-weight:bold">&#34;address&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;127.0.0.1&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#204a87;font-weight:bold">&#34;ports&#34;</span><span style="color:#000;font-weight:bold">:[{</span><span style="color:#204a87;font-weight:bold">&#34;name&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;default&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#204a87;font-weight:bold">&#34;port&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#0000cf;font-weight:bold">7777</span><span style="color:#000;font-weight:bold">}]}}}</span>
</span></span></code></pre></div><p>The Watch GameServer stream is also exposed as a WebSocket endpoint on the same URL and port as the HTTP <code>watch/gameserver</code> API. This endpoint is provided as a convienence for streaming data to clients such as Unreal that support WebSocket but not HTTP streaming, and HTTP streaming should be used instead if possible.</p>
<p>An example command that uses the WebSocket endpoint instead of streaming over HTTP is:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -N -H <span style="color:#4e9a06">&#34;Connection: Upgrade&#34;</span> -H <span style="color:#4e9a06">&#34;Upgrade: websocket&#34;</span> -H <span style="color:#4e9a06">&#34;Sec-WebSocket-Key: ExampleKey1234567890===&#34;</span> -H <span style="color:#4e9a06">&#34;Sec-WebSocket-Version: 13&#34;</span> -X GET http://localhost:<span style="color:#4e9a06">${</span><span style="color:#000">AGONES_SDK_HTTP_PORT</span><span style="color:#4e9a06">}</span>/watch/gameserver
</span></span></code></pre></div><p>The data returned from this endpoint is delimited by the boundaries of a WebSocket payload as defined by <a href="https://tools.ietf.org/html/rfc6455#section-5.2">RFC 6455, section 5.2</a>. When reading from this endpoint, if your WebSocket client does not automatically handle frame reassembly (e.g. Unreal), make sure to read to the end of the WebSocket payload (as defined by the FIN bit) before attempting to parse the data returned. This is transparent in most clients.</p>
<h3 id="metadata-management">Metadata Management</h3>
<h4 id="set-label">Set Label</h4>
<p>Apply a Label with the prefix &ldquo;agones.dev/sdk-&rdquo; to the backing <code>GameServer</code> metadata.</p>
<p>See the SDK <a href="https://codeblind.ai/docs/guides/client-sdks/#setlabelkey-value">SetLabel</a> documentation for restrictions.</p>
<h5 id="example-5">Example</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -d <span style="color:#4e9a06">&#39;{&#34;key&#34;: &#34;foo&#34;, &#34;value&#34;: &#34;bar&#34;}&#39;</span> -H <span style="color:#4e9a06">&#34;Content-Type: application/json&#34;</span> -X PUT http://localhost:<span style="color:#4e9a06">${</span><span style="color:#000">AGONES_SDK_HTTP_PORT</span><span style="color:#4e9a06">}</span>/metadata/label
</span></span></code></pre></div><h4 id="set-annotation">Set Annotation</h4>
<p>Apply an Annotation with the prefix &ldquo;agones.dev/sdk-&rdquo; to the backing <code>GameServer</code> metadata</p>
<h5 id="example-6">Example</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -d <span style="color:#4e9a06">&#39;{&#34;key&#34;: &#34;foo&#34;, &#34;value&#34;: &#34;bar&#34;}&#39;</span> -H <span style="color:#4e9a06">&#34;Content-Type: application/json&#34;</span> -X PUT http://localhost:<span style="color:#4e9a06">${</span><span style="color:#000">AGONES_SDK_HTTP_PORT</span><span style="color:#4e9a06">}</span>/metadata/annotation
</span></span></code></pre></div><h3 id="counters-and-lists">Counters and Lists</h3>

<div class="alert alert-warning" role="alert">
    <h4 class="alert-heading">Warning</h4>
    <p>The Counters and Lists feature is currently <strong><a href="https://codeblind.ai/docs/guides/feature-stages/#alpha">Alpha</a></strong>,
        not enabled by default, and may change in the future.</p>
<p>Use the FeatureGate  <code>CountsAndLists</code>
to enable and test this feature.</p>
    <p>See the <a href="https://codeblind.ai/docs/guides/feature-stages/#feature-gates">Feature Gate documentation</a> for details on how to enable features.</p>
</div>

<h4 id="counters">Counters</h4>
<p>In all the  Counter examples, we retrieve the counter under the key <code>rooms</code> as if it was previously defined in <a href="https://codeblind.ai/docs/reference/agones_crd_api_reference/#agones.dev/v1.GameServerSpec"><code>GameServer.Spec.counters[room]</code></a>.</p>
<p>For your own Counter REST requests, replace the value <code>rooms</code> with your own key in the path.</p>
<h5 id="alpha-getcounter">Alpha: GetCounter</h5>
<p>This function retrieves a specified counter by its key, <code>rooms</code>, and returns its information.</p>
<h6 id="example-7">Example</h6>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -H <span style="color:#4e9a06">&#34;Content-Type: application/json&#34;</span> -X GET http://localhost:<span style="color:#4e9a06">${</span><span style="color:#000">AGONES_SDK_HTTP_PORT</span><span style="color:#4e9a06">}</span>/v1alpha1/counters/rooms
</span></span></code></pre></div><p>Response:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span><span style="color:#204a87;font-weight:bold">&#34;name&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;rooms&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">&#34;count&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;1&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">&#34;capacity&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;10&#34;</span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h5 id="alpha-updatecounter">Alpha: UpdateCounter</h5>
<p>This function updates the properties of the counter with the key <code>rooms</code>, such as its count and capacity, and returns the updated counter details.</p>
<h6 id="example-8">Example</h6>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -d <span style="color:#4e9a06">&#39;{&#34;count&#34;: &#34;5&#34;, &#34;capacity&#34;: &#34;11&#34;}&#39;</span> -H <span style="color:#4e9a06">&#34;Content-Type: application/json&#34;</span> -X PATCH http://localhost:<span style="color:#4e9a06">${</span><span style="color:#000">AGONES_SDK_HTTP_PORT</span><span style="color:#4e9a06">}</span>/v1alpha1/counters/rooms
</span></span></code></pre></div><p>Response:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span><span style="color:#204a87;font-weight:bold">&#34;name&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;rooms&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">&#34;count&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;5&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">&#34;capacity&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;11&#34;</span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h4 id="lists">Lists</h4>
<p>In all the List examples, we retrieve the list under the key <code>players</code> as if it was previously defined in <a href="https://codeblind.ai/docs/reference/agones_crd_api_reference/#agones.dev/v1.GameServerSpec"><code>GameServer.Spec.lists[players]</code></a>.</p>
<p>For your own List REST based requests, replace the value <code>players</code> with your own key in the path.</p>
<h5 id="alpha-getlist">Alpha: GetList</h5>
<p>This function retrieves the list&rsquo;s properties with the key <code>players</code>, returns the list&rsquo;s information.</p>
<h6 id="example-9">Example</h6>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -H <span style="color:#4e9a06">&#34;Content-Type: application/json&#34;</span> -X GET http://localhost:<span style="color:#4e9a06">${</span><span style="color:#000">AGONES_SDK_HTTP_PORT</span><span style="color:#4e9a06">}</span>/v1alpha1/lists/players
</span></span></code></pre></div><p>Response:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span><span style="color:#204a87;font-weight:bold">&#34;name&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;players&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">&#34;capacity&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;100&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">&#34;values&#34;</span><span style="color:#000;font-weight:bold">:[</span><span style="color:#4e9a06">&#34;player0&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;player1&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;player2&#34;</span><span style="color:#000;font-weight:bold">]}</span>     
</span></span></code></pre></div><h5 id="alpha-updatelist">Alpha: UpdateList</h5>
<p>This function updates the list&rsquo;s properties with the key <code>players</code>, such as its capacity and values, returns the updated list details. This will overwrite all existing List.Values with the update list request values. Use addValue or removeValue for modifying the List.Values field.</p>
<h6 id="example-10">Example</h6>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -d <span style="color:#4e9a06">&#39;{&#34;capacity&#34;: &#34;120&#34;, &#34;values&#34;: [&#34;player3&#34;, &#34;player4&#34;]}&#39;</span> -H <span style="color:#4e9a06">&#34;Content-Type: application/json&#34;</span> -X PATCH http://localhost:<span style="color:#4e9a06">${</span><span style="color:#000">AGONES_SDK_HTTP_PORT</span><span style="color:#4e9a06">}</span>/v1alpha1/lists/players
</span></span></code></pre></div><p>Response:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span><span style="color:#204a87;font-weight:bold">&#34;name&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;players&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">&#34;capacity&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;120&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">&#34;values&#34;</span><span style="color:#000;font-weight:bold">:[</span><span style="color:#4e9a06">&#34;player3&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;player4&#34;</span><span style="color:#000;font-weight:bold">]}</span>
</span></span></code></pre></div><h5 id="alpha-addlistvalue">Alpha: AddListValue</h5>
<p>This function adds a new value to a list with the key <code>players</code> and returns the list with this addition.</p>
<h6 id="example-11">Example</h6>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -d <span style="color:#4e9a06">&#39;{&#34;value&#34;: &#34;player9&#34;}&#39;</span> -H <span style="color:#4e9a06">&#34;Content-Type: application/json&#34;</span> -X POST http://localhost:<span style="color:#4e9a06">${</span><span style="color:#000">AGONES_SDK_HTTP_PORT</span><span style="color:#4e9a06">}</span>/v1alpha1/lists/players:addValue
</span></span></code></pre></div><p>Response:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span><span style="color:#204a87;font-weight:bold">&#34;name&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;players&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">&#34;capacity&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;120&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">&#34;values&#34;</span><span style="color:#000;font-weight:bold">:[</span><span style="color:#4e9a06">&#34;player3&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;player4&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;player9&#34;</span><span style="color:#000;font-weight:bold">]}</span>
</span></span></code></pre></div><h5 id="alpha-removelistvalue">Alpha: RemoveListValue</h5>
<p>This function removes a value from the list with the key <code>players</code> and returns updated list.</p>
<h6 id="example-12">Example</h6>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -d <span style="color:#4e9a06">&#39;{&#34;value&#34;: &#34;player3&#34;}&#39;</span> -H <span style="color:#4e9a06">&#34;Content-Type: application/json&#34;</span> -X POST http://localhost:<span style="color:#4e9a06">${</span><span style="color:#000">AGONES_SDK_HTTP_PORT</span><span style="color:#4e9a06">}</span>/v1alpha1/lists/players:removeValue
</span></span></code></pre></div><p>Response:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span><span style="color:#204a87;font-weight:bold">&#34;name&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;players&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">&#34;capacity&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;120&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">&#34;values&#34;</span><span style="color:#000;font-weight:bold">:[</span><span style="color:#4e9a06">&#34;player4&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;player9&#34;</span><span style="color:#000;font-weight:bold">]}</span>
</span></span></code></pre></div><h3 id="player-tracking">Player Tracking</h3>

<div class="alert alert-warning" role="alert">
    <h4 class="alert-heading">Warning</h4>
    <p>The Player Tracking feature is currently <strong><a href="https://codeblind.ai/docs/guides/feature-stages/#alpha">Alpha</a></strong>,
        not enabled by default, and may change in the future.</p>
<p>Use the FeatureGate  <code>PlayerTracking</code>
to enable and test this feature.</p>
    <p>See the <a href="https://codeblind.ai/docs/guides/feature-stages/#feature-gates">Feature Gate documentation</a> for details on how to enable features.</p>
</div>

<h4 id="alpha-playerconnect">Alpha: PlayerConnect</h4>
<p>This function increases the SDK’s stored player count by one, and appends this playerID to
<code>GameServer.Status.Players.IDs</code>.</p>
<h5 id="example-13">Example</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -d <span style="color:#4e9a06">&#39;{&#34;playerID&#34;: &#34;uzh7i&#34;}&#39;</span> -H <span style="color:#4e9a06">&#34;Content-Type: application/json&#34;</span> -X POST http://localhost:<span style="color:#4e9a06">${</span><span style="color:#000">AGONES_SDK_HTTP_PORT</span><span style="color:#4e9a06">}</span>/alpha/player/connect
</span></span></code></pre></div><p>Response:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span><span style="color:#204a87;font-weight:bold">&#34;bool&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h4 id="alpha-playerdisconnect">Alpha: PlayerDisconnect</h4>
<p>This function decreases the SDK’s stored player count by one, and removes the playerID from
<a href="https://codeblind.ai/docs/reference/agones_crd_api_reference/#agones.dev/v1.PlayerStatus"><code>GameServer.Status.Players.IDs</code></a>.</p>
<h5 id="example-14">Example</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -d <span style="color:#4e9a06">&#39;{&#34;playerID&#34;: &#34;uzh7i&#34;}&#39;</span> -H <span style="color:#4e9a06">&#34;Content-Type: application/json&#34;</span> -X POST http://localhost:<span style="color:#4e9a06">${</span><span style="color:#000">AGONES_SDK_HTTP_PORT</span><span style="color:#4e9a06">}</span>/alpha/player/disconnect
</span></span></code></pre></div><p>Response:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span><span style="color:#204a87;font-weight:bold">&#34;bool&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h4 id="alpha-setplayercapacity">Alpha: SetPlayerCapacity</h4>
<p>Update the <a href="https://codeblind.ai/docs/reference/agones_crd_api_reference/#agones.dev/v1.PlayerStatus"><code>GameServer.Status.Players.Capacity</code></a> value with a new capacity.</p>
<h5 id="example-15">Example</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -d <span style="color:#4e9a06">&#39;{&#34;count&#34;: 5}&#39;</span> -H <span style="color:#4e9a06">&#34;Content-Type: application/json&#34;</span> -X PUT http://localhost:<span style="color:#4e9a06">${</span><span style="color:#000">AGONES_SDK_HTTP_PORT</span><span style="color:#4e9a06">}</span>/alpha/player/capacity
</span></span></code></pre></div><h4 id="alpha-getplayercapacity">Alpha: GetPlayerCapacity</h4>
<p>This function retrieves the current player capacity. This is always accurate from what has been set through this SDK,
even if the value has yet to be updated on the GameServer status resource.</p>
<h5 id="example-16">Example</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -d <span style="color:#4e9a06">&#39;{}&#39;</span> -H <span style="color:#4e9a06">&#34;Content-Type: application/json&#34;</span> -X GET http://localhost:<span style="color:#4e9a06">${</span><span style="color:#000">AGONES_SDK_HTTP_PORT</span><span style="color:#4e9a06">}</span>/alpha/player/capacity
</span></span></code></pre></div><p>Response:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span><span style="color:#204a87;font-weight:bold">&#34;count&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;5&#34;</span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h4 id="alpha-getplayercount">Alpha: GetPlayerCount</h4>
<p>This function retrieves the current player count.
This is always accurate from what has been set through this SDK, even if the value has yet to be updated on the GameServer status resource.</p>
<h5 id="example-17">Example</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -H <span style="color:#4e9a06">&#34;Content-Type: application/json&#34;</span> -X GET http://localhost:<span style="color:#4e9a06">${</span><span style="color:#000">AGONES_SDK_HTTP_PORT</span><span style="color:#4e9a06">}</span>/alpha/player/count
</span></span></code></pre></div><p>Response:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span><span style="color:#204a87;font-weight:bold">&#34;count&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;2&#34;</span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h4 id="alpha-isplayerconnected">Alpha: IsPlayerConnected</h4>
<p>This function returns if the playerID is currently connected to the GameServer. This is always accurate from what has
been set through this SDK,
even if the value has yet to be updated on the GameServer status resource.</p>
<h5 id="example-18">Example</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -H <span style="color:#4e9a06">&#34;Content-Type: application/json&#34;</span> -X GET http://localhost:<span style="color:#4e9a06">${</span><span style="color:#000">AGONES_SDK_HTTP_PORT</span><span style="color:#4e9a06">}</span>/alpha/player/connected/uzh7i
</span></span></code></pre></div><p>Response:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span><span style="color:#204a87;font-weight:bold">&#34;bool&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h4 id="alpha-getconnectedplayers">Alpha: GetConnectedPlayers</h4>
<p>This function returns the list of the currently connected player ids. This is always accurate from what has been set
through this SDK, even if the value has yet to be updated on the GameServer status resource.</p>
<h5 id="example-19">Example</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -H <span style="color:#4e9a06">&#34;Content-Type: application/json&#34;</span> -X GET http://localhost:<span style="color:#4e9a06">${</span><span style="color:#000">AGONES_SDK_HTTP_PORT</span><span style="color:#4e9a06">}</span>/alpha/player/connected
</span></span></code></pre></div><p>Response:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span><span style="color:#204a87;font-weight:bold">&#34;list&#34;</span><span style="color:#000;font-weight:bold">:[</span><span style="color:#4e9a06">&#34;uzh7i&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#4e9a06">&#34;3zh7i&#34;</span><span style="color:#000;font-weight:bold">]}</span>
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-556057b2ca01a14c9507c51a6c2ec979">5.3.9 - Local Development</h1>
    <div class="lead">Working against the SDK without having to run a full kubernetes stack</div>
	<p>When the game server is running on Code Blind, the SDK communicates over TCP to a small
gRPC server that Code Blind coordinated to run in a container in the same network
namespace as it - usually referred to in Kubernetes terms as a &ldquo;sidecar&rdquo;.</p>
<p>Therefore, when developing locally, we also need a process for the SDK to connect to!</p>
<p>To do this, we can run the same binary (the SDK Server) that runs inside Code Blind, but pass in a flag
to run it in &ldquo;local mode&rdquo;. Local mode means that the sidecar binary
will not try to connect to anything, and will just send log messages to stdout and persist local state in memory so
that you can see exactly what the SDK in your game server is doing, and can
confirm everything works.</p>
<h2 id="running-the-sdk-server">Running the SDK Server</h2>
<p>To run the SDK Server, you will need a copy of the binary.
This can either be done by downloading a prebuilt binary or running from source code.
This guide will focus on running from the prebuilt binary, but details about running from source code can be found <a href="/docs/guides/client-sdks/local/#running-from-source-code-instead-of-prebuilt-binary">below</a>.</p>
<p>To run the prebuilt binary, for the latest release, you will need to download
<a href="https://github.com/josephbarnett/codeblind.ai/releases/download/v1.38.0/agonessdk-server-1.38.0.zip"  data-proofer-ignore>agonessdk-server-1.38.0.zip</a>
, and unzip it.
You will find the executables for the SDK server, for each type of operating system.</p>
<ul>
<li>MacOS
<ul>
<li>sdk-server.darwin.amd64</li>
<li>sdk-server.darwin.arm64</li>
</ul>
</li>
<li>Linux
<ul>
<li>sdk-server.linux.amd64</li>
<li>sdk-server.linux.arm64</li>
</ul>
</li>
<li>Windows
<ul>
<li>sdk-server.windows.amd64.exe</li>
</ul>
</li>
</ul>
<h3 id="running-in-local-mode">Running In &ldquo;Local Mode&rdquo;</h3>
<p>To run in local mode, pass the flag <code>--local</code> to the executable.</p>
<p>For example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./sdk-server.linux.amd64 --local
</span></span></code></pre></div><p>You should see output similar to the following:</p>
<pre tabindex="0"><code>{&#34;ctlConf&#34;:{&#34;Address&#34;:&#34;localhost&#34;,&#34;IsLocal&#34;:true,&#34;LocalFile&#34;:&#34;&#34;,&#34;Delay&#34;:0,&#34;Timeout&#34;:0,&#34;Test&#34;:&#34;&#34;,&#34;GRPCPort&#34;:9357,&#34;HTTPPort&#34;:9358},&#34;message&#34;:&#34;Starting sdk sidecar&#34;,&#34;severity&#34;:&#34;info&#34;,&#34;source&#34;:&#34;main&#34;,&#34;time&#34;:&#34;2019-10-30T21:44:37.973139+03:00&#34;,&#34;version&#34;:&#34;1.1.0&#34;}
{&#34;grpcEndpoint&#34;:&#34;localhost:9357&#34;,&#34;message&#34;:&#34;Starting SDKServer grpc service...&#34;,&#34;severity&#34;:&#34;info&#34;,&#34;source&#34;:&#34;main&#34;,&#34;time&#34;:&#34;2019-10-30T21:44:37.974585+03:00&#34;}
{&#34;httpEndpoint&#34;:&#34;localhost:9358&#34;,&#34;message&#34;:&#34;Starting SDKServer grpc-gateway...&#34;,&#34;severity&#34;:&#34;info&#34;,&#34;source&#34;:&#34;main&#34;,&#34;time&#34;:&#34;2019-10-30T21:44:37.975086+03:00&#34;}
{&#34;message&#34;:&#34;Ready request has been received!&#34;,&#34;severity&#34;:&#34;info&#34;,&#34;time&#34;:&#34;2019-10-30T21:45:47.031989+03:00&#34;}
{&#34;message&#34;:&#34;gameserver update received&#34;,&#34;severity&#34;:&#34;info&#34;,&#34;time&#34;:&#34;2019-10-30T21:45:47.03225+03:00&#34;}
{&#34;message&#34;:&#34;Shutdown request has been received!&#34;,&#34;severity&#34;:&#34;info&#34;,&#34;time&#34;:&#34;2019-10-30T21:46:18.179341+03:00&#34;}
{&#34;message&#34;:&#34;gameserver update received&#34;,&#34;severity&#34;:&#34;info&#34;,&#34;time&#34;:&#34;2019-10-30T21:46:18.179459+03:00&#34;}
</code></pre><h3 id="enabling-feature-gates">Enabling Feature Gates</h3>
<p>For development and testing purposes, you might want to enable specific <a href="https://codeblind.ai/docs/guides/feature-stages/#feature-gates">features gates</a> in the local SDK Server.</p>
<p>To do this, you can either set the <code>FEATURE_GATES</code> environment variable or use the <code>--feature-gates</code> command line parameter like so, with the same format as utilised when <a href="https://codeblind.ai/docs/installation/install-agones/helm/#configuration">configuring it on a Helm install</a>.</p>
<p>For example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./sdk-server.linux.amd64 --local --feature-gates <span style="color:#000">Example</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span>
</span></span></code></pre></div><p>or</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#000">FEATURE_GATES</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">Example</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> ./sdk-server.linux.amd64 --local
</span></span></code></pre></div><h2 id="providing-your-own-gameserver-configuration-for-local-development">Providing your own <code>GameServer</code> configuration for local development</h2>
<p>By default, the local sdk-server will create a default <code>GameServer</code> configuration that is used for <code>GameServer()</code>
and <code>WatchGameServer()</code> SDK calls. If you wish to provide your own configuration, as either yaml or json, this
can be passed through as either <code>--file</code> or <code>-f</code> along with the <code>--local</code> flag.</p>
<p>If the <code>GamerServer</code> configuration file is changed while the local server is running,
this will be picked up by the local server, and will change the current active configuration, as well as sending out
events for <code>WatchGameServer()</code>. This is a useful way of testing functionality, such as changes of state from <code>Ready</code> to
<code>Allocated</code> in your game server code.</p>


<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Note</h4>

    File modification events can fire more than one for each save (for a variety of reasons),
but it&rsquo;s best practice to ensure handlers that implement <code>WatchGameServer()</code> be idempotent regardless, as repeats can
happen when live as well.

</div>

<p>For example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>wget https://raw.githubusercontent.com/googleforgames/agones/release-1.38.0/examples/simple-game-server/gameserver.yaml
</span></span><span style="display:flex;"><span>./sdk-server.linux.amd64 --local -f ./gameserver.yaml
</span></span></code></pre></div><pre tabindex="0"><code>{&#34;ctlConf&#34;:{&#34;Address&#34;:&#34;localhost&#34;,&#34;IsLocal&#34;:true,&#34;LocalFile&#34;:&#34;./gameserver.yaml&#34;,&#34;Delay&#34;:0,&#34;Timeout&#34;:0,&#34;Test&#34;:&#34;&#34;,&#34;GRPCPort&#34;:9357,&#34;HTTPPort&#34;:9358},&#34;message&#34;:&#34;Starting sdk sidecar&#34;,&#34;severity&#34;:&#34;info&#34;,&#34;source&#34;:&#34;main&#34;,&#34;time&#34;:&#34;2019-10-30T21:47:45.742776+03:00&#34;,&#34;version&#34;:&#34;1.1.0&#34;}
{&#34;filePath&#34;:&#34;/Users/alexander.apalikov/Downloads/agonessdk-server-1.1.0/gameserver.yaml&#34;,&#34;message&#34;:&#34;Reading GameServer configuration&#34;,&#34;severity&#34;:&#34;info&#34;,&#34;time&#34;:&#34;2019-10-30T21:47:45.743369+03:00&#34;}
{&#34;grpcEndpoint&#34;:&#34;localhost:9357&#34;,&#34;message&#34;:&#34;Starting SDKServer grpc service...&#34;,&#34;severity&#34;:&#34;info&#34;,&#34;source&#34;:&#34;main&#34;,&#34;time&#34;:&#34;2019-10-30T21:47:45.759692+03:00&#34;}
{&#34;httpEndpoint&#34;:&#34;localhost:9358&#34;,&#34;message&#34;:&#34;Starting SDKServer grpc-gateway...&#34;,&#34;severity&#34;:&#34;info&#34;,&#34;source&#34;:&#34;main&#34;,&#34;time&#34;:&#34;2019-10-30T21:47:45.760312+03:00&#34;}
</code></pre><h2 id="changing-state-of-a-local-gameserver">Changing State of a Local GameServer</h2>
<p>Some SDK calls would change the GameServer state according to <a href="https://codeblind.ai/docs/reference/gameserver/#gameserver-state-diagram">GameServer State Diagram</a>. Also local SDK server would persist labels and annotations updates.</p>
<p>Here is a complete list of these commands: ready, allocate, setlabel, setannotation, shutdown, reserve.</p>
<p>For example call to Reserve() for 30 seconds would change the GameServer state to Reserve and if no call to Allocate() occurs it would return back to Ready state after this period.</p>


<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Note</h4>

    All state transitions are supported for local SDK server, however not all of them are valid in the real scenario. For instance, you cannot make a transition of a GameServer from Shutdown to a Ready state, but can do using local SDK server.

</div>

<p>All changes to the GameServer state could be observed and retrieved using Watch() or GameServer() methods using GameServer SDK.</p>
<p>Example of using HTTP gateway locally:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -X POST <span style="color:#4e9a06">&#34;http://localhost:9358/ready&#34;</span> -H <span style="color:#4e9a06">&#34;accept: application/json&#34;</span> -H <span style="color:#4e9a06">&#34;Content-Type: application/json&#34;</span> -d <span style="color:#4e9a06">&#34;{}&#34;</span>
</span></span></code></pre></div><pre tabindex="0"><code>{}
</code></pre><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -GET <span style="color:#4e9a06">&#34;http://localhost:9358/gameserver&#34;</span> -H <span style="color:#4e9a06">&#34;accept: application/json&#34;</span>
</span></span></code></pre></div><pre tabindex="0"><code>{&#34;object_meta&#34;:{&#34;creation_timestamp&#34;:&#34;-62135596800&#34;},&#34;spec&#34;:{&#34;health&#34;:{}},&#34;status&#34;:{&#34;state&#34;:&#34;Ready&#34;}}
</code></pre><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -X PUT <span style="color:#4e9a06">&#34;http://localhost:9358/metadata/label&#34;</span> -H <span style="color:#4e9a06">&#34;accept: application/json&#34;</span> -H <span style="color:#4e9a06">&#34;Content-Type: application/json&#34;</span> -d <span style="color:#4e9a06">&#34;{ \&#34;key\&#34;: \&#34;foo\&#34;, \&#34;value\&#34;: \&#34;bar\&#34;}&#34;</span>
</span></span><span style="display:flex;"><span>curl -GET <span style="color:#4e9a06">&#34;http://localhost:9358/gameserver&#34;</span> -H <span style="color:#4e9a06">&#34;accept: application/json&#34;</span>
</span></span></code></pre></div><pre tabindex="0"><code>{&#34;object_meta&#34;:{&#34;creation_timestamp&#34;:&#34;-62135596800&#34;,&#34;labels&#34;:{&#34;agones.dev/sdk-foo&#34;:&#34;bar&#34;}},&#34;spec&#34;:{&#34;health&#34;:{}},&#34;status&#34;:{&#34;state&#34;:&#34;Ready&#34;}}
</code></pre><h2 id="running-local-mode-in-a-container">Running Local Mode in a Container</h2>
<p>Once you have your game server process in a container, you may also want to test the container build locally as well.</p>
<p>Since the production agones-sdk binary has the <code>--local</code> mode built in, you can also use the production container image
locally as well!</p>
<p>Since the SDK and your game server container need to share a port on <code>localhost</code>, one of the easiest ways to do that
is to have them both run using the host network, like so:</p>
<p>In one shell run:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>docker run --network<span style="color:#ce5c00;font-weight:bold">=</span>host --rm us-docker.pkg.dev/agones-images/release/agones-sdk:1.38.0 --local
</span></span></code></pre></div><p>You should see a similar output to what you would if you were running the binary directly, i.e. outside a container.</p>
<p>Then in another shell, start your game server container:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>docker run --network<span style="color:#ce5c00;font-weight:bold">=</span>host --rm &lt;your image here&gt;
</span></span></code></pre></div><p>If you want to <a href="/docs/guides/client-sdks/local/#providing-your-own-gameserver-configuration-for-local-development">mount a custom <code>gameserver.yaml</code></a>,
this is also possible:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>wget https://raw.githubusercontent.com/googleforgames/agones/release-1.38.0/examples/simple-game-server/gameserver.yaml
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># required so that the `agones` user in the container can read the file</span>
</span></span><span style="display:flex;"><span>chmod o+r gameserver.yaml
</span></span><span style="display:flex;"><span>docker run --network<span style="color:#ce5c00;font-weight:bold">=</span>host --rm -v <span style="color:#204a87;font-weight:bold">$(</span><span style="color:#204a87">pwd</span><span style="color:#204a87;font-weight:bold">)</span>/gameserver.yaml:/tmp/gameserver.yaml us-docker.pkg.dev/agones-images/release/agones-sdk:1.38.0 --local -f /tmp/gameserver.yaml
</span></span></code></pre></div><p>If you run Docker on a OS that doesn&rsquo;t run Docker natively or in a VM, such as on Windows or macOS, you may want to to run the ClientSDK and your game server container together with <a href="https://docs.docker.com/compose/">Docker Compose</a>. To do so, create a <code>docker-compose.yaml</code> file setup with a network overlay shared between them:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">version</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;3&#39;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">services</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">gameserver</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">build</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">.</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># &lt;path to build context&gt;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">ports</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#4e9a06">&#34;127.0.0.1:7777:7777/udp&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">sdk-server</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">image</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;us-docker.pkg.dev/agones-images/release/agones-sdk:1.38.0&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">command</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>--<span style="color:#000">local -f /gs_config</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">network_mode</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">service:gameserver</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># &lt;shared network between sdk and game server&gt;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">configs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">gs_config</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">configs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">gs_config</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">file</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">./gameserver.yaml</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>Run <code>docker-compose</code></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>docker-compose up --build
</span></span></code></pre></div><h2 id="running-from-source-code-instead-of-prebuilt-binary">Running from source code instead of prebuilt binary</h2>
<p>If you wish to run from source rather than pre-built binaries, that is an available alternative.
You will need <a href="https://go.dev/doc/install">Go installed</a> and will need to clone the <a href="https://github.com/googleforgames/agones">Code Blind GitHub repo</a>.</p>
<p><strong>Disclaimer:</strong> Code Blind is run and tested with the version of Go specified by the <code>GO_VERSION</code> variable in the project&rsquo;s <a href="https://github.com/googleforgames/agones/blob/main/build/build-image/Dockerfile">build Dockerfile</a>. Other versions are not supported, but may still work.</p>
<p>Your cloned repository is best switched to the latest specific release&rsquo;s branch/tag. For example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>git clone https://github.com/googleforgames/agones.git
</span></span><span style="display:flex;"><span><span style="color:#204a87">cd</span> agones
</span></span><span style="display:flex;"><span>git checkout release-1.38.0
</span></span></code></pre></div><p>With Go installed and the Code Blind repository cloned, the SDK Server can be run with the following command (from the Code Blind clone directory):</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>go run cmd/sdk-server/main.go --local
</span></span></code></pre></div><p>Commandline flags (e.g. <code>--local</code>) are exactly the same as command line flags when utilising a pre-built binary.</p>
<h2 id="next-steps">Next Steps:</h2>
<ul>
<li>Learn how to connect your local development game server binary into a running Code Blind Kubernetes cluster for even more live development options with an <a href="https://codeblind.ai/docs/advanced/out-of-cluster-dev-server/">out of cluster dev server</a>.</li>
</ul>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-5e516fa2b9ffa121bddad09db5bc4c2c">5.4 - Windows Gameservers</h1>
    <div class="lead">Run <code>GameServers</code> on Kubernetes nodes with the Windows operating system.</div>
	

<div class="alert alert-warning" role="alert">
<h4 class="alert-heading">Warning</h4>

    Running <code>GameServers</code> on Windows nodes is currently Alpha, and any feedback
would be appreciated.

</div>

<h2 id="prerequisites">Prerequisites</h2>

<p>The following prerequisites are required to create a GameServer:</p>
<ol>
<li>A Kubernetes cluster with the UDP port range 7000-8000 open on each node.</li>
<li>Code Blind controller installed in the targeted cluster</li>
<li>kubectl properly configured</li>
<li>Netcat which is already installed on most Linux/macOS distributions, for windows you can use <a href="https://docs.microsoft.com/en-us/windows/wsl/install-win10">WSL</a>.</li>
</ol>
<p>If you don’t have a Kubernetes cluster you can follow <a href="/docs/installation/">these instructions</a> to create a cluster on Google Kubernetes Engine (GKE), Minikube or Azure Kubernetes Service (AKS), and install Code Blind.</p>
<p>For the purpose of this guide we’re going to use the
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/examples/simple-game-server/" target="_blank" data-proofer-ignore>simple-game-server</a>
 example as the GameServer container. This example is a very simple UDP server written in Go. Don’t hesitate to look at the code of this example for more information.</p>


<p>Ensure that you have some nodes to your cluster that are running Windows.</p>
<h2 id="objectives">Objectives</h2>
<ul>
<li>Create a GameServer on a Windows node.</li>
<li>Connect to the GameServer.</li>
</ul>
<h3 id="1-create-a-gameserver">1. Create a GameServer</h3>


<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Note</h4>

    Starting with version 0.3, the
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>simple-game-server</a> example is compiled as a multi-arch docker image that will run on both Linux and Windows. To ensure that the game server runs on a Windows node, a nodeSelector of <code>&quot;kubernetes.io/os&quot;: windows</code> must be added to the game server specification.

</div>

<p>Create a GameServer using the following command:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl create -f https://raw.githubusercontent.com/googleforgames/agones/release-1.38.0/examples/simple-game-server/gameserver-windows.yaml
</span></span></code></pre></div><p>You should see a successful output similar to this:</p>
<pre tabindex="0"><code>gameserver.agones.dev/simple-game-server-4ss4j created
</code></pre><p>Verify that the GameServer becomes Ready by running:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl get gameservers
</span></span></code></pre></div><p>It should look something like this:</p>
<pre tabindex="0"><code>NAME                       STATE     ADDRESS       PORT   NODE     AGE
simple-game-server-7pjrq   Ready   35.233.183.43   7190   agones   3m
</code></pre><p>Take a note of the Game Server IP address and ports.</p>
<p>For the full details of the YAML file head to the <a href="https://codeblind.ai/docs/reference/gameserver/">GameServer Specification Guide</a></p>
<h3 id="2-connect-to-the-gameserver">2. Connect to the GameServer</h3>


<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Note</h4>

    If you have Code Blind installed on Google Kubernetes Engine, and are using
Cloud Shell for your terminal, UDP is blocked. For this step, we recommend
SSH&rsquo;ing into a running VM in your project, such as a Kubernetes node.
You can click the &lsquo;SSH&rsquo; button on the <a href="https://console.cloud.google.com/compute/instances">Google Compute Engine Instances</a>
page to do this.
Run <code>toolbox</code> on GKE Node to run docker container with tools and then <code>nc</code> command would be available.

</div>

<p>You can now communicate with the Game Server:</p>


<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Note</h4>

    <p>If you do not have netcat installed
(i.e. you get a response of <code>nc: command not found</code>),
you can install netcat by running <code>sudo apt install netcat</code>.</p>
<p>If you are on Windows, you can alternatively install netcat on
<a href="https://docs.microsoft.com/en-us/windows/wsl/install-win10">WSL</a>,
or download a version of netcat for Windows from <a href="https://nmap.org/ncat/">nmap.org</a>.</p>


</div>

<pre tabindex="0"><code>nc -u {IP} {PORT}
Hello World !
ACK: Hello World !
EXIT
</code></pre><p>You can finally type <code>EXIT</code> which tells the SDK to run the <a href="https://codeblind.ai/docs/guides/client-sdks/#shutdown">Shutdown command</a>, and therefore shuts down the <code>GameServer</code>.</p>
<p>If you run <code>kubectl describe gameserver</code> again - either the GameServer will be gone completely, or it will be in <code>Shutdown</code> state, on the way to being deleted.</p>
<h2 id="next-steps">Next Steps</h2>
<ul>
<li>Make a local copy of the simple-game-server 
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>fleet configuration</a>,
modify it to include a node selector, and use it to go through the <a href="https://codeblind.ai/docs/getting-started/create-fleet/">Quickstart: Create a Game Server Fleet</a>.</li>
<li>If you want to use your own GameServer container make sure you have properly integrated the <a href="https://codeblind.ai/docs/guides/client-sdks/">Code Blind SDK</a>.</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-02f8cd51bf4cf97802ded5bc598c3392">5.5 - Fleet Updates</h1>
    <div class="lead">Common patterns and approaches for updating Fleets with newer and/or different versions of your <code>GameServer</code> configuration.</div>
	<h2 id="rolling-update-strategy">Rolling Update Strategy</h2>
<p>When Fleets are edited and updated, the default strategy of Code Blind is to roll the new version of the <code>GameServer</code>
out to the entire <code>Fleet</code>, in a step by step increment and decrement by adding a chunk of the new version and removing
a chunk of the current set of <code>GameServers</code>.</p>
<p>This is done while ensuring that <code>Allocated</code> <code>GameServers</code> are not deleted
until they are specifically shutdown through the game servers SDK, as they are expected to have players on them.</p>
<p>You can see this in the <code>Fleet.Spec.Strategy</code> <a href="https://codeblind.ai/docs/reference/fleet/">reference</a>, with controls for how
much of the <code>Fleet</code> is  incremented and decremented at one time:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">strategy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">RollingUpdate</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">rollingUpdate</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">maxSurge</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">25</span><span style="color:#000">%</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">maxUnavailable</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">25</span><span style="color:#000">%</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>So when a Fleet is edited (any field other than <code>replicas</code>, see note below), either through <code>kubectl</code> <code>edit</code>/<code>apply</code> or via the Kubernetes API, this performs the following operations:</p>
<ol>
<li>Adds the <code>maxSurge</code> number of <code>GameServers</code> to the Fleet.</li>
<li>Shutdown the <code>maxUnavailable</code> number of <code>GameServers</code> in the Fleet, skipping <code>Allocated</code> <code>GameServers</code>.</li>
<li>Repeat above steps until all the previous <code>GameServer</code> configurations have been <code>Shutdown</code> and deleted.</li>
</ol>
<p>By default, a Fleet will wait for new <code>GameSevers</code> to become <code>Ready</code> during a Rolling Update before continuing to shutdown additional <code>GameServers</code>, only counting <code>GameServers</code> that are <code>Ready</code> as being available when calculating the current <code>maxUnavailable</code> value which controls the rate at which <code>GameServers</code> are updated.
This ensures that a Fleet cannot accidentally have zero <code>GameServers</code> in the <code>Ready</code> state if something goes wrong during a Rolling Update or if <code>GameServers</code> have a long delay before moving to the <code>Ready</code> state.</p>


<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Note</h4>

    <p>When <code>Fleet</code> update contains only changes to the <code>replicas</code> parameter, then new GameServers will be created/deleted straight away,
which means in that case <code>maxSurge</code> and <code>maxUnavailable</code> parameters for a RollingUpdate will not be used.
The RollingUpdate strategy takes place when you update <code>spec</code> parameters other than <code>replicas</code>.</p>
<p>If you are using a Fleet which is scaled by a FleetAutoscaler, <a href="/docs/getting-started/create-fleetautoscaler/#7-change-autoscaling-parameters">read the Fleetautoscaler guide</a> for more details on how RollingUpdates with FleetAutoscalers need to be implemented.</p>
<p>You could also check the behaviour of the Fleet with a RollingUpdate strategy on a test <code>Fleet</code> to preview your upcoming updates.
Use <code>kubectl describe fleet</code> to track scaling events in a Fleet.</p>


</div>

<h2 id="recreate-strategy">Recreate Strategy</h2>
<p>This is an optimal <code>Fleet</code> update strategy if you want to replace all <code>GameServers</code> that are not <code>Allocated</code>
with a new version as quickly as possible.</p>
<p>You can see this in the <code>Fleet.Spec.Strategy</code> <a href="https://codeblind.ai/docs/reference/fleet/">reference</a>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">strategy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Recreate</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>So when a Fleet is edited, either through <code>kubectl</code> <code>edit</code>/<code>apply</code> or via the Kubernetes API, this performs the following operations:</p>
<ol>
<li><code>Shutdown</code> all <code>GameServers</code> in the Fleet that are not currently <code>Allocated</code>.</li>
<li>Create the same number of the new version of the <code>GameServers</code> that were previously deleted.</li>
<li>Repeat above steps until all the previous <code>GameServer</code> configurations have been <code>Shutdown</code> and deleted.</li>
</ol>
<h2 id="two-or-more-fleets-strategy">Two (or more) Fleets Strategy</h2>
<p>If you want very fine-grained control over the rate that new versions of a <code>GameServer</code> configuration is rolled out, or
if you want to do some version of A/B testing or smoke test between different versions, running two (or more) <code>Fleets</code> at the same time is a
good solution for this.</p>
<p>To do this, create a second <code>Fleet</code> inside your cluster, starting with zero replicas. From there you can scale this newer <code>Fleet</code>
up and the older <code>Fleet</code> down as required by your specific rollout strategy.</p>
<p>This also allows you to rollback if issues arise with the newer version, as you can delete the newer <code>Fleet</code>
and scale up the old Fleet to its previous levels, resulting in minimal impact to the players.</p>


<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Note</h4>

    For GameServerAllocation, you will need to have at least a single shared label between the <code>GameServers</code> in each
Fleet.

</div>

<h3 id="gameserverallocation-across-fleets">GameServerAllocation Across Fleets</h3>
<p>Since <code>GameServerAllocation</code> is powered by label selectors, it is possible to allocate across multiple fleets, and/or
give preference to particular sets of <code>GameServers</code> over others. You can see details of this in
the <code>GameServerAllocation</code> <a href="https://codeblind.ai/docs/reference/gameserverallocation/">reference</a>.</p>
<p>In a scenario where a new <code>v2</code> version of a <code>Fleet</code> is being slowly scaled up in a separate Fleet from the previous <code>v1</code>
Fleet, we can specify that we <code>prefer</code> allocation to occur from the <code>v2</code> Fleet, and if none are available, fallback to
the <code>v1</code> Fleet, like so:</p>

  
  
<ul class="nav nav-tabs" id="tabs-5" role="tablist">
  <li class="nav-item">
      <button class="nav-link active"
          id="tabs-05-00-tab" data-bs-toggle="tab" data-bs-target="#tabs-05-00" role="tab"
          data-td-tp-persist="yaml" aria-controls="tabs-05-00" aria-selected="true">
        selectors
      </button>
    </li><li class="nav-item">
      <button class="nav-link"
          id="tabs-05-01-tab" data-bs-toggle="tab" data-bs-target="#tabs-05-01" role="tab"
          aria-controls="tabs-05-01" aria-selected="false">
        required &amp; preferred (deprecated)
      </button>
    </li>
</ul>

<div class="tab-content" id="tabs-5-content">
    <div class="tab-pane fade show active"
        id="tabs-05-00" role="tabpanel" aria-labelled-by="tabs-05-00-tab" tabindex="5">
        <div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;allocation.agones.dev/v1&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">GameServerAllocation</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">selectors</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">matchLabels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">agones.dev/fleet</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">v2</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">matchLabels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">game</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">my-awesome-game</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span></span></span></code></pre></div>
    </div>
    <div class="tab-pane fade"
        id="tabs-05-01" role="tabpanel" aria-labelled-by="tabs-05-01-tab" tabindex="5">
        <div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;allocation.agones.dev/v1&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">GameServerAllocation</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># Deprecated, use field selectors instead.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">required</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">matchLabels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">game</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">my-awesome-game</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># Deprecated, use field selectors instead.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">preferred</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">matchLabels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">agones.dev/fleet</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">v2</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span></span></span></code></pre></div>
    </div>
</div>

<p>In this example, all <code>GameServers</code> have the label <code>game: my-awesome-game</code>, so the Allocation will search across both
Fleets through that mechanism. The <code>selectors</code> label matching selector tells the allocation system to first search
all <code>GameServers</code> with the <code>v2</code> <code>Fleet</code> label, and if not found, search through the rest of the set.</p>
<p>The above <code>GameServerAllocation</code> can then be used while you scale up the <code>v2</code> Fleet and scale down the original Fleet at
the rate that you deem fit for your specific rollout.</p>
<h2 id="notifying-gameservers-on-fleet-updatedownscale">Notifying GameServers on Fleet Update/Downscale</h2>

<div class="alert alert-warning" role="alert">
    <h4 class="alert-heading">Warning</h4>
    <p>The Allocated GameSever Overflow Notification feature is currently <strong><a href="https://codeblind.ai/docs/guides/feature-stages/#beta">Beta</a></strong>,
        and while it is enabled by default it may change in the future.</p>
    <p>Use the Feature Gate <code>FleetAllocationOverflow</code> to disable this feature.</p>
    <p>See the <a href="https://codeblind.ai/docs/guides/feature-stages/#feature-gates">Feature Gate documentation</a> for details on how to disable features.</p>
</div>

<p>When <code>Allocated</code> <code>GameServers</code> are utilised for a long time, such as a Lobby <code>GameServer</code>,
or a <code>GameServer</code> that is being reused multiple times in a row, it can be useful
to notify an <code>Allocated</code> <code>GameServer</code> process when its backing Fleet has been updated.
When an update occurs, the <code>Allocated</code> <code>GameServer</code>, may want to actively perform a graceful shutdown and release its
resources such that it can be replaced by a new version, or similar actions.</p>
<p>To do this, we provide the ability to apply a user-provided set of labels and/or annotations to the <code>Allocated</code>
<code>GameServers</code> when a <code>Fleet</code> update occurs that updates its <code>GameServer</code> template, or generally
causes the <code>Fleet</code> replica count to drop below the number of currently <code>Allocated</code> <code>GameServers</code>.</p>
<p>This provides two useful capabilities:</p>
<ol>
<li>The <code>GameServer</code> <a href="/docs/guides/client-sdks/#watchgameserverfunctiongameserver"><code>SDK.WatchGameServer()</code></a>
command can be utilised to react to this annotation and/or label change to
indicate the Fleet system change, and the game server binary could execute code accordingly.</li>
<li>This can also be used to proactively update <code>GameServer</code> labels, to effect change in allocation strategy - such as
preferring the newer <code>GameServers</code> when allocating, but falling back to the older version if there aren&rsquo;t enough
of the new ones yet spun up.</li>
</ol>
<p>The labels and/or annotations are applied to <code>GameServers</code> in a <code>Fleet</code> in the order designated by their configured <a href="https://codeblind.ai/docs/advanced/scheduling-and-autoscaling/#fleet-scheduling">Fleet scheduling</a>.</p>
<p>Example yaml configuration:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;agones.dev/v1&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Fleet</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">simple-game-server</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">replicas</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">allocationOverflow</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># This specifies which annotations and/or labels are applied</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">labels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">mykey</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">myvalue</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">version</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># empty an existing label value, so it&#39;s no longer in the allocation selection</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">annotations</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">event</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">overflow</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">template</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">ports</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">default</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">containerPort</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">7654</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">template</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">containers</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">simple-game-server</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">              </span><span style="color:#204a87;font-weight:bold">image</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">us-docker.pkg.dev/agones-images/examples/simple-game-server:0.27</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>See the <a href="/docs/reference/fleet/">Fleet reference</a> for more details.</p>
<!-- This is the only way I could get the alert to work in a feature code -->


<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Note</h4>

    This works the same across Fleet resizing and Rolling/Recreate Updates, in that the implementation responds to the
underlying <code>GameServerSet</code>&rsquo;s replicas being shrunk to a value smaller than the number of <code>Allocated</code>
<code>GameServers</code> it controls. Therefore, this functionality works equally well with a rolling update as it does with an
update strategy that requires at least two <code>Fleets</code>.

</div>


</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-92d27aa55ec2fc72cebf70399bffad86">5.6 - GameServer Health Checking</h1>
    <div class="lead">Health checking exists to track the overall healthy state of the GameServer,  such that action can be taken when a something goes wrong or a GameServer drops into an Unhealthy state</div>
	<h2 id="disabling-health-checking">Disabling Health Checking</h2>
<p>By default, health checking is enabled, but it can be turned off by setting the <code>spec.health.disabled</code> property to
true.</p>
<h2 id="sdk-api">SDK API</h2>
<p>The <code>Health()</code> function on the <a href="/docs/guides/client-sdks/">SDK object</a> needs to be called at an
interval less than the <code>spec.health.periodSeconds</code>
threshold time to be considered before it will be considered a <code>failure</code>.</p>
<p>The health check will also need to have not been called a consecutive number of times (<code>spec.health.failureThreshold</code>),
giving it a chance to heal if it there is an issue.</p>
<h2 id="health-failure-strategy">Health Failure Strategy</h2>
<p>The following is the process for what happens to a <code>GameServer</code> when it is unhealthy.</p>
<ol>
<li>If the <code>GameServer</code> container exits with an error before the <code>GameServer</code> moves to <code>Ready</code> then,
it is restarted as per the <code>restartPolicy</code> (which defaults to &ldquo;Always&rdquo;).</li>
<li>If the <code>GameServer</code> fails health checking at any point, then it doesn&rsquo;t restart,
but moves to an <code>Unhealthy</code> state.</li>
<li>If the <code>GameServer</code> container exits while in <code>Ready</code>, <code>Allocated</code> or <code>Reserved</code> state, it will be restarted
as per the <code>restartPolicy</code>  (which defaults to &ldquo;Always&rdquo;, since <code>RestartPolicy</code> is a <code>Pod</code> wide setting),
but will immediately move to an <code>Unhealthy</code> state.</li>
<li>If the SDK sidecar fails, then it will be restarted, assuming the <code>RestartPolicy</code> is Always/OnFailure.</li>
</ol>
<h2 id="fleet-management-of-unhealthy-gameservers">Fleet Management of Unhealthy GameServers</h2>
<p>If a <code>GameServer</code> moves into an <code>Unhealthy</code> state when it is not part of a Fleet, the <code>GameServer</code> will remain in the
Unhealthy state until explicitly deleted.  This is useful for debugging <code>Unhealthy</code> <code>GameServers</code>, or if you are
creating your own <code>GameServer</code> management layer, you can explicitly choose what to do if a <code>GameServer</code> becomes
<code>Unhealthy</code>.</p>
<p>If a <code>GameServer</code> is part of a <code>Fleet</code>, the <code>Fleet</code> management system will <em>delete</em> any <code>Unhealthy</code> <code>GameServers</code> and
immediately replace them with a brand new <code>GameServer</code> to ensure it has the configured number of Replicas.</p>
<h2 id="configuration-reference">Configuration Reference</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># Health checking for the running game server</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">health</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># Disable health checking. defaults to false, but can be set to true</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">disabled</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">false</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># Number of seconds after the container has started before health check is initiated. Defaults to 5 seconds</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">initialDelaySeconds</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">5</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># If the `Health()` function doesn&#39;t get called at least once every period (seconds), then</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># the game server is not healthy. Defaults to 5</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">periodSeconds</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">5</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># Minimum consecutive failures for the health probe to be considered failed after having succeeded.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># Defaults to 3. Minimum value is 1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">failureThreshold</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>See the 
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>full GameServer example</a> for more details</p>
<h2 id="example">Example</h2>
<h3 id="c">C++</h3>
<p>For a configuration that requires a health ping every 5 seconds, the example below sends a request every 2 seconds
to be sure that the GameServer is under the threshold.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">void</span> <span style="color:#000">doHealth</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">agones</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">SDK</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">sdk</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">while</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">true</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">!</span><span style="color:#000">sdk</span><span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">Health</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">std</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">cout</span> <span style="color:#ce5c00;font-weight:bold">&lt;&lt;</span> <span style="color:#4e9a06">&#34;Health ping failed&#34;</span> <span style="color:#ce5c00;font-weight:bold">&lt;&lt;</span> <span style="color:#000">std</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">endl</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span> <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">std</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">cout</span> <span style="color:#ce5c00;font-weight:bold">&lt;&lt;</span> <span style="color:#4e9a06">&#34;Health ping sent&#34;</span> <span style="color:#ce5c00;font-weight:bold">&lt;&lt;</span> <span style="color:#000">std</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">endl</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">std</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">this_thread</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">sleep_for</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">std</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">chrono</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">seconds</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">));</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">main</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">agones</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">SDK</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">sdk</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">agones</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">SDK</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">bool</span> <span style="color:#000">connected</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">sdk</span><span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">Connect</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">!</span><span style="color:#000">connected</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">std</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#204a87;font-weight:bold">thread</span> <span style="color:#000">health</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">doHealth</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">sdk</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">// ...  run the game server code
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h3 id="full-game-server">Full Game Server</h3>
<p>Also look in the 
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>examples</a> directory.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-a08db3b081cafbd3d70d9f298bfcb5a4">5.7 - Player Tracking</h1>
    <div class="lead">Track player connections, disconnections, counts and capacities through the Code Blind SDK</div>
	
<div class="alert alert-warning" role="alert">
    <h4 class="alert-heading">Warning</h4>
    <p>The Player Tracking feature is currently <strong><a href="https://codeblind.ai/docs/guides/feature-stages/#alpha">Alpha</a></strong>,
        not enabled by default, and may change in the future.</p>
<p>Use the FeatureGate  <code>PlayerTracking</code>
to enable and test this feature.</p>
    <p>See the <a href="https://codeblind.ai/docs/guides/feature-stages/#feature-gates">Feature Gate documentation</a> for details on how to enable features.</p>
</div>

<h2 id="managing-gameserver-capacities">Managing GameServer Capacities</h2>
<p>To track your <code>GameServer</code> current player capacity, Code Blind gives you the ability to both set an initial capacity at
<code>GameServer</code> creation, as well be able to change it during the lifecycle of the <code>GameServer</code> through the Code Blind SDK.</p>
<p>To set the initial capacity, you can do so via <code>GameServer.Spec.Players.InitialCapacity</code> like so:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;agones.dev/v1&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">GameServer</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;gs-example&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># ...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">players</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># set this GameServer&#39;s initial player capacity to 10</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">initialCapacity</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">10</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>From there, if you need to change the capacity of the GameSever as gameplay is in progress, you can also do so via
<a href="https://codeblind.ai/docs/guides/client-sdks/#alphasetplayercapacitycount"><code>SDK.Alpha().SetPlayerCapacity(count)</code></a></p>
<p>The current player capacity is represented in <code>GameServer.Status.Players.Capacity</code> resource value.</p>
<p>We can see this in action, when we look at the Status section of a GameServer resource
, wherein the capacity has been set to 20:</p>
<pre tabindex="0"><code>...
Status:
  Address:    14.81.195.72
  Node Name:  gke-test-cluster-default-6cd0ba67-1mps
  Players:
    Capacity:  20
    Count:     0
    Ids:       &lt;nil&gt;
  Ports:
    Name:          gameport
    Port:          7983
  Reserved Until:  &lt;nil&gt;
  State:           Ready
</code></pre><p>From the SDK, the game server binary can also retrieve the current player capacity
via <a href="https://codeblind.ai/docs/guides/client-sdks/#alphagetplayercapacity"><code>SDK.Alpha().GetPlayerCapacity()</code></a>.</p>


<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Note</h4>

    <p>Changing the capacity value here has no impact on players actually
connected to or trying to connect to your server, as that is not a responsibility of Code Blind.</p>
<p>This functionality is for tracking purposes only.</p>


</div>

<h2 id="connecting-and-disconnecting-players">Connecting and Disconnecting Players</h2>
<p>As players connect and disconnect from your game, the Player Tracking functions enable you to track which players
are currently connected.</p>
<p>It assumed that each player that connects has a unique token that identifies them as a player.</p>
<p>When a player connects to the game server binary,
calling <a href="https://codeblind.ai/docs/guides/client-sdks/#alphaplayerconnectplayerid"><code>SDK.Alpha().PlayerConnect(playerID)</code></a>
with the unique player token will register them as connected, and store their player id.</p>
<p>At disconnection time,
call <a href="https://codeblind.ai/docs/guides/client-sdks/#alphaplayerdisconnectplayerid"><code>SDK.Alpha().PlayerDisconnect(playerID)</code></a>
, which will deregister them and remove their player id from the list.</p>
<p>Each of these <code>playerIDs</code> is stored on <code>GameServer.Status.Players.IDs</code>, and the current count of connected players
can be seen in <code>GameServer.Status.Players.Count</code>.</p>
<p>You can see this in action below in the <code>GameServer</code> Status section, where there are 4 players connected:</p>
<pre tabindex="0"><code>...
Status:
  Address:    39.82.196.74
  Node Name:  gke-test-cluster-default-6cd0ba77-1mps
  Players:
    Capacity:  10
    Count:     4
    Ids:
      xy8a
      m0ux
      71nj
      lpq5
  Ports:
    Name:          gameport
    Port:          7166
  Reserved Until:  &lt;nil&gt;
  State:           Ready
</code></pre>

<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Note</h4>

    <p>Calling <code>PlayerConnect</code> or <code>PlayerDisconnect</code> functions will not
connect or disconnect players, as that is not under the control of Code Blind.</p>
<p>This functionality is for tracking purposes only.</p>


</div>

<h2 id="checking-player-data">Checking Player Data</h2>
<p>Not only is the connected player data stored on the <code>GameServer</code> resource, it is also stored in memory within the
SDK, so that it can be used from within the game server binary as a realtime, thread safe, registry of connected
players.</p>
<p>Therefore, if you want to:</p>
<ul>
<li>Get the current player count, call <a href="https://codeblind.ai/docs/guides/client-sdks/#alphagetplayercount"><code>SDK.Alpha().GetPlayerCount()</code></a></li>
<li>Check if a specific player is connected, call <a href="https://codeblind.ai/docs/guides/client-sdks/#alphaisplayerconnectedplayerid"><code>SDK.Alpha().IsPlayerConnected(playerID)</code></a></li>
<li>Retrieve the full list of connected players, call <a href="https://codeblind.ai/docs/guides/client-sdks/#alphagetconnectedplayers"><code>SDK.Alpha().GetConnectedPlayers()</code></a></li>
</ul>
<h2 id="next-steps">Next Steps</h2>
<ul>
<li>Review the <a href="https://codeblind.ai/docs/guides/client-sdks/#player-tracking">Player Tracking SDK Reference</a></li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-23757d70ae51993a62d84d8b6ff8f736">5.8 - Local Game Server</h1>
    <div class="lead">Register your local game server with Code Blind.</div>
	<p>You can register a local game server with Code Blind. This means you can run an experimental build of your game server in the Code Blind environment without the need of packaging and deploying it to a fleet. This allows you to quickly iterate on your game server code while still being able to plugin to your Code Blind environment.</p>
<h2 id="register-your-server-with-code-blind">Register your server with Code Blind</h2>
<p>To register your local game server you&rsquo;ll need to know the IP address of the machine running it and the port. With that you&rsquo;ll create a game server config like the one below.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;agones.dev/v1&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">GameServer</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">my-local-server</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">annotations</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># Causes Code Blind to register your local game server at 192.1.1.2, replace with your server&#39;s IP address.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">agones.dev/dev-address</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;192.1.1.2&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">ports</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">default</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">portPolicy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Static</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">hostPort</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">17654</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">containerPort</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">17654</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># The following is ignored but required due to validation.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">template</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">containers</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">simple-game-server</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">image</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">us-docker.pkg.dev/codeblind/examples/simple-server:0.27</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>Once you save this to a file make sure you have <code>kubectl</code> configured to point to your Code Blind cluster and then run <code>kubectl apply -f dev-gameserver.yaml</code>. This will register your server with Code Blind.</p>
<p>Local Game Servers has a few limitations:</p>
<ul>
<li>PortPolicy must be <code>Static</code>.</li>
<li>The game server is not managed by Code Blind. Features like autoscaling, replication, etc are not available.</li>
</ul>
<p>When you are finished working with your server, you can remove the registration with <code>kubectl delete -f dev-gameserver.yaml</code></p>
<h2 id="next-steps">Next Steps:</h2>
<ul>
<li>Review the specification of <a href="https://codeblind.ai/docs/reference/gameserver/">GameServer</a>.</li>
<li>Read about <code>GameServer</code> allocation.
<ul>
<li>Review the flow of how <a href="https://codeblind.ai/docs/integration-patterns/allocation-from-fleet/">allocation</a> is done.</li>
<li>Review the specification of <a href="https://codeblind.ai/docs/reference/gameserverallocation/">GameServerAllocation</a>.</li>
<li>Check out the <a href="https://codeblind.ai/docs/advanced/allocator-service/">Allocator Service</a> as a richer alternative to <code>GameServerAllocation</code>.</li>
</ul>
</li>
<li>Learn how to connect your local development game server binary into a running Code Blind Kubernetes cluster for even more live development options with an <a href="https://codeblind.ai/docs/advanced/out-of-cluster-dev-server/">out of cluster dev server</a>.</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-d09d57ab1b4977b31173571cab22eba4">5.9 - Latency Testing with Multiple Clusters</h1>
    <div class="lead">When running multiple Code Blind clusters around the world, you may need to have clients determine which cluster to connect to based on latency.</div>
	<p>To make latency testing easier, Code Blind installs with a simple ping service with both HTTP and UDP services that can be called
for the purpose of timing how long the roundtrip takes for information to be returned from either of these services.</p>
<h2 id="installing">Installing</h2>
<p>By default, Code Blind installs <a href="https://kubernetes.io/docs/concepts/services-networking/service/">Kubernetes Services</a> for
both HTTP and the UDP ping endpoints. These can be disabled entirely,
or disabled individually. See the <a href="https://codeblind.ai/docs/installation/install-agones/helm/">Helm install guide</a> for the parameters to
pass through,
as well as configuration options.</p>
<p>The ping services as all installed under the <code>agones-system</code> namespace.</p>
<h2 id="http-service">HTTP Service</h2>
<p>This exposes an endpoint that returns a simple text HTTP response on request to the root &ldquo;/&rdquo; path. By default this is <code>ok</code>, but
it can be configured via the <code>agones.ping.http.response</code> parameter.</p>
<p>This could be useful for providing clusters
with unique lookup names, such that clients are able to identify clusters from their responses.</p>
<p>To lookup the details of this service, run <code>kubectl describe service agones-ping-http-service --namespace=agones-system</code></p>
<h2 id="udp-service">UDP Service</h2>
<p>The UDP ping service is a rate limited UDP echo service that returns the udp packet that it receives to its designated
sender.</p>
<p>Since UDP sender details can be spoofed, this service is rate limited to 20 requests per second,
per sender address, per running instance (default is 2).</p>
<p>This rate limit can be raised or lowered via the Helm install parameter <code>agones.ping.udp.rateLimit</code>.</p>
<p>UDP packets are also limited to 1024 bytes in size.</p>
<p>To lookup the details of this service, run <code>kubectl describe service agones-ping-udp-service --namespace=agones-system</code></p>
<h2 id="client-side-tooling">Client side tooling</h2>
<p>We deliberately didn&rsquo;t provide any game client libraries, as all major languages and engines have capabilities
to send HTTP requests as well as UDP packets.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-9346aaa1ce9cead47412256db81fcfb4">5.10 - Metrics</h1>
    
	<p>Code Blind controller exposes metrics via <a href="https://opencensus.io/">OpenCensus</a>. OpenCensus is a single distribution of libraries that collect metrics and distributed traces from your services, we only use it for metrics but it will allow us to support multiple exporters in the future.</p>
<p>We choose to start with <a href="https://prometheus.io/">Prometheus</a> as this is the most popular with Kubernetes but it is also compatible with Cloud Monitoring.
If you need another exporter, check the <a href="https://opencensus.io/exporters/supported-exporters/go/">list of supported</a> exporters. It should be pretty straightforward to register a new one. (GitHub PRs are more than welcome.)</p>
<p>We plan to support multiple exporters in the future via environment variables and helm flags.</p>
<h2 id="backend-integrations">Backend integrations</h2>
<h3 id="prometheus">Prometheus</h3>
<p>If you are running a <a href="https://prometheus.io/">Prometheus</a> instance you just need to ensure that metrics and kubernetes service discovery are enabled. (helm chart values <code>agones.metrics.prometheusEnabled</code> and <code>agones.metrics.prometheusServiceDiscovery</code>). This will automatically add annotations required by Prometheus to discover Code Blind metrics and start collecting them. (see <a href="https://github.com/prometheus/prometheus/tree/main/documentation/examples/kubernetes-rabbitmq">example</a>)</p>
<p>If your Prometheus metrics collection agent requires that you scrape from the pods directly(such as with <a href="https://cloud.google.com/stackdriver/docs/managed-prometheus">Google Cloud Managed Prometheus</a>), then the metrics ports for the controller and allocator will both be named <code>http</code> and exposed on <code>8080</code>. In the case of the allocator, the port name and number can be overriden with the <code>agones.allocator.serviceMetrics.http.portName</code> and <code>agones.allocator.serviceMetrics.http.port</code> helm chart values.</p>
<h3 id="prometheus-operator">Prometheus Operator</h3>
<p>If you have <a href="https://github.com/coreos/prometheus-operator">Prometheus operator</a> installed in your cluster, just enable ServiceMonitor installation in values:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">agones</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">metrics</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">serviceMonitor</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">enabled</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h3 id="google-cloud-managed-service-for-prometheus">Google Cloud Managed Service for Prometheus</h3>
<p><a href="https://cloud.google.com/stackdriver/docs/managed-prometheus">Google Cloud Managed Service for Prometheus</a> is a fully managed multi-cloud solution for <a href="https://prometheus.io/">Prometheus</a>.
If you wish to use Managed Prometheus with Code Blind, follow the <a href="/docs/guides/metrics/#google-cloud-managed-service-for-prometheus-installation">Google Cloud Managed Service for Prometheus installation steps</a>.</p>
<h3 id="google-cloud-monitoring-formerly-stackdriver">Google Cloud Monitoring (formerly Stackdriver)</h3>
<p>We support the <a href="https://opencensus.io/exporters/supported-exporters/go/stackdriver/">OpenCensus Stackdriver exporter</a>.
In order to use it you should enable <a href="https://cloud.google.com/monitoring/api/enable-api">Cloud Monitoring API</a> in Google Cloud Console.
Follow the <a href="/docs/guides/metrics/#google-cloud-monitoring-installation">Google Cloud Monitoring installation steps</a> to see your metrics in Cloud Monitoring.</p>
<h2 id="metrics-available">Metrics available</h2>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>agones_gameservers_count</td>
<td>The number of gameservers per fleet and status</td>
<td>gauge</td>
</tr>
<tr>
<td>agones_gameserver_allocations_duration_seconds</td>
<td>The distribution of gameserver allocation requests latencies</td>
<td>histogram</td>
</tr>
<tr>
<td>agones_gameservers_total</td>
<td>The total of gameservers per fleet and status</td>
<td>counter</td>
</tr>
<tr>
<td>agones_gameserver_player_connected_total</td>
<td>The total number of players connected to gameservers (Only available when <a href="/docs/guides/player-tracking/">player tracking</a> is enabled)</td>
<td>gauge</td>
</tr>
<tr>
<td>agones_gameserver_player_capacity_total</td>
<td>The available capacity for players on gameservers (Only available when <a href="/docs/guides/player-tracking/">player tracking</a> is enabled)</td>
<td>gauge</td>
</tr>
<tr>
<td>agones_fleets_replicas_count</td>
<td>The number of replicas per fleet (total, desired, ready, reserved, allocated)</td>
<td>gauge</td>
</tr>
<tr>
<td>agones_fleet_autoscalers_able_to_scale</td>
<td>The fleet autoscaler can access the fleet to scale</td>
<td>gauge</td>
</tr>
<tr>
<td>agones_fleet_autoscalers_buffer_limits</td>
<td>The limits of buffer based fleet autoscalers (min, max)</td>
<td>gauge</td>
</tr>
<tr>
<td>agones_fleet_autoscalers_buffer_size</td>
<td>The buffer size of fleet autoscalers (count or percentage)</td>
<td>gauge</td>
</tr>
<tr>
<td>agones_fleet_autoscalers_current_replicas_count</td>
<td>The current replicas count as seen by autoscalers</td>
<td>gauge</td>
</tr>
<tr>
<td>agones_fleet_autoscalers_desired_replicas_count</td>
<td>The desired replicas count as seen by autoscalers</td>
<td>gauge</td>
</tr>
<tr>
<td>agones_fleet_autoscalers_limited</td>
<td>The fleet autoscaler is outside the limits set by MinReplicas and MaxReplicas.</td>
<td>gauge</td>
</tr>
<tr>
<td>agones_gameservers_node_count</td>
<td>The distribution of gameservers per node</td>
<td>histogram</td>
</tr>
<tr>
<td>agones_nodes_count</td>
<td>The count of nodes empty and with gameservers</td>
<td>gauge</td>
</tr>
<tr>
<td>agones_gameservers_state_duration</td>
<td>The distribution of gameserver state duration in seconds. Note: this metric could have some missing samples by design. Do not use the <code>_total</code> counter as the real value for state changes.</td>
<td>histogram</td>
</tr>
<tr>
<td>agones_k8s_client_http_request_total</td>
<td>The total of HTTP requests to the Kubernetes API by status code</td>
<td>counter</td>
</tr>
<tr>
<td>agones_k8s_client_http_request_duration_seconds</td>
<td>The distribution of HTTP requests latencies to the Kubernetes API by status code</td>
<td>histogram</td>
</tr>
<tr>
<td>agones_k8s_client_cache_list_total</td>
<td>The total number of list operations for client-go caches</td>
<td>counter</td>
</tr>
<tr>
<td>agones_k8s_client_cache_list_duration_seconds</td>
<td>Duration of a Kubernetes list API call in seconds</td>
<td>histogram</td>
</tr>
<tr>
<td>agones_k8s_client_cache_list_items</td>
<td>Count of items in a list from the Kubernetes API</td>
<td>histogram</td>
</tr>
<tr>
<td>agones_k8s_client_cache_watches_total</td>
<td>The total number of watch operations for client-go caches</td>
<td>counter</td>
</tr>
<tr>
<td>agones_k8s_client_cache_last_resource_version</td>
<td>Last resource version from the Kubernetes API</td>
<td>gauge</td>
</tr>
<tr>
<td>agones_k8s_client_workqueue_depth</td>
<td>Current depth of the work queue</td>
<td>gauge</td>
</tr>
<tr>
<td>agones_k8s_client_workqueue_latency_seconds</td>
<td>How long an item stays in the work queue</td>
<td>histogram</td>
</tr>
<tr>
<td>agones_k8s_client_workqueue_items_total</td>
<td>Total number of items added to the work queue</td>
<td>counter</td>
</tr>
<tr>
<td>agones_k8s_client_workqueue_work_duration_seconds</td>
<td>How long processing an item from the work queue takes</td>
<td>histogram</td>
</tr>
<tr>
<td>agones_k8s_client_workqueue_retries_total</td>
<td>Total number of items retried to the work queue</td>
<td>counter</td>
</tr>
<tr>
<td>agones_k8s_client_workqueue_longest_running_processor</td>
<td>How long the longest running workqueue processor has been running in microseconds</td>
<td>gauge</td>
</tr>
<tr>
<td>agones_k8s_client_workqueue_unfinished_work_seconds</td>
<td>How long unfinished work has been sitting in the workqueue in seconds</td>
<td>gauge</td>
</tr>
</tbody>
</table>
<h3 id="dropping-metric-labels">Dropping Metric Labels</h3>
<p>When a Fleet or FleetAutoscaler is deleted from the system, Code Blind will automatically clear metrics that utilise
their name as a label from the exported metrics, so the metrics exported do not continuously grow in size over the
lifecycle of the Code Blind installation.</p>
<h2 id="dashboard">Dashboard</h2>
<h3 id="grafana-dashboards">Grafana Dashboards</h3>
<p>We provide a set of useful <a href="https://grafana.com/">Grafana</a> dashboards to monitor Code Blind workload, they are located under the 
<a href="https://github.com/josephbarnett/codeblind.ai/blob/main/" target="_blank" data-proofer-ignore>grafana folder</a>:</p>
<ul>
<li>
<p>
<a href="https://github.com/josephbarnett/codeblind.ai/blob/main/" target="_blank" data-proofer-ignore>Code Blind Autoscalers</a> allows you to monitor your current autoscalers replicas request as well as fleet replicas allocation and readyness statuses. You can only select one autoscaler at the time using the provided dropdown.</p>
</li>
<li>
<p>
<a href="https://github.com/josephbarnett/codeblind.ai/blob/main/" target="_blank" data-proofer-ignore>Code Blind GameServers</a> displays your current game servers workload status (allocations, game servers statuses, fleets replicas) with optional fleet name filtering.</p>
</li>
<li>
<p>
<a href="https://github.com/josephbarnett/codeblind.ai/blob/main/" target="_blank" data-proofer-ignore>Code Blind GameServer Allocations</a> displays Code Blind gameservers allocations rates and counts per fleet.</p>
</li>
<li>
<p>
<a href="https://github.com/josephbarnett/codeblind.ai/blob/main/" target="_blank" data-proofer-ignore>Code Blind Allocator Resource</a> displays Code Blind Allocators CPU, memory usage and also some useful Golang runtime metrics.</p>
</li>
<li>
<p>
<a href="https://github.com/josephbarnett/codeblind.ai/blob/main/" target="_blank" data-proofer-ignore>Code Blind Status</a> displays Code Blind controller health status.</p>
</li>
<li>
<p>
<a href="https://github.com/josephbarnett/codeblind.ai/blob/main/" target="_blank" data-proofer-ignore>Code Blind Controller Resource Usage</a> displays Code Blind Controller CPU and memory usage and also some Golang runtime metrics.</p>
</li>
<li>
<p>
<a href="https://github.com/josephbarnett/codeblind.ai/blob/main/" target="_blank" data-proofer-ignore>Code Blind Controller go-client requests</a> displays Code Blind Controller Kubernetes API consumption.</p>
</li>
<li>
<p>
<a href="https://github.com/josephbarnett/codeblind.ai/blob/main/" target="_blank" data-proofer-ignore>Code Blind Controller go-client caches</a> displays Code Blind Controller Kubernetes Watches/Lists operations used.</p>
</li>
<li>
<p>
<a href="https://github.com/josephbarnett/codeblind.ai/blob/main/" target="_blank" data-proofer-ignore>Code Blind Controller go-client workqueues</a> displays Code Blind Controller workqueue processing time and rates.</p>
</li>
<li>
<p>
<a href="https://github.com/josephbarnett/codeblind.ai/blob/main/" target="_blank" data-proofer-ignore>Code Blind Controller API Server requests</a> displays your current API server request rate, errors rate and request latencies with optional CustomResourceDefinition filtering by Types: fleets, gameserversets, gameservers, gameserverallocations.</p>
</li>
</ul>
<p>Dashboard screenshots :</p>
<p><img alt="grafana dashboard autoscalers" src="../../../images/grafana-dashboard-autoscalers.png"></p>
<p><img alt="grafana dashboard controller" src="../../../images/grafana-dashboard-controller.png"></p>


<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Note</h4>

    You can import our dashboards by copying the json content from
<a href="https://github.com/josephbarnett/codeblind.ai/blob/main/" target="_blank" data-proofer-ignore>each config map</a> into your own instance of Grafana (+ &gt; Create &gt; Import &gt; Or paste json) or follow the <a href="/#installation">installation</a> guide.

</div>

<h2 id="installation">Installation</h2>
<p>When operating a live multiplayer game you will need to observe performances, resource usage and availability to learn more about your system. This guide will explain how you can setup Prometheus and Grafana into your own Kubernetes cluster to monitor your Code Blind workload.</p>
<p>Before attemping this guide you should make sure you have <a href="https://kubernetes.io/docs/tasks/tools/install-kubectl/">kubectl</a> and <a href="https://docs.helm.sh/using_helm/">helm</a> installed and configured to reach your kubernetes cluster.</p>
<h3 id="prometheus-installation">Prometheus installation</h3>
<p>Prometheus is an open source monitoring solution, we will use it to store Code Blind controller metrics and query back the data.</p>
<p>Let&rsquo;s install Prometheus using the <a href="https://prometheus-community.github.io/helm-charts/">Prometheus Community Kubernetes Helm Charts</a> repository.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
</span></span><span style="display:flex;"><span>helm repo update
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>helm upgrade --install --wait prom prometheus-community/prometheus --namespace metrics --create-namespace <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    --set server.global.scrape_interval<span style="color:#ce5c00;font-weight:bold">=</span>30s <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    --set server.persistentVolume.enabled<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    --set server.persistentVolume.size<span style="color:#ce5c00;font-weight:bold">=</span>64Gi <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    -f ./build/prometheus.yaml
</span></span></code></pre></div><p>For resiliency it is recommended to run Prometheus on a dedicated node which is separate from nodes where Game Servers
are scheduled. If you use the above command, with our 
<a href="https://github.com/josephbarnett/codeblind.ai/blob/main/" target="_blank" data-proofer-ignore>prometheus.yaml</a> to set up Prometheus, it will schedule Prometheus pods on nodes
tainted with <code>agones.dev/agones-metrics=true:NoExecute</code> and labeled with <code>agones.dev/agones-metrics=true</code> if available.</p>
<p>As an example, to set up a dedicated node pool for Prometheus on GKE, run the following command before installing Prometheus. Alternatively you can taint and label nodes manually.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcloud container node-pools create agones-metrics --cluster<span style="color:#ce5c00;font-weight:bold">=</span>... --zone<span style="color:#ce5c00;font-weight:bold">=</span>... <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --node-taints agones.dev/agones-metrics<span style="color:#ce5c00;font-weight:bold">=</span>true:NoExecute <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --node-labels agones.dev/agones-metrics<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --num-nodes<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --machine-type<span style="color:#ce5c00;font-weight:bold">=</span>e2-standard-4
</span></span></code></pre></div><p>By default we will disable the push gateway (we don&rsquo;t need it for Code Blind) and other exporters.</p>
<p>The helm chart supports
<a href="https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#nodeselector">nodeSelector</a>,
<a href="https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#affinity-and-anti-affinity">affinity</a> and <a href="https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/">toleration</a>, you can use them to schedule Prometheus deployments on an isolated node(s) to have an homogeneous game servers workload.</p>
<p>This will install a Prometheus Server in your current cluster with <a href="https://kubernetes.io/docs/concepts/storage/persistent-volumes/">Persistent Volume Claim</a> (Deactivated for Minikube and Kind) for storing and querying time series, it will automatically start collecting metrics from Code Blind Controller.</p>
<p>Finally, to access Prometheus metrics, rules and alerts explorer use</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl port-forward deployments/prom-prometheus-server <span style="color:#0000cf;font-weight:bold">9090</span> -n metrics
</span></span></code></pre></div><p>Now you can access the prometheus dashboard <a href="http://localhost:9090">http://localhost:9090</a>.</p>
<p>On the landing page you can start exploring metrics by creating <a href="https://prometheus.io/docs/prometheus/latest/querying/basics/">queries</a>. You can also verify what <a href="http://localhost:9090/targets">targets</a> Prometheus currently monitors (Header Status &gt; Targets), you should see Code Blind controller pod in the <code>kubernetes-pods</code> section.</p>


<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Note</h4>

    Metrics will be first registered when you will start using Code Blind.

</div>

<p>Now let&rsquo;s install some Grafana dashboards.</p>
<h3 id="grafana-installation">Grafana installation</h3>
<p>Grafana is a open source time series analytics platform which supports Prometheus data source. We can also easily import pre-built dashboards.</p>
<p>First we will install <a href="/docs/guides/metrics/#grafana-dashboards">Code Blind dashboard</a> as <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-pod-configmap/">config maps</a> in our cluster.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl apply -f ./build/grafana/
</span></span></code></pre></div><p>Now we can install the
<a href="https://grafana.github.io/helm-charts/">Grafana Community Kubernetes Helm Charts</a> from
their repository. (Replace <code>&lt;your-admin-password&gt;</code> with the admin password of your choice)</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>helm repo add grafana https://grafana.github.io/helm-charts
</span></span><span style="display:flex;"><span>helm repo update
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>helm upgrade --install --wait grafana grafana/grafana --namespace metrics <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --set <span style="color:#000">adminPassword</span><span style="color:#ce5c00;font-weight:bold">=</span>&lt;your-admin-password&gt; -f ./build/grafana.yaml
</span></span></code></pre></div><p>This will install Grafana with our prepopulated dashboards and prometheus datasource <a href="/docs/guides/metrics/#prometheus-installation">previously installed</a></p>
<p>Finally to access dashboards run</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl port-forward deployments/grafana <span style="color:#0000cf;font-weight:bold">3000</span> -n metrics
</span></span></code></pre></div><p>Open a web browser to <a href="http://localhost:3000">http://localhost:3000</a>, you should see Code Blind <a href="/docs/guides/metrics/#grafana-dashboards">dashboards</a> after login as admin.</p>
<h3 id="google-cloud-managed-service-for-prometheus-installation">Google Cloud Managed Service for Prometheus installation</h3>
<p>To collect Code Blind metrics using <a href="https://cloud.google.com/stackdriver/docs/managed-prometheus">Managed Prometheus</a>:</p>
<ul>
<li>
<p>Follow the instructions to enable managed collection for a <a href="https://cloud.google.com/stackdriver/docs/managed-prometheus/setup-managed#enable-mgdcoll-gke">GKE cluster</a> or <a href="https://cloud.google.com/stackdriver/docs/managed-prometheus/setup-managed#enable-mgdcoll-non-gke">non-GKE cluster</a>.</p>
</li>
<li>
<p>Configure Managed Prometheus to scrape Code Blind by creating a <code>PodMonitoring</code> resource:</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl apply -n agones-system -f https://raw.githubusercontent.com/googleforgames/agones/release-1.38.0/build/prometheus-google-managed.yaml
</span></span></code></pre></div><ul>
<li>Confirm that you can see <a href="https://cloud.google.com/monitoring/promql">Prometheus metrics in Cloud Monitoring</a>. If that&rsquo;s all you need, you can stop here.</li>
</ul>
<p>To install Grafana using a Managed Prometheus backend:</p>
<ul>
<li>Complete the <a href="https://cloud.google.com/stackdriver/docs/managed-prometheus/query#begin">Before you begin</a>. To align with the Code Blind <a href="/docs/guides/metrics/#grafana-installation">Grafana installation</a>, we&rsquo;ll be installing in the <code>metrics</code> namespace, which you&rsquo;ll need to create.
<ul>
<li>If your cluster has Workload Identity enabled, which is enabled on GKE Autopilot by default, follow <a href="https://cloud.google.com/stackdriver/docs/managed-prometheus/query#gmp-wli-svcacct">Configure a service account for Workload Identity</a> to ensure that you have appropriately authorized the default Kubernetes service account in the <code>metrics</code> namespace.</li>
</ul>
</li>
<li>Install the <a href="https://cloud.google.com/stackdriver/docs/managed-prometheus/query#ui-prometheus">Standalone Prometheus frontend UI</a> in the <code>metrics</code> namespace - this will act as your authentication proxy for PromQL queries.</li>
<li><a href="/docs/guides/metrics/#grafana-installation">Install Grafana as above</a>, using <code>-f ./build/grafana-frontend.yaml</code> instead of <code>-f ./build/grafana.yaml</code>.</li>
</ul>
<h3 id="google-cloud-monitoring-installation">Google Cloud Monitoring installation</h3>
<p>In order to use <a href="https://console.cloud.google.com/monitoring">Google Cloud Monitoring</a> you must <a href="https://cloud.google.com/monitoring/api/enable-api">enable the Monitoring API</a> in the Google Cloud Console. The Cloud Monitoring exporter uses a strategy called Application Default Credentials (ADC) to find your application&rsquo;s credentials. Details can be found in <a href="https://cloud.google.com/docs/authentication/production">Setting Up Authentication for Server to Server Production Applications</a>.</p>
<p>You need to grant all the necessary permissions to the users (see <a href="https://cloud.google.com/monitoring/access-control">Access Control Guide</a>). The predefined role Monitoring Metric Writer contains those permissions. Use the following command to assign the role to your default service account.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcloud projects add-iam-policy-binding <span style="color:#ce5c00;font-weight:bold">[</span>PROJECT_ID<span style="color:#ce5c00;font-weight:bold">]</span> --member serviceAccount:<span style="color:#ce5c00;font-weight:bold">[</span>PROJECT_NUMBER<span style="color:#ce5c00;font-weight:bold">]</span>-compute@developer.gserviceaccount.com --role roles/monitoring.metricWriter
</span></span></code></pre></div>

<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Note</h4>

    Cloud Operations for GKE (including Cloud Monitoring) is enabled by default on GKE clusters, however you can follow this <a href="https://cloud.google.com/stackdriver/docs/solutions/gke/installing#upgrade-instructions">guide</a> if it is currently disabled in your GKE cluster.

</div>

<p>Before proceeding, ensure you have created a metrics node pool as mentioned in the Google Cloud <a href="https://codeblind.ai/docs/installation/creating-cluster/gke/">installation guide</a>.</p>
<p>The default metrics exporter installed with Code Blind is Prometheus. If you are using the <a href="https://codeblind.ai/docs/installation/install-agones/helm/">Helm installation</a>, you can install or upgrade Code Blind to use Cloud Monitoring, using the following chart parameters:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>helm upgrade --install --wait --set agones.metrics.stackdriverEnabled<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> --set agones.metrics.prometheusEnabled<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">false</span> --set agones.metrics.prometheusServiceDiscovery<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">false</span> my-release-name agones/agones --namespace<span style="color:#ce5c00;font-weight:bold">=</span>agones-system
</span></span></code></pre></div>

<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Note</h4>

    If you are using the <a href="https://codeblind.ai/docs/installation/install-agones/yaml/">YAML installation</a>, follow the instructions on the page to change the above parameters by using helm to generate a custom YAML file locally.

</div>

<p>With this configuration only the Cloud Monitoring exporter would be used instead of Prometheus exporter.</p>
<h4 id="using-cloud-monitoring-with-workload-identity">Using Cloud Monitoring with Workload Identity</h4>
<p>If you would like to enable Cloud Monitoring in conjunction with <a href="https://cloud.google.com/kubernetes-engine/docs/how-to/workload-identity">Workload Identity</a>, there are a few extra steps you need to follow:</p>
<ol>
<li>
<p>When setting up the Google service account following the instructions for <a href="https://cloud.google.com/kubernetes-engine/docs/how-to/workload-identity#authenticating_to">Authenticating to Google Cloud</a>, create two IAM policy bindings, one for <code>serviceAccount:PROJECT_ID.svc.id.goog[agones-system/agones-controller]</code> and one for <code>serviceAccount:PROJECT_ID.svc.id.goog[agones-system/agones-allocator]</code>.</p>
</li>
<li>
<p>Pass parameters to helm when installing Code Blind to add annotations to the <code>agones-controller</code> and <code>agones-allocator</code> Kubernetes service accounts:</p>
</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>helm install my-release --namespace agones-system --create-namespace agones/agones --set agones.metrics.stackdriverEnabled<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> --set agones.metrics.prometheusEnabled<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">false</span> --set agones.metrics.prometheusServiceDiscovery<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">false</span> --set agones.serviceaccount.allocator.annotations.<span style="color:#4e9a06">&#34;iam\.gke\.io/gcp-service-account&#34;</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;GSA_NAME@PROJECT_ID\.iam\.gserviceaccount\.com&#34;</span> --set agones.serviceaccount.allocator.labels.<span style="color:#4e9a06">&#34;iam\.gke\.io/gcp-service-account&#34;</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;GSA_NAME@PROJECT_ID\.iam\.gserviceaccount\.com&#34;</span> --set agones.serviceaccount.controller.annotations.<span style="color:#4e9a06">&#34;iam\.gke\.io/gcp-service-account&#34;</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;GSA_NAME@PROJECT_ID\.iam\.gserviceaccount\.com&#34;</span>
</span></span></code></pre></div><p>To verify that metrics are being sent to Cloud Monitoring, create a Fleet or a Gameserver and look for the metrics to show up in the Cloud Monitoring dashboard. Navigate to the <a href="https://console.cloud.google.com/monitoring/metrics-explorer">Metrics explorer</a> and search for metrics with the prefix <code>agones/</code>. Select a metric and look for data to be plotted in the graph to the right.</p>
<p>An example of a custom dashboard is:</p>
<p><img alt="cloud monitoring dashboard" src="../../../images/stackdriver-metrics-dashboard.png"></p>
<p>Currently there exists only manual way of configuring Cloud Monitoring Dashboard. So it is up to you to set an Alignment Period (minimal is 1 minute), GroupBy, Filter parameters and other graph settings.</p>
<h4 id="troubleshooting">Troubleshooting</h4>
<p>If you can&rsquo;t see Code Blind metrics you should have a look at the controller logs for connection errors. Also ensure that your cluster has the necessary credentials to interact with Cloud Monitoring. You can configure <code>stackdriverProjectID</code> manually, if the automatic discovery is not working.</p>
<p>Permissions problem example from controller logs:</p>
<pre tabindex="0"><code>Failed to export to Stackdriver: rpc error: code = PermissionDenied desc = Permission monitoring.metricDescriptors.create denied (or the resource may not exist).
</code></pre><p>If you receive this error, ensure your service account has the role or corresponding permissions mentioned above.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-35cc8c47e6283062d03d8cced1728ff8">5.11 - Access Code Blind via the Kubernetes API</h1>
    <div class="lead">It&rsquo;s likely that we will want to programmatically interact with Code Blind. Everything that can be done via the <code>kubectl</code> and yaml configurations can also be done via the <a href="https://kubernetes.io/docs/concepts/overview/kubernetes-api/">Kubernetes API</a>.</div>
	<p>Installing Code Blind creates several <a href="https://kubernetes.io/docs/concepts/api-extension/custom-resources">Custom Resource Definitions (CRD)</a>,
which can be accessed and manipulated through the Kubernetes API.</p>
<p>The detailed list of Code Blind CRDs with their parameters could be found here - <a href="../../reference/agones_crd_api_reference/">Code Blind CRD API Reference</a>.</p>
<p>Kubernetes has multiple <a href="https://kubernetes.io/docs/reference/using-api/client-libraries/">client libraries</a>, however,
at time of writing, only
the <a href="https://github.com/kubernetes/client-go">Go</a> and
<a href="https://github.com/kubernetes-client/python/">Python</a> clients are documented to support accessing CRDs.</p>
<p>This can be found in the <a href="https://kubernetes.io/docs/concepts/api-extension/custom-resources/#accessing-a-custom-resource">Accessing a custom resource</a>
section of the Kubernetes documentation.</p>
<p>At this time, we recommend interacting with Code Blind through the Go client that has been generated in this repository,
but other methods may also work as well.</p>
<h2 id="go-client">Go Client</h2>
<p>Kubernetes Go Client tooling generates a Client for Code Blind that we can use to interact with the Code Blind
installation on our Kubernetes cluster.</p>
<ul>
<li><a href="https://pkg.go.dev/agones.dev/agones/pkg/client/clientset/versioned">Godoc for the Code Blind Client</a></li>
<li><a href="https://pkg.go.dev/k8s.io/client-go/kubernetes">Godoc for the standard Kubernetes Client</a></li>
</ul>
<h3 id="authentication">Authentication</h3>
<p>This client uses the same authentication mechanisms as the Kubernetes API.</p>
<p>If you plan to run your code in the same cluster as the Code Blind install, have a look at the
<a href="https://github.com/kubernetes/client-go/tree/master/examples/in-cluster-client-configuration">in cluster configuration</a>
example from the Kubernetes Client.</p>
<p>If you plan to run your code outside the Kubernetes cluster as your Code Blind install,
look at the <a href="https://github.com/kubernetes/client-go/tree/master/examples/out-of-cluster-client-configuration">out of cluster configuration</a>
example from the Kubernetes client.</p>
<h3 id="example">Example</h3>
<p>The following is an example of a in-cluster configuration, that creates a <code>Clientset</code> for Code Blind
and then creates a <code>GameServer</code>.</p>
<p>A full example code is available in the 
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore> example folder</a>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">package</span> <span style="color:#000">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>	<span style="color:#4e9a06">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#4e9a06">&#34;context&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">agonesv1</span> <span style="color:#4e9a06">&#34;agones.dev/agones/pkg/apis/agones/v1&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#4e9a06">&#34;agones.dev/agones/pkg/client/clientset/versioned&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#4e9a06">&#34;agones.dev/agones/pkg/util/runtime&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">corev1</span> <span style="color:#4e9a06">&#34;k8s.io/api/core/v1&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">metav1</span> <span style="color:#4e9a06">&#34;k8s.io/apimachinery/pkg/apis/meta/v1&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#4e9a06">&#34;k8s.io/client-go/kubernetes&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#4e9a06">&#34;k8s.io/client-go/rest&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">func</span> <span style="color:#000">main</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">config</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">err</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">rest</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">InClusterConfig</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">logger</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">runtime</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">NewLoggerWithSource</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;main&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">err</span> <span style="color:#ce5c00;font-weight:bold">!=</span> <span style="color:#204a87;font-weight:bold">nil</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">logger</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">WithError</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">err</span><span style="color:#000;font-weight:bold">).</span><span style="color:#000">Fatal</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Could not create in cluster config&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#8f5902;font-style:italic">// Access to standard Kubernetes resources through the Kubernetes Clientset
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>	<span style="color:#8f5902;font-style:italic">// We don&#39;t actually need this for this example, but it&#39;s just here for
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>	<span style="color:#8f5902;font-style:italic">// illustrative purposes
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>	<span style="color:#000">kubeClient</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">err</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">kubernetes</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">NewForConfig</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">config</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">err</span> <span style="color:#ce5c00;font-weight:bold">!=</span> <span style="color:#204a87;font-weight:bold">nil</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">logger</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">WithError</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">err</span><span style="color:#000;font-weight:bold">).</span><span style="color:#000">Fatal</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Could not create the kubernetes clientset&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#8f5902;font-style:italic">// Access to the Code Blind resources through the Code Blind Clientset
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>	<span style="color:#8f5902;font-style:italic">// Note that we reuse the same config as we used for the Kubernetes Clientset
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>	<span style="color:#000">agonesClient</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">err</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">versioned</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">NewForConfig</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">config</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">err</span> <span style="color:#ce5c00;font-weight:bold">!=</span> <span style="color:#204a87;font-weight:bold">nil</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">logger</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">WithError</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">err</span><span style="color:#000;font-weight:bold">).</span><span style="color:#000">Fatal</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Could not create the agones api clientset&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#8f5902;font-style:italic">// Create a GameServer
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>	<span style="color:#000">gs</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#ce5c00;font-weight:bold">&amp;</span><span style="color:#000">agonesv1</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">GameServer</span><span style="color:#000;font-weight:bold">{</span><span style="color:#000">ObjectMeta</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">metav1</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">ObjectMeta</span><span style="color:#000;font-weight:bold">{</span><span style="color:#000">GenerateName</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;simple-game-server&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">Namespace</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;default&#34;</span><span style="color:#000;font-weight:bold">},</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">Spec</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">agonesv1</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">GameServerSpec</span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">Container</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;simple-game-server&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">Ports</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[]</span><span style="color:#000">agonesv1</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">GameServerPort</span><span style="color:#000;font-weight:bold">{{</span>
</span></span><span style="display:flex;"><span>				<span style="color:#000">ContainerPort</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">7654</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>				<span style="color:#000">HostPort</span><span style="color:#000;font-weight:bold">:</span>      <span style="color:#0000cf;font-weight:bold">7654</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>				<span style="color:#000">Name</span><span style="color:#000;font-weight:bold">:</span>          <span style="color:#4e9a06">&#34;gameport&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>				<span style="color:#000">PortPolicy</span><span style="color:#000;font-weight:bold">:</span>    <span style="color:#000">agonesv1</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Static</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>				<span style="color:#000">Protocol</span><span style="color:#000;font-weight:bold">:</span>      <span style="color:#000">corev1</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">ProtocolUDP</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000;font-weight:bold">}},</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">Template</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">corev1</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">PodTemplateSpec</span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>				<span style="color:#000">Spec</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">corev1</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">PodSpec</span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>					<span style="color:#000">Containers</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[]</span><span style="color:#000">corev1</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Container</span><span style="color:#000;font-weight:bold">{{</span><span style="color:#000">Name</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;simple-game-server&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">Image</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;us-docker.pkg.dev/codeblind/examples/simple-server:0.27&#34;</span><span style="color:#000;font-weight:bold">}},</span>
</span></span><span style="display:flex;"><span>				<span style="color:#000;font-weight:bold">},</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000;font-weight:bold">},</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000;font-weight:bold">},</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">newGS</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">err</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">agonesClient</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">AgonesV1</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">GameServers</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;default&#34;</span><span style="color:#000;font-weight:bold">).</span><span style="color:#000">Create</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">context</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">TODO</span><span style="color:#000;font-weight:bold">(),</span> <span style="color:#000">gs</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">metav1</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">CreateOptions</span><span style="color:#000;font-weight:bold">{})</span>
</span></span><span style="display:flex;"><span>	<span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">err</span> <span style="color:#ce5c00;font-weight:bold">!=</span> <span style="color:#204a87;font-weight:bold">nil</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#204a87">panic</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">err</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">fmt</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Printf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;New game servers&#39; name is: %s&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">newGS</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">ObjectMeta</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Name</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>In order to create GS using provided example, you can run it as a Kubernetes Job:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl create -f https://raw.githubusercontent.com/googleforgames/agones/release-1.38.0/examples/crd-client/create-gs.yaml --namespace agones-system
</span></span><span style="display:flex;"><span>kubectl get pods --namespace agones-system
</span></span></code></pre></div><pre tabindex="0"><code>NAME                                 READY   STATUS      RESTARTS   AGE
create-gs-6wz86-7qsm5                0/1     Completed   0          6s
</code></pre><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl logs create-gs-6wz86-7qsm5  --namespace agones-system
</span></span></code></pre></div><pre tabindex="0"><code>{&#34;message&#34;:&#34;\u0026{0xc0001dde00 default}&#34;,&#34;severity&#34;:&#34;info&#34;,&#34;source&#34;:&#34;main&#34;,&#34;time&#34;:&#34;2020-04-21T11:14:00.477576428Z&#34;}
{&#34;message&#34;:&#34;New GameServer name is: helm-test-server-fxfgg&#34;,&#34;severity&#34;:&#34;info&#34;,&#34;time&#34;:&#34;2020-04-21T11:14:00.516024697Z&#34;}
</code></pre><p>You have just created a GameServer using Kubernetes Go Client.</p>
<h2 id="best-practice-using-informers-and-listers">Best Practice: Using Informers and Listers</h2>
<p>Almost all  Kubernetes&rsquo; controllers and custom controllers utilise <code>Informers</code> and <code>Listers</code>
to reduce the load on the Kubernetes&rsquo;s control plane.</p>
<p>Repetitive, direct access of the Kubernetes control plane API can significantly
reduce the performance of the cluster &ndash; and Informers and Listers help resolving that issue.</p>
<p>Informers and Listers reduce the load on the Kubernetes control plane
by creating, using and maintaining an eventually consistent an in-memory cache.
This can be watched and also queried with zero cost, since it will only read against
its in-memory model of the Kubernetes resources.</p>
<p>Informer&rsquo;s role and Lister&rsquo;s role are different.</p>
<p>An Informer is the mechanism for watching a Kubernetes object&rsquo;s event,
such that when a Kubernetes object changes(e.g. CREATE,UPDATE,DELETE), the Informer is informed,
and can execute a callback with the relevant object as an argument.</p>
<p>This can be very useful for building event based systems against the Kubernetes API.</p>
<p>A Lister is the mechanism for querying Kubernetes object&rsquo;s against the client side in-memory cache.
Since the Lister stores objects in an in-memory cache, queries against a come at practically no cost.</p>
<p>Of course, Code Blind itself also uses Informers and Listers in its codebase.</p>
<h3 id="example-1">Example</h3>
<p>The following is an example of Informers and Listers,
that show the GameServer&rsquo;s name &amp; status &amp; IPs in the Kubernetes cluster.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">package</span> <span style="color:#000">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>	<span style="color:#4e9a06">&#34;context&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#4e9a06">&#34;time&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#4e9a06">&#34;agones.dev/agones/pkg/client/clientset/versioned&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#4e9a06">&#34;agones.dev/agones/pkg/client/informers/externalversions&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#4e9a06">&#34;agones.dev/agones/pkg/util/runtime&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#4e9a06">&#34;k8s.io/apimachinery/pkg/labels&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#4e9a06">&#34;k8s.io/client-go/informers&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#4e9a06">&#34;k8s.io/client-go/kubernetes&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#4e9a06">&#34;k8s.io/client-go/tools/cache&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">func</span> <span style="color:#000">main</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">config</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">err</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">rest</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">InClusterConfig</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">logger</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">runtime</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">NewLoggerWithSource</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;main&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">err</span> <span style="color:#ce5c00;font-weight:bold">!=</span> <span style="color:#204a87;font-weight:bold">nil</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">logger</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">WithError</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">err</span><span style="color:#000;font-weight:bold">).</span><span style="color:#000">Fatal</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Could not create in cluster config&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">kubeClient</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">err</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">kubernetes</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">NewForConfig</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">config</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">agonesClient</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">err</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">versioned</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">NewForConfig</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">config</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">err</span> <span style="color:#ce5c00;font-weight:bold">!=</span> <span style="color:#204a87;font-weight:bold">nil</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">logger</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">WithError</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">err</span><span style="color:#000;font-weight:bold">).</span><span style="color:#000">Fatal</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Could not create the agones api clientset&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#8f5902;font-style:italic">// Create InformerFactory which create the informer
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>	<span style="color:#000">informerFactory</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">informers</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">NewSharedInformerFactory</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">kubeClient</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">time</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Second</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#0000cf;font-weight:bold">30</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">agonesInformerFactory</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">externalversions</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">NewSharedInformerFactory</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">agonesClient</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">time</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Second</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#0000cf;font-weight:bold">30</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#8f5902;font-style:italic">// Create Pod informer by informerFactory
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>	<span style="color:#000">podInformer</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">informerFactory</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Core</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">V1</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">Pods</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#8f5902;font-style:italic">// Create GameServer informer by informerFactory
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>	<span style="color:#000">gameServers</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">agonesInformerFactory</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Code</span> <span style="color:#000">Blind</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">V1</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">GameServers</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">gsInformer</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">gameServers</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Informer</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#8f5902;font-style:italic">// Add EventHandler to informer
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>	<span style="color:#8f5902;font-style:italic">// When the object&#39;s event happens, the function will be called
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>	<span style="color:#8f5902;font-style:italic">// For example, when the pod is added, &#39;AddFunc&#39; will be called and put out the &#34;Pod Added&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>	<span style="color:#000">podInformer</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Informer</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">AddEventHandler</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">cache</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">ResourceEventHandlerFuncs</span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">AddFunc</span><span style="color:#000;font-weight:bold">:</span>    <span style="color:#204a87;font-weight:bold">func</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">new</span> <span style="color:#204a87;font-weight:bold">interface</span><span style="color:#000;font-weight:bold">{})</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#000">logger</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Infof</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Pod Added&#34;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">},</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">UpdateFunc</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">func</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">old</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">new</span> <span style="color:#204a87;font-weight:bold">interface</span><span style="color:#000;font-weight:bold">{})</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#000">logger</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Infof</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Pod Updated&#34;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">},</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">DeleteFunc</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">func</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">old</span> <span style="color:#204a87;font-weight:bold">interface</span><span style="color:#000;font-weight:bold">{})</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#000">logger</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Infof</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Pod Deleted&#34;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">},</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000;font-weight:bold">})</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">gsInformer</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">AddEventHandler</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">cache</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">ResourceEventHandlerFuncs</span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">AddFunc</span><span style="color:#000;font-weight:bold">:</span>    <span style="color:#204a87;font-weight:bold">func</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">new</span> <span style="color:#204a87;font-weight:bold">interface</span><span style="color:#000;font-weight:bold">{})</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#000">logger</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Infof</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;GameServer Added&#34;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">},</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">UpdateFunc</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">func</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">old</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">new</span> <span style="color:#204a87;font-weight:bold">interface</span><span style="color:#000;font-weight:bold">{})</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#000">logger</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Infof</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;GameServer Updated&#34;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">},</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">DeleteFunc</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">func</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">old</span> <span style="color:#204a87;font-weight:bold">interface</span><span style="color:#000;font-weight:bold">{})</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#000">logger</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Infof</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;GameServer Deleted&#34;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">},</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000;font-weight:bold">})</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">ctx</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">context</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Background</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#8f5902;font-style:italic">// Start Go routines for informer
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>	<span style="color:#000">informerFactory</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Start</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">ctx</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Done</span><span style="color:#000;font-weight:bold">())</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">agonesInformerFactory</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Start</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">ctx</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Done</span><span style="color:#000;font-weight:bold">())</span>
</span></span><span style="display:flex;"><span>	<span style="color:#8f5902;font-style:italic">// Wait until finish caching with List API
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>	<span style="color:#000">informerFactory</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">WaitForCacheSync</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">ctx</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Done</span><span style="color:#000;font-weight:bold">())</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">agonesInformerFactory</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">WaitForCacheSync</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">ctx</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Done</span><span style="color:#000;font-weight:bold">())</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#8f5902;font-style:italic">// Create Lister which can list objects from the in-memory-cache
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>	<span style="color:#000">podLister</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">podInformer</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Lister</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">gsLister</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">gameServers</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Lister</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#8f5902;font-style:italic">// Get List objects of Pods from Pod Lister
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>		<span style="color:#000">p</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">podLister</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Pods</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;default&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>		<span style="color:#8f5902;font-style:italic">// Get List objects of GameServers from GameServer Lister
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>		<span style="color:#000">gs</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">err</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">gsLister</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">List</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">labels</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Everything</span><span style="color:#000;font-weight:bold">())</span>
</span></span><span style="display:flex;"><span>		<span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">err</span> <span style="color:#ce5c00;font-weight:bold">!=</span> <span style="color:#204a87;font-weight:bold">nil</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>			<span style="color:#204a87">panic</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">err</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>		<span style="color:#8f5902;font-style:italic">// Show GameServer&#39;s name &amp; status &amp; IPs
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>		<span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">_</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">g</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#204a87;font-weight:bold">range</span> <span style="color:#000">gs</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">a</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">err</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">p</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Get</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">g</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">GetName</span><span style="color:#000;font-weight:bold">())</span>
</span></span><span style="display:flex;"><span>			<span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">err</span> <span style="color:#ce5c00;font-weight:bold">!=</span> <span style="color:#204a87;font-weight:bold">nil</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>				<span style="color:#204a87">panic</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">err</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">logger</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Infof</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;------------------------------&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">logger</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Infof</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Name: %s&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">g</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">GetName</span><span style="color:#000;font-weight:bold">())</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">logger</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Infof</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Status: %s&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">g</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Status</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">State</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">logger</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Infof</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;External IP: %s&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">g</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Status</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Address</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">logger</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Infof</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Internal IP: %s&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">a</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Status</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">PodIP</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">time</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Sleep</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">time</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Second</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#0000cf;font-weight:bold">25</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>You can list GameServer&rsquo;s name and status and IPs using Kubernetes Informers and Listers.</p>
<h2 id="direct-access-to-the-rest-api-via-kubectl">Direct Access to the REST API via Kubectl</h2>
<p>If there isn&rsquo;t a client written in your preferred language, it is always possible to communicate
directly with Kubernetes API to interact with Code Blind.</p>
<p>The Kubernetes API can be authenticated and exposed locally through the
<a href="https://kubernetes.io/docs/tasks/extend-kubernetes/http-proxy-access-api/"><code>kubectl proxy</code></a></p>
<p>For example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl proxy <span style="color:#000;font-weight:bold">&amp;</span>
</span></span></code></pre></div><pre tabindex="0"><code>Starting to serve on 127.0.0.1:8001
</code></pre><h3 id="list-all-code-blind-endpoints">List all Code Blind endpoints</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl http://localhost:8001/apis <span style="color:#000;font-weight:bold">|</span> grep agones -A <span style="color:#0000cf;font-weight:bold">5</span> -B <span style="color:#0000cf;font-weight:bold">5</span>
</span></span></code></pre></div><pre tabindex="0"><code>{
    &#34;name&#34;: &#34;agones.dev&#34;,
    &#34;versions&#34;: [
    {
        &#34;groupVersion&#34;: &#34;agones.dev/v1&#34;,
        &#34;version&#34;: &#34;v1&#34;
    }
    ],
    &#34;preferredVersion&#34;: {
    &#34;groupVersion&#34;: &#34;agones.dev/v1&#34;,
    &#34;version&#34;: &#34;v1&#34;
    },
    &#34;serverAddressByClientCIDRs&#34;: null
}
</code></pre><h3 id="list-code-blind-resources">List Code Blind resources</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl http://localhost:8001/apis/agones.dev/v1
</span></span></code></pre></div><pre tabindex="0"><code>{
  &#34;kind&#34;: &#34;APIResourceList&#34;,
  &#34;apiVersion&#34;: &#34;v1&#34;,
  &#34;groupVersion&#34;: &#34;agones.dev/v1&#34;,
  &#34;resources&#34;: [
    {
      &#34;name&#34;: &#34;gameservers&#34;,
      &#34;singularName&#34;: &#34;gameserver&#34;,
      &#34;namespaced&#34;: true,
      &#34;kind&#34;: &#34;GameServer&#34;,
      &#34;verbs&#34;: [
        &#34;delete&#34;,
        &#34;deletecollection&#34;,
        &#34;get&#34;,
        &#34;list&#34;,
        &#34;patch&#34;,
        &#34;create&#34;,
        &#34;update&#34;,
        &#34;watch&#34;
      ],
      &#34;shortNames&#34;: [
        &#34;gs&#34;
      ]
    }
  ]
}
</code></pre><h3 id="list-all-gameservers-in-the-default-namespace">List all gameservers in the default namespace</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl http://localhost:8001/apis/agones.dev/v1/namespaces/default/gameservers
</span></span></code></pre></div><pre tabindex="0"><code>{
    &#34;apiVersion&#34;: &#34;agones.dev/v1&#34;,
    &#34;items&#34;: [
        {
            &#34;apiVersion&#34;: &#34;agones.dev/v1&#34;,
            &#34;kind&#34;: &#34;GameServer&#34;,
            &#34;metadata&#34;: {
                &#34;annotations&#34;: {
                    &#34;kubectl.kubernetes.io/last-applied-configuration&#34;: &#34;{\&#34;apiVersion\&#34;:\&#34;agones.dev/v1\&#34;,\&#34;kind\&#34;:\&#34;GameServer\&#34;,\&#34;metadata\&#34;:{\&#34;annotations\&#34;:{},\&#34;name\&#34;:\&#34;simple-game-server\&#34;,\&#34;namespace\&#34;:\&#34;default\&#34;},\&#34;spec\&#34;:{\&#34;containerPort\&#34;:7654,\&#34;hostPort\&#34;:7777,\&#34;portPolicy\&#34;:\&#34;static\&#34;,\&#34;template\&#34;:{\&#34;spec\&#34;:{\&#34;containers\&#34;:[{\&#34;image\&#34;:\&#34;us-docker.pkg.dev/codeblind/examples/simple-server:0.27\&#34;,\&#34;name\&#34;:\&#34;simple-game-server\&#34;}]}}}}\n&#34;
                },
                &#34;clusterName&#34;: &#34;&#34;,
                &#34;creationTimestamp&#34;: &#34;2018-03-02T21:41:05Z&#34;,
                &#34;finalizers&#34;: [
                    &#34;agones.dev&#34;
                ],
                &#34;generation&#34;: 0,
                &#34;name&#34;: &#34;simple-game-server&#34;,
                &#34;namespace&#34;: &#34;default&#34;,
                &#34;resourceVersion&#34;: &#34;760&#34;,
                &#34;selfLink&#34;: &#34;/apis/agones.dev/v1/namespaces/default/gameservers/simple-game-server&#34;,
                &#34;uid&#34;: &#34;692beea6-1e62-11e8-beb2-080027637781&#34;
            },
            &#34;spec&#34;: {
                &#34;PortPolicy&#34;: &#34;Static&#34;,
                &#34;container&#34;: &#34;simple-game-server&#34;,
                &#34;containerPort&#34;: 7654,
                &#34;health&#34;: {
                    &#34;failureThreshold&#34;: 3,
                    &#34;initialDelaySeconds&#34;: 5,
                    &#34;periodSeconds&#34;: 5
                },
                &#34;hostPort&#34;: 7777,
                &#34;protocol&#34;: &#34;UDP&#34;,
                &#34;template&#34;: {
                    &#34;metadata&#34;: {
                        &#34;creationTimestamp&#34;: null
                    },
                    &#34;spec&#34;: {
                        &#34;containers&#34;: [
                            {
                                &#34;image&#34;: &#34;us-docker.pkg.dev/codeblind/examples/simple-server:0.27&#34;,
                                &#34;name&#34;: &#34;simple-game-server&#34;,
                                &#34;resources&#34;: {}
                            }
                        ]
                    }
                }
            },
            &#34;status&#34;: {
                &#34;address&#34;: &#34;192.168.99.100&#34;,
                &#34;nodeName&#34;: &#34;agones&#34;,
                &#34;port&#34;: 7777,
                &#34;state&#34;: &#34;Ready&#34;
            }
        }
    ],
    &#34;kind&#34;: &#34;GameServerList&#34;,
    &#34;metadata&#34;: {
        &#34;continue&#34;: &#34;&#34;,
        &#34;resourceVersion&#34;: &#34;1062&#34;,
        &#34;selfLink&#34;: &#34;/apis/agones.dev/v1/namespaces/default/gameservers&#34;
    }
}
</code></pre><h3 id="allocate-a-gameserver-from-a-fleet-named-simple-game-server-with-gameserverallocation">Allocate a gameserver from a fleet named &lsquo;simple-game-server&rsquo;, with GameServerAllocation</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -d <span style="color:#4e9a06">&#39;{&#34;apiVersion&#34;:&#34;allocation.agones.dev/v1&#34;,&#34;kind&#34;:&#34;GameServerAllocation&#34;,&#34;spec&#34;:{&#34;required&#34;:{&#34;matchLabels&#34;:{&#34;agones.dev/fleet&#34;:&#34;simple-game-server&#34;}}}}&#39;</span> -H <span style="color:#4e9a06">&#34;Content-Type: application/json&#34;</span> -X POST http://localhost:8001/apis/allocation.agones.dev/v1/namespaces/default/gameserverallocations
</span></span></code></pre></div><pre tabindex="0"><code>{
    &#34;kind&#34;: &#34;GameServerAllocation&#34;,
    &#34;apiVersion&#34;: &#34;allocation.agones.dev/v1&#34;,
    &#34;metadata&#34;: {
        &#34;name&#34;: &#34;simple-game-server-v6jwb-cmdcv&#34;,
        &#34;namespace&#34;: &#34;default&#34;,
        &#34;creationTimestamp&#34;: &#34;2019-07-03T17:19:47Z&#34;
    },
    &#34;spec&#34;: {
        &#34;multiClusterSetting&#34;: {
            &#34;policySelector&#34;: {}
        },
        &#34;required&#34;: {
            &#34;matchLabels&#34;: {
                &#34;agones.dev/fleet&#34;: &#34;simple-game-server&#34;
            }
        },
        &#34;scheduling&#34;: &#34;Packed&#34;,
        &#34;metadata&#34;: {}
    },
    &#34;status&#34;: {
        &#34;state&#34;: &#34;Allocated&#34;,
        &#34;gameServerName&#34;: &#34;simple-game-server-v6jwb-cmdcv&#34;,
        &#34;ports&#34;: [
            {
                &#34;name&#34;: &#34;default&#34;,
                &#34;port&#34;: 7445
            }
        ],
        &#34;address&#34;: &#34;34.94.118.237&#34;,
        &#34;nodeName&#34;: &#34;gke-test-cluster-default-f11755a7-5km3&#34;
    }
}
</code></pre><p>You may wish to review the <a href="https://codeblind.ai/docs/reference/agones_crd_api_reference/">Code Blind Kubernetes API</a> for the full data structure reference.</p>
<p>The <a href="https://kubernetes.io/docs/reference/using-api/api-concepts/">Kubernetes API Concepts</a>
section may also provide the more details on the API conventions that are used in the Kubernetes API.</p>
<h2 id="next-steps">Next Steps</h2>
<ul>
<li>Learn how to use <a href="/docs/advanced/allocator-service/">Allocator Service</a> for single and multi-cluster Allocation.</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-48e070a0265c9a00bbcc2563e96ed22c">5.12 - Troubleshooting</h1>
    <div class="lead">Troubleshooting guides and steps.</div>
	<h2 id="something-went-wrong-with-my-gameserver">Something went wrong with my GameServer</h2>
<p>If there is something going wrong with your GameServer, there are a few approaches to determining the cause:</p>
<h3 id="run-with-the-local-sdk-server">Run with the local SDK server</h3>
<p>A good first step for seeing what may be going wrong is replicating the issue locally. To do this you can take
advantage of the Code Blind <a href="https://codeblind.ai/docs/guides/local-game-server/">local SDK server</a>
, with the following troubleshooting steps:</p>
<ol>
<li>Run your game server as a local binary against the local SDK server</li>
<li>Run your game server container against the local SDK server. It&rsquo;s worth noting that running with
<code>docker run --network=host ...</code> can be an easy way to allow your game server container(s) access to the local SDK
server)</li>
</ol>
<p>At each stage, keep an eye on the logs of your game server binary, and the local SDK server, and ensure there are no system
errors.</p>
<h3 id="run-as-a-gameserver-rather-than-a-fleet">Run as a <code>GameServer</code> rather than a <code>Fleet</code></h3>
<p>A <code>Fleet</code> will automatically replace any unhealthy <code>GameServer</code> under its control - which can make it hard to catch
all the details to determine the cause.</p>
<p>To work around this, instantiate a single instance of your game server as a<br>
<a href="https://codeblind.ai/docs/reference/gameserver/">GameServer</a> within your Code Blind cluster.</p>
<p>This <code>GameServer</code> will not be replaced if it moves to an Unhealthy state, giving you time to introspect what is
going wrong.</p>
<h3 id="introspect-with-kubernetes-tooling">Introspect with Kubernetes tooling</h3>
<p>There are many Kubernetes tools that will help with determining where things have potentially gone wrong for your
game server. Here are a few you may want to try.</p>
<h4 id="kubectl-describe">kubectl describe</h4>
<p>Depending on what is happening, you may want to run <code>kubectl describe &lt;gameserver name&gt;</code> to view the events
that are associated with that particular <code>GameServer</code> resource. This can give you insight into the lifecycle of the
<code>GameServer</code> and if anything has gone wrong.</p>
<p>For example, here we can see where the simple-game-server example has been moved to the <code>Unhealthy</code> state
due to a crash in the backing <code>GameServer</code> Pod container&rsquo;s binary.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl describe gs simple-game-server-zqppv
</span></span></code></pre></div><pre tabindex="0"><code>Name:         simple-game-server-zqppv
Namespace:    default
Labels:       &lt;none&gt;
Annotations:  agones.dev/sdk-version: 1.0.0-dce1546
API Version:  agones.dev/v1
Kind:         GameServer
Metadata:
  Creation Timestamp:  2019-08-16T21:25:44Z
  Finalizers:
    agones.dev
  Generate Name:     simple-game-server-
  Generation:        1
  Resource Version:  1378575
  Self Link:         /apis/agones.dev/v1/namespaces/default/gameservers/simple-game-server-zqppv
  UID:               6818adc7-c06c-11e9-8dbd-42010a8a0109
Spec:
  Container:  simple-game-server
  Health:
    Failure Threshold:      3
    Initial Delay Seconds:  5
    Period Seconds:         5
  Ports:
    Container Port:  7654
    Host Port:       7058
    Name:            default
    Port Policy:     Dynamic
    Protocol:        UDP
  Scheduling:        Packed
  Template:
    Metadata:
      Creation Timestamp:  &lt;nil&gt;
    Spec:
      Containers:
        Image:  us-docker.pkg.dev/codeblind/examples/simple-server:0.27
        Name:   simple-game-server
        Resources:
          Limits:
            Cpu:     20m
            Memory:  32Mi
          Requests:
            Cpu:     20m
            Memory:  32Mi
Status:
  Address:    35.230.59.117
  Node Name:  gke-test-cluster-default-590db5e4-4s6r
  Ports:
    Name:          default
    Port:          7058
  Reserved Until:  &lt;nil&gt;
  State:           Unhealthy
Events:
  Type     Reason          Age   From                   Message
  ----     ------          ----  ----                   -------
  Normal   PortAllocation  72s   gameserver-controller  Port allocated
  Normal   Creating        72s   gameserver-controller  Pod simple-game-server-zqppv created
  Normal   Scheduled       72s   gameserver-controller  Address and port populated
  Normal   RequestReady    67s   gameserver-sidecar     SDK state change
  Normal   Ready           66s   gameserver-controller  SDK.Ready() complete
  Warning  Unhealthy       34s   health-controller      Issue with Gameserver pod
</code></pre><p>The backing Pod has the same name as the <code>GameServer</code> - so it&rsquo;s also worth looking at the
details and events for the Pod to see if there are any issues there, such as restarts due to binary crashes etc.</p>
<p>For example, you can see the restart count on the us-docker.pkg.dev/codeblind/examples/simple-server:0.27 container
is set to <code>1</code>, due to the game server binary crash</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl describe pod simple-game-server-zqppv
</span></span></code></pre></div><pre tabindex="0"><code>Name:               simple-game-server-zqppv
Namespace:          default
Priority:           0
PriorityClassName:  &lt;none&gt;
Node:               gke-test-cluster-default-590db5e4-4s6r/10.138.0.23
Start Time:         Fri, 16 Aug 2019 21:25:44 +0000
Labels:             agones.dev/gameserver=simple-game-server-zqppv
                    agones.dev/role=gameserver
Annotations:        agones.dev/container: simple-game-server
                    agones.dev/sdk-version: 1.0.0-dce1546
                    cluster-autoscaler.kubernetes.io/safe-to-evict: false
Status:             Running
IP:                 10.48.1.80
Controlled By:      GameServer/simple-game-server-zqppv
Containers:
  simple-game-server:
    Container ID:   docker://69eacd03cc89b0636b78abe47926b02183ba84d18fa20649ca443f5232511661
    Image:          us-docker.pkg.dev/codeblind/examples/simple-server:0.27
    Image ID:       docker-pullable://gcr.io/agones-images/simple-game-server@sha256:6a60eff5e68b88b5ce75ae98082d79cff36cda411a090f3495760e5c3b6c3575
    Port:           7654/UDP
    Host Port:      7058/UDP
    State:          Running
      Started:      Fri, 16 Aug 2019 21:26:22 +0000
    Last State:     Terminated
      Reason:       Completed
      Exit Code:    0
      Started:      Fri, 16 Aug 2019 21:25:45 +0000
      Finished:     Fri, 16 Aug 2019 21:26:22 +0000
    Ready:          True
    Restart Count:  1
    Limits:
      cpu:     20m
      memory:  32Mi
    Requests:
      cpu:        20m
      memory:     32Mi
    Liveness:     http-get http://:8080/gshealthz delay=5s timeout=1s period=5s #success=1 #failure=3
    Environment:  &lt;none&gt;
    Mounts:
      /var/run/secrets/kubernetes.io/serviceaccount from empty (ro)
  agones-gameserver-sidecar:
    Container ID:   docker://f3c475c34d26232e19b60be65b03bc6ce41931f4c37e00770d3ab4a36281d31c
    Image:          gcr.io/agones-mark/agones-sdk:1.0.0-dce1546
    Image ID:       docker-pullable://gcr.io/agones-mark/agones-sdk@sha256:4b5693e95ee3023a2b2e2099d102bb6bac58d4ce0ac472e58a09cee6d160cd19
    Port:           &lt;none&gt;
    Host Port:      &lt;none&gt;
    State:          Running
      Started:      Fri, 16 Aug 2019 21:25:48 +0000
    Ready:          True
    Restart Count:  0
    Requests:
      cpu:     30m
    Liveness:  http-get http://:8080/healthz delay=3s timeout=1s period=3s #success=1 #failure=3
    Environment:
      GAMESERVER_NAME:  simple-game-server-zqppv
      POD_NAMESPACE:    default (v1:metadata.namespace)
    Mounts:
      /var/run/secrets/kubernetes.io/serviceaccount from agones-sdk-token-vr6qq (ro)
Conditions:
  Type              Status
  Initialized       True
  Ready             True
  ContainersReady   True
  PodScheduled      True
Volumes:
  empty:
    Type:    EmptyDir (a temporary directory that shares a pod&#39;s lifetime)
    Medium:
  agones-sdk-token-vr6qq:
    Type:        Secret (a volume populated by a Secret)
    SecretName:  agones-sdk-token-vr6qq
    Optional:    false
QoS Class:       Burstable
Node-Selectors:  &lt;none&gt;
Tolerations:     node.kubernetes.io/not-ready:NoExecute for 300s
                 node.kubernetes.io/unreachable:NoExecute for 300s
Events:
  Type    Reason     Age                   From                                             Message
  ----    ------     ----                  ----                                             -------
  Normal  Scheduled  2m32s                 default-scheduler                                Successfully assigned default/simple-game-server-zqppv to gke-test-cluster-default-590db5e4-4s6r
  Normal  Pulling    2m31s                 kubelet, gke-test-cluster-default-590db5e4-4s6r  pulling image &#34;gcr.io/agones-mark/agones-sdk:1.0.0-dce1546&#34;
  Normal  Started    2m28s                 kubelet, gke-test-cluster-default-590db5e4-4s6r  Started container
  Normal  Pulled     2m28s                 kubelet, gke-test-cluster-default-590db5e4-4s6r  Successfully pulled image &#34;gcr.io/agones-mark/agones-sdk:1.0.0-dce1546&#34;
  Normal  Created    2m28s                 kubelet, gke-test-cluster-default-590db5e4-4s6r  Created container
  Normal  Created    114s (x2 over 2m31s)  kubelet, gke-test-cluster-default-590db5e4-4s6r  Created container
  Normal  Started    114s (x2 over 2m31s)  kubelet, gke-test-cluster-default-590db5e4-4s6r  Started container
  Normal  Pulled     114s (x2 over 2m31s)  kubelet, gke-test-cluster-default-590db5e4-4s6r  Container image &#34;us-docker.pkg.dev/codeblind/examples/simple-server:0.27&#34; already present on machine
</code></pre><p>Finally, you can also get the logs of your <code>GameServer</code> <code>Pod</code> as well via <code>kubectl logs &lt;pod name&gt; -c &lt;game server container name&gt;</code>, for example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl logs simple-game-server-zqppv -c simple-game-server
</span></span></code></pre></div><pre tabindex="0"><code>2019/08/16 21:26:23 Creating SDK instance
2019/08/16 21:26:24 Starting Health Ping
2019/08/16 21:26:24 Starting UDP server, listening on port 7654
2019/08/16 21:26:24 Marking this server as ready
</code></pre><p>The above commands will only give the most recent container&rsquo;s logs (so we won&rsquo;t get the previous crash), but
you can use <code>kubectl logs --previous=true simple-game-server-zqppv -c simple-game-server</code> to get the previous instance of the containers logs, or
use your Kubernetes platform of choice&rsquo;s logging aggregation tools to view the crash details.</p>
<h4 id="kubectl-events">kubectl events</h4>
<p>The &ldquo;Events&rdquo; section that is seen at the bottom of a <code>kubectl describe</code> is backed an actual <code>Event</code> record in
Kubernetes, which can be queried - and is general persistent for an hour after it is created.</p>
<p>Therefore, even a <code>GameServer</code> or <code>Pod</code> resource is no longer available in the system, its <code>Events</code> may well be.</p>
<p><code>kubectl get events</code> can be used to see all these events. This can also be grepped with the GameServer name to see
all events across both the <code>GameServer</code> and its backing <code>Pod</code>, like so:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl get events <span style="color:#000;font-weight:bold">|</span> grep simple-game-server-v992s-jwpx2
</span></span></code></pre></div><pre tabindex="0"><code>2m47s       Normal   PortAllocation          gameserver/simple-game-server-v992s-jwpx2   Port allocated
2m47s       Normal   Creating                gameserver/simple-game-server-v992s-jwpx2   Pod simple-game-server-v992s-jwpx2 created
2m47s       Normal   Scheduled               pod/simple-game-server-v992s-jwpx2          Successfully assigned default/simple-game-server-v992s-jwpx2 to gke-test-cluster-default-77e7f57d-j1mp
2m47s       Normal   Scheduled               gameserver/simple-game-server-v992s-jwpx2   Address and port populated
2m46s       Normal   Pulled                  pod/simple-game-server-v992s-jwpx2          Container image &#34;us-docker.pkg.dev/codeblind/examples/simple-server:0.27&#34; already present on machine
2m46s       Normal   Created                 pod/simple-game-server-v992s-jwpx2          Created container simple-game-server
2m45s       Normal   Started                 pod/simple-game-server-v992s-jwpx2          Started container simple-game-server
2m45s       Normal   Pulled                  pod/simple-game-server-v992s-jwpx2          Container image &#34;gcr.io/agones-images/agones-sdk:1.7.0&#34; already present on machine
2m45s       Normal   Created                 pod/simple-game-server-v992s-jwpx2          Created container agones-gameserver-sidecar
2m45s       Normal   Started                 pod/simple-game-server-v992s-jwpx2          Started container agones-gameserver-sidecar
2m45s       Normal   RequestReady            gameserver/simple-game-server-v992s-jwpx2   SDK state change
2m45s       Normal   Ready                   gameserver/simple-game-server-v992s-jwpx2   SDK.Ready() complete
2m47s       Normal   SuccessfulCreate        gameserverset/simple-game-server-v992s      Created gameserver: simple-game-server-v992s-jwpx2
</code></pre><h4 id="other-techniques">Other techniques</h4>
<p>For more tips and tricks, the <a href="https://kubernetes.io/docs/reference/kubectl/cheatsheet/#interacting-with-running-pods">Kubernetes Cheatsheet: Interactive with Pods</a>
also provides more troubleshooting techniques.</p>
<h2 id="how-do-i-see-the-logs-for-code-blind">How do I see the logs for Code Blind?</h2>
<p>If something is going wrong, and you want to see the logs for Code Blind, there are potentially two places you will want to
check:</p>
<ol>
<li>The controller: assuming you installed Code Blind in the <code>agones-system</code> namespace, you will find that there
is a single pod called <code>agones-controller-&lt;hash&gt;</code> (where hash is the unique code that Kubernetes generates)
that exists there, that you can get the logs from. This is the main
controller for Code Blind, and should be the first place to check when things go wrong.
<ol>
<li>To get the logs from this controller run:<br>
<code>kubectl logs --namespace=agones-system agones-controller-&lt;hash&gt;</code></li>
</ol>
</li>
<li>The SDK server sidecar: Code Blind runs a small <a href="https://grpc.io/">gRPC</a> + http server for the SDK in a container in the
same network namespace as the game server container to connect to via the SDK.<br>
The logs from this SDK server are also useful for tracking down issues, especially if you are having trouble with a
particular <code>GameServer</code>.
<ol>
<li>To find the <code>Pod</code> for the <code>GameServer</code> look for the pod with a name that is prefixed with the name of the
owning <code>GameServer</code>. For example if you have a <code>GameServer</code> named <code>simple-game-server</code>, it&rsquo;s pod could potentially be named
<code>simple-game-server-dnbwj</code>.</li>
<li>To get the logs from that <code>Pod</code>, we need to specify that we want the logs from the <code>agones-gameserver-sidecar</code>
container. To do that, run the following:<br>
<code>kubectl logs simple-game-server-dnbwj -c agones-gameserver-sidecar</code></li>
</ol>
</li>
</ol>
<p>Code Blind uses JSON structured logging, therefore errors will be visible through the <code>&quot;severity&quot;:&quot;info&quot;</code> key and value.</p>
<h3 id="enable-debug-level-logging-for-the-sdk-server">Enable Debug Level Logging for the SDK Server</h3>
<p>By default, the SDK Server binary is set to an <code>Info</code> level of logging.</p>
<p>You can use the <code>sdkServer.logLevel</code> to increase this to <code>Debug</code> levels, and see extra information about what is
happening with the SDK Server that runs alonside your game server container(s).</p>
<p>See the <a href="https://codeblind.ai/docs/reference/gameserver/">GameServer reference</a> for configuration details.</p>
<h3 id="enable-debug-level-logging-for-the-code-blind-controller">Enable Debug Level Logging for the Code Blind Controller</h3>
<p>By default, the log level for the Code Blind controller is &ldquo;info&rdquo;. To get a more verbose log output, switch this to &ldquo;debug&rdquo;
via the <code>agones.controller.logLevel</code>
<a href="https://codeblind.ai/docs/installation/install-agones/helm/#configuration">Helm Configuration parameters</a>
at installation.</p>
<h2 id="the-feature-flag-i-enableddisabled-isnt-working-as-expected">The Feature Flag I enabled/disabled isn&rsquo;t working as expected</h2>
<p>It&rsquo;s entirely possible that Alpha features may still have bugs in them (They are <em>alpha</em> after all 😃), but the first
thing to check is what the actual <a href="/docs/guides/feature-stages/#feature-gates">Feature Flags</a> states
were passed to Code Blind are, and that they were set correctly.</p>
<p>The easiest way is to check the top <code>info</code> level log lines from the Code Blind controller.</p>
<p>For example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl logs -n agones-system agones-controller-7575dc59-7p2rg  <span style="color:#000;font-weight:bold">|</span> head
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{</span><span style="color:#4e9a06">&#34;filename&#34;</span>:<span style="color:#4e9a06">&#34;/home/agones/logs/agones-controller-20220615_211540.log&#34;</span>,<span style="color:#4e9a06">&#34;message&#34;</span>:<span style="color:#4e9a06">&#34;logging to file&#34;</span>,<span style="color:#4e9a06">&#34;numbackups&#34;</span>:99,<span style="color:#4e9a06">&#34;severity&#34;</span>:<span style="color:#4e9a06">&#34;info&#34;</span>,<span style="color:#4e9a06">&#34;source&#34;</span>:<span style="color:#4e9a06">&#34;main&#34;</span>,<span style="color:#4e9a06">&#34;time&#34;</span>:<span style="color:#4e9a06">&#34;2022-06-15T21:15:40.309349789Z&#34;</span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{</span><span style="color:#4e9a06">&#34;logLevel&#34;</span>:<span style="color:#4e9a06">&#34;info&#34;</span>,<span style="color:#4e9a06">&#34;message&#34;</span>:<span style="color:#4e9a06">&#34;Setting LogLevel configuration&#34;</span>,<span style="color:#4e9a06">&#34;severity&#34;</span>:<span style="color:#4e9a06">&#34;info&#34;</span>,<span style="color:#4e9a06">&#34;source&#34;</span>:<span style="color:#4e9a06">&#34;main&#34;</span>,<span style="color:#4e9a06">&#34;time&#34;</span>:<span style="color:#4e9a06">&#34;2022-06-15T21:15:40.309403296Z&#34;</span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{</span><span style="color:#4e9a06">&#34;ctlConf&#34;</span>:<span style="color:#ce5c00;font-weight:bold">{</span><span style="color:#4e9a06">&#34;MinPort&#34;</span>:7000,<span style="color:#4e9a06">&#34;MaxPort&#34;</span>:8000,<span style="color:#4e9a06">&#34;SidecarImage&#34;</span>:<span style="color:#4e9a06">&#34;gcr.io/agones-images/agones-sdk:1.23.0&#34;</span>,<span style="color:#4e9a06">&#34;SidecarCPURequest&#34;</span>:<span style="color:#4e9a06">&#34;30m&#34;</span>,<span style="color:#4e9a06">&#34;SidecarCPULimit&#34;</span>:<span style="color:#4e9a06">&#34;0&#34;</span>,<span style="color:#4e9a06">&#34;SidecarMemoryRequest&#34;</span>:<span style="color:#4e9a06">&#34;0&#34;</span>,<span style="color:#4e9a06">&#34;SidecarMemoryLimit&#34;</span>:<span style="color:#4e9a06">&#34;0&#34;</span>,<span style="color:#4e9a06">&#34;SdkServiceAccount&#34;</span>:<span style="color:#4e9a06">&#34;agones-sdk&#34;</span>,<span style="color:#4e9a06">&#34;AlwaysPullSidecar&#34;</span>:false,<span style="color:#4e9a06">&#34;PrometheusMetrics&#34;</span>:true,<span style="color:#4e9a06">&#34;Stackdriver&#34;</span>:false,<span style="color:#4e9a06">&#34;StackdriverLabels&#34;</span>:<span style="color:#4e9a06">&#34;&#34;</span>,<span style="color:#4e9a06">&#34;KeyFile&#34;</span>:<span style="color:#4e9a06">&#34;/home/agones/certs/server.key&#34;</span>,<span style="color:#4e9a06">&#34;CertFile&#34;</span>:<span style="color:#4e9a06">&#34;/home/agones/certs/server.crt&#34;</span>,<span style="color:#4e9a06">&#34;KubeConfig&#34;</span>:<span style="color:#4e9a06">&#34;&#34;</span>,<span style="color:#4e9a06">&#34;GCPProjectID&#34;</span>:<span style="color:#4e9a06">&#34;&#34;</span>,<span style="color:#4e9a06">&#34;NumWorkers&#34;</span>:100,<span style="color:#4e9a06">&#34;APIServerSustainedQPS&#34;</span>:400,<span style="color:#4e9a06">&#34;APIServerBurstQPS&#34;</span>:500,<span style="color:#4e9a06">&#34;LogDir&#34;</span>:<span style="color:#4e9a06">&#34;/home/agones/logs&#34;</span>,<span style="color:#4e9a06">&#34;LogLevel&#34;</span>:<span style="color:#4e9a06">&#34;info&#34;</span>,<span style="color:#4e9a06">&#34;LogSizeLimitMB&#34;</span>:10000<span style="color:#ce5c00;font-weight:bold">}</span>,<span style="color:#4e9a06">&#34;featureGates&#34;</span>:<span style="color:#4e9a06">&#34;Example=true\u0026NodeExternalDNS=true\u0026PlayerAllocationFilter=false\u0026PlayerTracking=false&#34;</span>,<span style="color:#4e9a06">&#34;message&#34;</span>:<span style="color:#4e9a06">&#34;starting gameServer operator...&#34;</span>,<span style="color:#4e9a06">&#34;severity&#34;</span>:<span style="color:#4e9a06">&#34;info&#34;</span>,<span style="color:#4e9a06">&#34;source&#34;</span>:<span style="color:#4e9a06">&#34;main&#34;</span>,<span style="color:#4e9a06">&#34;time&#34;</span>:<span style="color:#4e9a06">&#34;2022-06-15T21:15:40.309528802Z&#34;</span>,<span style="color:#4e9a06">&#34;version&#34;</span>:<span style="color:#4e9a06">&#34;1.23.0&#34;</span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><p>The <code>ctlConf</code> section has the full configuration for Code Blind as it was passed to the controller. Within that log line
there is a <code>featureGates</code> key, that has the full Feature Gate configuration as a URL Query String (<code>\u0026</code>
is JSON for <code>&amp;</code>), so you can see if the Feature Gates are set as expected.</p>
<h2 id="i-uninstalled-code-blind-before-deleted-all-my-gameservers-and-now-they-wont-delete">I uninstalled Code Blind before deleted all my <code>GameServers</code> and now they won&rsquo;t delete</h2>
<p>Code Blind <code>GameServers</code> use <a href="https://kubernetes.io/docs/tasks/access-kubernetes-api/custom-resources/custom-resource-definitions/#finalizers">Finalizers</a>
to manage garbage collection of the <code>GameServers</code>. This means that if the Code Blind controller
doesn&rsquo;t remove the finalizer for you (i.e. if it has been uninstalled),  it can be tricky to remove them all.</p>
<p>Thankfully, if we create a patch to remove the finalizers from all GameServers, we can delete them with impunity.</p>
<p>A quick one liner to do this:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl get gameserver -o name <span style="color:#000;font-weight:bold">|</span> xargs -n1 -P1 -I<span style="color:#ce5c00;font-weight:bold">{}</span> kubectl patch <span style="color:#ce5c00;font-weight:bold">{}</span> --type<span style="color:#ce5c00;font-weight:bold">=</span>merge -p <span style="color:#4e9a06">&#39;{&#34;metadata&#34;: {&#34;finalizers&#34;: []}}&#39;</span>
</span></span></code></pre></div><p>Once this is done, you can <code>kubectl delete gs --all</code> and clean everything up (if it&rsquo;s not gone already).</p>
<h2 id="im-getting-forbidden-errors-when-trying-to-install-code-blind">I&rsquo;m getting Forbidden errors when trying to install Code Blind</h2>
<p>Ensure that you are running Kubernetes 1.12 or later, which does not require any special
clusterrolebindings to install Code Blind.</p>
<p>If you want to install Code Blind on an older version of Kubernetes, you need to create a
clusterrolebinding to add your identity as a cluster admin, e.g.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Kubernetes Engine</span>
</span></span><span style="display:flex;"><span>kubectl create clusterrolebinding cluster-admin-binding <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --clusterrole cluster-admin --user <span style="color:#4e9a06">`</span>gcloud config get-value account<span style="color:#4e9a06">`</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Minikube</span>
</span></span><span style="display:flex;"><span>kubectl create clusterrolebinding cluster-admin-binding <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --clusterrole<span style="color:#ce5c00;font-weight:bold">=</span>cluster-admin --serviceaccount<span style="color:#ce5c00;font-weight:bold">=</span>kube-system:default
</span></span></code></pre></div><p>On GKE, <code>gcloud config get-value accounts</code> will return a lowercase email address, so if
you are using a CamelCase email, you may need to type it in manually.</p>
<h2 id="im-getting-stuck-in-terminating-when-i-uninstall-code-blind">I&rsquo;m getting stuck in &ldquo;Terminating&rdquo; when I uninstall Code Blind</h2>
<p>If you try to uninstall the <code>agones-system</code> namespace before you have removed all of the components in the namespace you may
end up in a <code>Terminating</code> state.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl get ns
</span></span></code></pre></div><pre tabindex="0"><code>NAME              STATUS        AGE                                                                                                                                                    
agones-system     Terminating   4d
</code></pre><p>Fixing this up requires us to bypass the finalizer in Kubernetes (<a href="https://www.ibm.com/support/knowledgecenter/en/SSBS6K_3.1.1/troubleshoot/ns_terminating.html">article link</a>), by manually changing the namespace details:</p>
<p>First get the current state of the namespace:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl get namespace agones-system -o json &gt;tmp.json
</span></span></code></pre></div><p>Edit the response <code>tmp.json</code> to remove the finalizer data, for example remove the following:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#4e9a06">&#34;spec&#34;</span><span style="color:#a40000">:</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">&#34;finalizers&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;kubernetes&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span><span style="color:#a40000">,</span>
</span></span></code></pre></div><p>Open a new terminal to proxy traffic:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> kubectl proxy
</span></span></code></pre></div><pre tabindex="0"><code>Starting to serve on 127.0.0.1:8001
</code></pre><p>Now make an API call to send the altered namespace data:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> curl -k -H <span style="color:#4e9a06">&#34;Content-Type: application/json&#34;</span> -X PUT --data-binary @tmp.json http://127.0.0.1:8001/api/v1/namespaces/agones-system/finalize
</span></span></code></pre></div><p>You may need to clean up any other Code Blind related resources you have in your cluster at this point.</p>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-6d2425143fef027b493bdb4e064ff1b8">6 - Common Integration Patterns</h1>
    <div class="lead">Common patterns and integrations of external systems, such as matchmakers, with <code>GameServer</code> starting, allocating  and shutdown.</div>
	

<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Note</h4>

    These examples will use the <code>GameServerAllocation</code> resource for convenience, but these same patterns can be applied
when using the <a href="https://codeblind.ai/docs/advanced/allocator-service/">Allocation Service</a> instead.

</div>


</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-4fd9de9527c6b855f671d3d36654cf69">6.1 - Matchmaker requests a GameServer from a Fleet</h1>
    <div class="lead">This is the preferred workflow for a GameServer, in which an external matchmaker requests an allocation from one or  more <code>Fleets</code> using a <code>GameServerAllocation</code>.</div>
	<p><img alt="Allocated Lifecycle Sequence Diagram" src="../../../diagrams/gameserver-lifecycle.puml.png"></p>
<h2 id="sample-gameserverallocation">Sample <code>GameServerAllocation</code></h2>
<p>Since Code Blind will automatically add the label <code>agones.dev/fleet</code> to a <code>GameServer</code> of a given <code>Fleet</code>, we can use that
label selector to target a specific <code>Fleet</code> by name. In this instance, we are targeting the <code>Fleet</code> <code>xonotic</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;allocation.agones.dev/v1&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">GameServerAllocation</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">required</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">matchLabels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">agones.dev/fleet</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">xonotic</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h2 id="next-steps">Next Steps:</h2>
<ul>
<li>Read the various specification references.
<ul>
<li>Review the <a href="https://codeblind.ai/docs/reference/gameserver/">GameServer</a> spec.</li>
<li>Review the <a href="https://codeblind.ai/docs/reference/fleet/">Fleet</a> spec.</li>
<li>Review the <a href="https://codeblind.ai/docs/reference/gameserverallocation/">GameServerAllocation</a> spec.</li>
</ul>
</li>
<li>Review the specifics of <a href="https://codeblind.ai/docs/guides/health-checking/">Health Checking</a>.</li>
<li>See all the commands the <a href="https://codeblind.ai/docs/guides/client-sdks/">Client SDK</a> provides - we only show a few here!</li>
<li>Check out the <a href="https://codeblind.ai/docs/advanced/allocator-service/">Allocator Service</a> as a richer alternative to <code>GameServerAllocation</code>.</li>
<li>If you aren&rsquo;t familiar with the term <a href="https://kubernetes.io/docs/concepts/workloads/pods/pod/">Pod</a>, this should provide a reference.</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-86a46b984c7a9dbe801d9b640feca57f">6.2 - Matchmaker requires game server process registration</h1>
    <div class="lead">A scenario in which a Matchmaker requires a game server process to register themselves with the matchmaker, and the matchmaker decides which <code>GameServer</code> players are sent to.</div>
	<p>In this scenario, the <code>GameServer</code> process will need to self Allocate when informed by the matchmaker that players
are being sent to them.</p>
<p><img alt="Reserved Lifecycle Sequence Diagram" src="../../../diagrams/gameserver-reserved.puml.png"></p>


<div class="alert alert-warning" role="alert">
<h4 class="alert-heading">Warning</h4>

    This does relinquish control over how <code>GameServers</code> are packed across the cluster to the external matchmaker. It is likely
it will not do as good a job at packing and scaling as Code Blind.

</div>

<h2 id="next-steps">Next Steps:</h2>
<ul>
<li>Read the various references, including the
<a href="https://codeblind.ai/docs/reference/gameserver/">GameServer</a> and <a href="https://codeblind.ai/docs/reference/fleet/">Fleet</a>
reference materials.</li>
<li>Review the specifics of <a href="https://codeblind.ai/docs/guides/health-checking/">Health Checking</a>.</li>
<li>See all the commands the <a href="https://codeblind.ai/docs/guides/client-sdks/">Client SDK</a> provides - we only show a
few here!</li>
<li>If you aren&rsquo;t familiar with the term <a href="https://kubernetes.io/docs/concepts/workloads/pods/pod/">Pod</a>, this should
provide a reference.</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-f1a79f903a95085298e374f195e23456">6.3 - Canary Testing a new Fleet</h1>
    <div class="lead">Run a small Fleet for the new version of your <code>GameServer</code> to ensure it works correctly, before rolling it out to all your players.</div>
	<p>To <a href="https://martinfowler.com/bliki/CanaryRelease.html">canary release/test</a> a new <code>Fleet</code>,
we can run a small, fixed size <code>Fleet</code> of the new version of our GameServer, while also running the current stable
production version.</p>
<p><code>Allocations</code> can then <code>prefer</code> to come from the canary <code>Fleet</code>, but if all <code>GameServers</code> are already allocated from the
canary <code>Fleet</code>, players will be allocated to the current stable Fleets.</p>
<p>Over time, if the monitoring of those playing on the canary <code>Fleet</code> is working as expected, the size of the canary
<code>Fleet</code> can be grown until you feel confident in its stability.</p>
<p>Once confidence has been achieved, the configuration for stable <code>Fleet</code> can be updated to match the canary (usually
triggering a <a href="https://codeblind.ai/docs/guides/fleet-updates/#rolling-update-strategy">rolling update</a>). The
canary <code>Fleet</code> can then be deleted or updated to a new testing version of the game server process.</p>
<a href="../../../diagrams/canary-testing.puml.png" target="_blank">
<img src="../../../diagrams/canary-testing.puml.png" alt="Canary Fleet Diagram" />
</a>
<h2 id="sample-gameserverallocation">Sample <code>GameServerAllocation</code></h2>
<p>To ensure we don&rsquo;t have to change the Allocation system every time we have a canary <code>Fleet</code>, in this example, we will
state that in our system, the label <code>canary: &quot;true&quot;</code> will be added to any canary <code>Fleet</code> in the cluster.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;allocation.agones.dev/v1&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">GameServerAllocation</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">preferred</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">matchLabels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">canary</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;true&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">required</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">matchLabels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">agones.dev/fleet</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">stable</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>The above <code>Allocation</code> will then preferentially choose the <code>Fleet</code> that has <code>GameServers</code> with the label and key
value of<code>canary:&quot;true&quot;</code>, if it exists, and has remaining Ready <code>GameServers</code>, and if not, will apply the
<code>Allocation</code> to the <code>Fleet</code> named &ldquo;stable&rdquo;.</p>
<h2 id="next-steps">Next Steps</h2>
<ul>
<li>Read about different <a href="https://codeblind.ai/docs/guides/fleet-updates/"><code>Fleet</code> update</a> options and strategies that are
available.</li>
<li>Have a look at all the options available on a
<a href="https://codeblind.ai/docs/reference/gameserverallocation/"><code>GameServerAllocation</code></a>.</li>
<li>Review the <a href="https://codeblind.ai/docs/reference/fleet/"><code>Fleet</code> reference</a>.</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-05d94f8163838ad613b32d32bb977c15">6.4 - Reusing Allocated GameServers for more than one game session</h1>
    <div class="lead">After a <code>GameServer</code> has completed a player session, return it back to the pool of Ready <code>GameServers</code> for reuse.</div>
	<p>Having a <code>GameServer</code> terminate after a single player session is better for packing and optimisation of
infrastructure usage, as well as safety to ensure the process returns to an absolute zero state.</p>
<p>However, depending on the <code>GameServer</code> startup time, or other factors there may be reasons you wish to reuse a
<code>GameServer</code> for <em>n</em> number of sessions before finally shutting it down.</p>
<p>The &ldquo;magic trick&rdquo; to this is knowing that the <code>GameServer</code> process can call
<a href="https://codeblind.ai/docs/guides/client-sdks/#ready"><code>SDK.Ready()</code></a> to return to a <code>Ready</code>
state after the <code>GameServer</code> has been allocated.</p>
<p>It is then up to the game developer to ensure that the game server process returns to a zero state once a game
session has been completed.</p>
<a href="../../../diagrams/reusing-gameservers.puml.png" target="_blank">
<img src="../../../diagrams/reusing-gameservers.puml.png" alt="Reserved Lifecycle Sequence Diagram" />
</a>
<h2 id="next-steps">Next Steps</h2>
<ul>
<li>Have a look at all commands the <a href="https://codeblind.ai/docs/guides/client-sdks/">Client SDK</a> provides.</li>
<li>If you aren&rsquo;t familiar with the term <a href="https://kubernetes.io/docs/concepts/workloads/pods/pod/">Pod</a>, this shouldw
provide a reference.</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-62a4fdfa11ee32040369e2ca6dce6316">6.5 - High Density GameServers</h1>
    <div class="lead">How to run multiple concurrent game sessions in a single GameServer process.</div>
	<p>Depending on the setup and resource requirements of your game server process, sometimes it can be a more economical
use of resources to run multiple concurrent game sessions from within a single <code>GameServer</code> instance.</p>
<p>The tradeoff here is that this requires more management on behalf of the integrated game server process and external
systems, since it works around the common Kubernetes and/or Code Blind container lifecycle.</p>
<p>Utilising the new allocation <code>gameServerState</code> filter as well as the existing ability to edit the
<code>GameServer</code> labels at both <a href="https://codeblind.ai/docs/reference/gameserverallocation/">allocation time</a>, and from
within the game server process, <a href="https://codeblind.ai/docs/guides/client-sdks/#setlabelkey-value">via the SDK</a>,
means Code Blind is able to atomically remove a <code>GameServer</code> from the list of potentially allocatable
<code>GameServers</code> at allocation time, and then return it back into the pool of allocatable <code>GameServers</code> if and when the
game server process deems that is has room to host another game session.</p>
<a href="../../../diagrams/high-density.puml.png" target="_blank">
<img src="../../../diagrams/high-density.puml.png" alt="High Density Allocation Diagram" />
</a>


<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Info</h4>

    To watch for Allocation events, there is the initial <code>GameServer.status.state</code> change from <code>Ready</code> to <code>Allocated</code>,
but it is also useful to know that the value of <code>GameServer.metadata.annotations[&quot;agones.dev/last-allocated&quot;]</code> will
change as it is set by Code Blind with each allocation with the current timestamp, regardless of if there
is a state change or not.

</div>

<h2 id="example-gameserverallocation">Example <code>GameServerAllocation</code></h2>
<p>The below <code>Allocation</code> will first attempt to find a <code>GameServer</code> from the <code>Fleet</code> <code>simple-udp</code> that is already
Allocated and also has the label <code>agones.dev/sdk-gs-session-ready</code> with the value of <code>true</code>.</p>
<p>The above condition indicates that the matching game server process behind the matched <code>GameServer</code> record is able to
accept another game session at this time.</p>
<p>If an Allocated <code>GameServer</code> does not exist with the desired labels, then use the next selector to allocate a Ready
<code>GameServer</code> from the <code>simple-udp</code> <code>Fleet</code>.</p>
<p>Whichever condition is met, once allocation is made against a <code>GameServer</code>, its label of <code>agones.dev/sdk-gs-session-ready</code>
will be set to the value of <code>false</code> and it will no longer match the first selector, thereby removing it from any
future allocations with the below schema.</p>
<p>It will then be up to the game server process to decide on if and when it is appropriate to set the
<code>agones.dev/sdk-gs-session-ready</code> value back to <code>true</code>, thereby indicating that it can accept another concurrent
gameplay session.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;allocation.agones.dev/v1&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">GameServerAllocation</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">selectors</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">matchLabels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">agones.dev/fleet</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">simple-udp</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">agones.dev/sdk-gs-session-ready</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;true&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># this is important</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">gameServerState: Allocated # new state filter</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">allocate from Allocated servers</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">matchLabels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">agones.dev/fleet</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">simple-udp</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">gameServerState</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Ready</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Allocate out of the Ready Pool (which would be default, so backward compatible)</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">labels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">agones.dev/sdk-gs-session-ready</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;false&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># this removes it from the pool</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div>

<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Info</h4>

    It&rsquo;s important to note that the labels that the <code>GameServer</code> process use to add itself back into the pool of
allocatable instances, must start with the prefix <code>agones.dev/sdk-</code>, since only labels that have this prefix are
available to be [updated from the SDK][sdk].

</div>

<h2 id="consistency">Consistency</h2>
<p>Code Blind, and Kubernetes itself are built as eventually consistent, self-healing systems. To that end, it is worth
noting that there may be minor delays between each of the operations in the above flow.  For example, depending on the
cluster load, it may take up to a second for an <a href="https://codeblind.ai/docs/guides/client-sdks/#setlabelkey-value">SDK driven label change</a> on a <code>GameServer</code> record to be
visible to the Code Blind allocation system. We recommend building your integrations with Code Blind with this in mind.</p>
<h2 id="next-steps">Next Steps</h2>
<ul>
<li>View the details about <a href="https://codeblind.ai/docs/guides/client-sdks/#setlabelkey-value">using the SDK</a> to set
labels on the <code>GameServer</code>.</li>
<li>Check all the options available on <a href="https://codeblind.ai/docs/reference/gameserverallocation/"><code>GameServerAllocation</code></a>.</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-b5060da5db3ee4fca018df5aa30bf2b1">6.6 - Allocating based on GameServer Player Capacity</h1>
    <div class="lead">Find a <code>GameServer</code> that has room for a specific number of players.</div>
	
<div class="alert alert-warning" role="alert">
    <h4 class="alert-heading">Warning</h4>
    <p>The Player Tracking and Allocation Player Filter features are currently <strong><a href="https://codeblind.ai/docs/guides/feature-stages/#alpha">Alpha</a></strong>,
        not enabled by default, and may change in the future.</p>
<p>Use the FeatureGates  <code>PlayerTracking</code>, and <code>PlayerAllocationFilter</code>
to enable and test these features.</p>
    <p>See the <a href="https://codeblind.ai/docs/guides/feature-stages/#feature-gates">Feature Gate documentation</a> for details on how to enable features.</p>
</div>

<p>Using this approach, we are able to be able to make a request that is akin to: &ldquo;Find me a <code>GameServer</code> that is already
allocated, with room for <em>n</em> number of players, and if one is not available, allocate me a <code>Ready</code> <code>GameServer</code>&rdquo;.</p>
<p>Common applications of this type of allocation are Lobby servers where players await matchmaking, or a
persistent world server where players connect and disconnect from a large map.</p>
<a href="../../../diagrams/allocation-player-capacity.puml.png" target="_blank">
<img src="../../../diagrams/allocation-player-capacity.puml.png" alt="Player Capacity Allocation Diagram" />
</a>
<h2 id="example-gameserverallocation">Example <code>GameServerAllocation</code></h2>
<p>The below allocation will attempt to find an already Allocated <code>GameServer</code> from the <code>Fleet</code> &ldquo;lobby&rdquo; with room for 10
to 15 players, and if it cannot find one, will allocate a Ready one from the same <code>Fleet</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;allocation.agones.dev/v1&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">GameServerAllocation</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">selectors</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">matchLabels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">agones.dev/fleet</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">lobby</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">gameServerState</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Allocated</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">players</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">minAvailable</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">10</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">maxAvailable</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">15</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">matchLabels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">agones.dev/fleet</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">lobby</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div>

<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Note</h4>

    We recommend doing an extra check when players connect to a <code>GameServer</code> that there is the expected player capacity
on the <code>GameServer</code> as there can be a small delay between a player connecting and it being reported
to Code Blind.

</div>

<h2 id="next-steps">Next Steps</h2>
<ul>
<li>Have a look at all commands the <a href="https://codeblind.ai/docs/guides/client-sdks/">Client SDK</a> provides.</li>
<li>Check all the options available on <a href="https://codeblind.ai/docs/reference/gameserverallocation/"><code>GameServerAllocation</code></a>.</li>
<li>If you aren&rsquo;t familiar with the term <a href="https://kubernetes.io/docs/concepts/workloads/pods/pod/">Pod</a>, this should
provide a reference.</li>
</ul>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-68ec2370d0409cc27325be36693f9368">7 - Tutorials</h1>
    <div class="lead">Code Blind Tutorials</div>
	
</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-e43457c0d8b1ad8fc42509c38e7d0f1b">7.1 - Tutorial Build and Run a Simple Gameserver (Rust)</h1>
    <div class="lead">This tutorial describes how to use the Code Blind Rust SDK in a simple Rust gameserver.</div>
	<h2 id="objectives">Objectives</h2>
<ul>
<li>Run a simple gameserver</li>
<li>Understand how the simple gameserver uses the Code Blind Rust SDK</li>
<li>Build a customized version of the simple gameserver</li>
<li>Run your customized simple gameserver</li>
</ul>
<h2 id="prerequisites">Prerequisites</h2>
<ol>
<li><a href="https://www.docker.com/get-started/">Docker</a></li>
<li>Code Blind installed on GKE</li>
<li>kubectl properly configured</li>
<li>A local copy of the <a href="https://github.com/googleforgames/agones/tree/release-1.38.0">Code Blind repository</a></li>
<li>A repository for Docker images, such as <a href="https://hub.docker.com/">Docker Hub</a> or <a href="https://cloud.google.com/container-registry/">GC Container Registry</a></li>
</ol>
<p>To install on GKE, follow the install instructions (if you haven&rsquo;t already) at
<a href="https://codeblind.ai/docs/installation/creating-cluster/gke/">Setting up a Google Kubernetes Engine (GKE) cluster</a>.
Also complete the &ldquo;Installing Code Blind&rdquo; instructions on the same page.</p>
<p>While not required, you may wish to review the <a href="/docs/getting-started/create-gameserver/">Create a Game Server</a>,
<a href="/docs/getting-started/create-fleet/">Create a Game Server Fleet</a>, and/or <a href="/docs/getting-started/edit-first-gameserver-go/">Edit a Game Server</a> quickstarts.</p>
<h3 id="1-run-the-simple-gameserver">1. Run the simple gameserver</h3>
<p>First, run the pre-built version of the simple gameserver and take note of the name that was created:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl create -f https://raw.githubusercontent.com/googleforgames/agones/release-1.38.0/examples/rust-simple/gameserver.yaml
</span></span><span style="display:flex;"><span><span style="color:#000">GAMESERVER_NAME</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>kubectl get gs -o go-template --template <span style="color:#4e9a06">&#39;{{range .items}}{{.metadata.name}}{{&#34;\n&#34;}}{{end}}&#39;</span><span style="color:#204a87;font-weight:bold">)</span>
</span></span></code></pre></div><p>The game server sets up the Code Blind SDK, calls <code>sdk.ready()</code> to inform Code Blind that it is ready to serve traffic,
prints a message every 10 seconds, and then calls <code>sdk.shutdown()</code> after a minute to indicate that the gameserver
is going to exit.</p>
<p>You can follow along with the lifecycle of the gameserver by running</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl logs <span style="color:#4e9a06">${</span><span style="color:#000">GAMESERVER_NAME</span><span style="color:#4e9a06">}</span> rust-simple -f
</span></span></code></pre></div><p>which should produce output similar to</p>
<pre tabindex="0"><code>Rust Game Server has started!
Creating SDK instance
Setting a label
Starting to watch GameServer updates...
Health ping sent
Setting an annotation
Marking server as ready...
...marked Ready
Getting GameServer details...
GameServer name: rust-simple-txsc6
Running for 0 seconds
GameServer Update, name: rust-simple-txsc6
GameServer Update, state: Scheduled
GameServer Update, name: rust-simple-txsc6
GameServer Update, state: Scheduled
GameServer Update, name: rust-simple-txsc6
GameServer Update, state: RequestReady
GameServer Update, name: rust-simple-txsc6
GameServer Update, state: Ready
Health ping sent
Health ping sent
Health ping sent
Health ping sent
Health ping sent
Running for 10 seconds
GameServer Update, name: rust-simple-txsc6
GameServer Update, state: Ready
...
Shutting down after 60 seconds...
...marked for Shutdown
Running for 60 seconds
Health ping sent
GameServer Update, name: rust-simple-txsc6
GameServer Update, state: Shutdown
GameServer Update, name: rust-simple-txsc6
GameServer Update, state: Shutdown
...
</code></pre><p>If everything goes as expected, the gameserver will exit automatically after about a minute.</p>
<p>In some cases, the gameserver goes into an unhealthy state, in which case it will be restarted indefinitely.
If this happens, you can manually remove it by running</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl delete gs <span style="color:#4e9a06">${</span><span style="color:#000">GAMESERVER_NAME</span><span style="color:#4e9a06">}</span>
</span></span></code></pre></div><h3 id="2-build-a-simple-gameserver">2. Build a simple gameserver</h3>
<p>Change directories to your local agones/examples/rust-simple directory. To experiment with the SDK, open up <code>main.rs</code>
in your favorite editor and change the interval at which the gameserver calls <code>sdk.health()</code> from 2 seconds to 20
seconds by modifying the line in the thread assigned to <code>let _health</code> to be</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#000">thread</span>::<span style="color:#000">sleep</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Duration</span>::<span style="color:#000">from_secs</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">20</span><span style="color:#000;font-weight:bold">));</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>Next build a new docker image by running</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87">cd</span> examples/rust-simple
</span></span><span style="display:flex;"><span><span style="color:#000">REPOSITORY</span><span style="color:#ce5c00;font-weight:bold">=</span>&lt;your-repository&gt; <span style="color:#8f5902;font-style:italic"># e.g. gcr.io/agones-images</span>
</span></span><span style="display:flex;"><span>make build-image <span style="color:#000">REPOSITORY</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">${</span><span style="color:#000">REPOSITORY</span><span style="color:#4e9a06">}</span>
</span></span></code></pre></div><p>The multi-stage Dockerfile will pull down all of the dependencies needed to build the image. Note that it is normal
for this to take several minutes to complete.</p>
<p>Once the container has been built, push it to your repository</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker push <span style="color:#4e9a06">${</span><span style="color:#000">REPOSITORY</span><span style="color:#4e9a06">}</span>/rust-simple-server:0.4
</span></span></code></pre></div><h3 id="3-run-the-customized-gameserver">3. Run the customized gameserver</h3>
<p>Now it is time to deploy your newly created gameserver container into your Code Blind cluster.</p>
<p>First, you need to edit <code>examples/rust-simple/gameserver.yaml</code> to point to your new image:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">containers</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">rust-simple</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">image</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">$(REPOSITORY)/rust-simple-server:0.4</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">imagePullPolicy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Always</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>Then, deploy your gameserver</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl create -f gameserver.yaml
</span></span><span style="display:flex;"><span><span style="color:#000">GAMESERVER_NAME</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>kubectl get gs -o go-template --template <span style="color:#4e9a06">&#39;{{range .items}}{{.metadata.name}}{{&#34;\n&#34;}}{{end}}&#39;</span><span style="color:#204a87;font-weight:bold">)</span>
</span></span></code></pre></div><p>Again, follow along with the lifecycle of the gameserver by running</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl logs <span style="color:#4e9a06">${</span><span style="color:#000">GAMESERVER_NAME</span><span style="color:#4e9a06">}</span> rust-simple -f
</span></span></code></pre></div><p>which should produce output similar to</p>
<pre tabindex="0"><code>Rust Game Server has started!
Creating SDK instance
Setting a label
Starting to watch GameServer updates...
Health ping sent
Setting an annotation
Marking server as ready...
...marked Ready
Getting GameServer details...
GameServer name: rust-simple-z6lz8
Running for 0 seconds
GameServer Update, name: rust-simple-z6lz8
GameServer Update, state: Scheduled
GameServer Update, name: rust-simple-z6lz8
GameServer Update, state: RequestReady
GameServer Update, name: rust-simple-z6lz8
GameServer Update, state: RequestReady
GameServer Update, name: rust-simple-z6lz8
GameServer Update, state: Ready
Running for 10 seconds
GameServer Update, name: rust-simple-z6lz8
GameServer Update, state: Ready
GameServer Update, name: rust-simple-z6lz8
GameServer Update, state: Unhealthy
Health ping sent
Running for 20 seconds
Running for 30 seconds
Health ping sent
Running for 40 seconds
GameServer Update, name: rust-simple-z6lz8
GameServer Update, state: Unhealthy
Running for 50 seconds
Health ping sent
Shutting down after 60 seconds...
...marked for Shutdown
Running for 60 seconds
Running for 70 seconds
GameServer Update, name: rust-simple-z6lz8
GameServer Update, state: Unhealthy
Health ping sent
Running for 80 seconds
Running for 90 seconds
Health ping sent
Rust Game Server finished.
</code></pre><p>with the slower healthcheck interval, the gameserver gets automatically marked an <code>Unhealthy</code> by Code Blind.</p>
<p>To finish, clean up the gameserver by manually removing it</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl delete gs <span style="color:#4e9a06">${</span><span style="color:#000">GAMESERVER_NAME</span><span style="color:#4e9a06">}</span>
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-20b721aa1328ed6386e53f4fb6bd7bba">7.2 - Tutorial Build and Run a Simple Gameserver (node.js)</h1>
    <div class="lead">This tutorial describes how to use the Code Blind node.js SDK in a simple node.js gameserver.</div>
	<h2 id="objectives">Objectives</h2>
<ul>
<li>Run a simple gameserver</li>
<li>Understand how the simple gameserver uses the Code Blind node.js SDK</li>
<li>Build a customized version of the simple gameserver</li>
<li>Run your customized simple gameserver</li>
</ul>
<h2 id="prerequisites">Prerequisites</h2>
<ol>
<li><a href="https://www.docker.com/get-started/">Docker</a></li>
<li>Code Blind installed on GKE</li>
<li>kubectl properly configured</li>
<li>A local copy of the <a href="https://github.com/googleforgames/agones/tree/release-1.38.0">Code Blind repository</a></li>
<li>A repository for Docker images, such as <a href="https://hub.docker.com/">Docker Hub</a> or <a href="https://cloud.google.com/container-registry/">GC Container Registry</a></li>
</ol>
<p>To install on GKE, follow the install instructions (if you haven&rsquo;t already) at
<a href="https://codeblind.ai/docs/installation/creating-cluster/gke/">Setting up a Google Kubernetes Engine (GKE) cluster</a>.
Also complete the &ldquo;Installing Code Blind&rdquo; instructions on the same page.</p>
<p>While not required, you may wish to review the <a href="/docs/getting-started/create-gameserver/">Create a Game Server</a>,
<a href="/docs/getting-started/create-fleet/">Create a Game Server Fleet</a>, and/or <a href="/docs/getting-started/edit-first-gameserver-go/">Edit a Game Server</a> quickstarts.</p>
<h3 id="1-run-the-simple-gameserver">1. Run the simple gameserver</h3>
<p>First, run the pre-built version of the simple gameserver and take note of the name that was created:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl create -f https://raw.githubusercontent.com/googleforgames/agones/release-1.38.0/examples/nodejs-simple/gameserver.yaml
</span></span><span style="display:flex;"><span><span style="color:#000">GAMESERVER_NAME</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>kubectl get gs -o go-template --template <span style="color:#4e9a06">&#39;{{range .items}}{{.metadata.name}}{{&#34;\n&#34;}}{{end}}&#39;</span><span style="color:#204a87;font-weight:bold">)</span>
</span></span></code></pre></div><p>The game server sets up the Code Blind SDK, calls <code>sdk.ready()</code> to inform Code Blind that it is ready to serve traffic,
prints a message every 10 seconds, and then calls <code>sdk.shutdown()</code> after a minute to indicate that the gameserver
is going to exit.</p>
<p>You can follow along with the lifecycle of the gameserver by running</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl logs <span style="color:#4e9a06">${</span><span style="color:#000">GAMESERVER_NAME</span><span style="color:#4e9a06">}</span> nodejs-simple -f
</span></span></code></pre></div><p>which should produce output similar to</p>
<pre tabindex="0"><code>&gt; @ start /home/server/examples/nodejs-simple
&gt; node src/index.js

node.js Game Server has started!
Setting a label
(node:20) [DEP0005] DeprecationWarning: Buffer() is deprecated due to security and usability issues. Please use the Buffer.alloc(), Buffer.allocUnsafe(), or Buffer.from() methods instead.
Setting an annotation
Marking server as ready...
...marked Ready
GameServer Update:
	name: nodejs-simple-9bw4g 
	state: Scheduled
GameServer Update:
	name: nodejs-simple-9bw4g 
	state: RequestReady
GameServer Update:
	name: nodejs-simple-9bw4g 
	state: RequestReady
GameServer Update:
	name: nodejs-simple-9bw4g 
	state: Ready
Health ping sent
Health ping sent
Health ping sent
Health ping sent
Health ping sent
Running for 10 seconds!
Health ping sent
Health ping sent
Health ping sent
Health ping sent
Running for 20 seconds!
Health ping sent
Health ping sent
Health ping sent
Health ping sent
Health ping sent
GameServer Update:
	name: nodejs-simple-9bw4g 
	state: Ready
Running for 30 seconds!
Health ping sent
Health ping sent
Health ping sent
Health ping sent
Health ping sent
Running for 40 seconds!
Health ping sent
Health ping sent
Health ping sent
Health ping sent
Health ping sent
Running for 50 seconds!
Health ping sent
Health ping sent
Health ping sent
Health ping sent
Health ping sent
GameServer Update:
	name: nodejs-simple-9bw4g 
	state: Ready
Running for 60 seconds!
Shutting down after 60 seconds...
...marked for Shutdown
GameServer Update:
	name: nodejs-simple-9bw4g 
	state: Shutdown
Health ping sent
GameServer Update:
	name: nodejs-simple-9bw4g 
	state: Shutdown
Health ping sent
Health ping sent
Health ping sent
Health ping sent
Running for 70 seconds!
Health ping sent
Health ping sent
Health ping sent
Health ping sent
Health ping sent
Running for 80 seconds!
Health ping sent
Health ping sent
Health ping sent
Health ping sent
Health ping sent
Running for 90 seconds!
</code></pre><p>If everything goes as expected, the gameserver will exit automatically after about a minute.</p>
<p>In some cases, the gameserver goes into an unhealthy state, in which case it will be restarted indefinitely.
If this happens, you can manually remove it by running</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl delete gs <span style="color:#4e9a06">${</span><span style="color:#000">GAMESERVER_NAME</span><span style="color:#4e9a06">}</span>
</span></span></code></pre></div><h3 id="2-build-a-simple-gameserver">2. Build a simple gameserver</h3>
<p>Change directories to your local agones/examples/nodejs-simple directory. To experiment with the SDK, open up
<code>src/index.js</code> in your favorite editor and change the interval at which the gameserver calls <code>sdk.health()</code> from
2 seconds to 20 seconds by modifying the lines in the health ping handler to be</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#000">setInterval</span><span style="color:#000;font-weight:bold">(()</span> <span style="color:#000;font-weight:bold">=&gt;</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">agonesSDK</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">health</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">console</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">log</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;Health ping sent&#39;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">},</span> <span style="color:#0000cf;font-weight:bold">20000</span><span style="color:#000;font-weight:bold">);</span>
</span></span></code></pre></div><p>Next build a new docker image by running</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87">cd</span> examples/nodejs-simple
</span></span><span style="display:flex;"><span><span style="color:#000">REPOSITORY</span><span style="color:#ce5c00;font-weight:bold">=</span>&lt;your-repository&gt; <span style="color:#8f5902;font-style:italic"># e.g. gcr.io/agones-images</span>
</span></span><span style="display:flex;"><span>make build <span style="color:#000">REPOSITORY</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">${</span><span style="color:#000">REPOSITORY</span><span style="color:#4e9a06">}</span>
</span></span></code></pre></div><p>Once the container has been built, push it to your repository</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker push <span style="color:#4e9a06">${</span><span style="color:#000">REPOSITORY</span><span style="color:#4e9a06">}</span>/nodejs-simple-server:0.1
</span></span></code></pre></div><h3 id="3-run-the-customized-gameserver">3. Run the customized gameserver</h3>
<p>Now it is time to deploy your newly created gameserver container into your Code Blind cluster.</p>
<p>First, you need to edit <code>examples/nodejs-simple/gameserver.yaml</code> to point to your new image:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">containers</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">nodejs-simple</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">image</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">$(REPOSITORY)/nodejs-simple-server:0.1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">imagePullPolicy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Always</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>Then, deploy your gameserver</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl create -f gameserver.yaml
</span></span><span style="display:flex;"><span><span style="color:#000">GAMESERVER_NAME</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>kubectl get gs -o go-template --template <span style="color:#4e9a06">&#39;{{range .items}}{{.metadata.name}}{{&#34;\n&#34;}}{{end}}&#39;</span><span style="color:#204a87;font-weight:bold">)</span>
</span></span></code></pre></div><p>Again, follow along with the lifecycle of the gameserver by running</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl logs <span style="color:#4e9a06">${</span><span style="color:#000">GAMESERVER_NAME</span><span style="color:#4e9a06">}</span> nodejs-simple -f
</span></span></code></pre></div><p>which should produce output similar to</p>
<pre tabindex="0"><code>&gt; @ start /home/server/examples/nodejs-simple
&gt; node src/index.js

node.js Game Server has started!
Setting a label
(node:20) [DEP0005] DeprecationWarning: Buffer() is deprecated due to security and usability issues. Please use the Buffer.alloc(), Buffer.allocUnsafe(), or Buffer.from() methods instead.
Setting an annotation
Marking server as ready...
...marked Ready
GameServer Update:
	name: nodejs-simple-qkpqn 
	state: Scheduled
GameServer Update:
	name: nodejs-simple-qkpqn 
	state: Scheduled
GameServer Update:
	name: nodejs-simple-qkpqn 
	state: RequestReady
GameServer Update:
	name: nodejs-simple-qkpqn 
	state: Ready
Running for 10 seconds!
GameServer Update:
	name: nodejs-simple-qkpqn 
	state: Unhealthy
Health ping sent
Running for 20 seconds!
GameServer Update:
	name: nodejs-simple-qkpqn 
	state: Unhealthy
Running for 30 seconds!
Health ping sent
Running for 40 seconds!
Running for 50 seconds!
GameServer Update:
	name: nodejs-simple-qkpqn 
	state: Unhealthy
Health ping sent
Shutting down after 60 seconds...
...marked for Shutdown
Running for 60 seconds!
Running for 70 seconds!
Health ping sent
Running for 80 seconds!
GameServer Update:
	name: nodejs-simple-qkpqn 
	state: Unhealthy
Running for 90 seconds!
</code></pre><p>with the slower healthcheck interval, the gameserver gets automatically marked an <code>Unhealthy</code> by Code Blind.</p>
<p>To finish, clean up the gameserver by manually removing it</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl delete gs <span style="color:#4e9a06">${</span><span style="color:#000">GAMESERVER_NAME</span><span style="color:#4e9a06">}</span>
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-bc8f973cd2ecdd6bc9ff8c5a73a5fa51">7.3 - Tutorial Build and Run a Simple Gameserver (C&#43;&#43;)</h1>
    <div class="lead">This tutorial describes how to use the Code Blind C++ SDK in a simple C++ gameserver.</div>
	<h2 id="objectives">Objectives</h2>
<ul>
<li>Run a simple gameserver</li>
<li>Understand how the simple gameserver uses the Code Blind C++ SDK</li>
<li>Build a customized version of the simple gameserver</li>
<li>Run your customized simple gameserver</li>
</ul>
<h2 id="prerequisites">Prerequisites</h2>
<ol>
<li><a href="https://www.docker.com/get-started/">Docker</a></li>
<li>Code Blind installed on GKE</li>
<li>kubectl properly configured</li>
<li>A local copy of the <a href="https://github.com/googleforgames/agones/tree/release-1.38.0">Code Blind repository</a></li>
<li>A repository for Docker images, such as <a href="https://hub.docker.com/">Docker Hub</a> or <a href="https://cloud.google.com/container-registry/">GC Container Registry</a></li>
</ol>
<p>To install on GKE, follow the install instructions (if you haven&rsquo;t already) at
<a href="https://codeblind.ai/docs/installation/creating-cluster/gke/">Setting up a Google Kubernetes Engine (GKE) cluster</a>.
Also complete the &ldquo;Installing Code Blind&rdquo; instructions on the same page.</p>
<p>While not required, you may wish to review the <a href="/docs/getting-started/create-gameserver/">Create a Game Server</a>,
<a href="/docs/getting-started/create-fleet/">Create a Game Server Fleet</a>, and/or <a href="/docs/getting-started/edit-first-gameserver-go/">Edit a Game Server</a> quickstarts.</p>
<h3 id="1-run-the-simple-gameserver">1. Run the simple gameserver</h3>
<p>First, run the pre-built version of the simple gameserver and take note of the name that was created:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl create -f https://raw.githubusercontent.com/googleforgames/agones/release-1.38.0/examples/cpp-simple/gameserver.yaml
</span></span><span style="display:flex;"><span><span style="color:#000">GAMESERVER_NAME</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>kubectl get gs -o go-template --template <span style="color:#4e9a06">&#39;{{range .items}}{{.metadata.name}}{{&#34;\n&#34;}}{{end}}&#39;</span><span style="color:#204a87;font-weight:bold">)</span>
</span></span></code></pre></div><p>The game server sets up the Code Blind SDK, calls <code>SDK::Ready()</code> to inform Code Blind that it is ready to serve traffic,
prints a message every 10 seconds, and then calls <code>SDK::Shutdown()</code> after a minute to indicate that the gameserver
is going to exit.</p>
<p>You can follow along with the lifecycle of the gameserver by running</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl logs <span style="color:#4e9a06">${</span><span style="color:#000">GAMESERVER_NAME</span><span style="color:#4e9a06">}</span> cpp-simple -f
</span></span></code></pre></div><p>which should produce output similar to</p>
<pre tabindex="0"><code>C++ Game Server has started!
Getting the instance of the SDK!
Attempting to connect...
...handshake complete.
Setting a label
Starting to watch GameServer updates...
Health ping sent
Setting an annotation
Marking server as ready...
...marked Ready
Getting GameServer details...
GameServer name: cpp-simple-tlgzp
Running for 0 seconds !
GameServer Update:
	name: cpp-simple-tlgzp
	state: Scheduled
GameServer Update:
	name: cpp-simple-tlgzp
	state: RequestReady
GameServer Update:
	name: cpp-simple-tlgzp
	state: RequestReady
GameServer Update:
	name: cpp-simple-tlgzp
	state: Ready
Health ping sent
Health ping sent
Health ping sent
Health ping sent
Health ping sent
Running for 10 seconds !
Health ping sent
...
GameServer Update:
	name: cpp-simple-2mtdc
	state: Ready
Shutting down after 60 seconds...
...marked for Shutdown
Running for 60 seconds !
Health ping sent
GameServer Update:
	name: cpp-simple-2mtdc
	state: Shutdown
GameServer Update:
	name: cpp-simple-2mtdc
	state: Shutdown
Health ping failed
Health ping failed
Health ping failed
Health ping failed
Running for 70 seconds !
Health ping failed
Health ping failed
Health ping failed
Health ping failed
Health ping failed
Running for 80 seconds !
Health ping failed
Health ping failed
Health ping failed
Health ping failed
Health ping failed
</code></pre><p>If everything goes as expected, the gameserver will exit automatically after about a minute.</p>
<p>In some cases, the gameserver goes into an unhealthy state, in which case it will be restarted indefinitely.
If this happens, you can manually remove it by running</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl delete gs <span style="color:#4e9a06">${</span><span style="color:#000">GAMESERVER_NAME</span><span style="color:#4e9a06">}</span>
</span></span></code></pre></div><h3 id="2-run-a-fleet-of-simple-gameservers">2. Run a fleet of simple gameservers</h3>
<p>Next, run a fleet of gameservers</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl create -f https://raw.githubusercontent.com/googleforgames/agones/release-1.38.0/examples/cpp-simple/fleet.yaml
</span></span><span style="display:flex;"><span><span style="color:#000">FLEET_NAME</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>kubectl get fleets -o go-template --template <span style="color:#4e9a06">&#39;{{range .items}}{{.metadata.name}}{{&#34;\n&#34;}}{{end}}&#39;</span><span style="color:#204a87;font-weight:bold">)</span>
</span></span></code></pre></div><p>You can again inspect the output of an individual gameserver (which will look the same as above), but what is more
interesting is to watch the set of all gameservers over time. Each gameserver exits after about a minute, but a fleet
is responsible for keeping a sufficient number of gameservers in the <code>Ready</code> state. So as each gameserver exits, it
is replaced by a new one. You can see this in action by running</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>watch <span style="color:#4e9a06">&#34;kubectl get gameservers&#34;</span>
</span></span></code></pre></div><p>which should show how gameservers are constantly transitioning from <code>Scheduled</code> to <code>Ready</code> to <code>Shutdown</code> before
disappearing.</p>
<p>When you are finished watching the fleet produce new gameservers you should remove the fleet by running</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl delete fleet <span style="color:#4e9a06">${</span><span style="color:#000">FLEET_NAME</span><span style="color:#4e9a06">}</span>
</span></span></code></pre></div><h3 id="3-build-a-simple-gameserver">3. Build a simple gameserver</h3>
<p>Change directories to your local agones/examples/cpp-simple directory. To experiment with the SDK, open up <code>server.cc</code>
in your favorite editor and change the interval at which the gameserver calls <code>SDK::Health</code> from 2 seconds to 20
seconds by modifying the line in <code>DoHealth</code> to be</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#000">std</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">this_thread</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">sleep_for</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">std</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">chrono</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">seconds</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">20</span><span style="color:#000;font-weight:bold">));</span>
</span></span></code></pre></div><p>Next build a new docker image by running</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87">cd</span> examples/cpp-simple
</span></span><span style="display:flex;"><span><span style="color:#000">REPOSITORY</span><span style="color:#ce5c00;font-weight:bold">=</span>&lt;your-repository&gt; <span style="color:#8f5902;font-style:italic"># e.g. gcr.io/agones-images</span>
</span></span><span style="display:flex;"><span>make build <span style="color:#000">REPOSITORY</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">${</span><span style="color:#000">REPOSITORY</span><span style="color:#4e9a06">}</span>
</span></span></code></pre></div><p>The multi-stage Dockerfile will pull down all of the dependencies needed to build the image. Note that it is normal
for this to take several minutes to complete.</p>
<p>Once the container has been built, push it to your repository</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker push <span style="color:#4e9a06">${</span><span style="color:#000">REPOSITORY</span><span style="color:#4e9a06">}</span>/cpp-simple-server:0.6
</span></span></code></pre></div><h3 id="4-run-the-customized-gameserver">4. Run the customized gameserver</h3>
<p>Now it is time to deploy your newly created gameserver container into your Code Blind cluster.</p>
<p>First, you need to edit <code>examples/cpp-simple/gameserver.yaml</code> to point to your new image:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">containers</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">cpp-simple</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">image</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">$(REPOSITORY)/cpp-simple-server:0.6</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">imagePullPolicy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Always</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># add for development</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>Then, deploy your gameserver</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl create -f gameserver.yaml
</span></span><span style="display:flex;"><span><span style="color:#000">GAMESERVER_NAME</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>kubectl get gs -o go-template --template <span style="color:#4e9a06">&#39;{{range .items}}{{.metadata.name}}{{&#34;\n&#34;}}{{end}}&#39;</span><span style="color:#204a87;font-weight:bold">)</span>
</span></span></code></pre></div><p>Again, follow along with the lifecycle of the gameserver by running</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl logs <span style="color:#4e9a06">${</span><span style="color:#000">GAMESERVER_NAME</span><span style="color:#4e9a06">}</span> cpp-simple -f
</span></span></code></pre></div><p>which should produce output similar to</p>
<pre tabindex="0"><code>C++ Game Server has started!
Getting the instance of the SDK!
Attempting to connect...
...handshake complete.
Setting a label
Health ping sent
Starting to watch GameServer updates...
Setting an annotation
Marking server as ready...
...marked Ready
Getting GameServer details...
GameServer name: cpp-simple-f255n
Running for 0 seconds !
GameServer Update:
	name: cpp-simple-f255n
	state: Scheduled
GameServer Update:
	name: cpp-simple-f255n
	state: Scheduled
GameServer Update:
	name: cpp-simple-f255n
	state: RequestReady
GameServer Update:
	name: cpp-simple-f255n
	state: Ready
Running for 10 seconds !
GameServer Update:
	name: cpp-simple-f255n
	state: Unhealthy
Health ping sent
Running for 20 seconds !
GameServer Update:
	name: cpp-simple-f255n
	state: Unhealthy
Running for 30 seconds !
Health ping sent
Running for 40 seconds !
Running for 50 seconds !
GameServer Update:
	name: cpp-simple-f255n
	state: Unhealthy
Health ping sent
Shutting down after 60 seconds...
...marked for Shutdown
Running for 60 seconds !
Running for 70 seconds !
Health ping sent
Running for 80 seconds !
GameServer Update:
	name: cpp-simple-f255n
	state: Unhealthy
Running for 90 seconds !
Health ping sent
</code></pre><p>with the slower healthcheck interval, the gameserver gets automatically marked an <code>Unhealthy</code> by Code Blind.</p>
<p>To finish, clean up the gameserver by manually removing it</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl delete gs <span style="color:#4e9a06">${</span><span style="color:#000">GAMESERVER_NAME</span><span style="color:#4e9a06">}</span>
</span></span></code></pre></div>
</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-b00a88a07ceb21b1a83e5822e0c86c1d">8 - Reference</h1>
    <div class="lead">Reference documentation for Code Blind Custom Resource Definitions</div>
	
</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-822e19008f3423d8a6da51608c598d90">8.1 - GameServer Specification</h1>
    <div class="lead">Like any other Kubernetes resource you describe a GameServer&rsquo;s desired state via a specification written in YAML or JSON to the Kubernetes API. The Code Blind controller will then change the actual state to the desired state.</div>
	<p>A full GameServer specification is available below and in the 
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>example folder</a> for reference :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;agones.dev/v1&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">GameServer</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic"># GameServer Metadata</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic"># https://v1-27.docs.kubernetes.io/docs/reference/generated/kubernetes-api/v1.27/#objectmeta-v1-meta</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># generateName: &#34;gds-example&#34; # generate a unique name, with the given prefix</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;gds-example&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># set a fixed name</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># if there is more than one container, specify which one is the game server</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">container</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">example-server</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># Array of ports that can be exposed as direct connections to the game server container</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">ports</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># name is a descriptive name for the port</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">default</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># portPolicy has three options:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># - &#34;Dynamic&#34; (default) the system allocates a free hostPort for the gameserver, for game clients to connect to</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># - &#34;Static&#34;, user defines the hostPort that the game client will connect to. Then onus is on the user to ensure that the</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># port is available. When static is the policy specified, `hostPort` is required to be populated</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># - &#34;Passthrough&#34; dynamically sets the `containerPort` to the same value as the dynamically selected hostPort.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic">#      This will mean that users will need to lookup what port has been opened through the server side SDK.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">portPolicy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Static</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># The name of the container to open the port on. Defaults to the game server container if omitted or empty.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">container</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">simple-game-server</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># the port that is being opened on the game server process</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">containerPort</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">7654</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># the port exposed on the host, only required when `portPolicy` is &#34;Static&#34;. Overwritten when portPolicy is &#34;Dynamic&#34;.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">hostPort</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">7777</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># protocol being used. Defaults to UDP. TCP and TCPUDP are other options</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># - &#34;UDP&#34; (default) use the UDP protocol</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># - &#34;TCP&#34;, use the TCP protocol</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># - &#34;TCPUDP&#34;, uses both TCP and UDP, and exposes the same hostPort for both protocols.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic">#       This will mean that it adds an extra port, and the first port is set to TCP, and second port set to UDP</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">protocol</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">UDP</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># Health checking for the running game server</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">health</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># Disable health checking. defaults to false, but can be set to true</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">disabled</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">false</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># Number of seconds after the container has started before health check is initiated. Defaults to 5 seconds</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">initialDelaySeconds</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">5</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># If the `Health()` function doesn&#39;t get called at least once every period (seconds), then</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># the game server is not healthy. Defaults to 5</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">periodSeconds</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">5</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># Minimum consecutive failures for the health probe to be considered failed after having succeeded.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># Defaults to 3. Minimum value is 1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">failureThreshold</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># Parameters for game server sidecar</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">sdkServer</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># sdkServer log level parameter has three options:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic">#  - &#34;Info&#34; (default) The SDK server will output all messages except for debug messages</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic">#  - &#34;Debug&#34; The SDK server will output all messages including debug messages</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic">#  - &#34;Error&#34; The SDK server will only output error messages</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">logLevel</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Info</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># grpcPort and httpPort control what ports the sdkserver listens on.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># Starting with Code Blind 1.2 the default grpcPort is 9357 and the default</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># httpPort is 9358. In earlier releases, the defaults were 59357 and 59358</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># respectively but as these were in the ephemeral port range they could</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># conflict with other TCP connections.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">grpcPort</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">9357</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">httpPort</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">9358</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># [Stage:Alpha]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># [FeatureFlag:PlayerTracking]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># Players provides the configuration for player tracking features.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># Commented out since Alpha, and disabled by default</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># players:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic">#   # set this GameServer&#39;s initial player capacity</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic">#   initialCapacity: 10</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic">#</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># [Stage:Alpha]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># [FeatureFlag:CountsAndLists]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># Counts and Lists provides the configuration for generic (player, room, session, etc.) tracking features.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># Commented out since Alpha, and disabled by default</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># counters: # counters are int64 counters that can be incremented and decremented by set amounts. Keys must be declared at GameServer creation time.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic">#   games: # arbitrary key.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic">#     count: 1 # initial value.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic">#     capacity: 100 # (Optional) Defaults to 1000 and setting capacity to max(int64) may lead to issues and is not recommended. See GitHub issue https://github.com/googleforgames/agones/issues/3636 for more details.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic">#   sessions:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic">#     count: 1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># lists: # lists are lists of values stored against this GameServer that can be added and deleted from. Keys must be declared at GameServer creation time.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic">#   players: # an empty list, with a capacity set to 10.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic">#     capacity: 10 # capacity value, defaults to 1000.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic">#   rooms:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic">#     capacity: 333</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic">#     values: # initial set of values in a list.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic">#       - room1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic">#       - room2</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic">#       - room3</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic">#  </span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># Pod template configuration</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># https://v1-27.docs.kubernetes.io/docs/reference/generated/kubernetes-api/v1.27/#podtemplate-v1-core</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">template</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># pod metadata. Name &amp; Namespace is overwritten</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">labels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">myspeciallabel</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">myspecialvalue</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># Pod Specification</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">containers</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">simple-game-server</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">image</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">us-docker.pkg.dev/codeblind/examples/simple-server:0.27</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">imagePullPolicy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Always</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># nodeSelector is a label that can be used to tell Kubernetes which host</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># OS to use. For Windows game servers uncomment the nodeSelector</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># definition below.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># Details: https://kubernetes.io/docs/setup/production-environment/windows/user-guide-windows-containers/#ensuring-os-specific-workloads-land-on-the-appropriate-container-host</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># nodeSelector:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic">#   kubernetes.io/os: windows</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>Since Code Blind defines a new <a href="https://kubernetes.io/docs/concepts/api-extension/custom-resources/">Custom Resources Definition (CRD)</a> we can define a new resource using the kind <code>GameServer</code> with the custom group <code>agones.dev</code> and API version <code>v1</code>.</p>
<p>You can use the metadata field to target a specific <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/">namespaces</a>
but also attach specific <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/">annotations</a> and <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/">labels</a> to your resource. This is a very common pattern in the Kubernetes ecosystem.</p>
<p>The length of the <code>name</code> field of the Gameserver should not exceed 63 characters.</p>
<p>The <code>spec</code> field is the actual GameServer specification and it is composed as follow:</p>
<ul>
<li><code>container</code> is the name of container running the GameServer in case you have more than one container defined in the <a href="https://kubernetes.io/docs/concepts/workloads/pods/pod-overview/">pod</a>. If you do,  this is a mandatory field. For instance this is useful if you want to run a sidecar to ship logs.</li>
<li><code>ports</code> are an array of ports that can be exposed as direct connections to the game server container
<ul>
<li><code>name</code> is an optional descriptive name for a port</li>
<li><code>portPolicy</code> has three options:
- <code>Dynamic</code> (default) the system allocates a random free hostPort for the gameserver, for game clients to connect to.
- <code>Static</code>, user defines the hostPort that the game client will connect to. Then onus is on the user to ensure that the port is available. When static is the policy specified, <code>hostPort</code> is required to be populated.
- <code>Passthrough</code> dynamically sets the <code>containerPort</code>  to the same value as the dynamically selected hostPort. This will mean that users will need to lookup what port to open through the server side SDK before starting communications.</li>
<li><code>container</code> (Alpha) the name of the container to open the port on. Defaults to the game server container if omitted or empty.</li>
<li><code>containerPort</code> the port that is being opened on the game server process, this is a required field for <code>Dynamic</code> and <code>Static</code> port policies, and should not be included in <code>Passthrough</code> configuration.</li>
<li><code>protocol</code> the protocol being used. Defaults to UDP. TCP and TCPUDP are other options.</li>
</ul>
</li>
<li><code>health</code> to track the overall healthy state of the GameServer, more information available in the <a href="/docs/guides/health-checking/">health check documentation</a>.</li>
<li><code>sdkServer</code> defines parameters for the game server sidecar
<ul>
<li><code>logging</code> field defines log level for SDK server. Defaults to &ldquo;Info&rdquo;. It has three options:
<ul>
<li>&ldquo;Info&rdquo; (default) The SDK server will output all messages except for debug messages</li>
<li>&ldquo;Debug&rdquo; The SDK server will output all messages including debug messages</li>
<li>&ldquo;Error&rdquo; The SDK server will only output error messages</li>
</ul>
</li>
<li><code>grpcPort</code> the port that the SDK Server binds to for gRPC connections</li>
<li><code>httpPort</code> the port that the SDK Server binds to for HTTP gRPC gateway connections</li>
</ul>
</li>
<li><code>players</code> (Alpha, behind &ldquo;PlayerTracking&rdquo; feature gate), sets this GameServer&rsquo;s initial player capacity</li>
<li><code>counters</code> (Alpha, requires &ldquo;CountsAndLists&rdquo; feature flag) are int64 counters with a default capacity of 1000 that can be incremented and decremented by set amounts. Keys must be declared at GameServer creation time. Note that setting the capacity to max(int64) may lead to issues.</li>
<li><code>lists</code> (Alpha, requires &ldquo;CountsAndLists&rdquo; feature flag) are lists of values stored against this GameServer that can be added and deleted from. Key must be declared at GameServer creation time.</li>
<li><code>template</code> the <a href="https://v1-27.docs.kubernetes.io/docs/reference/generated/kubernetes-api/v1.27/#podtemplatespec-v1-core">pod spec template</a> to run your GameServer containers, <a href="https://kubernetes.io/docs/concepts/workloads/pods/pod-overview/#pod-templates">see</a> for more information.</li>
</ul>


<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Note</h4>

    The GameServer resource does not support updates. If you need to make regular updates to the GameServer spec, consider using a <a href="https://codeblind.ai/docs/reference/fleet/">Fleet</a>.

</div>

<h2 id="stable-network-id">Stable Network ID</h2>
<p>If you want to connect to a <code>GameServer</code> from within your Kubernetes cluster via a convention based
DNS entry, each Pod attached to a <code>GameServer</code> automatically derives its hostname from the name of the <code>GameServer</code>.</p>
<p>To create internal DNS entries within the cluster, a group of <code>Pods</code> attached to <code>GameServers</code> can use a
<a href="https://kubernetes.io/docs/concepts/services-networking/service/#headless-services">Headless Service</a> to control
the domain of the Pods, along with providing
a <a href="https://kubernetes.io/docs/concepts/services-networking/dns-pod-service/#pod-s-hostname-and-subdomain-fields"><code>subdomain</code> value to the <code>GameServer</code> <code>PodTemplateSpec</code></a>
to provide all the required details such that Kubernetes will create a DNS record for each Pod behind the Service.</p>
<p>You are also responsible for setting the labels on the <code>GameServer.Spec.Template.Metadata</code> to set the labels on the
created Pods and creating the Headless Service responsible for the network identity of the pods, Code Blind will not do
this for you, as a stable DNS record is not required for all use cases.</p>
<p>To ensure that the <code>hostName</code> value matches
<a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#dns-label-names">RFC 1123</a>, any <code>.</code> values
in the <code>GameServer</code> name are replaced by <code>-</code> when setting the underlying <code>Pod.Spec.HostName</code> value.</p>
<h2 id="gameserver-state-diagram">GameServer State Diagram</h2>
<p>The following diagram shows the lifecycle of a <code>GameServer</code>.</p>
<p>Game Servers are created through Kubernetes API (either directly or through a <a href="https://codeblind.ai/docs/reference/fleet/">Fleet</a>) and their state transitions are orchestrated by:</p>
<ul>
<li>GameServer controller, which allocates ports, launches Pods backing game servers and manages their lifetime</li>
<li>Allocation controller, which marks game servers as <code>Allocated</code> to handle a game session</li>
<li>SDK, which manages health checking and shutdown of a game server session</li>
</ul>
<p><img alt="GameServer State Diagram" src="../../../diagrams/gameserver-states.dot.png"></p>
<h2 id="primary-address-vs-addresses">Primary Address vs Addresses</h2>
<p><a href="https://codeblind.ai/docs/reference/agones_crd_api_reference/#agones.dev/v1.GameServerStatus"><code>GameServer.Status</code></a> has two fields which reflect the network address of the <code>GameServer</code>: <code>address</code> and <code>addresses</code>.
The <code>address</code> field is a policy-based choice of &ldquo;primary address&rdquo; that will work for many use cases,
and will always be one of the <code>addresses</code>. The <code>addresses</code> field contains every address in the <a href="https://v1-26.docs.kubernetes.io/docs/reference/generated/kubernetes-api/v1.26/#nodeaddress-v1-core"><code>Node.Status.addresses</code></a>,
representing all known ways to reach the <code>GameServer</code> over the network.</p>
<p>To choose <code>address</code> from <code>addresses</code>, <a href="https://github.com/googleforgames/agones/blob/a59c5394c7f5bac66e530d21446302581c10c225/pkg/gameservers/gameservers.go#L37-L71">Code Blind looks for the following address types</a>, in highest to lowest priorty:</p>
<ul>
<li><code>ExternalDNS</code></li>
<li><code>ExternalIP</code></li>
<li><code>InternalDNS</code></li>
<li><code>InternalIP</code></li>
</ul>
<p>e.g. if any <code>ExternalDNS</code> address is found in the respective <code>Node</code>, it is used as the <code>address</code>.</p>
<p>The policy for <code>address</code> will work for many use-cases, but for some advanced cases, such as IPv6 enablement, you may need
to evaluate all <code>addresses</code> and pick the addresses that best suits your needs.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-c5c1cc90b66f2081135179b33e03430a">8.2 - Fleet Specification</h1>
    <div class="lead">A <code>Fleet</code> is a set of warm GameServers that are available to be allocated from.</div>
	<p>To allocate a <code>GameServer</code> from a <code>Fleet</code>, use a <code>GameServerAllocation</code>.</p>
<p>Like any other Kubernetes resource you describe a <code>Fleet</code>&rsquo;s desired state via a specification written in YAML or JSON to the Kubernetes API. The Code Blind controller will then change the actual state to the desired state.</p>
<p>A full <code>Fleet</code> specification is available below and in the 
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>example folder</a> for reference :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;agones.dev/v1&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Fleet</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic"># Fleet Metadata</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic"># https://v1-27.docs.kubernetes.io/docs/reference/generated/kubernetes-api/v1.27/#objectmeta-v1-meta</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">fleet-example</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># the number of GameServers to keep Ready or Allocated in this Fleet</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">replicas</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># defines how GameServers are organised across the cluster.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># Options include:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># &#34;Packed&#34; (default) is aimed at dynamic Kubernetes clusters, such as cloud providers, wherein we want to bin pack</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># resources</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># &#34;Distributed&#34; is aimed at static Kubernetes clusters, wherein we want to distribute resources across the entire</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># cluster</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">scheduling</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Packed</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># a GameServer template - see:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># https://agones.dev/docs/reference/gameserver/ for all the options</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">strategy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># The replacement strategy for when the GameServer template is changed. Default option is &#34;RollingUpdate&#34;,</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># &#34;RollingUpdate&#34; will increment by maxSurge value on each iteration, while decrementing by maxUnavailable on each</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># iteration, until all GameServers have been switched from one version to another.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># &#34;Recreate&#34; terminates all non-allocated GameServers, and starts up a new set with the new details to replace them.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">RollingUpdate</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># Only relevant when `type: RollingUpdate`</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">rollingUpdate</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># the amount to increment the new GameServers by. Defaults to 25%</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">maxSurge</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">25</span><span style="color:#000">%</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># the amount to decrements GameServers by. Defaults to 25%</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">maxUnavailable</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">25</span><span style="color:#000">%</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># [Stage:Beta]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># [FeatureFlag:FleetAllocationOverflow]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># Labels and/or Annotations to apply to overflowing GameServers when the number of Allocated GameServers is more</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># than the desired replicas on the underlying `GameServerSet`</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">allocationOverflow</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">labels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">mykey</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">myvalue</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">version</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># empty an existing label value</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">annotations</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">otherkey</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">setthisvalue</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic">#</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># [Stage:Alpha]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># [FeatureFlag:CountsAndLists]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># Which gameservers in the Fleet are most important to keep around - impacts scale down logic.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># priorities:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># - type: Counter # Sort by a “Counter”</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic">#   key: player # The name of the Counter. No impact if no GameServer found.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic">#   order: Descending # Default is &#34;Ascending&#34; so smaller capacity will be removed first on down scaling.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># - type: List # Sort by a “List”</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic">#   key: room # The name of the List. No impact if no GameServer found.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic">#   order: Ascending # Default is &#34;Ascending&#34; so smaller capacity will be removed first on down scaling.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic">#      </span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">template</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># GameServer metadata</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">labels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">foo</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">bar</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># GameServer specification</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">ports</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">default</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">portPolicy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Dynamic</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">containerPort</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">26000</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">health</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">initialDelaySeconds</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">30</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">periodSeconds</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">60</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># Parameters for game server sidecar</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">sdkServer</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">logLevel</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Info</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">grpcPort</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">9357</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">httpPort</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">9358</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># The GameServer&#39;s Pod template</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">template</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">containers</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">simple-game-server</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">image</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">us-docker.pkg.dev/codeblind/examples/simple-server:0.27</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>Since Code Blind defines a new
<a href="https://kubernetes.io/docs/concepts/api-extension/custom-resources/">Custom Resources Definition (CRD)</a>
we can define a new resource using the kind <code>Fleet</code> with the custom group <code>agones.dev</code> and API
version <code>v1</code>.</p>
<p>You can use the metadata field to target a specific
<a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/">namespaces</a> but also
attach specific <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/">annotations</a>
and <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/">labels</a> to your resource.
This is a very common pattern in the Kubernetes ecosystem.</p>
<p>The length of the <code>name</code> field of the fleet should be at most 63 characters.</p>
<p>The <code>spec</code> field is the actual <code>Fleet</code> specification and it is composed as follow:</p>
<ul>
<li><code>replicas</code> is the number of <code>GameServers</code> to keep Ready or Allocated in this Fleet</li>
<li><code>scheduling</code> defines how GameServers are organised across the cluster. Affects backing Pod scheduling, as well as scale
down mechanics.
&ldquo;Packed&rdquo; (default) is aimed at dynamic Kubernetes clusters, such as cloud providers, wherein we want to bin pack
resources. &ldquo;Distributed&rdquo; is aimed at static Kubernetes clusters, wherein we want to distribute resources across the entire
cluster. See <a href="/docs/advanced/scheduling-and-autoscaling/">Scheduling and Autoscaling</a> for more details.</li>
<li><code>strategy</code> is the <code>GameServer</code> replacement strategy for when the <code>GameServer</code> template is edited.
<ul>
<li><code>type</code> is replacement strategy for when the GameServer template is changed. Default option is &ldquo;RollingUpdate&rdquo;, but &ldquo;Recreate&rdquo; is also available.
<ul>
<li><code>RollingUpdate</code> will increment by <code>maxSurge</code> value on each iteration, while decrementing by <code>maxUnavailable</code> on each iteration, until all GameServers have been switched from one version to another.</li>
<li><code>Recreate</code> terminates all non-allocated <code>GameServers</code>, and starts up a new set with the new <code>GameServer</code> configuration to replace them.</li>
</ul>
</li>
<li><code>rollingUpdate</code> is only relevant when <code>type: RollingUpdate</code>
<ul>
<li><code>maxSurge</code> is the amount to increment the new GameServers by. Defaults to 25%</li>
<li><code>maxUnavailable</code> is the amount to decrements GameServers by. Defaults to 25%</li>
</ul>
</li>
</ul>
</li>
<li><code>allocationOverflow</code> (Beta, requires <code>FleetAllocationOverflow</code> flag) The labels and/or Annotations to apply to
GameServers when the number of Allocated GameServers exceeds the desired replicas in the underlying
<code>GameServerSet</code>.
<ul>
<li><code>labels</code> the map of labels to be applied</li>
<li><code>annotations</code> the map of annotations to be applied</li>
<li><code>Fleet's Scheduling Strategy</code>: The GameServers associated with the GameServerSet are sorted based on either <code>Packed</code> or <code>Distributed</code> strategy.
<ul>
<li><code>Packed</code>: Code Blind maximizes resource utilization by trying to populate nodes that are already in use before allocating GameServers to other nodes.</li>
<li><code>Distributed</code>: Code Blind employs this strategy to spread out GameServer allocations, ensuring an even distribution of GameServers across the available nodes.</li>
</ul>
</li>
</ul>
</li>
<li><code>priorities</code>: (Alpha, requires <code>CountsAndLists</code> feature flag): Defines which gameservers in the Fleet are most important to keep around - impacts scale down logic.
<ul>
<li><code>type</code>: Sort by a &ldquo;Counter&rdquo; or a &ldquo;List&rdquo;.</li>
<li><code>key</code>: The name of the Counter or List. If not found on the GameServer, has no impact.</li>
<li><code>order</code>: Order: Sort by “Ascending” or “Descending”. “Descending” a bigger Capacity is preferred. “Ascending” would be smaller Capacity is preferred.</li>
</ul>
</li>
<li><code>template</code> a full <code>GameServer</code> configuration template.
See the <a href="/docs/reference/gameserver/">GameServer</a> reference for all available fields.</li>
</ul>
<h2 id="fleet-scale-subresource-specification">Fleet Scale Subresource Specification</h2>
<p>Scale subresource is defined for a Fleet. Please refer to <a href="https://kubernetes.io/docs/tasks/access-kubernetes-api/custom-resources/custom-resource-definitions/#subresources">Kubernetes docs</a>.</p>
<p>You can use the following command to scale the fleet with name simple-game-server:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl scale fleet simple-game-server --replicas<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">10</span>
</span></span></code></pre></div><pre tabindex="0"><code>fleet.agones.dev/simple-game-server scaled
</code></pre><p>You can also use <a href="https://codeblind.ai/docs/guides/access-api/">Kubernetes API</a> to get or update the Replicas count:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl http://localhost:8001/apis/agones.dev/v1/namespaces/default/fleets/simple-game-server/scale
</span></span></code></pre></div><pre tabindex="0"><code>{
  &#34;kind&#34;: &#34;Scale&#34;,
  &#34;apiVersion&#34;: &#34;autoscaling/v1&#34;,
  &#34;metadata&#34;: {
    &#34;name&#34;: &#34;simple-game-server&#34;,
    &#34;namespace&#34;: &#34;default&#34;,
    &#34;selfLink&#34;: &#34;/apis/agones.dev/v1/namespaces/default/fleets/simple-game-server/scale&#34;,
    &#34;uid&#34;: &#34;4dfaa310-2566-11e9-afd1-42010a8a0058&#34;,
    &#34;resourceVersion&#34;: &#34;292652&#34;,
    &#34;creationTimestamp&#34;: &#34;2019-01-31T14:41:33Z&#34;
  },
  &#34;spec&#34;: {
    &#34;replicas&#34;: 10
  },
  &#34;status&#34;: {
    &#34;replicas&#34;: 10
  }
</code></pre><p>Also exposing a Scale subresource would allow you to configure HorizontalPodAutoscaler and PodDisruptionBudget for a fleet in the future. However these features have not been tested, and are not currently supported - but if you are looking for these features, please be sure to let us know in the <a href="https://github.com/googleforgames/agones/issues/553">ticket</a>.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-73ab628c43273741615508c66fe16549">8.3 - GameServerAllocation Specification</h1>
    <div class="lead">A <code>GameServerAllocation</code> is used to atomically allocate a GameServer out of a set of GameServers. This could be a single Fleet, multiple Fleets, or a self managed group of GameServers.</div>
	<p>Allocation is the process of selecting the optimal <code>GameServer</code> that matches the filters defined in the <code>GameServerAllocation</code> specification below, and returning its details.</p>
<p>A successful Alloction moves the <code>GameServer</code> to the <code>Allocated</code> state, which indicates that it is currently active, likely with players on it, and should not be removed until SDK.Shutdown() is called, or it is explicitly manually deleted.</p>
<p>A full <code>GameServerAllocation</code> specification is available below and in the

<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>example folder</a> for reference:</p>

  
  
<ul class="nav nav-tabs" id="tabs-1" role="tablist">
  <li class="nav-item">
      <button class="nav-link active"
          id="tabs-01-00-tab" data-bs-toggle="tab" data-bs-target="#tabs-01-00" role="tab"
          data-td-tp-persist="yaml" aria-controls="tabs-01-00" aria-selected="true">
        selectors
      </button>
    </li><li class="nav-item">
      <button class="nav-link"
          id="tabs-01-01-tab" data-bs-toggle="tab" data-bs-target="#tabs-01-01" role="tab"
          aria-controls="tabs-01-01" aria-selected="false">
        required &amp; preferred (deprecated)
      </button>
    </li>
</ul>

<div class="tab-content" id="tabs-1-content">
    <div class="tab-pane fade show active"
        id="tabs-01-00" role="tabpanel" aria-labelled-by="tabs-01-00-tab" tabindex="1">
        <div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;allocation.agones.dev/v1&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">GameServerAllocation</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># GameServer selector from which to choose GameServers from.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># Defaults to all GameServers.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># matchLabels, matchExpressions, gameServerState and player filters can be used for filtering.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># See: https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/ for more details on label selectors.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># An ordered list of GameServer label selectors.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># If the first selector is not matched, the selection attempts the second selector, and so on.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># This is useful for things like smoke testing of new game servers.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">selectors</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">matchLabels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">agones.dev/fleet</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">green-fleet</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#8f5902;font-style:italic"># [Stage:Alpha]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#8f5902;font-style:italic"># [FeatureFlag:PlayerAllocationFilter]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">players</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">minAvailable</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">maxAvailable</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">99</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">matchLabels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">agones.dev/fleet</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">blue-fleet</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">matchLabels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">game</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">my-game</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">matchExpressions</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span>- {<span style="color:#204a87;font-weight:bold">key: tier, operator: In, values</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">cache]}</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># Specifies which State is the filter to be used when attempting to retrieve a GameServer</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># via Allocation. Defaults to &#34;Ready&#34;. The only other option is &#34;Allocated&#34;, which can be used in conjunction with</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># label/annotation/player selectors to retrieve an already Allocated GameServer.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">gameServerState</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Ready</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># [Stage:Alpha]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># [FeatureFlag:CountsAndLists]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># counters: # selector for counter current values of a GameServer count</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic">#   rooms:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic">#     minCount: 1 # minimum value. Defaults to 0.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic">#     maxCount: 5 # maximum value. Defaults to max(int64)</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic">#     minAvailable: 1 # minimum available (current capacity - current count). Defaults to 0.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic">#     maxAvailable: 10 # maximum available (current capacity - current count) Defaults to max(int64)</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># lists:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic">#   players:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic">#     containsValue: &#34;x6k8z&#34; # only match GameServers who has this value in the list. Defaults to &#34;&#34;, which is all.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic">#     minAvailable: 1 # minimum available (current capacity - current count). Defaults to 0.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic">#     maxAvailable: 10 # maximum available (current capacity - current count) Defaults to 0, which translates to max(int64)</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># [Stage:Alpha]      </span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># [FeatureFlag:PlayerAllocationFilter]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># Provides a filter on minimum and maximum values for player capacity when retrieving a GameServer</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># through Allocation. Defaults to no limits.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">players</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">minAvailable</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">maxAvailable</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">99</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># defines how GameServers are organised across the cluster.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># Options include:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># &#34;Packed&#34; (default) is aimed at dynamic Kubernetes clusters, such as cloud providers, wherein we want to bin pack</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># resources</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># &#34;Distributed&#34; is aimed at static Kubernetes clusters, wherein we want to distribute resources across the entire</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># cluster</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">scheduling</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Packed</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># Optional custom metadata that is added to the game server at allocation</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># You can use this to tell the server necessary session data</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">labels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">mode</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">deathmatch</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">annotations</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">map</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">garden22</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># [Stage:Alpha]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># [FeatureFlag:CountsAndLists]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># The first Priority on the array of Priorities is the most important for sorting. The allocator will</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># use the first priority for sorting GameServers by available Capacity in the Selector set. Acts as a</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># tie-breaker after sorting the game servers by State and Strategy Packed. Impacts which GameServer</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># is checked first. Optional.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># priorities:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># - type: List  # Whether a Counter or a List.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic">#   key: rooms  # The name of the Counter or List.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic">#   order: Ascending  # &#34;Ascending&#34; lists smaller available capacity first.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># [Stage:Alpha]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># [FeatureFlag:CountsAndLists]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># Counter actions to perform during allocation. Optional.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># counters:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic">#   rooms:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic">#     action: increment # Either &#34;Increment&#34; or &#34;Decrement&#34; the Counter’s Count.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic">#     amount: 1 # Amount is the amount to increment or decrement the Count. Must be a positive integer.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic">#     capacity: 5 # Amount to update the maximum capacity of the Counter to this number. Min 0, Max int64.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># List actions to perform during allocation. Optional.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># lists:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic">#   players:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic">#     addValues: # appends values to a List’s Values array. Any duplicate values will be ignored</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic">#       - x7un</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic">#       - 8inz</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic">#     capacity: 40 # Updates the maximum capacity of the Counter to this number. Min 0, Max 1000.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span></span></span></code></pre></div>
    </div>
    <div class="tab-pane fade"
        id="tabs-01-01" role="tabpanel" aria-labelled-by="tabs-01-01-tab" tabindex="1">
        <div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;allocation.agones.dev/v1&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">GameServerAllocation</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># Deprecated, use field selectors instead.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># GameServer selector from which to choose GameServers from.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># Defaults to all GameServers.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># matchLabels, matchExpressions, gameServerState and player filters can be used for filtering.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># See: https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/ for more details on label selectors.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># Deprecated, use field selectors instead.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">required</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">matchLabels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">game</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">my-game</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">matchExpressions</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- {<span style="color:#204a87;font-weight:bold">key: tier, operator: In, values</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">cache]}</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># Specifies which State is the filter to be used when attempting to retrieve a GameServer</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># via Allocation. Defaults to &#34;Ready&#34;. The only other option is &#34;Allocated&#34;, which can be used in conjunction with</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># label/annotation/player selectors to retrieve an already Allocated GameServer.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">gameServerState</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Ready</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># [Stage:Alpha]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># [FeatureFlag:PlayerAllocationFilter]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># Provides a filter on minimum and maximum values for player capacity when retrieving a GameServer</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># through Allocation. Defaults to no limits.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">players</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">minAvailable</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">maxAvailable</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">99</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># Deprecated, use field selectors instead.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># An ordered list of preferred GameServer label selectors</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># that are optional to be fulfilled, but will be searched before the `required` selector.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># If the first selector is not matched, the selection attempts the second selector, and so on.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># If any of the preferred selectors are matched, the required selector is not considered.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># This is useful for things like smoke testing of new game servers.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># This also support matchExpressions, gameServerState and player filters.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">preferred</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">matchLabels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">agones.dev/fleet</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">green-fleet</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># [Stage:Alpha]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># [FeatureFlag:PlayerAllocationFilter]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">players</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">minAvailable</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">maxAvailable</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">99</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">matchLabels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">agones.dev/fleet</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">blue-fleet</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># defines how GameServers are organised across the cluster.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># Options include:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># &#34;Packed&#34; (default) is aimed at dynamic Kubernetes clusters, such as cloud providers, wherein we want to bin pack</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># resources</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># &#34;Distributed&#34; is aimed at static Kubernetes clusters, wherein we want to distribute resources across the entire</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># cluster</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">scheduling</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Packed</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># Optional custom metadata that is added to the game server at allocation</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># You can use this to tell the server necessary session data</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">labels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">mode</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">deathmatch</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">annotations</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">map</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">garden22</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span></span></span></code></pre></div>
    </div>
</div>

<p>The <code>spec</code> field is the actual <code>GameServerAllocation</code> specification, and it is composed as follows:</p>
<ul>
<li>Deprecated, use <code>selectors</code> instead. If <code>selectors</code> is set, this field will be ignored.
<code>required</code> is a <a href="https://codeblind.ai/docs/reference/agones_crd_api_reference/#allocation.agones.dev/v1.GameServerSelector">GameServerSelector</a>
(matchLabels. matchExpressions, gameServerState and player filters) from which to choose GameServers from.</li>
<li>Deprecated, use <code>selectors</code> instead. If <code>selectors</code> is set, this field will be ignored.
<code>preferred</code> is an ordered list of preferred <a href="https://codeblind.ai/docs/reference/agones_crd_api_reference/#allocation.agones.dev/v1.GameServerSelector">GameServerSelector</a>
that are <em>optional</em> to be fulfilled, but will be searched before the <code>required</code> selector.
If the first selector is not matched, the selection attempts the second selector, and so on.
If any of the <code>preferred</code> selectors are matched, the <code>required</code> selector is not considered.
This is useful for things like smoke testing of new game servers.</li>
<li><code>selectors</code> is an ordered list of <a href="https://codeblind.ai/docs/reference/agones_crd_api_reference/#allocation.agones.dev/v1.GameServerSelector">GameServerSelector</a>.
If the first selector is not matched, the selection attempts the second selector, and so on.
This is useful for things like smoke testing of new game servers.</li>
<li><code>matchLabels</code> is a map of {key,value} pairs. A single {key,value} in the matchLabels map is equivalent to an element
of matchExpressions, whose key field is &ldquo;key&rdquo;, the operator is &ldquo;In&rdquo;, and the values array contains only &ldquo;value&rdquo;.
The requirements are ANDed. Optional.</li>
<li><code>matchExpressions</code> is a list of label selector requirements. The requirements are ANDed. Optional.</li>
<li><code>gameServerState</code> GameServerState specifies which State is the filter to be used when attempting to retrieve a
GameServer via Allocation. Defaults to &ldquo;Ready&rdquo;. The only other option is &ldquo;Allocated&rdquo;, which can be used in
conjunction with label/annotation/player selectors to retrieve an already Allocated GameServer.</li>
<li><code>counters</code> (Alpha, &ldquo;CountsAndLists&rdquo; feature flag) enables filtering based on game server Counter status, such as
the minimum and maximum number of active rooms. This helps in selecting game servers based on their current activity
or capacity. Optional.</li>
<li><code>lists</code> (Alpha, &ldquo;CountsAndLists&rdquo; feature flag) enables filtering based on game server List status, such as allowing
for inclusion or exclusion of specific players. Optional.</li>
<li><code>scheduling</code> defines how GameServers are organised across the cluster, in this case specifically when allocating
<code>GameServers</code> for usage.
&ldquo;Packed&rdquo; (default) is aimed at dynamic Kubernetes clusters, such as cloud providers, wherein we want to bin pack
resources. &ldquo;Distributed&rdquo; is aimed at static Kubernetes clusters, wherein we want to distribute resources across the entire
cluster. See <a href="https://codeblind.ai/docs/advanced/scheduling-and-autoscaling/">Scheduling and Autoscaling</a> for more details.</li>
<li><code>metadata</code> is an optional list of custom labels and/or annotations that will be used to patch
the game server&rsquo;s metadata in the moment of allocation. This can be used to tell the server necessary session data</li>
<li><code>priorities</code> (Alpha, requires <code>CountsAndLists</code> feature flag) manages counters and lists for game servers, setting limits on
room counts and player inclusion/exclusion.</li>
<li><code>counters</code> (Alpha, &ldquo;CountsAndLists&rdquo; feature flag) Counter actions to perform during allocation.</li>
<li><code>lists</code> (Alpha, &ldquo;CountsAndLists&rdquo; feature flag) List actions to perform during allocation.</li>
</ul>
<p>Once created the <code>GameServerAllocation</code> will have a <code>status</code> field consisting of the following:</p>
<ul>
<li><code>State</code> is the current state of a GameServerAllocation, e.g. <code>Allocated</code>, or <code>UnAllocated</code></li>
<li><code>GameServerName</code> is the name of the game server attached to this allocation, once the <code>state</code> is <code>Allocated</code></li>
<li><code>Ports</code> is a list of the ports that the game server makes available. See <a href="https://codeblind.ai/docs/reference/gameserver/">the GameServer Reference</a> for more details.</li>
<li><code>Address</code> is the primary network address where the game server can be reached.</li>
<li><code>Addresses</code> is an array of all network addresses where the game server can be reached. It is a copy of the <a href="https://v1-26.docs.kubernetes.io/docs/reference/generated/kubernetes-api/v1.26/#nodeaddress-v1-core"><code>Node.Status.addresses</code></a> field for the node the <code>GameServer</code> is scheduled on.</li>
<li><code>NodeName</code> is the name of the node that the gameserver is running on.</li>
<li><code>Source</code> is &ldquo;local&rdquo; unless this allocation is from a remote cluster, in which case <code>Source</code> is the endpoint of the remote agones-allocator. See <a href="https://codeblind.ai/docs/advanced/multi-cluster-allocation/">Multi-cluster Allocation</a> for more details.</li>
<li><code>Metadata</code> conststs of:
<ul>
<li><code>Labels</code> containing the labels of the game server at allocation time.</li>
<li><code>Annotations</code> containing the annotations of the underlying game server at allocation time.</li>
</ul>
</li>
</ul>


<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Info</h4>

    <p>For performance reasons, the query cache for a <code>GameServerAllocation</code> is <em>eventually consistent</em>.</p>
<p>Usually, the cache is populated practically immediately on <code>GameServer</code> change, but under high load of the Kubernetes
control plane, it may take some time for updates to <code>GameServer</code> selectable features to be populated into the cache
(although this doesn&rsquo;t affect the atomicity of the Allocation operation).</p>
<p>While Code Blind will do a small series of retries when an allocatable <code>GameServer</code> is not available in its cache,
depending on your game requirements, it may be worth implementing your own more extend retry mechanism for
Allocation requests for high load scenarios.</p>


</div>

<p>Each <code>GameServerAllocation</code> will allocate from a single <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces">namespace</a>. The namespace can be specified outside of
the spec, either with the <code>--namespace</code> flag when using the command line / <code>kubectl</code> or
<a href="https://codeblind.ai/docs/guides/access-api/#allocate-a-gameserver-from-a-fleet-named-simple-game-server-with-gameserverallocation">in the url</a>
when using an API call. If not specified when using the command line, the <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces">namespace</a> will be automatically set to <code>default</code>.</p>
<h2 id="next-steps">Next Steps:</h2>
<ul>
<li>Check out the <a href="https://codeblind.ai/docs/advanced/allocator-service/">Allocator Service</a> as a richer alternative to <code>GameServerAllocation</code>.</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-00ae33a4d3a44f39e3c7d65e198fc037">8.4 - Fleet Autoscaler Specification</h1>
    <div class="lead">A <code>FleetAutoscaler</code>&rsquo;s job is to automatically scale up and down a <code>Fleet</code> in response to demand.</div>
	<p>A full <code>FleetAutoscaler</code> specification is available below and in the

<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>example folder</a> for reference, but here are several
examples that show different autoscaling policies.</p>
<h2 id="ready-buffer-autoscaling">Ready Buffer Autoscaling</h2>
<p>Fleet autoscaling with a buffer can be used to maintain a configured number of game server instances ready to serve
players based on number of allocated instances in a Fleet. The buffer size can be specified as an absolute number or a
percentage of the desired number of Ready game server instances over the Allocated count.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;autoscaling.agones.dev/v1&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">FleetAutoscaler</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic"># FleetAutoscaler Metadata</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic"># https://v1-27.docs.kubernetes.io/docs/reference/generated/kubernetes-api/v1.27/#objectmeta-v1-meta</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">fleet-autoscaler-example</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># The name of the fleet to attach to and control. Must be an existing Fleet in the same namespace</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># as this FleetAutoscaler</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">fleetName</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">fleet-example</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># The autoscaling policy</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">policy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># type of the policy. for now, only Buffer is available</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Buffer</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># parameters of the buffer policy</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">buffer</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># Size of a buffer of &#34;ready&#34; game server instances</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># The FleetAutoscaler will scale the fleet up and down trying to maintain this buffer, </span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># as instances are being allocated or terminated</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># it can be specified either in absolute (i.e. 5) or percentage format (i.e. 5%)</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">bufferSize</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">5</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># minimum fleet size to be set by this FleetAutoscaler. </span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># if not specified, the actual minimum fleet size will be bufferSize</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">minReplicas</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">10</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># maximum fleet size that can be set by this FleetAutoscaler</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># required</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">maxReplicas</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">20</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># The autoscaling sync strategy</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">sync</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># type of the sync. for now, only FixedInterval is available</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">FixedInterval</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># parameters of the fixedInterval sync</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">fixedInterval</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># the time in seconds between each auto scaling</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">seconds</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">30</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h2 id="counter-and-list-autoscaling">Counter and List Autoscaling</h2>
<p>A Counter based autoscaler can be used to autoscale <code>GameServers</code> based on a Count and Capacity set on each of the
GameServers in a Fleet to ensure there is always a buffer of total capacity available.</p>
<p>For example, if you have a game server that can support 10 rooms, and you want to ensure that there are always at least
5 rooms available, you could use a counter-based autoscaler with a buffer size of 5. The autoscaler would then scale the
<code>Fleet</code> up or down based on the difference between the count of rooms across the <code>Fleet</code> and the capacity of
rooms across the Fleet to ensure the buffer is maintained.</p>
<p>Counter-based <code>FleetAutoscaler</code> specification below and in the 
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>example folder</a>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">autoscaling.agones.dev/v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">FleetAutoscaler</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">fleet-autoscaler-counter</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">fleetName</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">fleet-example</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">policy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Counter </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Counter based autoscaling</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">counter</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># Key is the name of the Counter. Required field.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">players</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># BufferSize is the size of a buffer of counted items that are available in the Fleet (available capacity).</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># Value can be an absolute number (ex: 5) or a percentage of the Counter available capacity (ex: 5%).</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># An absolute number is calculated from percentage by rounding up. Must be bigger than 0. Required field.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">bufferSize</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">5</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># MinCapacity is the minimum aggregate Counter total capacity across the fleet.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># If BufferSize is specified as a percentage, MinCapacity is required and cannot be 0.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># If non zero, MinCapacity must be smaller than MaxCapacity and must be greater than or equal to BufferSize.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">minCapacity</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">10</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># MaxCapacity is the maximum aggregate Counter total capacity across the fleet.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># MaxCapacity must be greater than or equal to both MinCapacity and BufferSize. Required field.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">maxCapacity</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">100</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>A List based autoscaler can be used to autoscale <code>GameServers</code> based on the List length and Capacity set on each of the
GameServers in a Fleet to ensure there is always a buffer of total capacity available.</p>
<p>For example, if you have a game server that can support 10 players, and you want to ensure that there are always
room for at least 5 players across <code>GameServers</code> in a <code>Fleet</code>, you could use a list-based autoscaler with a buffer size
of 5. The autoscaler would then scale the <code>Fleet</code> up or down based on the difference between the total length of
the <code>players</code> and the total <code>players</code> capacity across the Fleet to ensure the buffer is maintained.</p>
<p>List-based <code>FleetAutoscaler</code> specification below and in the 
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>example folder</a>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">autoscaling.agones.dev/v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">FleetAutoscaler</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">fleet-autoscaler-list</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">fleetName</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">fleet-example</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">policy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">List </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># List based autoscaling.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">list</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># Key is the name of the List. Required field.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">rooms</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># BufferSize is the size of a buffer based on the List capacity that is available over the current</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># aggregate List length in the Fleet (available capacity).</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># It can be specified either as an absolute value (i.e. 5) or percentage format (i.e. 5%).</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># Must be bigger than 0. Required field.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">bufferSize</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">5</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># MinCapacity is the minimum aggregate List total capacity across the fleet.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># If BufferSize is specified as a percentage, MinCapacity is required must be greater than 0.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># If non-zero, MinCapacity must be smaller than MaxCapacity and must be greater than or equal to BufferSize.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">minCapacity</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">10</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># MaxCapacity is the maximum aggregate List total capacity across the fleet.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># MaxCapacity must be greater than or equal to both MinCapacity and BufferSize. Required field.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">maxCapacity</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">100</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h2 id="webhook-autoscaling">Webhook Autoscaling</h2>
<p>A webhook-based <code>FleetAutoscaler</code> can be used to delegate the scaling logic to a separate http based service. This
can be useful if you want to use a custom scaling algorithm or if you want to integrate with other systems. For
example, you could use a webhook-based <code>FleetAutoscaler</code> to scale your fleet based on data from a match-maker or player
authentication system or a combination of systems.</p>
<p>Webhook based autoscalers have the added benefit of being able to scale a Fleet to 0 replicas, since they are able to
scale up on demand based on an external signal before a <code>GameServerAllocation</code> is executed from a match-maker or
similar system.</p>
<p>In order to define the path to your Webhook you can use either <code>URL</code> or <code>service</code>. Note that <code>caBundle</code> parameter is
required if you use HTTPS for webhook <code>FleetAutoscaler</code>, <code>caBundle</code> should be omitted if you want to use HTTP webhook
server.</p>
<p>For Webhook FleetAutoscaler below and in 
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>example folder</a>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;autoscaling.agones.dev/v1&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">FleetAutoscaler</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">webhook-fleet-autoscaler</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">fleetName</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">simple-game-server</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">policy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># type of the policy - this example is Webhook</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Webhook</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># parameters for the webhook policy - this is a WebhookClientConfig, as per other K8s webhooks</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">webhook</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># use a service, or URL</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">service</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">autoscaler-webhook-service</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">namespace</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">default</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">path</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">scale</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># optional for URL defined webhooks</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># url: &#34;&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># caBundle:  optional, used for HTTPS webhook type</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># The autoscaling sync strategy</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">sync</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># type of the sync. for now, only FixedInterval is available</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">FixedInterval</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># parameters of the fixedInterval sync</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">fixedInterval</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># the time in seconds between each auto scaling</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">seconds</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">30</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>See the <a href="/docs/reference/fleetautoscaler/#webhook-endpoint-specification">Webhook Endpoint Specification</a> for the specification of the incoming and
outgoing JSON packet structure for the webhook endpoint.</p>
<h2 id="spec-field-reference">Spec Field Reference</h2>
<p>The <code>spec</code> field of the <code>FleetAutoscaler</code> is composed as follows:</p>
<ul>
<li><code>fleetName</code> is name of the fleet to attach to and control. Must be an existing <code>Fleet</code> in the same namespace
as this <code>FleetAutoscaler</code>.</li>
<li><code>policy</code> is the autoscaling policy
<ul>
<li><code>type</code> is type of the policy. &ldquo;Buffer&rdquo; and &ldquo;Webhook&rdquo; are available</li>
<li><code>buffer</code> parameters of the buffer policy type
<ul>
<li><code>bufferSize</code>  is the size of a buffer of &ldquo;ready&rdquo; and &ldquo;reserved&rdquo; game server instances.
The FleetAutoscaler will scale the fleet up and down trying to maintain this buffer,
as instances are being allocated or terminated.
Note that &ldquo;reserved&rdquo; game servers could not be scaled down.
It can be specified either in absolute (i.e. 5) or percentage format (i.e. 5%)</li>
<li><code>minReplicas</code> is the minimum fleet size to be set by this FleetAutoscaler.
if not specified, the minimum fleet size will be bufferSize if absolute value is used.
When <code>bufferSize</code> in percentage format is used, <code>minReplicas</code> should be more than 0.</li>
<li><code>maxReplicas</code> is the maximum fleet size that can be set by this FleetAutoscaler. Required.</li>
</ul>
</li>
<li><code>webhook</code> parameters of the webhook policy type
<ul>
<li><code>service</code> is a reference to the service for this webhook. Either <code>service</code> or <code>url</code> must be specified. If the webhook is running within the cluster, then you should use <code>service</code>. Port 8000 will be used if it is open, otherwise it is an error.
<ul>
<li><code>name</code>  is the service name bound to Deployment of autoscaler webhook. Required 
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>(see example)</a>
The FleetAutoscaler will scale the fleet up and down based on the response from this webhook server</li>
<li><code>namespace</code> is the kubernetes namespace where webhook is deployed. Optional
If not specified, the &ldquo;default&rdquo; would be used</li>
<li><code>path</code> is an optional URL path which will be sent in any request to this service. (i. e. /scale)</li>
<li><code>port</code> is optional, it is the port for the service which is hosting the webhook. The default is 8000 for backward compatibility. If given, it should be a valid port number (1-65535, inclusive).</li>
</ul>
</li>
<li><code>url</code> gives the location of the webhook, in standard URL form (<code>[scheme://]host:port/path</code>). Exactly one of <code>url</code> or <code>service</code> must be specified. The <code>host</code> should not refer to a service running in the cluster; use the <code>service</code> field instead.  (optional, instead of service)</li>
<li><code>caBundle</code> is a PEM encoded certificate authority bundle which is used to issue and then validate the webhook&rsquo;s server certificate. Base64 encoded PEM string. Required only for HTTPS. If not present HTTP client would be used.</li>
</ul>
</li>
<li>Note: only one <code>buffer</code> or <code>webhook</code> could be defined for FleetAutoscaler which is based on the <code>type</code> field.</li>
<li><code>counter</code> parameters of the counter policy type
<ul>
<li><code>counter</code> contains the settings for counter-based autoscaling:
<ul>
<li><code>key</code> is the name of the counter to use for scaling decisions.</li>
<li><code>bufferSize</code> is the size of a buffer of counted items that are available in the Fleet (available capacity). Value can be an absolute number or a percentage of desired game server instances. An absolute number is calculated from percentage by rounding up. Must be bigger than 0.</li>
<li><code>minCapacity</code> is the minimum aggregate Counter total capacity across the fleet. If zero, MinCapacity is ignored. If non zero, MinCapacity must be smaller than MaxCapacity and bigger than BufferSize.</li>
<li><code>maxCapacity</code> is the maximum aggregate Counter total capacity across the fleet. It must be bigger than both MinCapacity and BufferSize.</li>
</ul>
</li>
</ul>
</li>
<li><code>list</code> parameters of the list policy type
<ul>
<li><code>list</code> contains the settings for list-based autoscaling:
<ul>
<li><code>key</code> is the name of the list to use for scaling decisions.</li>
<li><code>bufferSize</code> is the size of a buffer based on the List capacity that is available over the current aggregate List length in the Fleet (available capacity). It can be specified either as an absolute value or percentage format.</li>
<li><code>minCapacity</code> is the minimum aggregate List total capacity across the fleet. If zero, it is ignored. If non zero, it must be smaller than MaxCapacity and bigger than BufferSize.</li>
<li><code>maxCapacity</code> is the maximum aggregate List total capacity across the fleet. It must be bigger than both MinCapacity and BufferSize. Required field.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><code>sync</code> is autoscaling sync strategy. It defines when to run the autoscaling
<ul>
<li><code>type</code> is type of the sync. For now only &ldquo;FixedInterval&rdquo; is available</li>
<li><code>fixedInterval</code> parameters of the fixedInterval sync
<ul>
<li><code>seconds</code> is the time in seconds between each autoscaling</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="webhook-endpoint-specification">Webhook Endpoint Specification</h2>
<p>A webhook based <code>FleetAutoscaler</code> sends an HTTP POST request to the webhook endpoint every sync period (default is 30s)
with a JSON body, and scale the target fleet based on the data that is returned.</p>
<p>The JSON payload that is sent is a <code>FleetAutoscaleReview</code> data structure and a <code>FleetAutoscaleResponse</code> data
structure is expected to be returned.</p>
<p>The <code>FleetAutoscaleResponse</code>&rsquo;s <code>Replica</code> field is used to set the target <code>Fleet</code> count with each sync interval, thereby
providing the autoscaling functionality.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">// FleetAutoscaleReview is passed to the webhook with a populated Request value,
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">// and then returned with a populated Response.
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#204a87;font-weight:bold">type</span> <span style="color:#000">FleetAutoscaleReview</span> <span style="color:#204a87;font-weight:bold">struct</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">Request</span>  <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">FleetAutoscaleRequest</span>  <span style="color:#4e9a06">`json:&#34;request&#34;`</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">Response</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">FleetAutoscaleResponse</span> <span style="color:#4e9a06">`json:&#34;response&#34;`</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">type</span> <span style="color:#000">FleetAutoscaleRequest</span> <span style="color:#204a87;font-weight:bold">struct</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#8f5902;font-style:italic">// UID is an identifier for the individual request/response. It allows us to distinguish instances of requests which are
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>	<span style="color:#8f5902;font-style:italic">// otherwise identical (parallel requests, requests when earlier requests did not modify etc)
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>	<span style="color:#8f5902;font-style:italic">// The UID is meant to track the round trip (request/response) between the Autoscaler and the WebHook, not the user request.
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>	<span style="color:#8f5902;font-style:italic">// It is suitable for correlating log entries between the webhook and apiserver, for either auditing or debugging.
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>	<span style="color:#000">UID</span> <span style="color:#000">types</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">UID</span> <span style="color:#4e9a06">`json:&#34;uid&#34;&#34;`</span>
</span></span><span style="display:flex;"><span>	<span style="color:#8f5902;font-style:italic">// Name is the name of the Fleet being scaled
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>	<span style="color:#000">Name</span> <span style="color:#204a87;font-weight:bold">string</span> <span style="color:#4e9a06">`json:&#34;name&#34;`</span>
</span></span><span style="display:flex;"><span>	<span style="color:#8f5902;font-style:italic">// Namespace is the namespace associated with the request (if any).
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>	<span style="color:#000">Namespace</span> <span style="color:#204a87;font-weight:bold">string</span> <span style="color:#4e9a06">`json:&#34;namespace&#34;`</span>
</span></span><span style="display:flex;"><span>	<span style="color:#8f5902;font-style:italic">// The Fleet&#39;s status values
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>	<span style="color:#000">Status</span> <span style="color:#000">v1</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">FleetStatus</span> <span style="color:#4e9a06">`json:&#34;status&#34;`</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">type</span> <span style="color:#000">FleetAutoscaleResponse</span> <span style="color:#204a87;font-weight:bold">struct</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#8f5902;font-style:italic">// UID is an identifier for the individual request/response.
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>	<span style="color:#8f5902;font-style:italic">// This should be copied over from the corresponding FleetAutoscaleRequest.
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>	<span style="color:#000">UID</span> <span style="color:#000">types</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">UID</span> <span style="color:#4e9a06">`json:&#34;uid&#34;`</span>
</span></span><span style="display:flex;"><span>	<span style="color:#8f5902;font-style:italic">// Set to false if no scaling should occur to the Fleet
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>	<span style="color:#000">Scale</span> <span style="color:#204a87;font-weight:bold">bool</span> <span style="color:#4e9a06">`json:&#34;scale&#34;`</span>
</span></span><span style="display:flex;"><span>	<span style="color:#8f5902;font-style:italic">// The targeted replica count
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>	<span style="color:#000">Replicas</span> <span style="color:#204a87;font-weight:bold">int32</span> <span style="color:#4e9a06">`json:&#34;replicas&#34;`</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">// FleetStatus is the status of a Fleet
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#204a87;font-weight:bold">type</span> <span style="color:#000">FleetStatus</span> <span style="color:#204a87;font-weight:bold">struct</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#8f5902;font-style:italic">// Replicas the total number of current GameServer replicas
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>	<span style="color:#000">Replicas</span> <span style="color:#204a87;font-weight:bold">int32</span> <span style="color:#4e9a06">`json:&#34;replicas&#34;`</span>
</span></span><span style="display:flex;"><span>	<span style="color:#8f5902;font-style:italic">// ReadyReplicas are the number of Ready GameServer replicas
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>	<span style="color:#000">ReadyReplicas</span> <span style="color:#204a87;font-weight:bold">int32</span> <span style="color:#4e9a06">`json:&#34;readyReplicas&#34;`</span>
</span></span><span style="display:flex;"><span>	<span style="color:#8f5902;font-style:italic">// ReservedReplicas are the total number of Reserved GameServer replicas in this fleet.
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>	<span style="color:#8f5902;font-style:italic">// Reserved instances won&#39;t be deleted on scale down, but won&#39;t cause an autoscaler to scale up.
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>	<span style="color:#000">ReservedReplicas</span> <span style="color:#204a87;font-weight:bold">int32</span> <span style="color:#4e9a06">`json:&#34;reservedReplicas&#34;`</span>
</span></span><span style="display:flex;"><span>	<span style="color:#8f5902;font-style:italic">// AllocatedReplicas are the number of Allocated GameServer replicas
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>	<span style="color:#000">AllocatedReplicas</span> <span style="color:#204a87;font-weight:bold">int32</span> <span style="color:#4e9a06">`json:&#34;allocatedReplicas&#34;`</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>For Webhook Fleetautoscaler Policy either HTTP or HTTPS could be used. Switching between them occurs depending on https presence in <code>URL</code> or by the presence of <code>caBundle</code>.
The example of the webhook written in Go could be found 
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>here</a>.</p>
<p>It implements the 
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>scaling logic</a> based on the percentage of allocated gameservers in a fleet.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-121f697fccaea4a701edfcac0c1c0916">8.5 - Code Blind Kubernetes API</h1>
    <div class="lead">Detailed list of Code Blind Custom Resource Definitions available</div>
	



<p>Packages:</p>
<ul>
<li>
<a href="#allocation.agones.dev%2fv1">allocation.agones.dev/v1</a>
</li>
<li>
<a href="#autoscaling.agones.dev%2fv1">autoscaling.agones.dev/v1</a>
</li>
<li>
<a href="#multicluster.agones.dev%2fv1">multicluster.agones.dev/v1</a>
</li>
<li>
<a href="#agones.dev%2fv1">agones.dev/v1</a>
</li>
</ul>
<h2 id="allocation.agones.dev/v1">allocation.agones.dev/v1</h2>
<p>
<p>Package v1 is the v1 version of the API.</p>
</p>
Resource Types:
<ul><li>
<a href="#allocation.agones.dev/v1.GameServerAllocation">GameServerAllocation</a>
</li></ul>
<h3 id="allocation.agones.dev/v1.GameServerAllocation">GameServerAllocation
</h3>
<p>
<p>GameServerAllocation is the data structure for allocating against a set of
GameServers, defined <code>selectors</code> selectors</p>
</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>apiVersion</code></br>
string</td>
<td>
<code>
allocation.agones.dev/v1
</code>
</td>
</tr>
<tr>
<td>
<code>kind</code></br>
string
</td>
<td><code>GameServerAllocation</code></td>
</tr>
<tr>
<td>
<code>metadata</code></br>
<em>
<a href="https://v1-27.docs.kubernetes.io/docs/reference/generated/kubernetes-api/v1.27/#objectmeta-v1-meta">
Kubernetes meta/v1.ObjectMeta
</a>
</em>
</td>
<td>
Refer to the Kubernetes API documentation for the fields of the
<code>metadata</code> field.
</td>
</tr>
<tr>
<td>
<code>spec</code></br>
<em>
<a href="#allocation.agones.dev/v1.GameServerAllocationSpec">
GameServerAllocationSpec
</a>
</em>
</td>
<td>
<br/>
<br/>
<table>
<tr>
<td>
<code>multiClusterSetting</code></br>
<em>
<a href="#allocation.agones.dev/v1.MultiClusterSetting">
MultiClusterSetting
</a>
</em>
</td>
<td>
<p>MultiClusterPolicySelector if specified, multi-cluster policies are applied.
Otherwise, allocation will happen locally.</p>
</td>
</tr>
<tr>
<td>
<code>required</code></br>
<em>
<a href="#allocation.agones.dev/v1.GameServerSelector">
GameServerSelector
</a>
</em>
</td>
<td>
<p>Deprecated: use field Selectors instead. If Selectors is set, this field is ignored.
Required is the GameServer selector from which to choose GameServers from.
Defaults to all GameServers.</p>
</td>
</tr>
<tr>
<td>
<code>preferred</code></br>
<em>
<a href="#allocation.agones.dev/v1.GameServerSelector">
[]GameServerSelector
</a>
</em>
</td>
<td>
<p>Deprecated: use field Selectors instead. If Selectors is set, this field is ignored.
Preferred is an ordered list of preferred GameServer selectors
that are optional to be fulfilled, but will be searched before the <code>required</code> selector.
If the first selector is not matched, the selection attempts the second selector, and so on.
If any of the preferred selectors are matched, the required selector is not considered.
This is useful for things like smoke testing of new game servers.</p>
</td>
</tr>
<tr>
<td>
<code>priorities</code></br>
<em>
<a href="#agones.dev/v1.Priority">
[]Priority
</a>
</em>
</td>
<td>
<em>(Optional)</em>
<p>(Alpha, CountsAndLists feature flag) The first Priority on the array of Priorities is the most
important for sorting. The allocator will use the first priority for sorting GameServers by
available Capacity in the Selector set. Acts as a tie-breaker after sorting the game servers
by State and Strategy Packed. Impacts which GameServer is checked first.</p>
</td>
</tr>
<tr>
<td>
<code>selectors</code></br>
<em>
<a href="#allocation.agones.dev/v1.GameServerSelector">
[]GameServerSelector
</a>
</em>
</td>
<td>
<p>Ordered list of GameServer label selectors.
If the first selector is not matched, the selection attempts the second selector, and so on.
This is useful for things like smoke testing of new game servers.
Note: This field can only be set if neither Required or Preferred is set.</p>
</td>
</tr>
<tr>
<td>
<code>scheduling</code></br>
<em>
agones.dev/agones/pkg/apis.SchedulingStrategy
</em>
</td>
<td>
<p>Scheduling strategy. Defaults to &ldquo;Packed&rdquo;.</p>
</td>
</tr>
<tr>
<td>
<code>metadata</code></br>
<em>
<a href="#allocation.agones.dev/v1.MetaPatch">
MetaPatch
</a>
</em>
</td>
<td>
<p>MetaPatch is optional custom metadata that is added to the game server at allocation
You can use this to tell the server necessary session data</p>
</td>
</tr>
<tr>
<td>
<code>counters</code></br>
<em>
<a href="#allocation.agones.dev/v1.CounterAction">
map[string]agones.dev/agones/pkg/apis/allocation/v1.CounterAction
</a>
</em>
</td>
<td>
<em>(Optional)</em>
<p>(Alpha, CountsAndLists feature flag) Counter actions to perform during allocation.</p>
</td>
</tr>
<tr>
<td>
<code>lists</code></br>
<em>
<a href="#allocation.agones.dev/v1.ListAction">
map[string]agones.dev/agones/pkg/apis/allocation/v1.ListAction
</a>
</em>
</td>
<td>
<em>(Optional)</em>
<p>(Alpha, CountsAndLists feature flag) List actions to perform during allocation.</p>
</td>
</tr>
</table>
</td>
</tr>
<tr>
<td>
<code>status</code></br>
<em>
<a href="#allocation.agones.dev/v1.GameServerAllocationStatus">
GameServerAllocationStatus
</a>
</em>
</td>
<td>
</td>
</tr>
</tbody>
</table>
<h3 id="allocation.agones.dev/v1.CounterAction">CounterAction
</h3>
<p>
(<em>Appears on:</em>
<a href="#allocation.agones.dev/v1.GameServerAllocationSpec">GameServerAllocationSpec</a>)
</p>
<p>
<p>CounterAction is an optional action that can be performed on a Counter at allocation.</p>
</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>action</code></br>
<em>
string
</em>
</td>
<td>
<em>(Optional)</em>
<p>Action must to either &ldquo;Increment&rdquo; or &ldquo;Decrement&rdquo; the Counter&rsquo;s Count. Must also define the Amount.</p>
</td>
</tr>
<tr>
<td>
<code>amount</code></br>
<em>
int64
</em>
</td>
<td>
<em>(Optional)</em>
<p>Amount is the amount to increment or decrement the Count. Must be a positive integer.</p>
</td>
</tr>
<tr>
<td>
<code>capacity</code></br>
<em>
int64
</em>
</td>
<td>
<em>(Optional)</em>
<p>Capacity is the amount to update the maximum capacity of the Counter to this number. Min 0, Max int64.</p>
</td>
</tr>
</tbody>
</table>
<h3 id="allocation.agones.dev/v1.CounterSelector">CounterSelector
</h3>
<p>
(<em>Appears on:</em>
<a href="#allocation.agones.dev/v1.GameServerSelector">GameServerSelector</a>)
</p>
<p>
<p>CounterSelector is the filter options for a GameServer based on the count and/or available capacity.</p>
</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>minCount</code></br>
<em>
int64
</em>
</td>
<td>
<em>(Optional)</em>
<p>MinCount is the minimum current value. Defaults to 0.</p>
</td>
</tr>
<tr>
<td>
<code>maxCount</code></br>
<em>
int64
</em>
</td>
<td>
<em>(Optional)</em>
<p>MaxCount is the maximum current value. Defaults to 0, which translates as max(in64).</p>
</td>
</tr>
<tr>
<td>
<code>minAvailable</code></br>
<em>
int64
</em>
</td>
<td>
<em>(Optional)</em>
<p>MinAvailable specifies the minimum capacity (current capacity - current count) available on a GameServer. Defaults to 0.</p>
</td>
</tr>
<tr>
<td>
<code>maxAvailable</code></br>
<em>
int64
</em>
</td>
<td>
<em>(Optional)</em>
<p>MaxAvailable specifies the maximum capacity (current capacity - current count) available on a GameServer. Defaults to 0, which translates to max(int64).</p>
</td>
</tr>
</tbody>
</table>
<h3 id="allocation.agones.dev/v1.GameServerAllocationSpec">GameServerAllocationSpec
</h3>
<p>
(<em>Appears on:</em>
<a href="#allocation.agones.dev/v1.GameServerAllocation">GameServerAllocation</a>)
</p>
<p>
<p>GameServerAllocationSpec is the spec for a GameServerAllocation</p>
</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>multiClusterSetting</code></br>
<em>
<a href="#allocation.agones.dev/v1.MultiClusterSetting">
MultiClusterSetting
</a>
</em>
</td>
<td>
<p>MultiClusterPolicySelector if specified, multi-cluster policies are applied.
Otherwise, allocation will happen locally.</p>
</td>
</tr>
<tr>
<td>
<code>required</code></br>
<em>
<a href="#allocation.agones.dev/v1.GameServerSelector">
GameServerSelector
</a>
</em>
</td>
<td>
<p>Deprecated: use field Selectors instead. If Selectors is set, this field is ignored.
Required is the GameServer selector from which to choose GameServers from.
Defaults to all GameServers.</p>
</td>
</tr>
<tr>
<td>
<code>preferred</code></br>
<em>
<a href="#allocation.agones.dev/v1.GameServerSelector">
[]GameServerSelector
</a>
</em>
</td>
<td>
<p>Deprecated: use field Selectors instead. If Selectors is set, this field is ignored.
Preferred is an ordered list of preferred GameServer selectors
that are optional to be fulfilled, but will be searched before the <code>required</code> selector.
If the first selector is not matched, the selection attempts the second selector, and so on.
If any of the preferred selectors are matched, the required selector is not considered.
This is useful for things like smoke testing of new game servers.</p>
</td>
</tr>
<tr>
<td>
<code>priorities</code></br>
<em>
<a href="#agones.dev/v1.Priority">
[]Priority
</a>
</em>
</td>
<td>
<em>(Optional)</em>
<p>(Alpha, CountsAndLists feature flag) The first Priority on the array of Priorities is the most
important for sorting. The allocator will use the first priority for sorting GameServers by
available Capacity in the Selector set. Acts as a tie-breaker after sorting the game servers
by State and Strategy Packed. Impacts which GameServer is checked first.</p>
</td>
</tr>
<tr>
<td>
<code>selectors</code></br>
<em>
<a href="#allocation.agones.dev/v1.GameServerSelector">
[]GameServerSelector
</a>
</em>
</td>
<td>
<p>Ordered list of GameServer label selectors.
If the first selector is not matched, the selection attempts the second selector, and so on.
This is useful for things like smoke testing of new game servers.
Note: This field can only be set if neither Required or Preferred is set.</p>
</td>
</tr>
<tr>
<td>
<code>scheduling</code></br>
<em>
agones.dev/agones/pkg/apis.SchedulingStrategy
</em>
</td>
<td>
<p>Scheduling strategy. Defaults to &ldquo;Packed&rdquo;.</p>
</td>
</tr>
<tr>
<td>
<code>metadata</code></br>
<em>
<a href="#allocation.agones.dev/v1.MetaPatch">
MetaPatch
</a>
</em>
</td>
<td>
<p>MetaPatch is optional custom metadata that is added to the game server at allocation
You can use this to tell the server necessary session data</p>
</td>
</tr>
<tr>
<td>
<code>counters</code></br>
<em>
<a href="#allocation.agones.dev/v1.CounterAction">
map[string]agones.dev/agones/pkg/apis/allocation/v1.CounterAction
</a>
</em>
</td>
<td>
<em>(Optional)</em>
<p>(Alpha, CountsAndLists feature flag) Counter actions to perform during allocation.</p>
</td>
</tr>
<tr>
<td>
<code>lists</code></br>
<em>
<a href="#allocation.agones.dev/v1.ListAction">
map[string]agones.dev/agones/pkg/apis/allocation/v1.ListAction
</a>
</em>
</td>
<td>
<em>(Optional)</em>
<p>(Alpha, CountsAndLists feature flag) List actions to perform during allocation.</p>
</td>
</tr>
</tbody>
</table>
<h3 id="allocation.agones.dev/v1.GameServerAllocationState">GameServerAllocationState
(<code>string</code> alias)</p></h3>
<p>
(<em>Appears on:</em>
<a href="#allocation.agones.dev/v1.GameServerAllocationStatus">GameServerAllocationStatus</a>)
</p>
<p>
<p>GameServerAllocationState is the Allocation state</p>
</p>
<h3 id="allocation.agones.dev/v1.GameServerAllocationStatus">GameServerAllocationStatus
</h3>
<p>
(<em>Appears on:</em>
<a href="#allocation.agones.dev/v1.GameServerAllocation">GameServerAllocation</a>)
</p>
<p>
<p>GameServerAllocationStatus is the status for an GameServerAllocation resource</p>
</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>state</code></br>
<em>
<a href="#allocation.agones.dev/v1.GameServerAllocationState">
GameServerAllocationState
</a>
</em>
</td>
<td>
<p>GameServerState is the current state of an GameServerAllocation, e.g. Allocated, or UnAllocated</p>
</td>
</tr>
<tr>
<td>
<code>gameServerName</code></br>
<em>
string
</em>
</td>
<td>
</td>
</tr>
<tr>
<td>
<code>ports</code></br>
<em>
<a href="#agones.dev/v1.GameServerStatusPort">
[]GameServerStatusPort
</a>
</em>
</td>
<td>
</td>
</tr>
<tr>
<td>
<code>address</code></br>
<em>
string
</em>
</td>
<td>
</td>
</tr>
<tr>
<td>
<code>addresses</code></br>
<em>
<a href="https://v1-27.docs.kubernetes.io/docs/reference/generated/kubernetes-api/v1.27/#nodeaddress-v1-core">
[]Kubernetes core/v1.NodeAddress
</a>
</em>
</td>
<td>
</td>
</tr>
<tr>
<td>
<code>nodeName</code></br>
<em>
string
</em>
</td>
<td>
</td>
</tr>
<tr>
<td>
<code>source</code></br>
<em>
string
</em>
</td>
<td>
<p>If the allocation is from a remote cluster, Source is the endpoint of the remote agones-allocator.
Otherwise, Source is &ldquo;local&rdquo;</p>
</td>
</tr>
<tr>
<td>
<code>metadata</code></br>
<em>
<a href="#allocation.agones.dev/v1.GameServerMetadata">
GameServerMetadata
</a>
</em>
</td>
<td>
</td>
</tr>
</tbody>
</table>
<h3 id="allocation.agones.dev/v1.GameServerMetadata">GameServerMetadata
</h3>
<p>
(<em>Appears on:</em>
<a href="#allocation.agones.dev/v1.GameServerAllocationStatus">GameServerAllocationStatus</a>)
</p>
<p>
<p>GameServerMetadata is the metadata from the allocated game server at allocation time</p>
</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>labels</code></br>
<em>
map[string]string
</em>
</td>
<td>
</td>
</tr>
<tr>
<td>
<code>annotations</code></br>
<em>
map[string]string
</em>
</td>
<td>
</td>
</tr>
</tbody>
</table>
<h3 id="allocation.agones.dev/v1.GameServerSelector">GameServerSelector
</h3>
<p>
(<em>Appears on:</em>
<a href="#allocation.agones.dev/v1.GameServerAllocationSpec">GameServerAllocationSpec</a>)
</p>
<p>
<p>GameServerSelector contains all the filter options for selecting
a GameServer for allocation.</p>
</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>LabelSelector</code></br>
<em>
<a href="https://v1-27.docs.kubernetes.io/docs/reference/generated/kubernetes-api/v1.27/#labelselector-v1-meta">
Kubernetes meta/v1.LabelSelector
</a>
</em>
</td>
<td>
<p>
(Members of <code>LabelSelector</code> are embedded into this type.)
</p>
<p>See: <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/">https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/</a></p>
</td>
</tr>
<tr>
<td>
<code>gameServerState</code></br>
<em>
<a href="#agones.dev/v1.GameServerState">
GameServerState
</a>
</em>
</td>
<td>
<p>GameServerState specifies which State is the filter to be used when attempting to retrieve a GameServer
via Allocation. Defaults to &ldquo;Ready&rdquo;. The only other option is &ldquo;Allocated&rdquo;, which can be used in conjunction with
label/annotation/player selectors to retrieve an already Allocated GameServer.</p>
</td>
</tr>
<tr>
<td>
<code>players</code></br>
<em>
<a href="#allocation.agones.dev/v1.PlayerSelector">
PlayerSelector
</a>
</em>
</td>
<td>
<em>(Optional)</em>
<p>[Stage:Alpha]
[FeatureFlag:PlayerAllocationFilter]
Players provides a filter on minimum and maximum values for player capacity when retrieving a GameServer
through Allocation. Defaults to no limits.</p>
</td>
</tr>
<tr>
<td>
<code>counters</code></br>
<em>
<a href="#allocation.agones.dev/v1.CounterSelector">
map[string]agones.dev/agones/pkg/apis/allocation/v1.CounterSelector
</a>
</em>
</td>
<td>
<em>(Optional)</em>
<p>(Alpha, CountsAndLists feature flag) Counters provides filters on minimum and maximum values
for a Counter&rsquo;s count and available capacity when retrieving a GameServer through Allocation.
Defaults to no limits.</p>
</td>
</tr>
<tr>
<td>
<code>lists</code></br>
<em>
<a href="#allocation.agones.dev/v1.ListSelector">
map[string]agones.dev/agones/pkg/apis/allocation/v1.ListSelector
</a>
</em>
</td>
<td>
<em>(Optional)</em>
<p>(Alpha, CountsAndLists feature flag) Lists provides filters on minimum and maximum values
for List capacity, and for the existence of a value in a List, when retrieving a GameServer
through Allocation. Defaults to no limits.</p>
</td>
</tr>
</tbody>
</table>
<h3 id="allocation.agones.dev/v1.ListAction">ListAction
</h3>
<p>
(<em>Appears on:</em>
<a href="#allocation.agones.dev/v1.GameServerAllocationSpec">GameServerAllocationSpec</a>)
</p>
<p>
<p>ListAction is an optional action that can be performed on a List at allocation.</p>
</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>addValues</code></br>
<em>
[]string
</em>
</td>
<td>
<em>(Optional)</em>
<p>AddValues appends values to a List&rsquo;s Values array. Any duplicate values will be ignored.</p>
</td>
</tr>
<tr>
<td>
<code>capacity</code></br>
<em>
int64
</em>
</td>
<td>
<em>(Optional)</em>
<p>Capacity updates the maximum capacity of the Counter to this number. Min 0, Max 1000.</p>
</td>
</tr>
</tbody>
</table>
<h3 id="allocation.agones.dev/v1.ListSelector">ListSelector
</h3>
<p>
(<em>Appears on:</em>
<a href="#allocation.agones.dev/v1.GameServerSelector">GameServerSelector</a>)
</p>
<p>
<p>ListSelector is the filter options for a GameServer based on List available capacity and/or the
existence of a value in a List.</p>
</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>containsValue</code></br>
<em>
string
</em>
</td>
<td>
<em>(Optional)</em>
<p>ContainsValue says to only match GameServers who has this value in the list. Defaults to &ldquo;&rdquo;, which is all.</p>
</td>
</tr>
<tr>
<td>
<code>minAvailable</code></br>
<em>
int64
</em>
</td>
<td>
<em>(Optional)</em>
<p>MinAvailable specifies the minimum capacity (current capacity - current count) available on a GameServer. Defaults to 0.</p>
</td>
</tr>
<tr>
<td>
<code>maxAvailable</code></br>
<em>
int64
</em>
</td>
<td>
<em>(Optional)</em>
<p>MaxAvailable specifies the maximum capacity (current capacity - current count) available on a GameServer. Defaults to 0, which is translated as max(int64).</p>
</td>
</tr>
</tbody>
</table>
<h3 id="allocation.agones.dev/v1.MetaPatch">MetaPatch
</h3>
<p>
(<em>Appears on:</em>
<a href="#allocation.agones.dev/v1.GameServerAllocationSpec">GameServerAllocationSpec</a>)
</p>
<p>
<p>MetaPatch is the metadata used to patch the GameServer metadata on allocation</p>
</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>labels</code></br>
<em>
map[string]string
</em>
</td>
<td>
</td>
</tr>
<tr>
<td>
<code>annotations</code></br>
<em>
map[string]string
</em>
</td>
<td>
</td>
</tr>
</tbody>
</table>
<h3 id="allocation.agones.dev/v1.MultiClusterSetting">MultiClusterSetting
</h3>
<p>
(<em>Appears on:</em>
<a href="#allocation.agones.dev/v1.GameServerAllocationSpec">GameServerAllocationSpec</a>)
</p>
<p>
<p>MultiClusterSetting specifies settings for multi-cluster allocation.</p>
</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>enabled</code></br>
<em>
bool
</em>
</td>
<td>
</td>
</tr>
<tr>
<td>
<code>policySelector</code></br>
<em>
<a href="https://v1-27.docs.kubernetes.io/docs/reference/generated/kubernetes-api/v1.27/#labelselector-v1-meta">
Kubernetes meta/v1.LabelSelector
</a>
</em>
</td>
<td>
</td>
</tr>
</tbody>
</table>
<h3 id="allocation.agones.dev/v1.PlayerSelector">PlayerSelector
</h3>
<p>
(<em>Appears on:</em>
<a href="#allocation.agones.dev/v1.GameServerSelector">GameServerSelector</a>)
</p>
<p>
<p>PlayerSelector is the filter options for a GameServer based on player counts</p>
</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>minAvailable</code></br>
<em>
int64
</em>
</td>
<td>
</td>
</tr>
<tr>
<td>
<code>maxAvailable</code></br>
<em>
int64
</em>
</td>
<td>
</td>
</tr>
</tbody>
</table>
<hr/>
<h2 id="autoscaling.agones.dev/v1">autoscaling.agones.dev/v1</h2>
<p>
<p>Package v1 is the v1 version of the API.</p>
</p>
Resource Types:
<ul><li>
<a href="#autoscaling.agones.dev/v1.FleetAutoscaler">FleetAutoscaler</a>
</li></ul>
<h3 id="autoscaling.agones.dev/v1.FleetAutoscaler">FleetAutoscaler
</h3>
<p>
<p>FleetAutoscaler is the data structure for a FleetAutoscaler resource</p>
</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>apiVersion</code></br>
string</td>
<td>
<code>
autoscaling.agones.dev/v1
</code>
</td>
</tr>
<tr>
<td>
<code>kind</code></br>
string
</td>
<td><code>FleetAutoscaler</code></td>
</tr>
<tr>
<td>
<code>metadata</code></br>
<em>
<a href="https://v1-27.docs.kubernetes.io/docs/reference/generated/kubernetes-api/v1.27/#objectmeta-v1-meta">
Kubernetes meta/v1.ObjectMeta
</a>
</em>
</td>
<td>
Refer to the Kubernetes API documentation for the fields of the
<code>metadata</code> field.
</td>
</tr>
<tr>
<td>
<code>spec</code></br>
<em>
<a href="#autoscaling.agones.dev/v1.FleetAutoscalerSpec">
FleetAutoscalerSpec
</a>
</em>
</td>
<td>
<br/>
<br/>
<table>
<tr>
<td>
<code>fleetName</code></br>
<em>
string
</em>
</td>
<td>
</td>
</tr>
<tr>
<td>
<code>policy</code></br>
<em>
<a href="#autoscaling.agones.dev/v1.FleetAutoscalerPolicy">
FleetAutoscalerPolicy
</a>
</em>
</td>
<td>
<p>Autoscaling policy</p>
</td>
</tr>
<tr>
<td>
<code>sync</code></br>
<em>
<a href="#autoscaling.agones.dev/v1.FleetAutoscalerSync">
FleetAutoscalerSync
</a>
</em>
</td>
<td>
<em>(Optional)</em>
<p>Sync defines when FleetAutoscalers runs autoscaling</p>
</td>
</tr>
</table>
</td>
</tr>
<tr>
<td>
<code>status</code></br>
<em>
<a href="#autoscaling.agones.dev/v1.FleetAutoscalerStatus">
FleetAutoscalerStatus
</a>
</em>
</td>
<td>
</td>
</tr>
</tbody>
</table>
<h3 id="autoscaling.agones.dev/v1.BufferPolicy">BufferPolicy
</h3>
<p>
(<em>Appears on:</em>
<a href="#autoscaling.agones.dev/v1.FleetAutoscalerPolicy">FleetAutoscalerPolicy</a>)
</p>
<p>
<p>BufferPolicy controls the desired behavior of the buffer policy.</p>
</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>maxReplicas</code></br>
<em>
int32
</em>
</td>
<td>
<p>MaxReplicas is the maximum amount of replicas that the fleet may have.
It must be bigger than both MinReplicas and BufferSize</p>
</td>
</tr>
<tr>
<td>
<code>minReplicas</code></br>
<em>
int32
</em>
</td>
<td>
<p>MinReplicas is the minimum amount of replicas that the fleet must have
If zero, it is ignored.
If non zero, it must be smaller than MaxReplicas and bigger than BufferSize</p>
</td>
</tr>
<tr>
<td>
<code>bufferSize</code></br>
<em>
k8s.io/apimachinery/pkg/util/intstr.IntOrString
</em>
</td>
<td>
<p>BufferSize defines how many replicas the autoscaler tries to have ready all the time
Value can be an absolute number (ex: 5) or a percentage of desired gs instances (ex: 15%)
Absolute number is calculated from percentage by rounding up.
Example: when this is set to 20%, the autoscaler will make sure that 20%
of the fleet&rsquo;s game server replicas are ready. When this is set to 20,
the autoscaler will make sure that there are 20 available game servers
Must be bigger than 0
Note: by &ldquo;ready&rdquo; we understand in this case &ldquo;non-allocated&rdquo;; this is done to ensure robustness
and computation stability in different edge case (fleet just created, not enough
capacity in the cluster etc)</p>
</td>
</tr>
</tbody>
</table>
<h3 id="autoscaling.agones.dev/v1.CounterPolicy">CounterPolicy
</h3>
<p>
(<em>Appears on:</em>
<a href="#autoscaling.agones.dev/v1.FleetAutoscalerPolicy">FleetAutoscalerPolicy</a>)
</p>
<p>
<p>CounterPolicy controls the desired behavior of the Counter autoscaler policy.</p>
</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>key</code></br>
<em>
string
</em>
</td>
<td>
<p>Key is the name of the Counter. Required field.</p>
</td>
</tr>
<tr>
<td>
<code>maxCapacity</code></br>
<em>
int64
</em>
</td>
<td>
<p>MaxCapacity is the maximum aggregate Counter total capacity across the fleet.
MaxCapacity must be bigger than both MinCapacity and BufferSize. Required field.</p>
</td>
</tr>
<tr>
<td>
<code>minCapacity</code></br>
<em>
int64
</em>
</td>
<td>
<p>MinCapacity is the minimum aggregate Counter total capacity across the fleet.
If zero, MinCapacity is ignored.
If non zero, MinCapacity must be smaller than MaxCapacity and bigger than BufferSize.</p>
</td>
</tr>
<tr>
<td>
<code>bufferSize</code></br>
<em>
k8s.io/apimachinery/pkg/util/intstr.IntOrString
</em>
</td>
<td>
<p>BufferSize is the size of a buffer of counted items that are available in the Fleet (available
capacity). Value can be an absolute number (ex: 5) or a percentage of desired gs instances
(ex: 5%). An absolute number is calculated from percentage by rounding up.
Must be bigger than 0. Required field.</p>
</td>
</tr>
</tbody>
</table>
<h3 id="autoscaling.agones.dev/v1.FixedIntervalSync">FixedIntervalSync
</h3>
<p>
(<em>Appears on:</em>
<a href="#autoscaling.agones.dev/v1.FleetAutoscalerSync">FleetAutoscalerSync</a>)
</p>
<p>
<p>FixedIntervalSync controls the desired behavior of the fixed interval based sync.</p>
</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>seconds</code></br>
<em>
int32
</em>
</td>
<td>
<p>Seconds defines how often we run fleet autoscaling in seconds</p>
</td>
</tr>
</tbody>
</table>
<h3 id="autoscaling.agones.dev/v1.FleetAutoscaleRequest">FleetAutoscaleRequest
</h3>
<p>
(<em>Appears on:</em>
<a href="#autoscaling.agones.dev/v1.FleetAutoscaleReview">FleetAutoscaleReview</a>)
</p>
<p>
<p>FleetAutoscaleRequest defines the request to webhook autoscaler endpoint</p>
</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>uid</code></br>
<em>
k8s.io/apimachinery/pkg/types.UID
</em>
</td>
<td>
<p>UID is an identifier for the individual request/response. It allows us to distinguish instances of requests which are
otherwise identical (parallel requests, requests when earlier requests did not modify etc)
The UID is meant to track the round trip (request/response) between the Autoscaler and the WebHook, not the user request.
It is suitable for correlating log entries between the webhook and apiserver, for either auditing or debugging.</p>
</td>
</tr>
<tr>
<td>
<code>name</code></br>
<em>
string
</em>
</td>
<td>
<p>Name is the name of the Fleet being scaled</p>
</td>
</tr>
<tr>
<td>
<code>namespace</code></br>
<em>
string
</em>
</td>
<td>
<p>Namespace is the namespace associated with the request (if any).</p>
</td>
</tr>
<tr>
<td>
<code>status</code></br>
<em>
<a href="#agones.dev/v1.FleetStatus">
FleetStatus
</a>
</em>
</td>
<td>
<p>The Fleet&rsquo;s status values</p>
</td>
</tr>
</tbody>
</table>
<h3 id="autoscaling.agones.dev/v1.FleetAutoscaleResponse">FleetAutoscaleResponse
</h3>
<p>
(<em>Appears on:</em>
<a href="#autoscaling.agones.dev/v1.FleetAutoscaleReview">FleetAutoscaleReview</a>)
</p>
<p>
<p>FleetAutoscaleResponse defines the response of webhook autoscaler endpoint</p>
</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>uid</code></br>
<em>
k8s.io/apimachinery/pkg/types.UID
</em>
</td>
<td>
<p>UID is an identifier for the individual request/response.
This should be copied over from the corresponding FleetAutoscaleRequest.</p>
</td>
</tr>
<tr>
<td>
<code>scale</code></br>
<em>
bool
</em>
</td>
<td>
<p>Set to false if no scaling should occur to the Fleet</p>
</td>
</tr>
<tr>
<td>
<code>replicas</code></br>
<em>
int32
</em>
</td>
<td>
<p>The targeted replica count</p>
</td>
</tr>
</tbody>
</table>
<h3 id="autoscaling.agones.dev/v1.FleetAutoscaleReview">FleetAutoscaleReview
</h3>
<p>
<p>FleetAutoscaleReview is passed to the webhook with a populated Request value,
and then returned with a populated Response.</p>
</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>request</code></br>
<em>
<a href="#autoscaling.agones.dev/v1.FleetAutoscaleRequest">
FleetAutoscaleRequest
</a>
</em>
</td>
<td>
</td>
</tr>
<tr>
<td>
<code>response</code></br>
<em>
<a href="#autoscaling.agones.dev/v1.FleetAutoscaleResponse">
FleetAutoscaleResponse
</a>
</em>
</td>
<td>
</td>
</tr>
</tbody>
</table>
<h3 id="autoscaling.agones.dev/v1.FleetAutoscalerPolicy">FleetAutoscalerPolicy
</h3>
<p>
(<em>Appears on:</em>
<a href="#autoscaling.agones.dev/v1.FleetAutoscalerSpec">FleetAutoscalerSpec</a>)
</p>
<p>
<p>FleetAutoscalerPolicy describes how to scale a fleet</p>
</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>type</code></br>
<em>
<a href="#autoscaling.agones.dev/v1.FleetAutoscalerPolicyType">
FleetAutoscalerPolicyType
</a>
</em>
</td>
<td>
<p>Type of autoscaling policy.</p>
</td>
</tr>
<tr>
<td>
<code>buffer</code></br>
<em>
<a href="#autoscaling.agones.dev/v1.BufferPolicy">
BufferPolicy
</a>
</em>
</td>
<td>
<em>(Optional)</em>
<p>Buffer policy config params. Present only if FleetAutoscalerPolicyType = Buffer.</p>
</td>
</tr>
<tr>
<td>
<code>webhook</code></br>
<em>
<a href="#autoscaling.agones.dev/v1.WebhookPolicy">
WebhookPolicy
</a>
</em>
</td>
<td>
<em>(Optional)</em>
<p>Webhook policy config params. Present only if FleetAutoscalerPolicyType = Webhook.</p>
</td>
</tr>
<tr>
<td>
<code>counter</code></br>
<em>
<a href="#autoscaling.agones.dev/v1.CounterPolicy">
CounterPolicy
</a>
</em>
</td>
<td>
<em>(Optional)</em>
<p>[Stage:Alpha]
[FeatureFlag:CountsAndLists]
Counter policy config params. Present only if FleetAutoscalerPolicyType = Counter.</p>
</td>
</tr>
<tr>
<td>
<code>list</code></br>
<em>
<a href="#autoscaling.agones.dev/v1.ListPolicy">
ListPolicy
</a>
</em>
</td>
<td>
<em>(Optional)</em>
<p>[Stage:Alpha]
[FeatureFlag:CountsAndLists]
List policy config params. Present only if FleetAutoscalerPolicyType = List.</p>
</td>
</tr>
</tbody>
</table>
<h3 id="autoscaling.agones.dev/v1.FleetAutoscalerPolicyType">FleetAutoscalerPolicyType
(<code>string</code> alias)</p></h3>
<p>
(<em>Appears on:</em>
<a href="#autoscaling.agones.dev/v1.FleetAutoscalerPolicy">FleetAutoscalerPolicy</a>)
</p>
<p>
<p>FleetAutoscalerPolicyType is the policy for autoscaling
for a given Fleet</p>
</p>
<h3 id="autoscaling.agones.dev/v1.FleetAutoscalerSpec">FleetAutoscalerSpec
</h3>
<p>
(<em>Appears on:</em>
<a href="#autoscaling.agones.dev/v1.FleetAutoscaler">FleetAutoscaler</a>)
</p>
<p>
<p>FleetAutoscalerSpec is the spec for a Fleet Scaler</p>
</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>fleetName</code></br>
<em>
string
</em>
</td>
<td>
</td>
</tr>
<tr>
<td>
<code>policy</code></br>
<em>
<a href="#autoscaling.agones.dev/v1.FleetAutoscalerPolicy">
FleetAutoscalerPolicy
</a>
</em>
</td>
<td>
<p>Autoscaling policy</p>
</td>
</tr>
<tr>
<td>
<code>sync</code></br>
<em>
<a href="#autoscaling.agones.dev/v1.FleetAutoscalerSync">
FleetAutoscalerSync
</a>
</em>
</td>
<td>
<em>(Optional)</em>
<p>Sync defines when FleetAutoscalers runs autoscaling</p>
</td>
</tr>
</tbody>
</table>
<h3 id="autoscaling.agones.dev/v1.FleetAutoscalerStatus">FleetAutoscalerStatus
</h3>
<p>
(<em>Appears on:</em>
<a href="#autoscaling.agones.dev/v1.FleetAutoscaler">FleetAutoscaler</a>)
</p>
<p>
<p>FleetAutoscalerStatus defines the current status of a FleetAutoscaler</p>
</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>currentReplicas</code></br>
<em>
int32
</em>
</td>
<td>
<p>CurrentReplicas is the current number of gameserver replicas
of the fleet managed by this autoscaler, as last seen by the autoscaler</p>
</td>
</tr>
<tr>
<td>
<code>desiredReplicas</code></br>
<em>
int32
</em>
</td>
<td>
<p>DesiredReplicas is the desired number of gameserver replicas
of the fleet managed by this autoscaler, as last calculated by the autoscaler</p>
</td>
</tr>
<tr>
<td>
<code>lastScaleTime</code></br>
<em>
<a href="https://v1-27.docs.kubernetes.io/docs/reference/generated/kubernetes-api/v1.27/#time-v1-meta">
Kubernetes meta/v1.Time
</a>
</em>
</td>
<td>
<em>(Optional)</em>
<p>lastScaleTime is the last time the FleetAutoscaler scaled the attached fleet,</p>
</td>
</tr>
<tr>
<td>
<code>ableToScale</code></br>
<em>
bool
</em>
</td>
<td>
<p>AbleToScale indicates that we can access the target fleet</p>
</td>
</tr>
<tr>
<td>
<code>scalingLimited</code></br>
<em>
bool
</em>
</td>
<td>
<p>ScalingLimited indicates that the calculated scale would be above or below the range
defined by MinReplicas and MaxReplicas, and has thus been capped.</p>
</td>
</tr>
</tbody>
</table>
<h3 id="autoscaling.agones.dev/v1.FleetAutoscalerSync">FleetAutoscalerSync
</h3>
<p>
(<em>Appears on:</em>
<a href="#autoscaling.agones.dev/v1.FleetAutoscalerSpec">FleetAutoscalerSpec</a>)
</p>
<p>
<p>FleetAutoscalerSync describes when to sync a fleet</p>
</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>type</code></br>
<em>
<a href="#autoscaling.agones.dev/v1.FleetAutoscalerSyncType">
FleetAutoscalerSyncType
</a>
</em>
</td>
<td>
<p>Type of autoscaling sync.</p>
</td>
</tr>
<tr>
<td>
<code>fixedInterval</code></br>
<em>
<a href="#autoscaling.agones.dev/v1.FixedIntervalSync">
FixedIntervalSync
</a>
</em>
</td>
<td>
<em>(Optional)</em>
<p>FixedInterval config params. Present only if FleetAutoscalerSyncType = FixedInterval.</p>
</td>
</tr>
</tbody>
</table>
<h3 id="autoscaling.agones.dev/v1.FleetAutoscalerSyncType">FleetAutoscalerSyncType
(<code>string</code> alias)</p></h3>
<p>
(<em>Appears on:</em>
<a href="#autoscaling.agones.dev/v1.FleetAutoscalerSync">FleetAutoscalerSync</a>)
</p>
<p>
<p>FleetAutoscalerSyncType is the sync strategy for a given Fleet</p>
</p>
<h3 id="autoscaling.agones.dev/v1.ListPolicy">ListPolicy
</h3>
<p>
(<em>Appears on:</em>
<a href="#autoscaling.agones.dev/v1.FleetAutoscalerPolicy">FleetAutoscalerPolicy</a>)
</p>
<p>
<p>ListPolicy controls the desired behavior of the List autoscaler policy.</p>
</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>key</code></br>
<em>
string
</em>
</td>
<td>
<p>Key is the name of the List. Required field.</p>
</td>
</tr>
<tr>
<td>
<code>maxCapacity</code></br>
<em>
int64
</em>
</td>
<td>
<p>MaxCapacity is the maximum aggregate List total capacity across the fleet.
MaxCapacity must be bigger than both MinCapacity and BufferSize. Required field.</p>
</td>
</tr>
<tr>
<td>
<code>minCapacity</code></br>
<em>
int64
</em>
</td>
<td>
<p>MinCapacity is the minimum aggregate List total capacity across the fleet.
If zero, it is ignored.
If non zero, it must be smaller than MaxCapacity and bigger than BufferSize.</p>
</td>
</tr>
<tr>
<td>
<code>bufferSize</code></br>
<em>
k8s.io/apimachinery/pkg/util/intstr.IntOrString
</em>
</td>
<td>
<p>BufferSize is the size of a buffer based on the List capacity that is available over the
current aggregate List length in the Fleet (available capacity). It can be specified either
as an absolute value (i.e. 5) or percentage format (i.e. 5%).
Must be bigger than 0. Required field.</p>
</td>
</tr>
</tbody>
</table>
<h3 id="autoscaling.agones.dev/v1.WebhookPolicy">WebhookPolicy
</h3>
<p>
(<em>Appears on:</em>
<a href="#autoscaling.agones.dev/v1.FleetAutoscalerPolicy">FleetAutoscalerPolicy</a>)
</p>
<p>
<p>WebhookPolicy controls the desired behavior of the webhook policy.
It contains the description of the webhook autoscaler service
used to form url which is accessible inside the cluster</p>
</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>url</code></br>
<em>
string
</em>
</td>
<td>
<em>(Optional)</em>
<p><code>url</code> gives the location of the webhook, in standard URL form
(<code>scheme://host:port/path</code>). Exactly one of <code>url</code> or <code>service</code>
must be specified.</p>
<p>The <code>host</code> should not refer to a service running in the cluster; use
the <code>service</code> field instead. The host might be resolved via external
DNS in some apiservers (e.g., <code>kube-apiserver</code> cannot resolve
in-cluster DNS as that would be a layering violation). <code>host</code> may
also be an IP address.</p>
<p>Please note that using <code>localhost</code> or <code>127.0.0.1</code> as a <code>host</code> is
risky unless you take great care to run this webhook on all hosts
which run an apiserver which might need to make calls to this
webhook. Such installs are likely to be non-portable, i.e., not easy
to turn up in a new cluster.</p>
<p>The scheme must be &ldquo;https&rdquo;; the URL must begin with &ldquo;https://&rdquo;.</p>
<p>A path is optional, and if present may be any string permissible in
a URL. You may use the path to pass an arbitrary string to the
webhook, for example, a cluster identifier.</p>
<p>Attempting to use a user or basic auth e.g. &ldquo;user:password@&rdquo; is not
allowed. Fragments (&ldquo;#&hellip;&rdquo;) and query parameters (&ldquo;?&hellip;&rdquo;) are not
allowed, either.</p>
</td>
</tr>
<tr>
<td>
<code>service</code></br>
<em>
<a href="https://v1-27.docs.kubernetes.io/docs/reference/generated/kubernetes-api/v1.27/#servicereference-v1-admissionregistration">
Kubernetes admissionregistration/v1.ServiceReference
</a>
</em>
</td>
<td>
<em>(Optional)</em>
<p><code>service</code> is a reference to the service for this webhook. Either
<code>service</code> or <code>url</code> must be specified.</p>
<p>If the webhook is running within the cluster, then you should use <code>service</code>.</p>
</td>
</tr>
<tr>
<td>
<code>caBundle</code></br>
<em>
[]byte
</em>
</td>
<td>
<em>(Optional)</em>
<p><code>caBundle</code> is a PEM encoded CA bundle which will be used to validate the webhook&rsquo;s server certificate.
If unspecified, system trust roots on the apiserver are used.</p>
</td>
</tr>
</tbody>
</table>
<hr/>
<h2 id="multicluster.agones.dev/v1">multicluster.agones.dev/v1</h2>
<p>
<p>Package v1 is the v1 version of the API.</p>
</p>
Resource Types:
<ul><li>
<a href="#multicluster.agones.dev/v1.GameServerAllocationPolicy">GameServerAllocationPolicy</a>
</li></ul>
<h3 id="multicluster.agones.dev/v1.GameServerAllocationPolicy">GameServerAllocationPolicy
</h3>
<p>
<p>GameServerAllocationPolicy is the Schema for the gameserverallocationpolicies API</p>
</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>apiVersion</code></br>
string</td>
<td>
<code>
multicluster.agones.dev/v1
</code>
</td>
</tr>
<tr>
<td>
<code>kind</code></br>
string
</td>
<td><code>GameServerAllocationPolicy</code></td>
</tr>
<tr>
<td>
<code>metadata</code></br>
<em>
<a href="https://v1-27.docs.kubernetes.io/docs/reference/generated/kubernetes-api/v1.27/#objectmeta-v1-meta">
Kubernetes meta/v1.ObjectMeta
</a>
</em>
</td>
<td>
Refer to the Kubernetes API documentation for the fields of the
<code>metadata</code> field.
</td>
</tr>
<tr>
<td>
<code>spec</code></br>
<em>
<a href="#multicluster.agones.dev/v1.GameServerAllocationPolicySpec">
GameServerAllocationPolicySpec
</a>
</em>
</td>
<td>
<br/>
<br/>
<table>
<tr>
<td>
<code>priority</code></br>
<em>
int32
</em>
</td>
<td>
</td>
</tr>
<tr>
<td>
<code>weight</code></br>
<em>
int
</em>
</td>
<td>
</td>
</tr>
<tr>
<td>
<code>connectionInfo</code></br>
<em>
<a href="#multicluster.agones.dev/v1.ClusterConnectionInfo">
ClusterConnectionInfo
</a>
</em>
</td>
<td>
</td>
</tr>
</table>
</td>
</tr>
</tbody>
</table>
<h3 id="multicluster.agones.dev/v1.ClusterConnectionInfo">ClusterConnectionInfo
</h3>
<p>
(<em>Appears on:</em>
<a href="#multicluster.agones.dev/v1.GameServerAllocationPolicySpec">GameServerAllocationPolicySpec</a>)
</p>
<p>
<p>ClusterConnectionInfo defines the connection information for a cluster</p>
</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>clusterName</code></br>
<em>
string
</em>
</td>
<td>
<p>Optional: the name of the targeted cluster</p>
</td>
</tr>
<tr>
<td>
<code>allocationEndpoints</code></br>
<em>
[]string
</em>
</td>
<td>
<p>The endpoints for the allocator service in the targeted cluster.
If the AllocationEndpoints is not set, the allocation happens on local cluster.
If there are multiple endpoints any of the endpoints that can handle allocation request should suffice</p>
</td>
</tr>
<tr>
<td>
<code>secretName</code></br>
<em>
string
</em>
</td>
<td>
<p>The name of the secret that contains TLS client certificates to connect the allocator server in the targeted cluster</p>
</td>
</tr>
<tr>
<td>
<code>namespace</code></br>
<em>
string
</em>
</td>
<td>
<p>The cluster namespace from which to allocate gameservers</p>
</td>
</tr>
<tr>
<td>
<code>serverCa</code></br>
<em>
[]byte
</em>
</td>
<td>
<p>The PEM encoded server CA, used by the allocator client to authenticate the remote server.</p>
</td>
</tr>
</tbody>
</table>
<h3 id="multicluster.agones.dev/v1.ConnectionInfoIterator">ConnectionInfoIterator
</h3>
<p>
<p>ConnectionInfoIterator an iterator on ClusterConnectionInfo</p>
</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>currPriority</code></br>
<em>
int
</em>
</td>
<td>
<p>currPriority Current priority index from the orderedPriorities</p>
</td>
</tr>
<tr>
<td>
<code>orderedPriorities</code></br>
<em>
[]int32
</em>
</td>
<td>
<p>orderedPriorities list of ordered priorities</p>
</td>
</tr>
<tr>
<td>
<code>priorityToCluster</code></br>
<em>
map[int32]map[string][]*agones.dev/agones/pkg/apis/multicluster/v1.GameServerAllocationPolicy
</em>
</td>
<td>
<p>priorityToCluster Map of priority to cluster-policies map</p>
</td>
</tr>
<tr>
<td>
<code>clusterBlackList</code></br>
<em>
map[string]bool
</em>
</td>
<td>
<p>clusterBlackList the cluster blacklist for the clusters that has already returned</p>
</td>
</tr>
</tbody>
</table>
<h3 id="multicluster.agones.dev/v1.GameServerAllocationPolicySpec">GameServerAllocationPolicySpec
</h3>
<p>
(<em>Appears on:</em>
<a href="#multicluster.agones.dev/v1.GameServerAllocationPolicy">GameServerAllocationPolicy</a>)
</p>
<p>
<p>GameServerAllocationPolicySpec defines the desired state of GameServerAllocationPolicy</p>
</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>priority</code></br>
<em>
int32
</em>
</td>
<td>
</td>
</tr>
<tr>
<td>
<code>weight</code></br>
<em>
int
</em>
</td>
<td>
</td>
</tr>
<tr>
<td>
<code>connectionInfo</code></br>
<em>
<a href="#multicluster.agones.dev/v1.ClusterConnectionInfo">
ClusterConnectionInfo
</a>
</em>
</td>
<td>
</td>
</tr>
</tbody>
</table>
<hr/>
<h2 id="agones.dev/v1">agones.dev/v1</h2>
<p>
<p>Package v1 is the v1 version of the API.</p>
</p>
Resource Types:
<ul><li>
<a href="#agones.dev/v1.Fleet">Fleet</a>
</li><li>
<a href="#agones.dev/v1.GameServer">GameServer</a>
</li><li>
<a href="#agones.dev/v1.GameServerSet">GameServerSet</a>
</li></ul>
<h3 id="agones.dev/v1.Fleet">Fleet
</h3>
<p>
<p>Fleet is the data structure for a Fleet resource</p>
</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>apiVersion</code></br>
string</td>
<td>
<code>
agones.dev/v1
</code>
</td>
</tr>
<tr>
<td>
<code>kind</code></br>
string
</td>
<td><code>Fleet</code></td>
</tr>
<tr>
<td>
<code>metadata</code></br>
<em>
<a href="https://v1-27.docs.kubernetes.io/docs/reference/generated/kubernetes-api/v1.27/#objectmeta-v1-meta">
Kubernetes meta/v1.ObjectMeta
</a>
</em>
</td>
<td>
Refer to the Kubernetes API documentation for the fields of the
<code>metadata</code> field.
</td>
</tr>
<tr>
<td>
<code>spec</code></br>
<em>
<a href="#agones.dev/v1.FleetSpec">
FleetSpec
</a>
</em>
</td>
<td>
<br/>
<br/>
<table>
<tr>
<td>
<code>replicas</code></br>
<em>
int32
</em>
</td>
<td>
<p>Replicas are the number of GameServers that should be in this set. Defaults to 0.</p>
</td>
</tr>
<tr>
<td>
<code>allocationOverflow</code></br>
<em>
<a href="#agones.dev/v1.AllocationOverflow">
AllocationOverflow
</a>
</em>
</td>
<td>
<em>(Optional)</em>
<p>[Stage: Beta]
[FeatureFlag:FleetAllocationOverflow]
Labels and/or Annotations to apply to overflowing GameServers when the number of Allocated GameServers is more
than the desired replicas on the underlying <code>GameServerSet</code></p>
</td>
</tr>
<tr>
<td>
<code>strategy</code></br>
<em>
<a href="https://v1-27.docs.kubernetes.io/docs/reference/generated/kubernetes-api/v1.27/#deploymentstrategy-v1-apps">
Kubernetes apps/v1.DeploymentStrategy
</a>
</em>
</td>
<td>
<p>Deployment strategy</p>
</td>
</tr>
<tr>
<td>
<code>scheduling</code></br>
<em>
agones.dev/agones/pkg/apis.SchedulingStrategy
</em>
</td>
<td>
<p>Scheduling strategy. Defaults to &ldquo;Packed&rdquo;.</p>
</td>
</tr>
<tr>
<td>
<code>priorities</code></br>
<em>
<a href="#agones.dev/v1.Priority">
[]Priority
</a>
</em>
</td>
<td>
<em>(Optional)</em>
<p>(Alpha, CountsAndLists feature flag) The first Priority on the array of Priorities is the most
important for sorting. The Fleetautoscaler will use the first priority for sorting GameServers
by total Capacity in the Fleet and acts as a tie-breaker after sorting the game servers by
State and Strategy. Impacts scale down logic.</p>
</td>
</tr>
<tr>
<td>
<code>template</code></br>
<em>
<a href="#agones.dev/v1.GameServerTemplateSpec">
GameServerTemplateSpec
</a>
</em>
</td>
<td>
<p>Template the GameServer template to apply for this Fleet</p>
</td>
</tr>
</table>
</td>
</tr>
<tr>
<td>
<code>status</code></br>
<em>
<a href="#agones.dev/v1.FleetStatus">
FleetStatus
</a>
</em>
</td>
<td>
</td>
</tr>
</tbody>
</table>
<h3 id="agones.dev/v1.GameServer">GameServer
</h3>
<p>
<p>GameServer is the data structure for a GameServer resource.
It is worth noting that while there is a <code>GameServerStatus</code> Status entry for the <code>GameServer</code>, it is not
defined as a subresource - unlike <code>Fleet</code> and other Code Blind resources.
This is so that we can retain the ability to change multiple aspects of a <code>GameServer</code> in a single atomic operation,
which is particularly useful for operations such as allocation.</p>
</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>apiVersion</code></br>
string</td>
<td>
<code>
agones.dev/v1
</code>
</td>
</tr>
<tr>
<td>
<code>kind</code></br>
string
</td>
<td><code>GameServer</code></td>
</tr>
<tr>
<td>
<code>metadata</code></br>
<em>
<a href="https://v1-27.docs.kubernetes.io/docs/reference/generated/kubernetes-api/v1.27/#objectmeta-v1-meta">
Kubernetes meta/v1.ObjectMeta
</a>
</em>
</td>
<td>
Refer to the Kubernetes API documentation for the fields of the
<code>metadata</code> field.
</td>
</tr>
<tr>
<td>
<code>spec</code></br>
<em>
<a href="#agones.dev/v1.GameServerSpec">
GameServerSpec
</a>
</em>
</td>
<td>
<br/>
<br/>
<table>
<tr>
<td>
<code>container</code></br>
<em>
string
</em>
</td>
<td>
<p>Container specifies which Pod container is the game server. Only required if there is more than one
container defined</p>
</td>
</tr>
<tr>
<td>
<code>ports</code></br>
<em>
<a href="#agones.dev/v1.GameServerPort">
[]GameServerPort
</a>
</em>
</td>
<td>
<p>Ports are the array of ports that can be exposed via the game server</p>
</td>
</tr>
<tr>
<td>
<code>health</code></br>
<em>
<a href="#agones.dev/v1.Health">
Health
</a>
</em>
</td>
<td>
<p>Health configures health checking</p>
</td>
</tr>
<tr>
<td>
<code>scheduling</code></br>
<em>
agones.dev/agones/pkg/apis.SchedulingStrategy
</em>
</td>
<td>
<p>Scheduling strategy. Defaults to &ldquo;Packed&rdquo;</p>
</td>
</tr>
<tr>
<td>
<code>sdkServer</code></br>
<em>
<a href="#agones.dev/v1.SdkServer">
SdkServer
</a>
</em>
</td>
<td>
<p>SdkServer specifies parameters for the Code Blind SDK Server sidecar container</p>
</td>
</tr>
<tr>
<td>
<code>template</code></br>
<em>
<a href="https://v1-27.docs.kubernetes.io/docs/reference/generated/kubernetes-api/v1.27/#podtemplatespec-v1-core">
Kubernetes core/v1.PodTemplateSpec
</a>
</em>
</td>
<td>
<p>Template describes the Pod that will be created for the GameServer</p>
</td>
</tr>
<tr>
<td>
<code>players</code></br>
<em>
<a href="#agones.dev/v1.PlayersSpec">
PlayersSpec
</a>
</em>
</td>
<td>
<em>(Optional)</em>
<p>(Alpha, PlayerTracking feature flag) Players provides the configuration for player tracking features.</p>
</td>
</tr>
<tr>
<td>
<code>counters</code></br>
<em>
<a href="#agones.dev/v1.CounterStatus">
map[string]agones.dev/agones/pkg/apis/agones/v1.CounterStatus
</a>
</em>
</td>
<td>
<em>(Optional)</em>
<p>(Alpha, CountsAndLists feature flag) Counters provides the configuration for tracking of int64 values against a GameServer.
Keys must be declared at GameServer creation time.</p>
</td>
</tr>
<tr>
<td>
<code>lists</code></br>
<em>
<a href="#agones.dev/v1.ListStatus">
map[string]agones.dev/agones/pkg/apis/agones/v1.ListStatus
</a>
</em>
</td>
<td>
<em>(Optional)</em>
<p>(Alpha, CountsAndLists feature flag) Lists provides the configuration for tracking of lists of up to 1000 values against a GameServer.
Keys must be declared at GameServer creation time.</p>
</td>
</tr>
<tr>
<td>
<code>eviction</code></br>
<em>
<a href="#agones.dev/v1.Eviction">
Eviction
</a>
</em>
</td>
<td>
<em>(Optional)</em>
<p>Eviction specifies the eviction tolerance of the GameServer. Defaults to &ldquo;Never&rdquo;.</p>
</td>
</tr>
</table>
</td>
</tr>
<tr>
<td>
<code>status</code></br>
<em>
<a href="#agones.dev/v1.GameServerStatus">
GameServerStatus
</a>
</em>
</td>
<td>
</td>
</tr>
</tbody>
</table>
<h3 id="agones.dev/v1.GameServerSet">GameServerSet
</h3>
<p>
<p>GameServerSet is the data structure for a set of GameServers.
This matches philosophically with the relationship between
Deployments and ReplicaSets</p>
</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>apiVersion</code></br>
string</td>
<td>
<code>
agones.dev/v1
</code>
</td>
</tr>
<tr>
<td>
<code>kind</code></br>
string
</td>
<td><code>GameServerSet</code></td>
</tr>
<tr>
<td>
<code>metadata</code></br>
<em>
<a href="https://v1-27.docs.kubernetes.io/docs/reference/generated/kubernetes-api/v1.27/#objectmeta-v1-meta">
Kubernetes meta/v1.ObjectMeta
</a>
</em>
</td>
<td>
Refer to the Kubernetes API documentation for the fields of the
<code>metadata</code> field.
</td>
</tr>
<tr>
<td>
<code>spec</code></br>
<em>
<a href="#agones.dev/v1.GameServerSetSpec">
GameServerSetSpec
</a>
</em>
</td>
<td>
<br/>
<br/>
<table>
<tr>
<td>
<code>replicas</code></br>
<em>
int32
</em>
</td>
<td>
<p>Replicas are the number of GameServers that should be in this set</p>
</td>
</tr>
<tr>
<td>
<code>allocationOverflow</code></br>
<em>
<a href="#agones.dev/v1.AllocationOverflow">
AllocationOverflow
</a>
</em>
</td>
<td>
<em>(Optional)</em>
<p>[Stage: Beta]
[FeatureFlag:FleetAllocationOverflow]
Labels and Annotations to apply to GameServers when the number of Allocated GameServers drops below
the desired replicas on the underlying <code>GameServerSet</code></p>
</td>
</tr>
<tr>
<td>
<code>scheduling</code></br>
<em>
agones.dev/agones/pkg/apis.SchedulingStrategy
</em>
</td>
<td>
<p>Scheduling strategy. Defaults to &ldquo;Packed&rdquo;.</p>
</td>
</tr>
<tr>
<td>
<code>priorities</code></br>
<em>
<a href="#agones.dev/v1.Priority">
[]Priority
</a>
</em>
</td>
<td>
<em>(Optional)</em>
<p>(Alpha, CountsAndLists feature flag) The first Priority on the array of Priorities is the most
important for sorting. The Fleetautoscaler will use the first priority for sorting GameServers
by total Capacity in the Fleet and acts as a tie-breaker after sorting the game servers by
State and Strategy. Impacts scale down logic.</p>
</td>
</tr>
<tr>
<td>
<code>template</code></br>
<em>
<a href="#agones.dev/v1.GameServerTemplateSpec">
GameServerTemplateSpec
</a>
</em>
</td>
<td>
<p>Template the GameServer template to apply for this GameServerSet</p>
</td>
</tr>
</table>
</td>
</tr>
<tr>
<td>
<code>status</code></br>
<em>
<a href="#agones.dev/v1.GameServerSetStatus">
GameServerSetStatus
</a>
</em>
</td>
<td>
</td>
</tr>
</tbody>
</table>
<h3 id="agones.dev/v1.AggregatedCounterStatus">AggregatedCounterStatus
</h3>
<p>
(<em>Appears on:</em>
<a href="#agones.dev/v1.FleetStatus">FleetStatus</a>, 
<a href="#agones.dev/v1.GameServerSetStatus">GameServerSetStatus</a>)
</p>
<p>
<p>AggregatedCounterStatus stores total and allocated Counter tracking values</p>
</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>allocatedCount</code></br>
<em>
int64
</em>
</td>
<td>
</td>
</tr>
<tr>
<td>
<code>allocatedCapacity</code></br>
<em>
int64
</em>
</td>
<td>
</td>
</tr>
<tr>
<td>
<code>count</code></br>
<em>
int64
</em>
</td>
<td>
</td>
</tr>
<tr>
<td>
<code>capacity</code></br>
<em>
int64
</em>
</td>
<td>
</td>
</tr>
</tbody>
</table>
<h3 id="agones.dev/v1.AggregatedListStatus">AggregatedListStatus
</h3>
<p>
(<em>Appears on:</em>
<a href="#agones.dev/v1.FleetStatus">FleetStatus</a>, 
<a href="#agones.dev/v1.GameServerSetStatus">GameServerSetStatus</a>)
</p>
<p>
<p>AggregatedListStatus stores total and allocated List tracking values</p>
</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>allocatedCount</code></br>
<em>
int64
</em>
</td>
<td>
</td>
</tr>
<tr>
<td>
<code>allocatedCapacity</code></br>
<em>
int64
</em>
</td>
<td>
</td>
</tr>
<tr>
<td>
<code>count</code></br>
<em>
int64
</em>
</td>
<td>
</td>
</tr>
<tr>
<td>
<code>capacity</code></br>
<em>
int64
</em>
</td>
<td>
</td>
</tr>
</tbody>
</table>
<h3 id="agones.dev/v1.AggregatedPlayerStatus">AggregatedPlayerStatus
</h3>
<p>
(<em>Appears on:</em>
<a href="#agones.dev/v1.FleetStatus">FleetStatus</a>, 
<a href="#agones.dev/v1.GameServerSetStatus">GameServerSetStatus</a>)
</p>
<p>
<p>AggregatedPlayerStatus stores total player tracking values</p>
</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>count</code></br>
<em>
int64
</em>
</td>
<td>
</td>
</tr>
<tr>
<td>
<code>capacity</code></br>
<em>
int64
</em>
</td>
<td>
</td>
</tr>
</tbody>
</table>
<h3 id="agones.dev/v1.AllocationOverflow">AllocationOverflow
</h3>
<p>
(<em>Appears on:</em>
<a href="#agones.dev/v1.FleetSpec">FleetSpec</a>, 
<a href="#agones.dev/v1.GameServerSetSpec">GameServerSetSpec</a>)
</p>
<p>
<p>AllocationOverflow specifies what labels and/or annotations to apply on Allocated GameServers
if the desired number of the underlying <code>GameServerSet</code> drops below the number of Allocated GameServers
attached to it.</p>
</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>labels</code></br>
<em>
map[string]string
</em>
</td>
<td>
<em>(Optional)</em>
<p>Labels to be applied to the <code>GameServer</code></p>
</td>
</tr>
<tr>
<td>
<code>annotations</code></br>
<em>
map[string]string
</em>
</td>
<td>
<em>(Optional)</em>
<p>Annotations to be applied to the <code>GameServer</code></p>
</td>
</tr>
</tbody>
</table>
<h3 id="agones.dev/v1.CounterStatus">CounterStatus
</h3>
<p>
(<em>Appears on:</em>
<a href="#agones.dev/v1.GameServerSpec">GameServerSpec</a>, 
<a href="#agones.dev/v1.GameServerStatus">GameServerStatus</a>)
</p>
<p>
<p>CounterStatus stores the current counter values and maximum capacity</p>
</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>count</code></br>
<em>
int64
</em>
</td>
<td>
</td>
</tr>
<tr>
<td>
<code>capacity</code></br>
<em>
int64
</em>
</td>
<td>
</td>
</tr>
</tbody>
</table>
<h3 id="agones.dev/v1.Eviction">Eviction
</h3>
<p>
(<em>Appears on:</em>
<a href="#agones.dev/v1.GameServerSpec">GameServerSpec</a>, 
<a href="#agones.dev/v1.GameServerStatus">GameServerStatus</a>)
</p>
<p>
<p>Eviction specifies the eviction tolerance of the GameServer</p>
</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>safe</code></br>
<em>
<a href="#agones.dev/v1.EvictionSafe">
EvictionSafe
</a>
</em>
</td>
<td>
<p>Game server supports termination via SIGTERM:
- Always: Allow eviction for both Cluster Autoscaler and node drain for upgrades
- OnUpgrade: Allow eviction for upgrades alone
- Never (default): Pod should run to completion</p>
</td>
</tr>
</tbody>
</table>
<h3 id="agones.dev/v1.EvictionSafe">EvictionSafe
(<code>string</code> alias)</p></h3>
<p>
(<em>Appears on:</em>
<a href="#agones.dev/v1.Eviction">Eviction</a>)
</p>
<p>
<p>EvictionSafe specified whether the game server supports termination via SIGTERM</p>
</p>
<h3 id="agones.dev/v1.FleetSpec">FleetSpec
</h3>
<p>
(<em>Appears on:</em>
<a href="#agones.dev/v1.Fleet">Fleet</a>)
</p>
<p>
<p>FleetSpec is the spec for a Fleet</p>
</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>replicas</code></br>
<em>
int32
</em>
</td>
<td>
<p>Replicas are the number of GameServers that should be in this set. Defaults to 0.</p>
</td>
</tr>
<tr>
<td>
<code>allocationOverflow</code></br>
<em>
<a href="#agones.dev/v1.AllocationOverflow">
AllocationOverflow
</a>
</em>
</td>
<td>
<em>(Optional)</em>
<p>[Stage: Beta]
[FeatureFlag:FleetAllocationOverflow]
Labels and/or Annotations to apply to overflowing GameServers when the number of Allocated GameServers is more
than the desired replicas on the underlying <code>GameServerSet</code></p>
</td>
</tr>
<tr>
<td>
<code>strategy</code></br>
<em>
<a href="https://v1-27.docs.kubernetes.io/docs/reference/generated/kubernetes-api/v1.27/#deploymentstrategy-v1-apps">
Kubernetes apps/v1.DeploymentStrategy
</a>
</em>
</td>
<td>
<p>Deployment strategy</p>
</td>
</tr>
<tr>
<td>
<code>scheduling</code></br>
<em>
agones.dev/agones/pkg/apis.SchedulingStrategy
</em>
</td>
<td>
<p>Scheduling strategy. Defaults to &ldquo;Packed&rdquo;.</p>
</td>
</tr>
<tr>
<td>
<code>priorities</code></br>
<em>
<a href="#agones.dev/v1.Priority">
[]Priority
</a>
</em>
</td>
<td>
<em>(Optional)</em>
<p>(Alpha, CountsAndLists feature flag) The first Priority on the array of Priorities is the most
important for sorting. The Fleetautoscaler will use the first priority for sorting GameServers
by total Capacity in the Fleet and acts as a tie-breaker after sorting the game servers by
State and Strategy. Impacts scale down logic.</p>
</td>
</tr>
<tr>
<td>
<code>template</code></br>
<em>
<a href="#agones.dev/v1.GameServerTemplateSpec">
GameServerTemplateSpec
</a>
</em>
</td>
<td>
<p>Template the GameServer template to apply for this Fleet</p>
</td>
</tr>
</tbody>
</table>
<h3 id="agones.dev/v1.FleetStatus">FleetStatus
</h3>
<p>
(<em>Appears on:</em>
<a href="#agones.dev/v1.Fleet">Fleet</a>, 
<a href="#autoscaling.agones.dev/v1.FleetAutoscaleRequest">FleetAutoscaleRequest</a>)
</p>
<p>
<p>FleetStatus is the status of a Fleet</p>
</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>replicas</code></br>
<em>
int32
</em>
</td>
<td>
<p>Replicas the total number of current GameServer replicas</p>
</td>
</tr>
<tr>
<td>
<code>readyReplicas</code></br>
<em>
int32
</em>
</td>
<td>
<p>ReadyReplicas are the number of Ready GameServer replicas</p>
</td>
</tr>
<tr>
<td>
<code>reservedReplicas</code></br>
<em>
int32
</em>
</td>
<td>
<p>ReservedReplicas are the total number of Reserved GameServer replicas in this fleet.
Reserved instances won&rsquo;t be deleted on scale down, but won&rsquo;t cause an autoscaler to scale up.</p>
</td>
</tr>
<tr>
<td>
<code>allocatedReplicas</code></br>
<em>
int32
</em>
</td>
<td>
<p>AllocatedReplicas are the number of Allocated GameServer replicas</p>
</td>
</tr>
<tr>
<td>
<code>players</code></br>
<em>
<a href="#agones.dev/v1.AggregatedPlayerStatus">
AggregatedPlayerStatus
</a>
</em>
</td>
<td>
<em>(Optional)</em>
<p>[Stage:Alpha]
[FeatureFlag:PlayerTracking]
Players are the current total player capacity and count for this Fleet</p>
</td>
</tr>
<tr>
<td>
<code>counters</code></br>
<em>
<a href="#agones.dev/v1.AggregatedCounterStatus">
map[string]agones.dev/agones/pkg/apis/agones/v1.AggregatedCounterStatus
</a>
</em>
</td>
<td>
<em>(Optional)</em>
<p>(Alpha, CountsAndLists feature flag) Counters provides aggregated Counter capacity and Counter
count for this Fleet.</p>
</td>
</tr>
<tr>
<td>
<code>lists</code></br>
<em>
<a href="#agones.dev/v1.AggregatedListStatus">
map[string]agones.dev/agones/pkg/apis/agones/v1.AggregatedListStatus
</a>
</em>
</td>
<td>
<em>(Optional)</em>
<p>(Alpha, CountsAndLists feature flag) Lists provides aggregated List capacityv and List values
for this Fleet.</p>
</td>
</tr>
</tbody>
</table>
<h3 id="agones.dev/v1.GameServerPort">GameServerPort
</h3>
<p>
(<em>Appears on:</em>
<a href="#agones.dev/v1.GameServerSpec">GameServerSpec</a>)
</p>
<p>
<p>GameServerPort defines a set of Ports that
are to be exposed via the GameServer</p>
</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>name</code></br>
<em>
string
</em>
</td>
<td>
<p>Name is the descriptive name of the port</p>
</td>
</tr>
<tr>
<td>
<code>portPolicy</code></br>
<em>
<a href="#agones.dev/v1.PortPolicy">
PortPolicy
</a>
</em>
</td>
<td>
<p>PortPolicy defines the policy for how the HostPort is populated.
Dynamic port will allocate a HostPort within the selected MIN_PORT and MAX_PORT range passed to the controller
at installation time.
When <code>Static</code> portPolicy is specified, <code>HostPort</code> is required, to specify the port that game clients will
connect to</p>
</td>
</tr>
<tr>
<td>
<code>container</code></br>
<em>
string
</em>
</td>
<td>
<em>(Optional)</em>
<p>Container is the name of the container on which to open the port. Defaults to the game server container.</p>
</td>
</tr>
<tr>
<td>
<code>containerPort</code></br>
<em>
int32
</em>
</td>
<td>
<p>ContainerPort is the port that is being opened on the specified container&rsquo;s process</p>
</td>
</tr>
<tr>
<td>
<code>hostPort</code></br>
<em>
int32
</em>
</td>
<td>
<p>HostPort the port exposed on the host for clients to connect to</p>
</td>
</tr>
<tr>
<td>
<code>protocol</code></br>
<em>
<a href="https://v1-27.docs.kubernetes.io/docs/reference/generated/kubernetes-api/v1.27/#protocol-v1-core">
Kubernetes core/v1.Protocol
</a>
</em>
</td>
<td>
<p>Protocol is the network protocol being used. Defaults to UDP. TCP and TCPUDP are other options.</p>
</td>
</tr>
</tbody>
</table>
<h3 id="agones.dev/v1.GameServerSetSpec">GameServerSetSpec
</h3>
<p>
(<em>Appears on:</em>
<a href="#agones.dev/v1.GameServerSet">GameServerSet</a>)
</p>
<p>
<p>GameServerSetSpec the specification for GameServerSet</p>
</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>replicas</code></br>
<em>
int32
</em>
</td>
<td>
<p>Replicas are the number of GameServers that should be in this set</p>
</td>
</tr>
<tr>
<td>
<code>allocationOverflow</code></br>
<em>
<a href="#agones.dev/v1.AllocationOverflow">
AllocationOverflow
</a>
</em>
</td>
<td>
<em>(Optional)</em>
<p>[Stage: Beta]
[FeatureFlag:FleetAllocationOverflow]
Labels and Annotations to apply to GameServers when the number of Allocated GameServers drops below
the desired replicas on the underlying <code>GameServerSet</code></p>
</td>
</tr>
<tr>
<td>
<code>scheduling</code></br>
<em>
agones.dev/agones/pkg/apis.SchedulingStrategy
</em>
</td>
<td>
<p>Scheduling strategy. Defaults to &ldquo;Packed&rdquo;.</p>
</td>
</tr>
<tr>
<td>
<code>priorities</code></br>
<em>
<a href="#agones.dev/v1.Priority">
[]Priority
</a>
</em>
</td>
<td>
<em>(Optional)</em>
<p>(Alpha, CountsAndLists feature flag) The first Priority on the array of Priorities is the most
important for sorting. The Fleetautoscaler will use the first priority for sorting GameServers
by total Capacity in the Fleet and acts as a tie-breaker after sorting the game servers by
State and Strategy. Impacts scale down logic.</p>
</td>
</tr>
<tr>
<td>
<code>template</code></br>
<em>
<a href="#agones.dev/v1.GameServerTemplateSpec">
GameServerTemplateSpec
</a>
</em>
</td>
<td>
<p>Template the GameServer template to apply for this GameServerSet</p>
</td>
</tr>
</tbody>
</table>
<h3 id="agones.dev/v1.GameServerSetStatus">GameServerSetStatus
</h3>
<p>
(<em>Appears on:</em>
<a href="#agones.dev/v1.GameServerSet">GameServerSet</a>)
</p>
<p>
<p>GameServerSetStatus is the status of a GameServerSet</p>
</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>replicas</code></br>
<em>
int32
</em>
</td>
<td>
<p>Replicas is the total number of current GameServer replicas</p>
</td>
</tr>
<tr>
<td>
<code>readyReplicas</code></br>
<em>
int32
</em>
</td>
<td>
<p>ReadyReplicas is the number of Ready GameServer replicas</p>
</td>
</tr>
<tr>
<td>
<code>reservedReplicas</code></br>
<em>
int32
</em>
</td>
<td>
<p>ReservedReplicas is the number of Reserved GameServer replicas</p>
</td>
</tr>
<tr>
<td>
<code>allocatedReplicas</code></br>
<em>
int32
</em>
</td>
<td>
<p>AllocatedReplicas is the number of Allocated GameServer replicas</p>
</td>
</tr>
<tr>
<td>
<code>shutdownReplicas</code></br>
<em>
int32
</em>
</td>
<td>
<p>ShutdownReplicas is the number of Shutdown GameServers replicas</p>
</td>
</tr>
<tr>
<td>
<code>players</code></br>
<em>
<a href="#agones.dev/v1.AggregatedPlayerStatus">
AggregatedPlayerStatus
</a>
</em>
</td>
<td>
<em>(Optional)</em>
<p>[Stage:Alpha]
[FeatureFlag:PlayerTracking]
Players is the current total player capacity and count for this GameServerSet</p>
</td>
</tr>
<tr>
<td>
<code>counters</code></br>
<em>
<a href="#agones.dev/v1.AggregatedCounterStatus">
map[string]agones.dev/agones/pkg/apis/agones/v1.AggregatedCounterStatus
</a>
</em>
</td>
<td>
<em>(Optional)</em>
<p>(Alpha, CountsAndLists feature flag) Counters provides aggregated Counter capacity and Counter
count for this GameServerSet.</p>
</td>
</tr>
<tr>
<td>
<code>lists</code></br>
<em>
<a href="#agones.dev/v1.AggregatedListStatus">
map[string]agones.dev/agones/pkg/apis/agones/v1.AggregatedListStatus
</a>
</em>
</td>
<td>
<em>(Optional)</em>
<p>(Alpha, CountsAndLists feature flag) Lists provides aggregated List capacity and List values
for this GameServerSet.</p>
</td>
</tr>
</tbody>
</table>
<h3 id="agones.dev/v1.GameServerSpec">GameServerSpec
</h3>
<p>
(<em>Appears on:</em>
<a href="#agones.dev/v1.GameServer">GameServer</a>, 
<a href="#agones.dev/v1.GameServerTemplateSpec">GameServerTemplateSpec</a>)
</p>
<p>
<p>GameServerSpec is the spec for a GameServer resource</p>
</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>container</code></br>
<em>
string
</em>
</td>
<td>
<p>Container specifies which Pod container is the game server. Only required if there is more than one
container defined</p>
</td>
</tr>
<tr>
<td>
<code>ports</code></br>
<em>
<a href="#agones.dev/v1.GameServerPort">
[]GameServerPort
</a>
</em>
</td>
<td>
<p>Ports are the array of ports that can be exposed via the game server</p>
</td>
</tr>
<tr>
<td>
<code>health</code></br>
<em>
<a href="#agones.dev/v1.Health">
Health
</a>
</em>
</td>
<td>
<p>Health configures health checking</p>
</td>
</tr>
<tr>
<td>
<code>scheduling</code></br>
<em>
agones.dev/agones/pkg/apis.SchedulingStrategy
</em>
</td>
<td>
<p>Scheduling strategy. Defaults to &ldquo;Packed&rdquo;</p>
</td>
</tr>
<tr>
<td>
<code>sdkServer</code></br>
<em>
<a href="#agones.dev/v1.SdkServer">
SdkServer
</a>
</em>
</td>
<td>
<p>SdkServer specifies parameters for the Code Blind SDK Server sidecar container</p>
</td>
</tr>
<tr>
<td>
<code>template</code></br>
<em>
<a href="https://v1-27.docs.kubernetes.io/docs/reference/generated/kubernetes-api/v1.27/#podtemplatespec-v1-core">
Kubernetes core/v1.PodTemplateSpec
</a>
</em>
</td>
<td>
<p>Template describes the Pod that will be created for the GameServer</p>
</td>
</tr>
<tr>
<td>
<code>players</code></br>
<em>
<a href="#agones.dev/v1.PlayersSpec">
PlayersSpec
</a>
</em>
</td>
<td>
<em>(Optional)</em>
<p>(Alpha, PlayerTracking feature flag) Players provides the configuration for player tracking features.</p>
</td>
</tr>
<tr>
<td>
<code>counters</code></br>
<em>
<a href="#agones.dev/v1.CounterStatus">
map[string]agones.dev/agones/pkg/apis/agones/v1.CounterStatus
</a>
</em>
</td>
<td>
<em>(Optional)</em>
<p>(Alpha, CountsAndLists feature flag) Counters provides the configuration for tracking of int64 values against a GameServer.
Keys must be declared at GameServer creation time.</p>
</td>
</tr>
<tr>
<td>
<code>lists</code></br>
<em>
<a href="#agones.dev/v1.ListStatus">
map[string]agones.dev/agones/pkg/apis/agones/v1.ListStatus
</a>
</em>
</td>
<td>
<em>(Optional)</em>
<p>(Alpha, CountsAndLists feature flag) Lists provides the configuration for tracking of lists of up to 1000 values against a GameServer.
Keys must be declared at GameServer creation time.</p>
</td>
</tr>
<tr>
<td>
<code>eviction</code></br>
<em>
<a href="#agones.dev/v1.Eviction">
Eviction
</a>
</em>
</td>
<td>
<em>(Optional)</em>
<p>Eviction specifies the eviction tolerance of the GameServer. Defaults to &ldquo;Never&rdquo;.</p>
</td>
</tr>
</tbody>
</table>
<h3 id="agones.dev/v1.GameServerState">GameServerState
(<code>string</code> alias)</p></h3>
<p>
(<em>Appears on:</em>
<a href="#allocation.agones.dev/v1.GameServerSelector">GameServerSelector</a>, 
<a href="#agones.dev/v1.GameServerStatus">GameServerStatus</a>)
</p>
<p>
<p>GameServerState is the state for the GameServer</p>
</p>
<h3 id="agones.dev/v1.GameServerStatus">GameServerStatus
</h3>
<p>
(<em>Appears on:</em>
<a href="#agones.dev/v1.GameServer">GameServer</a>)
</p>
<p>
<p>GameServerStatus is the status for a GameServer resource</p>
</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>state</code></br>
<em>
<a href="#agones.dev/v1.GameServerState">
GameServerState
</a>
</em>
</td>
<td>
<p>GameServerState is the current state of a GameServer, e.g. Creating, Starting, Ready, etc</p>
</td>
</tr>
<tr>
<td>
<code>ports</code></br>
<em>
<a href="#agones.dev/v1.GameServerStatusPort">
[]GameServerStatusPort
</a>
</em>
</td>
<td>
</td>
</tr>
<tr>
<td>
<code>address</code></br>
<em>
string
</em>
</td>
<td>
</td>
</tr>
<tr>
<td>
<code>addresses</code></br>
<em>
<a href="https://v1-27.docs.kubernetes.io/docs/reference/generated/kubernetes-api/v1.27/#nodeaddress-v1-core">
[]Kubernetes core/v1.NodeAddress
</a>
</em>
</td>
<td>
<em>(Optional)</em>
<p>Addresses is the array of addresses at which the GameServer can be reached; copy of Node.Status.addresses.</p>
</td>
</tr>
<tr>
<td>
<code>nodeName</code></br>
<em>
string
</em>
</td>
<td>
</td>
</tr>
<tr>
<td>
<code>reservedUntil</code></br>
<em>
<a href="https://v1-27.docs.kubernetes.io/docs/reference/generated/kubernetes-api/v1.27/#time-v1-meta">
Kubernetes meta/v1.Time
</a>
</em>
</td>
<td>
</td>
</tr>
<tr>
<td>
<code>players</code></br>
<em>
<a href="#agones.dev/v1.PlayerStatus">
PlayerStatus
</a>
</em>
</td>
<td>
<em>(Optional)</em>
<p>[Stage:Alpha]
[FeatureFlag:PlayerTracking]</p>
</td>
</tr>
<tr>
<td>
<code>counters</code></br>
<em>
<a href="#agones.dev/v1.CounterStatus">
map[string]agones.dev/agones/pkg/apis/agones/v1.CounterStatus
</a>
</em>
</td>
<td>
<em>(Optional)</em>
<p>(Alpha, CountsAndLists feature flag) Counters and Lists provides the configuration for generic tracking features.</p>
</td>
</tr>
<tr>
<td>
<code>lists</code></br>
<em>
<a href="#agones.dev/v1.ListStatus">
map[string]agones.dev/agones/pkg/apis/agones/v1.ListStatus
</a>
</em>
</td>
<td>
<em>(Optional)</em>
</td>
</tr>
<tr>
<td>
<code>eviction</code></br>
<em>
<a href="#agones.dev/v1.Eviction">
Eviction
</a>
</em>
</td>
<td>
<em>(Optional)</em>
<p>Eviction specifies the eviction tolerance of the GameServer.</p>
</td>
</tr>
</tbody>
</table>
<h3 id="agones.dev/v1.GameServerStatusPort">GameServerStatusPort
</h3>
<p>
(<em>Appears on:</em>
<a href="#allocation.agones.dev/v1.GameServerAllocationStatus">GameServerAllocationStatus</a>, 
<a href="#agones.dev/v1.GameServerStatus">GameServerStatus</a>)
</p>
<p>
<p>GameServerStatusPort shows the port that was allocated to a
GameServer.</p>
</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>name</code></br>
<em>
string
</em>
</td>
<td>
</td>
</tr>
<tr>
<td>
<code>port</code></br>
<em>
int32
</em>
</td>
<td>
</td>
</tr>
</tbody>
</table>
<h3 id="agones.dev/v1.GameServerTemplateSpec">GameServerTemplateSpec
</h3>
<p>
(<em>Appears on:</em>
<a href="#agones.dev/v1.FleetSpec">FleetSpec</a>, 
<a href="#agones.dev/v1.GameServerSetSpec">GameServerSetSpec</a>)
</p>
<p>
<p>GameServerTemplateSpec is a template for GameServers</p>
</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>metadata</code></br>
<em>
<a href="https://v1-27.docs.kubernetes.io/docs/reference/generated/kubernetes-api/v1.27/#objectmeta-v1-meta">
Kubernetes meta/v1.ObjectMeta
</a>
</em>
</td>
<td>
Refer to the Kubernetes API documentation for the fields of the
<code>metadata</code> field.
</td>
</tr>
<tr>
<td>
<code>spec</code></br>
<em>
<a href="#agones.dev/v1.GameServerSpec">
GameServerSpec
</a>
</em>
</td>
<td>
<br/>
<br/>
<table>
<tr>
<td>
<code>container</code></br>
<em>
string
</em>
</td>
<td>
<p>Container specifies which Pod container is the game server. Only required if there is more than one
container defined</p>
</td>
</tr>
<tr>
<td>
<code>ports</code></br>
<em>
<a href="#agones.dev/v1.GameServerPort">
[]GameServerPort
</a>
</em>
</td>
<td>
<p>Ports are the array of ports that can be exposed via the game server</p>
</td>
</tr>
<tr>
<td>
<code>health</code></br>
<em>
<a href="#agones.dev/v1.Health">
Health
</a>
</em>
</td>
<td>
<p>Health configures health checking</p>
</td>
</tr>
<tr>
<td>
<code>scheduling</code></br>
<em>
agones.dev/agones/pkg/apis.SchedulingStrategy
</em>
</td>
<td>
<p>Scheduling strategy. Defaults to &ldquo;Packed&rdquo;</p>
</td>
</tr>
<tr>
<td>
<code>sdkServer</code></br>
<em>
<a href="#agones.dev/v1.SdkServer">
SdkServer
</a>
</em>
</td>
<td>
<p>SdkServer specifies parameters for the Code Blind SDK Server sidecar container</p>
</td>
</tr>
<tr>
<td>
<code>template</code></br>
<em>
<a href="https://v1-27.docs.kubernetes.io/docs/reference/generated/kubernetes-api/v1.27/#podtemplatespec-v1-core">
Kubernetes core/v1.PodTemplateSpec
</a>
</em>
</td>
<td>
<p>Template describes the Pod that will be created for the GameServer</p>
</td>
</tr>
<tr>
<td>
<code>players</code></br>
<em>
<a href="#agones.dev/v1.PlayersSpec">
PlayersSpec
</a>
</em>
</td>
<td>
<em>(Optional)</em>
<p>(Alpha, PlayerTracking feature flag) Players provides the configuration for player tracking features.</p>
</td>
</tr>
<tr>
<td>
<code>counters</code></br>
<em>
<a href="#agones.dev/v1.CounterStatus">
map[string]agones.dev/agones/pkg/apis/agones/v1.CounterStatus
</a>
</em>
</td>
<td>
<em>(Optional)</em>
<p>(Alpha, CountsAndLists feature flag) Counters provides the configuration for tracking of int64 values against a GameServer.
Keys must be declared at GameServer creation time.</p>
</td>
</tr>
<tr>
<td>
<code>lists</code></br>
<em>
<a href="#agones.dev/v1.ListStatus">
map[string]agones.dev/agones/pkg/apis/agones/v1.ListStatus
</a>
</em>
</td>
<td>
<em>(Optional)</em>
<p>(Alpha, CountsAndLists feature flag) Lists provides the configuration for tracking of lists of up to 1000 values against a GameServer.
Keys must be declared at GameServer creation time.</p>
</td>
</tr>
<tr>
<td>
<code>eviction</code></br>
<em>
<a href="#agones.dev/v1.Eviction">
Eviction
</a>
</em>
</td>
<td>
<em>(Optional)</em>
<p>Eviction specifies the eviction tolerance of the GameServer. Defaults to &ldquo;Never&rdquo;.</p>
</td>
</tr>
</table>
</td>
</tr>
</tbody>
</table>
<h3 id="agones.dev/v1.Health">Health
</h3>
<p>
(<em>Appears on:</em>
<a href="#agones.dev/v1.GameServerSpec">GameServerSpec</a>)
</p>
<p>
<p>Health configures health checking on the GameServer</p>
</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>disabled</code></br>
<em>
bool
</em>
</td>
<td>
<p>Disabled is whether health checking is disabled or not</p>
</td>
</tr>
<tr>
<td>
<code>periodSeconds</code></br>
<em>
int32
</em>
</td>
<td>
<p>PeriodSeconds is the number of seconds each health ping has to occur in</p>
</td>
</tr>
<tr>
<td>
<code>failureThreshold</code></br>
<em>
int32
</em>
</td>
<td>
<p>FailureThreshold how many failures in a row constitutes unhealthy</p>
</td>
</tr>
<tr>
<td>
<code>initialDelaySeconds</code></br>
<em>
int32
</em>
</td>
<td>
<p>InitialDelaySeconds initial delay before checking health</p>
</td>
</tr>
</tbody>
</table>
<h3 id="agones.dev/v1.ListStatus">ListStatus
</h3>
<p>
(<em>Appears on:</em>
<a href="#agones.dev/v1.GameServerSpec">GameServerSpec</a>, 
<a href="#agones.dev/v1.GameServerStatus">GameServerStatus</a>)
</p>
<p>
<p>ListStatus stores the current list values and maximum capacity</p>
</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>capacity</code></br>
<em>
int64
</em>
</td>
<td>
</td>
</tr>
<tr>
<td>
<code>values</code></br>
<em>
[]string
</em>
</td>
<td>
</td>
</tr>
</tbody>
</table>
<h3 id="agones.dev/v1.PlayerStatus">PlayerStatus
</h3>
<p>
(<em>Appears on:</em>
<a href="#agones.dev/v1.GameServerStatus">GameServerStatus</a>)
</p>
<p>
<p>PlayerStatus stores the current player capacity values</p>
</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>count</code></br>
<em>
int64
</em>
</td>
<td>
</td>
</tr>
<tr>
<td>
<code>capacity</code></br>
<em>
int64
</em>
</td>
<td>
</td>
</tr>
<tr>
<td>
<code>ids</code></br>
<em>
[]string
</em>
</td>
<td>
</td>
</tr>
</tbody>
</table>
<h3 id="agones.dev/v1.PlayersSpec">PlayersSpec
</h3>
<p>
(<em>Appears on:</em>
<a href="#agones.dev/v1.GameServerSpec">GameServerSpec</a>)
</p>
<p>
<p>PlayersSpec tracks the initial player capacity</p>
</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>initialCapacity</code></br>
<em>
int64
</em>
</td>
<td>
</td>
</tr>
</tbody>
</table>
<h3 id="agones.dev/v1.PortPolicy">PortPolicy
(<code>string</code> alias)</p></h3>
<p>
(<em>Appears on:</em>
<a href="#agones.dev/v1.GameServerPort">GameServerPort</a>)
</p>
<p>
<p>PortPolicy is the port policy for the GameServer</p>
</p>
<h3 id="agones.dev/v1.Priority">Priority
</h3>
<p>
(<em>Appears on:</em>
<a href="#agones.dev/v1.FleetSpec">FleetSpec</a>, 
<a href="#allocation.agones.dev/v1.GameServerAllocationSpec">GameServerAllocationSpec</a>, 
<a href="#agones.dev/v1.GameServerSetSpec">GameServerSetSpec</a>)
</p>
<p>
<p>Priority is a sorting option for GameServers with Counters or Lists based on the Capacity.</p>
</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>type</code></br>
<em>
string
</em>
</td>
<td>
<p>Type: Sort by a &ldquo;Counter&rdquo; or a &ldquo;List&rdquo;.</p>
</td>
</tr>
<tr>
<td>
<code>key</code></br>
<em>
string
</em>
</td>
<td>
<p>Key: The name of the Counter or List. If not found on the GameServer, has no impact.</p>
</td>
</tr>
<tr>
<td>
<code>order</code></br>
<em>
string
</em>
</td>
<td>
<p>Order: Sort by &ldquo;Ascending&rdquo; or &ldquo;Descending&rdquo;. &ldquo;Descending&rdquo; a bigger Capacity is preferred.
&ldquo;Ascending&rdquo; would be smaller Capacity is preferred.</p>
</td>
</tr>
</tbody>
</table>
<h3 id="agones.dev/v1.SdkServer">SdkServer
</h3>
<p>
(<em>Appears on:</em>
<a href="#agones.dev/v1.GameServerSpec">GameServerSpec</a>)
</p>
<p>
<p>SdkServer specifies parameters for the Code Blind SDK Server sidecar container</p>
</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>logLevel</code></br>
<em>
<a href="#agones.dev/v1.SdkServerLogLevel">
SdkServerLogLevel
</a>
</em>
</td>
<td>
<p>LogLevel for SDK server (sidecar) logs. Defaults to &ldquo;Info&rdquo;</p>
</td>
</tr>
<tr>
<td>
<code>grpcPort</code></br>
<em>
int32
</em>
</td>
<td>
<p>GRPCPort is the port on which the SDK Server binds the gRPC server to accept incoming connections</p>
</td>
</tr>
<tr>
<td>
<code>httpPort</code></br>
<em>
int32
</em>
</td>
<td>
<p>HTTPPort is the port on which the SDK Server binds the HTTP gRPC gateway server to accept incoming connections</p>
</td>
</tr>
</tbody>
</table>
<h3 id="agones.dev/v1.SdkServerLogLevel">SdkServerLogLevel
(<code>string</code> alias)</p></h3>
<p>
(<em>Appears on:</em>
<a href="#agones.dev/v1.SdkServer">SdkServer</a>)
</p>
<p>
<p>SdkServerLogLevel is the log level for SDK server (sidecar) logs</p>
</p>
<hr/>
<p><em>
Generated with <code>gen-crd-api-reference-docs</code>.
</em></p>



</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-7eee50e5d896d8c0f7761ed471a95d89">9 - Examples</h1>
    <div class="lead">List of available code examples</div>
	<h2 id="configuration-files">Configuration files</h2>
<p>These are full examples for each of the resource types of Code Blind</p>
<ul>
<li>
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>Full GameServer Configuration</a></li>
<li>
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>Full Fleet Configuration</a></li>
<li>
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>Full GameServer Allocation Configuration</a></li>
<li>
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>Full Autoscaler Configuration with Buffer Strategy</a></li>
<li>
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>Full Autoscaler Configuration with Webhook Strategy</a></li>
<li>
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>Full Autoscaler Configuration with Webhook Strategy + TLS</a></li>
</ul>
<h2 id="game-server-implementations">Game server implementations</h2>
<p>These are all examples of simple game server implementations, that integrate the Code Blind game server SDK.</p>
<ul>
<li>
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>Simple gameserver</a> (Go) - simple server that
responds to TCP connections or UDP packets on the same port.</li>
<li>
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>CPP Simple</a> (C++) - C++ example that starts up, stays
healthy and then shuts down after 60 seconds.</li>
<li>
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>Node.js Simple</a> (Node.js) -
A simple Node.js example that marks itself as ready, sets some labels and then shutsdown.</li>
<li>
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>Rust Simple</a> (Rust) -
A simple Rust example that marks itself as ready, sets some labels and then shutsdown.</li>
<li>
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>Unity Simple</a> (Unity3d)  -
This is a very simple &ldquo;unity server&rdquo; that doesn&rsquo;t do much other than show how the SDK works in Unity.</li>
<li>
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>Xonotic</a> - Wraps the SDK around the open source FPS game
<a href="http://www.xonotic.org">Xonotic</a> and hosts it on Code Blind.</li>
<li>
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>SuperTuxKart</a> - Wraps the SDK around the open source
racing game <a href="https://supertuxkart.net/">SuperTuxKart</a>, and hosts it on Code Blind.</li>
</ul>
<h2 id="building-on-top-of-code-blind">Building on top of Code Blind</h2>
<ul>
<li>
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>Code Blind API Usage Example</a> (Go) -
This service provides an example of using the <a href="https://pkg.go.dev/agones.dev/agones/pkg/client/clientset/versioned/typed/agones/v1">Code Blind API</a>
to create a GameServer.</li>
</ul>
<h2 id="game-server-allocation">Game Server Allocation</h2>
<ul>
<li>
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>Allocation Endpoint Example</a> - An Code Blind clusters
aware proxy, built on Google Cloud.</li>
</ul>
<h2 id="integrations-with-other-projects">Integrations with other projects</h2>
<ul>
<li><a href="https://github.com/googleforgames/space-agon">googleforgames/space-agon</a> - Space Agon is a demo of Code Blind and
Open Match with a browser based game.</li>
<li><a href="https://github.com/googleforgames/global-multiplayer-demo">googleforgames/global-multiplayer-demo</a> - A demo of a global scale multiplayer game using Code Blind, Open Match, Unreal Engine 5 and multiple Google Cloud products.</li>
</ul>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-6c4dd4bbdf2d2146d79c0c0f18f4c96a">10 - Advanced</h1>
    <div class="lead">Advanced Guides, Techniques and walk-throughs</div>
	
</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-15980123edc419424a9f2df1a62f3135">10.1 - Scheduling and Autoscaling</h1>
    <div class="lead">Scheduling and autoscaling go hand in hand, as where in the cluster <code>GameServers</code> are provisioned impacts how to autoscale fleets up and down (or if you would even want to)</div>
	<h2 id="cluster-autoscaler">Cluster Autoscaler</h2>
<p>Kubernetes has a <a href="https://github.com/kubernetes/autoscaler/tree/master/cluster-autoscaler">cluster node autoscaler that works with a wide variety of cloud providers</a>.</p>
<p>The default scheduling strategy (<code>Packed</code>) is designed to work with the Kubernetes autoscaler out of the box.</p>
<p>The autoscaler will automatically add Nodes to the cluster when <code>GameServers</code> don&rsquo;t have room to be scheduled on the
clusters, and then scale down when there are empty Nodes with no <code>GameServers</code> running on them.</p>
<p>This means that scaling <code>Fleets</code> up and down can be used to control the size of the cluster, as the cluster autoscaler
will adjust the size of the cluster to match the resource needs of one or more <code>Fleets</code> running on it.</p>
<p>To enable and configure autoscaling on your cloud provider, check their <a href="https://github.com/kubernetes/autoscaler/tree/master/cluster-autoscaler/cloudprovider">connector implementation</a>,
or their cloud specific documentation.</p>
<h3 id="google-kubernetes-engine">Google Kubernetes Engine</h3>
<ul>
<li><a href="https://cloud.google.com/kubernetes-engine/docs/how-to/cluster-autoscaler">Administering Clusters: Autoscaling a Cluster</a></li>
<li><a href="https://cloud.google.com/kubernetes-engine/docs/concepts/cluster-autoscaler">Cluster Autoscaler</a></li>
</ul>
<h3 id="amazon-elastic-kubernetes-service">Amazon Elastic Kubernetes Service</h3>
<ul>
<li><a href="https://docs.aws.amazon.com/eks/latest/userguide/cluster-autoscaler.html">Cluster Autoscaler for EKS</a></li>
</ul>
<h3 id="azure-kubernetes-service">Azure Kubernetes Service</h3>
<ul>
<li><a href="https://docs.microsoft.com/en-us/azure/aks/autoscaler">Cluster Autoscaler on Azure Kubernetes Service (AKS) - Preview</a></li>
</ul>
<h2 id="fleet-autoscaling">Fleet Autoscaling</h2>
<p>Fleet autoscaling is the only type of autoscaling that exists in Code Blind. It is currently available as a
buffer autoscaling strategy or as a webhook driven strategy, such that you can provide your own autoscaling logic.</p>
<p>Have a look at the <a href="/docs/getting-started/create-fleetautoscaler/">Create a Fleet Autoscaler</a> quickstart, the
<a href="/docs/getting-started/create-webhook-fleetautoscaler/">Create a Webhook Fleet Autoscaler</a> quickstart,
and the <a href="/docs/reference/fleetautoscaler/">Fleet Autoscaler Specification</a> for details.</p>
<h2 id="autoscaling-concepts">Autoscaling Concepts</h2>
<p>To facilitate autoscaling, we need to combine several concepts and functionality, as described below.</p>
<h3 id="allocation-scheduling">Allocation Scheduling</h3>
<p>Allocation scheduling refers to the order in which <code>GameServers</code>, and specifically their backing <code>Pods</code> are chosen
from across the Kubernetes cluster within a given <code>Fleet</code> when <a href="/docs/getting-started/create-fleet/#4-allocate-a-game-server-from-the-fleet">allocation</a> occurs.</p>
<h3 id="pod-scheduling">Pod Scheduling</h3>
<p>Each <code>GameServer</code> is backed by a Kubernetes <a href="https://kubernetes.io/docs/concepts/workloads/pods/pod/"><code>Pod</code></a>. Pod scheduling
refers to the strategy that is in place that determines which node in the Kubernetes cluster the Pod is assigned to,
when it is created.</p>
<h3 id="fleet-scale-down-strategy">Fleet Scale Down Strategy</h3>
<p>Fleet Scale Down strategy refers to the order in which the <code>GameServers</code> that belong to a <code>Fleet</code> are deleted,
when Fleets are shrunk in size.</p>
<h2 id="fleet-scheduling">Fleet Scheduling</h2>
<p>There are two scheduling strategies for Fleets - each designed for different types of Kubernetes Environments.</p>
<h3 id="packed">Packed</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;agones.dev/v1&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Fleet</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">simple-game-server</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">replicas</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">100</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">scheduling</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Packed</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">template</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">ports</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">containerPort</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">7654</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">template</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">containers</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">simple-game-server</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">image</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">us-docker.pkg.dev/codeblind/examples/simple-server:0.27</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>This is the <em>default</em> Fleet scheduling strategy. It is designed for dynamic Kubernetes environments, wherein you wish
to scale up and down as load increases or decreases, such as in a Cloud environment where you are paying
for the infrastructure you use.</p>
<p>It attempts to <em>pack</em> as much as possible into the smallest set of nodes, to make
scaling infrastructure down as easy as possible.</p>
<p>This affects the Cluster autoscaler, Allocation Scheduling, Pod Scheduling and Fleet Scale Down Scheduling.</p>
<h4 id="cluster-autoscaler-1">Cluster Autoscaler</h4>
<p>When using the &ldquo;Packed&rdquo; strategy, Code Blind will ensure that the Cluster Autoscaler doesn&rsquo;t attempt to evict and move <code>GameServer</code> <code>Pods</code> onto new Nodes during
gameplay.</p>
<p>If a gameserver can tolerate <a href="https://kubernetes.io/docs/concepts/scheduling-eviction/api-eviction/#how-api-initiated-eviction-works">being evicted</a>
(generally in combination with setting an appropriate graceful termination period on the gameserver pod) and you
want the Cluster Autoscaler to compact your cluster by evicting game servers when it would allow the Cluster
Autoscaler to reduce the number of nodes in the cluster, <a href="/docs/advanced/controlling-disruption/">Controlling Disruption</a> describes
how to choose the <code>.eviction</code> setting appropriate for your <code>GameServer</code> or <code>Fleet</code>.</p>
<h4 id="allocation-scheduling-strategy">Allocation Scheduling Strategy</h4>
<p>Under the &ldquo;Packed&rdquo; strategy, allocation will prioritise allocating <code>GameServers</code> to nodes that are running on
Nodes that already have allocated <code>GameServers</code> running on them.</p>
<h4 id="pod-scheduling-strategy">Pod Scheduling Strategy</h4>
<p>Under the &ldquo;Packed&rdquo; strategy, Pods will be scheduled using the <a href="https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#inter-pod-affinity-and-anti-affinity-beta-feature"><code>PodAffinity</code></a>
with a <code>preferredDuringSchedulingIgnoredDuringExecution</code> affinity with <a href="https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#interlude-built-in-node-labels">hostname</a>
topology. This attempts to group together <code>GameServer</code> Pods within as few nodes in the cluster as it can.</p>


<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Note</h4>

    The default Kubernetes scheduler doesn&rsquo;t do a perfect job of packing, but it&rsquo;s a good enough job for what we need -
at least at this stage.

</div>

<h4 id="fleet-scale-down-strategy-1">Fleet Scale Down Strategy</h4>
<p>With the &ldquo;Packed&rdquo; strategy, Fleets will remove <code>Ready</code> <code>GameServers</code> from Nodes with the <em>least</em> number of <code>Ready</code> and
<code>Allocated</code> <code>GameServers</code> on them. Attempting to empty Nodes so that they can be safely removed.</p>
<h3 id="distributed">Distributed</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;agones.dev/v1&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Fleet</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">simple-game-server</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">replicas</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">100</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">scheduling</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Distributed</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">template</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">ports</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">containerPort</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">7654</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">template</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">containers</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">simple-game-server</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">image</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">us-docker.pkg.dev/codeblind/examples/simple-server:0.27</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>This Fleet scheduling strategy is designed for static Kubernetes environments, such as when you are running Kubernetes
on bare metal, and the cluster size rarely changes, if at all.</p>
<p>This attempts to distribute the load across the entire cluster as much as possible, to take advantage of the static
size of the cluster.</p>


<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Note</h4>

    <p><code>Distributed</code> scheduling does not set
a <a href="https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#inter-pod-affinity-and-anti-affinity-beta-feature"><code>PodAffinity</code></a>
on <code>GameServer</code> <code>Pods</code>, and instead assumes that the default scheduler for your cluster will distribute the
<code>GameServer</code> <code>Pods</code> across the cluster by default.</p>
<p>If your default scheduler does not do this, you may wish to set your own <code>PodAffinity</code> to spread the load across the
cluster, or update the default scheduler to provide this functionality.</p>


</div>

<p>This affects Allocation Scheduling, Pod Scheduling and Fleet Scale Down Scheduling.</p>
<h4 id="cluster-autoscaler-2">Cluster Autoscaler</h4>
<p>Since this strategy is not aimed at clusters that autoscale, this strategy does nothing for the cluster autoscaler.</p>
<h4 id="allocation-scheduling-strategy-1">Allocation Scheduling Strategy</h4>
<p>Under the &ldquo;Distributed&rdquo; strategy, allocation will prioritise allocating <code>GameServers</code> to nodes that have the least
number of allocated <code>GameServers</code> on them.</p>
<h4 id="pod-scheduling-strategy-1">Pod Scheduling Strategy</h4>
<p>Under the &ldquo;Distributed&rdquo; strategy, <code>Pod</code> scheduling is provided by the default Kubernetes scheduler, which will attempt
to distribute the <code>GameServer</code> <code>Pods</code> across as many nodes as possible.</p>
<h4 id="fleet-scale-down-strategy-2">Fleet Scale Down Strategy</h4>
<p>With the &ldquo;Distributed&rdquo; strategy, Fleets will remove <code>Ready</code> <code>GameServers</code> from Nodes with at random, to ensure
a distributed load is maintained.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-01cd69ca33036b349a8d47b3ee3df55d">10.2 - High Availability Code Blind</h1>
    <div class="lead">Learn how to configure your Code Blind services for high availability and resiliancy to disruptions.</div>
	<h2 id="high-availability-for-code-blind-controller">High Availability for Code Blind Controller</h2>
<p>The <code>agones-controller</code> responsibility is split up into <code>agones-controller</code>, which enacts the Code Blind control loop, and <code>agones-extensions</code>, which acts as a service endpoint for webhooks and the allocation extension API. Splitting these responsibilities allows the <code>agones-extensions</code> pod to be <strong>horizontally scaled</strong>, making the Code Blind control plane <strong>highly available</strong> and more <strong>resiliant to disruption</strong>.</p>
<p>Multiple <code>agones-controller</code> pods enabled, with a primary controller selected via leader election. Having multiple <code>agones-controller</code> minimizes downtime of the service from pod disruptions such as deployment updates, autoscaler evictions, and crashes.</p>
<h2 id="extension-pod-configrations">Extension Pod Configrations</h2>
<p>The <code>agones-extensions</code> binary has a similar <code>helm</code> configuration to <code>agones-controller</code>, see <a href="/docs/installation/install-agones/helm/">here</a>. If you previously overrode <code>agones.controller.*</code> settings, you may need to override the same <code>agones.extensions.*</code> setting.</p>
<p>To change <code>controller.numWorkers</code> to 200 from 100 values and through the use of <code>helm --set</code>, add the follow to the <code>helm</code> command:</p>


<div class="alert alert-warning" role="alert">


    Important: This will not have any effect on any <code>extensions</code> values!

</div>

<pre tabindex="0"><code> ...
 --set agones.controller.numWorkers=200
 ...
</code></pre><p>An important configuration to note is the PodDisruptionBudget fields, <code>agones.extensions.pdb.minAvailable</code> and <code>agones.extensions.pdb.maxUnavailable</code>. Currently, the <code>agones.extensions.pdb.minAvailable</code> field is set to 1.</p>
<h2 id="deployment-considerations">Deployment Considerations</h2>
<p>Leader election will automatically be enabled and <code>agones.controller.replicas</code> is &gt; 1. <a href="/docs/installation/install-agones/helm/#configuration"><code>agones.controller.replicas</code></a> defaults to 2.</p>
<p>The default configuration now deploys 2 <code>agones-controller</code> pods and 2 <code>agones-extensions</code> pods, replacing the previous single <code>agones-controller</code> pod setup. For example:</p>
<pre tabindex="0"><code>NAME                                 READY   STATUS    RESTARTS   AGE
agones-allocator-78c6b8c79-h9nqc     1/1     Running   0          23h
agones-allocator-78c6b8c79-l2bzp     1/1     Running   0          23h
agones-allocator-78c6b8c79-rw75j     1/1     Running   0          23h
agones-controller-fbf944f4-vs9xx     1/1     Running   0          23h
agones-controller-fbf944f4-sjk3t     1/1     Running   0          23h
agones-extensions-5648fc7dcf-hm6lk   1/1     Running   0          23h
agones-extensions-5648fc7dcf-qbc6h   1/1     Running   0          23h
agones-ping-5b9647874-2rrl6          1/1     Running   0          27h
agones-ping-5b9647874-rksgg          1/1     Running   0          27h
</code></pre><p>The number of replicas for <code>agones-extensions</code> can be set using helm variable <a href="/docs/installation/install-agones/helm/#configuration"><code>agones.extensions.replicas</code></a>, but the default is <code>2</code>.</p>
<p>We expect the aggregate memory consumption of the pods will be slightly higher than the previous singleton pod, but as the responsibilities are now split across the pods, the aggregate CPU consumption should also be similar.</p>
<h2 id="feature-design">Feature Design</h2>
<p>Please see <a href="https://github.com/googleforgames/agones/issues/2797">HA Code Blind</a>.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-6689fca1455445a3c7759b93ee6d69e2">10.3 - Controlling Disruption</h1>
    <div class="lead">Game servers running on Code Blind may be disrupted by Kubernetes; learn how to control disruption of your game servers.</div>
	<h2 id="disruption-in-kubernetes">Disruption in Kubernetes</h2>
<p><a href="https://kubernetes.io/docs/concepts/workloads/pods/disruptions/#voluntary-and-involuntary-disruptions">A <code>Pod</code> in Kubernetes may be disrupted</a> for involuntary reasons, e.g. hardware failure, or voluntary reasons, such as when nodes are drained for upgrades.</p>
<p>By default, Code Blind assumes your game server should never be disrupted voluntarily and configures the <code>Pod</code> appropriately - but this isn&rsquo;t always the ideal setting. Here we discuss how Code Blind allows you to control the two most significant sources of voluntary <code>Pod</code> evictions, node upgrades and Cluster Autoscaler, using the <code>eviction</code> API on the <code>GameServer</code> object.</p>
<h2 id="benefits-of-allowing-voluntary-disruption">Benefits of Allowing Voluntary Disruption</h2>
<p>It&rsquo;s not always easy to write your game server in a way that allows for disruption, but it can have major benefits:</p>
<ul>
<li>Compaction of your cluster using <a href="https://github.com/kubernetes/autoscaler/tree/master/cluster-autoscaler">Cluster Autoscaler</a> can lead to considerable cost savings for your infrastructure.</li>
<li>Allowing automated node upgrades can save you management toil, and lowers the time it takes to patch security vulnerabilites.</li>
</ul>
<h2 id="considerations">Considerations</h2>
<p>When discussing game server pod disruption, it&rsquo;s important to keep two factors in mind:</p>
<ul>
<li><strong><code>TERM</code> signal:</strong> Is your game server tolerant of graceful termination? If you wish to support voluntary disruption, your game server must handle the <code>TERM</code> signal (even if it runs to completion after receiving <code>TERM</code>).</li>
<li><strong>Termination Grace Period:</strong> After receiving <code>TERM</code>, how long does your game server need to run? If you run to completion after receiving <code>TERM</code>, this is equivalent to the session length - if not, you can think of this as the cleanup time. In general, we bucket the grace period into &ldquo;less than 10 minutes&rdquo;, &ldquo;10 minutes to an hour&rdquo;, and &ldquo;greater than an hour&rdquo;. (See <a href="/docs/advanced/controlling-disruption/#whats-special-about-ten-minutes-and-one-hour">below</a> if you are curious about grace period considerations.)</li>
</ul>
<h2 id="eviction-api"><code>eviction</code> API</h2>
<p>The <code>eviction</code> API is specified as part of the <code>GameServerSpec</code>, like:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;agones.dev/v1&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">GameServer</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;simple-game-server&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">eviction</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">safe</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Always</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">template</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">...]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>You can set <code>eviction.safe</code> based on your game server&rsquo;s tolerance for disruption and session length, based on the following diagram:</p>
<p><img alt="Eviction Decision Diagram" src="../../../diagrams/eviction-decision.dot.png"></p>
<p>In words:</p>
<ul>
<li>Does the game server support <code>TERM</code> and terminate within ten minutes?
<ul>
<li>Yes to both: Set <code>safe: Always</code>, and set <a href="https://kubernetes.io/docs/concepts/containers/container-lifecycle-hooks/#hook-handler-execution">terminationGracePeriodSeconds</a> to the session length or cleanup time.</li>
<li>No to either: Does the game server support <code>TERM</code> and terminate within an hour?
<ul>
<li>Yes to both: Set <code>safe: OnUpgrade</code>, and configure <a href="https://kubernetes.io/docs/concepts/containers/container-lifecycle-hooks/#hook-handler-execution">terminationGracePeriodSeconds</a> to the session length or cleanup time.</li>
<li>No to either: Set <code>safe: Never</code>. If your game server does not terminate within an hour, see <a href="/docs/advanced/controlling-disruption/#considerations-for-long-sessions">below</a>.</li>
</ul>
</li>
</ul>
</li>
</ul>


<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Note</h4>

    To maintain backward compatibility with Code Blind prior to the introduction of <code>eviction</code> API, if your game server previously configured the <code>cluster-autoscaler.kubernetes.io/safe-to-evict: true</code> annotation, we assume <code>eviction.safe: Always</code> is intended.

</div>



<div class="alert alert-info" role="alert">
<h4 class="alert-heading">Note</h4>

    GKE Autopilot supports only <code>Never</code> and <code>Always</code>, not <code>OnUpgrade</code>.

</div>

<h2 id="whats-special-about-ten-minutes-and-one-hour">What&rsquo;s special about ten minutes and one hour?</h2>
<ul>
<li>
<p><strong>Ten minutes:</strong> Cluster Autoscaler respects <a href="https://github.com/kubernetes/autoscaler/blob/master/cluster-autoscaler/FAQ.md#does-ca-respect-gracefultermination-in-scale-down">ten minutes of graceful termination</a> on scale-down. On some cloud products, you can configure <code>--max-graceful-termination-sec</code> to change this, but it is not advised: Cluster Autoscaler is currently only capable of scaling down one node at a time, and larger graceful termination windows slow this down farther (see <a href="https://github.com/kubernetes/autoscaler/issues/5079">autoscaler#5079</a>). If the ten minute limit does not apply to you, generally you should choose between <code>safe: Always</code> (for sessions less than an hour), or see <a href="/docs/advanced/controlling-disruption/#considerations-for-long-sessions">below</a>.</p>
</li>
<li>
<p><strong>One hour:</strong> On many cloud products, <code>PodDisruptionBudget</code> can only block node upgrade evictions for a certain period of time - on GKE this is 1h. After that, the PDB is ignored, or the node upgrade fails with an error. Controlling <code>Pod</code> disruption for longer than one hour requires cluster configuration changes outside of Code Blind - see <a href="/docs/advanced/controlling-disruption/#considerations-for-long-sessions">below</a>.</p>
</li>
</ul>
<h2 id="considerations-for-long-sessions">Considerations for long sessions</h2>
<p>Outside of Cluster Autoscaler, the main source of disruption for long sessions is node upgrade. On some cloud products, such as GKE Standard, node upgrades are entirely within your control. On others, such as GKE Autopilot, node upgrade is automatic. Typical node upgrades use an eviction based, rolling recreate strategy, and may not honor <code>PodDisruptionBudget</code> for longer than an hour. See <a href="/docs/guides/best-practices/">Best Practices</a> for information specific to your cloud product.</p>
<h2 id="implementation--under-the-hood">Implementation / Under the hood</h2>
<p>Each option uses a slightly different permutation of:</p>
<ul>
<li>the <code>safe-to-evict</code> annotation to block <a href="https://github.com/kubernetes/autoscaler/blob/master/cluster-autoscaler/FAQ.md#what-types-of-pods-can-prevent-ca-from-removing-a-node">Cluster Autoscaler based eviction</a>, and</li>
<li>the <code>agones.dev/safe-to-evict</code> label selector to select the <code>agones-gameserver-safe-to-evict-false</code> <code>PodDisruptionBudget</code>. This blocks <a href="https://github.com/kubernetes/autoscaler/blob/master/cluster-autoscaler/FAQ.md#what-types-of-pods-can-prevent-ca-from-removing-a-node">Cluster Autoscaler</a> and (for a limited time) <a href="https://kubernetes.io/docs/concepts/workloads/pods/disruptions/#pod-disruption-budgets">disruption from node upgrades</a>.
<ul>
<li>Note that PDBs do influence pod preemption as well, but it&rsquo;s not guaranteed.</li>
</ul>
</li>
</ul>
<p>As a quick reference:</p>
<table>
<thead>
<tr>
<th>evictions.safe setting</th>
<th><code>safe-to-evict</code> pod annotation</th>
<th><code>agones.dev/safe-to-evict</code> label</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Never</code> (default)</td>
<td><code>false</code></td>
<td><code>false</code> (matches PDB)</td>
</tr>
<tr>
<td><code>OnUpdate</code></td>
<td><code>false</code></td>
<td><code>true</code> (does not match PDB)</td>
</tr>
<tr>
<td><code>Always</code></td>
<td><code>true</code></td>
<td><code>true</code> (does not match PDB)</td>
</tr>
</tbody>
</table>
<h2 id="further-reading">Further Reading</h2>
<ul>
<li><a href="https://github.com/googleforgames/agones/issues/2794"><code>eviction</code> design</a></li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-95571351289b80d85a0bde5b4c1a0b22">10.4 - Limiting CPU &amp; Memory</h1>
    <div class="lead">Kubernetes natively has inbuilt capabilities for requesting and limiting both CPU and Memory usage of running containers.</div>
	<p>As a short description:</p>
<ul>
<li>CPU <code>Requests</code> are limits that are applied when there is CPU congestion, and as such can burst above their set limits.</li>
<li>CPU <code>Limits</code> are hard limits on how much CPU time the particular container gets access to.</li>
</ul>
<p>This is useful for game servers, not just as a mechanism to distribute compute resources evenly, but also as a way
to advice the Kubernetes scheduler how many game server processes it is able to fit into a given node in the cluster.</p>
<p>It&rsquo;s worth reading the <a href="https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/">Managing Compute Resources for Containers</a>
Kubernetes documentation for more details on &ldquo;requests&rdquo; and &ldquo;limits&rdquo; to both CPU and Memory, and how to configure them.</p>
<h2 id="gameservers">GameServers</h2>
<p>Since the <code>GameServer</code> specification provides a full <a href="https://v1-27.docs.kubernetes.io/docs/reference/generated/kubernetes-api/v1.27/#podtemplatespec-v1-core"><code>PodSpecTemplate</code></a>,
we can take advantage of both resource limits and requests in our <code>GameServer</code> configurations.</p>
<p>For example, to set a CPU limit on our <code>GameServer</code> configuration of <code>250m/0.25</code> of a CPU,
we could do so as followed:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;agones.dev/v1&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">GameServer</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;simple-game-server&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">ports</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">default</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">containerPort</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">7654</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">template</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">containers</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">simple-game-server</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">image</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">us-docker.pkg.dev/codeblind/examples/simple-server:0.27</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">resources</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">limits</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">cpu</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;250m&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic">#this is our limit here</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>If you do not set a limit or request, the default is set by Kubernetes at a 100m CPU request.</p>
<h2 id="sdk-gameserver-sidecar">SDK GameServer sidecar</h2>
<p>You may also want to tweak the CPU request or limits on the SDK <code>GameServer</code> sidecar process that spins up alongside
each game server container.</p>
<p>You can do this through the <a href="https://codeblind.ai/docs/installation/install-agones/helm/">Helm configuration</a> when installing Code Blind.</p>
<p>By default, this is set to having a CPU request value of 30m, with no hard CPU limit. This ensures that the sidecar always has enough CPU
to function, but it is configurable in case a lower, or higher value is required on your clusters, or if you desire
hard limit.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-9265a75f393211dcf8575bc3474c7ef6">10.5 - Out of Cluster Dev Server</h1>
    <div class="lead">Running and debugging server binary locally while connected to a full kubernetes stack</div>
	<p>This section builds upon the topics discussed in <a href="https://codeblind.ai/docs/guides/client-sdks/local/">local SDK Server</a>, <a href="https://codeblind.ai/docs/guides/local-game-server/">Local Game Server</a>, and <code>GameServer</code> allocation (discussed <a href="https://codeblind.ai/docs/integration-patterns/allocation-from-fleet/">here</a>, <a href="https://codeblind.ai/docs/reference/gameserverallocation/">here</a>, and <a href="https://codeblind.ai/docs/advanced/allocator-service/">here</a>).
Having a firm understanding of those concepts will be necessary for running an &ldquo;out of cluster&rdquo; local server.</p>
<p>Running an &ldquo;out of cluster&rdquo; dev server combines the best parts of local debugging and being a part of a cluster.
A developer will be able to run a custom server binary on their local machine, even within an IDE with breakpoints.
The server would also be allocatable within a cluster, allowing integration with the project&rsquo;s full stack for handling game server lifetime.</p>
<p>For each run, the only manual steps required by the developer is to manually run the local SDK Server and to run their custom gameplay binary (each can easily be reused/restarted).
All other state progression will be automatically handled by the custom gameplay server (calling the SDK API), the SDK Server (handling the SDK calls), the cluster <code>GameServer</code> Controller (progressing specific <a href="https://codeblind.ai/docs/reference/gameserver/#gameserver-state-diagram">states</a>), and the cluster&rsquo;s allocation system (whether be through <code>GameServerAllocation</code> or via the Allocator Service) &ndash; just as it would when running in a pod in a cluster!</p>
<p>Out of cluster development is a fantastic option during early prototyping, as it can (optionally) all be run on a single machine with tools such as <a href="https://codeblind.ai/docs/installation/creating-cluster/minikube/">Minikube</a>.</p>
<p>The name &ldquo;out of cluster&rdquo; is to contrast <a href="https://pkg.go.dev/k8s.io/client-go/tools/clientcmd#InClusterConfig">InClusterConfig</a> which is used in the internal golang kubeconfig API.</p>
<h2 id="prerequisite-steps">Prerequisite steps</h2>
<p>To be able to run an &ldquo;out of cluster&rdquo; local game server, one needs to first complete a few prerequisite steps.</p>
<h3 id="cluster-created">Cluster created</h3>
<p>First, a cluster must have been created that the developer has access to through commands like <code>kubectl</code>.
This cluster could be running on a provider or locally (e.g. on Minikube).
See <a href="https://codeblind.ai/docs/installation/creating-cluster/">Create Kubernetes Cluster</a> for more details on how to create a cluster, if not already done so.</p>
<h3 id="code-blind-gameserver-resource-created">Code Blind <code>GameServer</code> resource created</h3>
<p>Out of cluster dev servers make use of <a href="https://codeblind.ai/docs/guides/local-game-server/">local dev servers</a>.
Follow the instructions there to create a <code>GameServer</code> resource for use with a local game server.
Note that the <code>metadata:annotations:agones.dev/dev-address</code> should be updated to point to the local machine, more details <a href="/docs/advanced/out-of-cluster-dev-server/#forwarded-ports">below</a> around port forwarding.</p>
<h3 id="sdk-server-available">SDK Server available</h3>
<p>An &ldquo;out of cluster&rdquo; dev server requires the need to also run the SDK Server locally.</p>
<p>When a <code>GameServer</code> runs normally in a prod-like environment, the Code Blind cluster controller will handle initializing the containers which contain the SDK Server and the game server binary.
The game server binary will be able to connect over gRPC to the SDK Server running in the sidecar container.
When the game server binary makes SDK calls (e.g. <code>SDK.Ready()</code>), those get sent to the SDK Server via gRPC and the SDK Server as able to modify the <code>GameServer</code> resource in the cluster.
When the <code>GameServer</code> resource gets modified (either by the Code Blind cluster controller, by the Code Blind Allocation Service, or by the K8s API), the SDK Server is monitoring and sends update events over gRPC to the SDK API, resulting in a callback in the game server binary logic.</p>
<p>The goal of an &ldquo;out of cluster&rdquo; dev server is to keep all this prod-like functionality, even in a debuggable context.
To do so, the developer must run the SDK Server locally such that the (also local) game server binary can connect via gRPC.
Instructions for downloading and running the SDK Server can be found <a href="https://codeblind.ai/docs/guides/client-sdks/local/">here</a>.
However, instead of using <code>--local</code> or <code>--file</code>, the SDK Server will need to be run in &ldquo;out of cluster&rdquo; mode by providing a kubeconfig file to connect to the cluster. This section is focusing on getting the SDK Server ready to run locally, more detail about running it can be found <a href="/docs/advanced/out-of-cluster-dev-server/#running-sdk-server-locally">below</a>.</p>
<h3 id="game-server-binary-available">Game server binary available</h3>
<p>When running Code Blind normally, the game server binary is inside a prebuilt docker image which is loaded into a container in a <code>GameServer</code>&rsquo;s pod.
This can either be a custom, developer-created, docker image and contained binary or a sample image/binary from an external source.
This document will use the sample <code>simple-game-server</code>, which follows suit from various other documentation pages (e.g. <a href="https://codeblind.ai/docs/getting-started/create-gameserver/">Quickstart: Create a Game Server</a>).</p>
<p>The <code>simple-game-server</code> can be run from the docker image <code>us-docker.pkg.dev/codeblind/examples/simple-server:0.27</code>.
The game server binary can either be run within a docker container or run locally, so long as all ports are published/forward &ndash; more on this <a href="/docs/advanced/out-of-cluster-dev-server/#forwarded-ports">below</a>.</p>
<p>Alternatively, the <code>simple-game-server</code> can also be run from source code; see <code>examples/simple-game-server/main.go</code>. More details about running from source can be found <a href="https://codeblind.ai/docs/guides/client-sdks/local/#running-from-source-code-instead-of-prebuilt-binary">here</a>.</p>
<p><strong>Disclaimer:</strong> Code Blind is run and tested with the version of Go specified by the <code>GO_VERSION</code> variable in the project&rsquo;s <a href="https://github.com/googleforgames/agones/blob/main/build/build-image/Dockerfile">build Dockerfile</a>. Other versions are not supported, but may still work.</p>
<p>If a developer has their own game server logic, written in the language of their choice, that would be perfectly fine.
A custom game server can be similarly run within a docker container, run directly on commandline, or run via an IDE/debugger.</p>
<h3 id="forwarded-ports">Forwarded Ports</h3>
<p>As the game server binary will be run on the developer&rsquo;s machine and a requesting client will attempt to connect to the game server via the <code>GameServer</code>&rsquo;s <code>metadata:annotations:agones.dev/dev-address</code> and <code>spec:ports:hostPort</code> fields, the developer needs to ensure that connection can take place.</p>
<p>If the game server binary and the arbitrary connecting client logic are both on the same network, then connecting should work without any extra steps.
However, if the developer has a more complicated network configuration or if they are attempting to connect over the public internet, extra steps may be required.</p>
<p>Obviously, this document does not know what every developer&rsquo;s specific network configuration is, how their custom game client(s) work, their development environment, and/or various other factors.
The developer will need to figure out which steps are necessary for their specific configuration.</p>
<p>If attempting to connect via the internet, the developer needs to set the <code>GameServer</code>&rsquo;s <code>metadata:annotations:agones.dev/dev-address</code> field to their public IP.
This can be found by going to <a href="https://www.whatsmyip.org/">whatsmyip.org</a> or <a href="https://www.whatismyip.com/">whatismyip.com</a> in a web browser.</p>
<p>The  <code>GameServer</code>&rsquo;s <code>spec:ports:hostPort</code>/<code>spec:ports:containerPort</code> should be set to whichever port the game server binary&rsquo;s logic will bind to &ndash; the port used by <code>simple-game-server</code> is 7654 (by default).
The local network&rsquo;s router must also be configured to forward this port to the desired machine; allowing inbound external requests (from the internet) to be directed to the machine on the network that is running the game server.</p>
<p>If the SDK Server is run on the same machine as the game server binary, no extra steps are necessary for the two to connect.
By default, the SDK API (in the game server binary) will attempt to gRPC connect to the SDK Server on <code>localhost</code> on the port <code>9357</code>.
If the SDK Server is run on another machine, or if the SDK Server is set to use different ports (e.g. via commandline arguments), the developer will need to also take appropriate steps to ensure that the game server can connect to the SDK Server.
As discussed <a href="/docs/advanced/out-of-cluster-dev-server/#running-sdk-server-locally">further below</a> running the SDK Server with <code>--address 0.0.0.0</code> can be quite helpful with various setups.</p>
<p>If the developer is running the SDK Server or the game server binary within docker container(s), then publishing ports and/or connecting to a docker network may be necessary.
Again, these configurations can vary quite dramatically and the developer will need to find the necessary steps for their specific setup.</p>
<h2 id="running-out-of-cluster-local-game-server">Running &ldquo;out of cluster&rdquo; local game server</h2>
<p>Now that all prerequisite steps have been completed, the developer should have:</p>
<ul>
<li>a <a href="/docs/advanced/out-of-cluster-dev-server/#cluster-created">cluster</a> with a configured <a href="/docs/advanced/out-of-cluster-dev-server/#agones-gameserver-resource-created"><code>GameServer</code> resource</a>.</li>
<li>the <a href="/docs/advanced/out-of-cluster-dev-server/#sdk-server-available">SDK Server</a> ready to run.</li>
<li>a <a href="/docs/advanced/out-of-cluster-dev-server/#game-server-binary-available">game server binary</a> ready to run.</li>
</ul>
<h3 id="optional-gameserver-state-monitoring">Optional <code>GameServer</code> state monitoring</h3>
<p>A helpful (optional) step to see progress when running is to watch the <code>GameServer</code> resource.</p>
<p>This can be done with the command:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl get --watch -n default gs my-local-server
</span></span></code></pre></div><p>It may be necessary to replace <code>default</code> and <code>my-local-server</code> with whichever namespace/name values are used by the dev <code>GameServer</code> created <a href="/docs/advanced/out-of-cluster-dev-server/#agones-gameserver-resource-created">above</a>).</p>
<p>With this command running, the terminal will automatically show updates to the <code>GameServer</code>&rsquo;s state &ndash; however, this is not necessary to proceed.</p>
<h3 id="running-sdk-server-locally">Running SDK Server locally</h3>
<p>The first step is to run the SDK Server, making it available for the (later run) game server binary to connect.
Here is a sample command to run the SDK Server, with each argument discussed after.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./sdk-server.linux.amd64 <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --gameserver-name my-local-server <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --pod-namespace default <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --kubeconfig <span style="color:#4e9a06">&#34;</span><span style="color:#000">$HOME</span><span style="color:#4e9a06">/.kube/config&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --address 0.0.0.0 <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --graceful-termination <span style="color:#204a87">false</span>
</span></span></code></pre></div><ul>
<li><code>--gameserver-name</code> is a necessary arg, passed instead of the <code>GAMESERVER_NAME</code> enviroment variable.
<ul>
<li>It is set to the name of the dev <code>GameServer</code> k8s resource.</li>
<li>It tells the SDK Sever which resource to read/write to on the k8s cluster.</li>
<li>This example value of <code>my-local-server</code> matches to the instructions for setting up a <a href="https://codeblind.ai/docs/guides/local-game-server/">Local Game Server</a>.</li>
</ul>
</li>
<li><code>--pod-namespace</code> is a necessary arg, passed instead of the <code>POD_NAMESPACE</code> enviroment variable.
<ul>
<li>It is set set to the namespace which the dev <code>GameServer</code> resides in.</li>
<li>It tells the SDK Sever which namespace to look under for the <code>GameServer</code> to read/write to on the k8s cluster.</li>
<li>This example value of <code>default</code> is used as most instructions in this documentation assumes <code>GameServers</code> to be created in the <code>default</code> namespace.</li>
</ul>
</li>
<li><code>--kubeconfig</code> tells the SDK Server how to connect to the k8s cluster.
<ul>
<li>This actually does not trigger any special flow (unlike <code>--local</code> or <code>--file</code>).
The SDK Server will run just as it would when created in a sidecar container in a k8s cluster.</li>
<li>Passing this argument simply provides where to connect along with the credentials to do so.</li>
<li>This example value of <code>&quot;$HOME/.kube/config&quot;</code> is the default location for k8s authentication information. This requires the developer be logged in via <code>kubectl</code> and have the desired cluster selected via <a href="https://jamesdefabia.github.io/docs/user-guide/kubectl/kubectl_config_use-context/"><code>kubectl config use-context</code></a>.</li>
</ul>
</li>
<li><code>--address</code> specifies the binding IP address for the SDK Server&rsquo;s SDK API.
<ul>
<li>By default, the binding address is <code>localhost</code>. This may be difficult for some development setups.</li>
<li>Overriding this value changes which IP address(es) the server will bind to for receiving gRPC/REST SDK API calls.</li>
<li>This example value of <code>0.0.0.0</code> sets the SDK Server to receive API calls that are sent to any IP address (that reach the machine).</li>
</ul>
</li>
<li><code>--graceful-termination</code> set to false will disable some smooth state transitions when exiting.
<ul>
<li>By default, the SDK Server will wait until the <code>GameServer</code> has reached the <code>Shutdown</code> state before exiting (&ldquo;graceful termination&rdquo;).</li>
<li>This will cause the SDK Server to hang (waiting on state update) when attempting to terminate (e.g. with <code>^C</code>).</li>
<li>When running binaries in a development context, quickly exiting and restarting the SDK Server is handy.</li>
</ul>
</li>
</ul>
<p>This can easily be terminated with <code>^C</code> and restarted as necessary.
Note that terminating the SDK Server while the game server binary (discussed in the <a href="/docs/advanced/out-of-cluster-dev-server/#running-game-server-binary-locally">next section</a>) is using it may result in failure to update/watch <code>GameServer</code> state and may result in a runtime error in the game server binary.</p>
<h3 id="running-game-server-binary-locally">Running game server binary locally</h3>
<p>Now that the SDK Server is running locally with k8s credentials, the game server binary can run in an integrated fashion.
The game server binary&rsquo;s SDK calls will reach the local SDK Server, which will then interact with the <code>GameServer</code> resource on the k8s cluster.</p>
<p>Again, this document will make use of <code>simple-game-server</code> via its docker image, but running directly or use of a custom game server binary is just as applicable.
Run the game server binary with the command:</p>
<pre tabindex="0"><code>docker run --rm --network=&#34;host&#34; us-docker.pkg.dev/codeblind/examples/simple-server:0.27
</code></pre><p>The <code>--rm</code> flag will nicely autoclean up the docker container after exiting.
The <code>--network=&quot;host&quot;</code> flag will tell the docker container to use the host&rsquo;s network stack directly; this allows calls to <code>localhost</code> to reach the SDK Server.
The commands and flags used will likely differ if running a custom game server binary.</p>
<p>If the earlier <code>kubectl get --watch</code> command was run, it will now show the <code>GameServer</code> progressed to the <code>RequestReady</code> state, which will automatically be progressed to the <code>Ready</code> state by the Code Blind controller on the cluster.</p>
<p>The <code>GameServer</code> state can further be modified by SDK calls, gRPC/REST calls, allocation via either <a href="https://codeblind.ai/docs/reference/gameserverallocation/"><code>GameServerAllocation</code></a> or <a href="https://codeblind.ai/docs/advanced/allocator-service/">Allocator Service</a>, K8s API calls, etc.
These changes will be shown by the <code>kubectl get --watch</code> command.
These changes will also be picked up by the game server binary, if there is a listener registered through the SDK API.
This means that this <code>GameServer</code> can be allocated just as it would be when running completely on k8s, but it can be locally debugged.</p>
<p>If the server crashes or is killed by the developer, it can easily be restarted.
This can be done without restarting the SDK Server or any other manual intevention with the <code>GameServer</code> resource.
Naturally, this may have implications on any connected clients, but that is project specific and left to the developer to handle.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-a147578c54e3cfc51d8c84b30bc32cc9">10.6 - Allocator Service</h1>
    <div class="lead">Code Blind provides an mTLS based allocator service that is accessible from outside the cluster using a load balancer. The service is deployed and scales independent to Code Blind controller.</div>
	<p>To allocate a game server, Code Blind provides a gRPC and REST service with mTLS authentication, called <code>agones-allocator</code> that can be used instead of 
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>GameServerAllocations</a>.</p>
<p>Both gRPC and REST are accessible through a Kubernetes service that can be externalized using a load balancer. By default, gRPC and REST are served from the same port. However, either service can be disabled or the services can be served from separate ports using the <a href="/docs/installation/install-agones/helm/">helm configuration</a>.</p>


<div class="alert alert-warning" role="alert">
<h4 class="alert-heading">Warning</h4>

    <p>If gRPC and REST are served using the same port, then an http multi-plexer is used along with an <a href="https://github.com/grpc/grpc-go/blob/2608e38e6386be7400720fecf2ece176c4cbc1b2/server.go#L933-L960">experimental gRPC server</a> which has <a href="https://github.com/grpc/grpc-go/issues/586#issuecomment-286257439">noticeably worse performance</a> than using the standard gRPC server.</p>
<p>If you require a fully compatible or feature compatible gRPC server implementation, you must separate the gRPC port from the REST port or disable the REST service.</p>


</div>

<p>For requests to either service to succeed, a client certificate must be provided that is in the authorization list of the allocator service.
The remainder of this article describes how to manually make a successful allocation request using the API.</p>
<p>The guide assumes you have command line tools installed for <a href="https://stedolan.github.io/jq/">jq</a>, <a href="https://golang.org/">go</a> and <a href="https://www.openssl.org/">openssl</a>.</p>
<h2 id="gameserverallocation-vs-allocator-service"><code>GameServerAllocation</code> vs Allocator Service</h2>
<p>There are several reasons you may prefer to use the Allocator Service over the <code>GameServerAllocation</code> custom resource
definition, depending on your architecture and requirements:</p>
<ul>
<li>A requirement to do <a href="/docs/advanced/multi-cluster-allocation/">multi-cluster allocation</a>.</li>
<li>Want to create Allocations from outside the Code Blind Kubernetes cluster.</li>
<li>Prefer SSL based authentication over Kubernetes <a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/">RBAC</a>.</li>
<li>Prefer a <a href="https://grpc.github.io/">gRPC</a> or REST based API over an integration with the
<a href="https://codeblind.ai/docs/guides/access-api/">Kubernetes API</a>.</li>
</ul>
<h2 id="find-the-external-ip">Find the external IP</h2>
<p>The service is hosted under the same namespace as the Code Blind controller. To find the external IP of your allocator service, replace agones-system namespace with the namespace to which Code Blind is deployed and execute the following command:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl get service agones-allocator -n agones-system
</span></span></code></pre></div><p>The output of the command should look like:</p>
<pre>
NAME                        TYPE           CLUSTER-IP      <b>EXTERNAL-IP</b>     PORT(S)            AGE
agones-allocator            LoadBalancer   10.55.251.73    <b>34.82.195.204</b>   443:30250/TCP      7d22h
</pre>
<h2 id="server-tls-certificate">Server TLS certificate</h2>
<p>If the <code>agones-allocator</code> service is installed as a <code>LoadBalancer</code> <a href="/docs/installation/install-agones/helm/#reserved-allocator-load-balancer-ip">using a reserved IP</a>, a valid self-signed server TLS certificate is generated using the IP provided. Otherwise, the server TLS certificate should be replaced. If you installed Code Blind using <a href="/docs/installation/install-agones/helm/">helm</a>, you can easily reconfigure the allocator service with a preset IP address by setting the <code>agones.allocator.service.loadBalancerIP</code> parameter to the address that was automatically assigned to the service and <code>helm upgrade</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#000">EXTERNAL_IP</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>kubectl get services agones-allocator -n agones-system -o <span style="color:#000">jsonpath</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;{.status.loadBalancer.ingress[0].ip}&#39;</span><span style="color:#204a87;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>helm upgrade my-release agones/agones -n agones-system --wait <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>   --set agones.allocator.service.loadBalancerIP<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">${</span><span style="color:#000">EXTERNAL_IP</span><span style="color:#4e9a06">}</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>   ...
</span></span></code></pre></div>

<div class="alert alert-warning" role="alert">
<h4 class="alert-heading">Warning</h4>

    The parameter used to automatically
replace the certificate changed in Code Blind 1.18.0. If you are using an older
version of Code Blind you should pass the parameter
<code>agones.allocator.http.loadBalancerIP</code> instead. If you need your script to work
with both older and newer versions of Code Blind, you can pass both parameters as
only one of them will effect the helm chart templates.

</div>

<p>Another approach is to replace the default server TLS certificate with a certificate with CN and subjectAltName. There are multiple approaches to generate a certificate. Code Blind recommends using <a href="https://cert-manager.io/">cert-manager.io</a> solution for cluster level certificate management.</p>
<p>In order to use the cert-manager solution, first <a href="https://cert-manager.io/docs/installation/kubernetes/">install cert-manager</a> on the cluster.
Then, <a href="https://cert-manager.io/docs/configuration/">configure</a> an <code>Issuer</code>/<code>ClusterIssuer</code> resource and
last <a href="https://cert-manager.io/docs/usage/certificate/">configure</a> a <code>Certificate</code> resource to manage allocator-tls <code>Secret</code>.
Make sure to configure the <code>Certificate</code> based on your system&rsquo;s requirements, including the validity <code>duration</code>.</p>
<p>Here is an example of using a self-signed <code>ClusterIssuer</code> for configuring allocator-tls <code>Secret</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#8f5902;font-style:italic"># Create a self-signed ClusterIssuer</span>
</span></span><span style="display:flex;"><span>cat <span style="color:#4e9a06">&lt;&lt;EOF | kubectl apply -f -
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">apiVersion: cert-manager.io/v1
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">kind: ClusterIssuer
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  name: selfsigned
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">spec:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  selfSigned: {}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">EXTERNAL_IP</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>kubectl get services agones-allocator -n agones-system -o <span style="color:#000">jsonpath</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;{.status.loadBalancer.ingress[0].ip}&#39;</span><span style="color:#204a87;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># for EKS use hostname</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># HOST_NAME=$(kubectl get services agones-allocator -n agones-system -o jsonpath=&#39;{.status.loadBalancer.ingress[0].hostname}&#39;)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Create a Certificate with IP for the allocator-tls secret</span>
</span></span><span style="display:flex;"><span>cat <span style="color:#4e9a06">&lt;&lt;EOF | kubectl apply -f -
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">apiVersion: cert-manager.io/v1
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">kind: Certificate
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  name: allocator-tls
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  namespace: agones-system
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">spec:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  commonName: ${EXTERNAL_IP}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  ipAddresses:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    - ${EXTERNAL_IP}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  secretName: allocator-tls
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  issuerRef:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    name: selfsigned
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    kind: ClusterIssuer
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Wait for the allocator-tls Secret</span>
</span></span><span style="display:flex;"><span>sleep <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span><span style="color:#000">TLS_CA_VALUE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>kubectl get secret allocator-tls -n agones-system -ojsonpath<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;{.data.ca\.crt}&#39;</span><span style="color:#204a87;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Add ca.crt to the allocator-tls-ca Secret</span>
</span></span><span style="display:flex;"><span>kubectl get secret allocator-tls-ca -o json -n agones-system <span style="color:#000;font-weight:bold">|</span> jq <span style="color:#4e9a06">&#39;.data[&#34;tls-ca.crt&#34;]=&#34;&#39;</span><span style="color:#4e9a06">${</span><span style="color:#000">TLS_CA_VALUE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#39;&#34;&#39;</span> <span style="color:#000;font-weight:bold">|</span> kubectl apply -f -
</span></span><span style="display:flex;"><span><span style="color:#204a87">echo</span> <span style="color:#000">$TLS_CA_VALUE</span> <span style="color:#000;font-weight:bold">|</span> base64 -d &gt; ca.crt
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># In case of MacOS</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># echo $TLS_CA_VALUE | base64 -D &gt; ca.crt</span>
</span></span></code></pre></div><h3 id="bring-your-own-certificates-advanced">Bring Your Own Certificates (advanced)</h3>
<p>If you would like to completely manage the tls secrets outside of helm, you can create them in the namespace where agones is going to be installed, and then set the helm value <code>agones.allocator.disableSecretCreation</code> to <code>true</code>. This method will also work with the cert-manager method, as long as your certificate and secret are created ahead of time, and you populate the <code>allocator-tls-ca</code> and <code>allocator-client-ca</code> yourself.</p>
<h2 id="client-certificate">Client Certificate</h2>
<p>Because agones-allocator uses an mTLS authentication mechanism, a client must provide a certificate that is accepted by the server.</p>
<p>If Code Blind is installed using Helm, you can leverage a default client secret, <code>allocator-client.default</code>, created in the game server namespace and allowlisted in <code>allocator-client-ca</code> Kubernetes secret. You can extract and use that secret for client side authentication, by following <a href="#send-allocation-request">the allocation example</a>.</p>
<p>Otherwise, here is an example of generating a client certificate using openssl.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#000">EXTERNAL_IP</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>kubectl get services agones-allocator -n agones-system -o <span style="color:#000">jsonpath</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;{.status.loadBalancer.ingress[0].ip}&#39;</span><span style="color:#204a87;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>openssl req -x509 -nodes -days <span style="color:#0000cf;font-weight:bold">365</span> -newkey rsa:2048 -keyout client.key -out client.crt -addext <span style="color:#4e9a06">&#39;subjectAltName=IP:&#39;</span><span style="color:#4e9a06">${</span><span style="color:#000">EXTERNAL_IP</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">CERT_FILE_VALUE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>cat client.crt <span style="color:#000;font-weight:bold">|</span> base64 -w 0<span style="color:#204a87;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># In case of MacOS</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># CERT_FILE_VALUE=$(cat client.crt | base64)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># allowlist client certificate</span>
</span></span><span style="display:flex;"><span>kubectl get secret allocator-client-ca -o json -n agones-system <span style="color:#000;font-weight:bold">|</span> jq <span style="color:#4e9a06">&#39;.data[&#34;client_trial.crt&#34;]=&#34;&#39;</span><span style="color:#4e9a06">${</span><span style="color:#000">CERT_FILE_VALUE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#39;&#34;&#39;</span> <span style="color:#000;font-weight:bold">|</span> kubectl apply -f -
</span></span></code></pre></div><p>The last command creates a new entry in the secret data map for <code>allocator-client-ca</code> for the client CA. This is for the <code>agones-allocator</code> service to accept the newly generated client certificate.</p>
<h2 id="send-allocation-request">Send allocation request</h2>
<p>After setting up <code>agones-allocator</code> with server certificate and allowlisting the client certificate, the service can be used to allocate game servers. Make sure you have a <a href="https://codeblind.ai/docs/getting-started/create-fleet/">fleet</a> with ready game servers in the game server namespace.</p>
<p>Set the environment variables and store the client secrets before allocating using gRPC or REST APIs:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#000">NAMESPACE</span><span style="color:#ce5c00;font-weight:bold">=</span>default <span style="color:#8f5902;font-style:italic"># replace with any namespace</span>
</span></span><span style="display:flex;"><span><span style="color:#000">EXTERNAL_IP</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>kubectl get services agones-allocator -n agones-system -o <span style="color:#000">jsonpath</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;{.status.loadBalancer.ingress[0].ip}&#39;</span><span style="color:#204a87;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">KEY_FILE</span><span style="color:#ce5c00;font-weight:bold">=</span>client.key
</span></span><span style="display:flex;"><span><span style="color:#000">CERT_FILE</span><span style="color:#ce5c00;font-weight:bold">=</span>client.crt
</span></span><span style="display:flex;"><span><span style="color:#000">TLS_CA_FILE</span><span style="color:#ce5c00;font-weight:bold">=</span>ca.crt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># allocator-client.default secret is created only when using helm installation. Otherwise generate the client certificate and replace the following.</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># In case of MacOS replace &#34;base64 -d&#34; with &#34;base64 -D&#34;</span>
</span></span><span style="display:flex;"><span>kubectl get secret allocator-client.default -n <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">NAMESPACE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> -ojsonpath<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;{.data.tls\.crt}&#34;</span> <span style="color:#000;font-weight:bold">|</span> base64 -d &gt; <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">CERT_FILE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span>kubectl get secret allocator-client.default -n <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">NAMESPACE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> -ojsonpath<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;{.data.tls\.key}&#34;</span> <span style="color:#000;font-weight:bold">|</span> base64 -d &gt; <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">KEY_FILE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span>kubectl get secret allocator-tls-ca -n agones-system -ojsonpath<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;{.data.tls-ca\.crt}&#34;</span> <span style="color:#000;font-weight:bold">|</span> base64 -d &gt; <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">TLS_CA_FILE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>
</span></span></code></pre></div><h3 id="using-grpc">Using gRPC</h3>
<p>To start, take a look at the allocation gRPC client examples in 
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>golang</a> and 
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>C#</a> languages. In the following, the 
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>golang gRPC client example</a> is used to allocate a Game Server in the <code>default</code> namespace.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>
</span></span><span style="display:flex;"><span>go run examples/allocator-client/main.go --ip <span style="color:#4e9a06">${</span><span style="color:#000">EXTERNAL_IP</span><span style="color:#4e9a06">}</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    --port <span style="color:#0000cf;font-weight:bold">443</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    --namespace <span style="color:#4e9a06">${</span><span style="color:#000">NAMESPACE</span><span style="color:#4e9a06">}</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    --key <span style="color:#4e9a06">${</span><span style="color:#000">KEY_FILE</span><span style="color:#4e9a06">}</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    --cert <span style="color:#4e9a06">${</span><span style="color:#000">CERT_FILE</span><span style="color:#4e9a06">}</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    --cacert <span style="color:#4e9a06">${</span><span style="color:#000">TLS_CA_FILE</span><span style="color:#4e9a06">}</span>
</span></span></code></pre></div><h3 id="using-rest">Using REST</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>
</span></span><span style="display:flex;"><span>curl --key <span style="color:#4e9a06">${</span><span style="color:#000">KEY_FILE</span><span style="color:#4e9a06">}</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>     --cert <span style="color:#4e9a06">${</span><span style="color:#000">CERT_FILE</span><span style="color:#4e9a06">}</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>     --cacert <span style="color:#4e9a06">${</span><span style="color:#000">TLS_CA_FILE</span><span style="color:#4e9a06">}</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>     -H <span style="color:#4e9a06">&#34;Content-Type: application/json&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>     --data <span style="color:#4e9a06">&#39;{&#34;namespace&#34;:&#34;&#39;</span><span style="color:#4e9a06">${</span><span style="color:#000">NAMESPACE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#39;&#34;}&#39;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>     https://<span style="color:#4e9a06">${</span><span style="color:#000">EXTERNAL_IP</span><span style="color:#4e9a06">}</span>/gameserverallocation <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>     -X POST
</span></span></code></pre></div><p>You should expect to see the following output:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span><span style="color:#204a87;font-weight:bold">&#34;gameServerName&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;game-server-name&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#204a87;font-weight:bold">&#34;ports&#34;</span><span style="color:#000;font-weight:bold">:[{</span><span style="color:#204a87;font-weight:bold">&#34;name&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;default&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#204a87;font-weight:bold">&#34;port&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#0000cf;font-weight:bold">7463</span><span style="color:#000;font-weight:bold">}],</span><span style="color:#204a87;font-weight:bold">&#34;address&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;1.2.3.4&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#204a87;font-weight:bold">&#34;nodeName&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#4e9a06">&#34;node-name&#34;</span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h3 id="sending-data-to-the-game-server">Sending Data to the Game Server</h3>
<p>The service accepts a <code>metadata</code> field, which can be used to apply <code>labels</code> and <code>annotations</code> to the allocated <code>GameServer</code>. The old <code>metaPatch</code> fields is now deprecated, but can still be used for compatibility. If both <code>metadata</code> and <code>metaPatch</code> fields are set, <code>metaPatch</code> is ignored.</p>
<h2 id="secrets-explained">Secrets Explained</h2>
<p><code>agones-allocator</code> has a dependency on three Kubernetes secrets:</p>
<ol>
<li><code>allocator-tls</code> - stores the server certificate.</li>
<li><code>allocator-client-ca</code> - stores the allocation authorized client CA for mTLS to allowlist client certificates.</li>
<li><code>allocator-tls-ca</code> (optional) - stores <code>allocator-tls</code> CA.</li>
</ol>
<p>The separation of CA secret from the private secret is for the security reason to avoid reading the private secret, while retrieving the allocator CA that is used by the allocation client to validate the server. It is optional to set or maintain the <code>allocator-tls-ca</code> secret.</p>
<h2 id="troubleshooting">Troubleshooting</h2>
<p>If you encounter problems, explore the following potential root causes:</p>
<ol>
<li>
<p>Check server certificate - Using openssl you can get the certificate chain for the server.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#000">EXTERNAL_IP</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>kubectl get services agones-allocator -n agones-system -o <span style="color:#000">jsonpath</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;{.status.loadBalancer.ingress[0].ip}&#39;</span><span style="color:#204a87;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>openssl s_client -connect <span style="color:#4e9a06">${</span><span style="color:#000">EXTERNAL_IP</span><span style="color:#4e9a06">}</span>:443
</span></span></code></pre></div><ul>
<li>Inspect the server certificate by storing the certificate returned, under <code>Server certificate</code> and validating using <code>openssl x509 -in tls.crt -text -noout</code>.</li>
<li>Make sure the certificate is not expired and the Subject Alternative Name is set.</li>
<li>If the issuer is <code>CN = allocation-ca</code>, the certificate is generated using Code Blind helm installation.</li>
</ul>
</li>
<li>
<p>Check client certificate</p>
<ul>
<li>You may get an error such as <code>rpc error: code = Unavailable desc = all SubConns are in TransientFailure, latest connection error: connection closed</code>, make sure your client certificate is allowlisted by being added to <code>allocator-client-ca</code>.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl get secret allocator-client-ca -o json -n agones-system
</span></span></code></pre></div><ul>
<li>If the server certificate is not accepted by the client, you may get an error such as <code>rpc error: code = Unavailable desc = all SubConns are in TransientFailure, latest connection error: connection error: desc = &quot;transport: authentication handshake failed: x509: certificate signed by unknown authority&quot;</code>, depending on the client. In this case, verify that the TLS CA file matches the server certificate.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl get secret allocator-tls -n agones-system -ojsonpath<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;{.data.tls\.crt}&#34;</span> <span style="color:#000;font-weight:bold">|</span> base64 -d &gt; tls.crt
</span></span><span style="display:flex;"><span>openssl verify -verbose -CAfile ca.crt tls.crt
</span></span><span style="display:flex;"><span>tls.crt: OK
</span></span></code></pre></div></li>
<li>
<p>Make sure the service is up and running.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl get pod -n agones-system <span style="color:#000;font-weight:bold">|</span> grep agones-allocator
</span></span><span style="display:flex;"><span>agones-allocator-59b4f6b5c6-86j62      1/1     Running     <span style="color:#0000cf;font-weight:bold">0</span>          6m36s
</span></span><span style="display:flex;"><span>agones-allocator-59b4f6b5c6-kbqrq      1/1     Running     <span style="color:#0000cf;font-weight:bold">0</span>          6m45s
</span></span><span style="display:flex;"><span>agones-allocator-59b4f6b5c6-trbkl      1/1     Running     <span style="color:#0000cf;font-weight:bold">0</span>          6m28s
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl get service agones-allocator -n agones-system
</span></span><span style="display:flex;"><span>agones-allocator   LoadBalancer   10.55.248.14   34.82.195.204    443:32468/TCP   6d23h
</span></span></code></pre></div></li>
</ol>
<h2 id="api-reference">API Reference</h2>
<p>The AllocationService API is located as a gRPC service 
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>here</a>. Additionally, the REST API is available as a 
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>Swagger API</a>.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-522dc6497d01e5cbc17d1c3587704eec">10.7 - Multi-cluster Allocation</h1>
    <div class="lead">In order to allow allocation from multiple clusters, Code Blind provides a mechanism to set redirect rules for allocation requests to the right cluster.</div>
	<p>There may be different types of clusters, such as on-premise, and Google Kubernetes Engine (GKE), used by a game to help with the cost-saving and availability.
For this purpose, Code Blind provides a mechanism to define priorities on the clusters. Priorities are defined on 
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>GameServerAllocationPolicy</a> agones CRD. A matchmaker can enable the multi-cluster rules on a request and target <a href="/docs/advanced/allocator-service/">agones-allocator</a> endpoint in any of the clusters and get resources allocated on the cluster with the highest priority. If the cluster with the highest priority is overloaded, the allocation request is redirected to the cluster with the next highest priority.</p>
<p>The remainder of this article describes how to enable multi-cluster allocation.</p>
<h2 id="define-cluster-priority">Define Cluster Priority</h2>
<p>
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>GameServerAllocationPolicy</a> is the CRD defined by Code Blind for setting multi-cluster allocation rules. In addition to cluster priority, it describes the connection information for the target cluster, including the game server namespace, agones-allocator endpoint and client K8s secrets name for redirecting the allocation request. Game servers will be allocated from clusters with the lowest <code>priority</code> number. If there are no available game servers available in clusters with the lowest <code>priority</code> number, they will be allocated from clusters with the next lowest <code>priority</code> number. For clusters with the same priority, the cluster is chosen with a probability relative to its weight.</p>
<p>Here is an example of setting the priority for a cluster and it&rsquo;s connection rules. One such resource should be defined per cluster.</p>
<p>In the following example the policy is defined for cluster B in cluster A.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cat <span style="color:#4e9a06">&lt;&lt;EOF | kubectl apply -f -
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">apiVersion: multicluster.agones.dev/v1
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">kind: GameServerAllocationPolicy
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  name: allocator-cluster-b
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  namespace: cluster-a-ns
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">spec:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  connectionInfo:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    allocationEndpoints:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    - 34.82.195.204
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    clusterName: &#34;clusterB&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    namespace: cluster-b-ns
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    secretName: allocator-client-to-cluster-b
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    serverCa: c2VydmVyQ0E=
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  priority: 1
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  weight: 100
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">EOF</span>
</span></span></code></pre></div><p>To define the local cluster priority a GameServerAllocationPolicy should be defined <em>without</em> an <code>allocationEndpoints</code> field. If the local cluster priority is not defined, the allocation from the local cluster happens only if allocation from other clusters with the existing allocation rules is unsuccessful.</p>
<p>Allocation requests with multi-cluster allocation enabled but with only the local cluster available (e.g. in development) <em>must</em> have a local cluster priority defined, or the request fails with the error &ldquo;no multi-cluster allocation policy is specified&rdquo;.</p>
<p>The <code>namespace</code> field in <code>connectionInfo</code> is the namespace that the game servers will be allocated in, and must be a namespace in the target cluster that has been previously defined as allowed to host game servers. The <code>Namespace</code> specified in the allocation request (below) is used to refer to the namespace that the GameServerAllocationPolicy itself is located in.</p>
<p><code>serverCa</code> is the server TLS CA public certificate, set only if the remote server certificate is not signed by a public CA (e.g. self-signed). If this field is not specified, the certificate can also be specified in a field named <code>ca.crt</code> of the client secret (the secret referred to in the <code>secretName</code> field).</p>
<h2 id="establish-trust">Establish trust</h2>
<p>To accept allocation requests from other clusters, agones-allocator for cluster B should be configured to accept the client&rsquo;s certificate from cluster A and the cluster A&rsquo;s client should be configured to accept the server TLS certificate, if it is not signed by a public Certificate Authority (CA).</p>
<p>Follow the steps to configure the <a href="/docs/advanced/allocator-service/">agones allocator gRPC service</a>. The client certificate pair in the mentioned document is stored as a K8s secret. Here are the secrets to set:</p>
<p>1.Client certificate to talk to other clusters:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cat <span style="color:#4e9a06">&lt;&lt;EOF | kubectl apply -f -
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">apiVersion: v1
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">kind: Secret
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  name: allocator-client-to-cluster-b
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  namespace: cluster-a-ns
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">type: Opaque
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">data:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  tls.crt: &lt;REDACTED&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  tls.key: &lt;REDACTED&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  ca.crt: &lt;REDACTED&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">EOF</span>
</span></span></code></pre></div><p>The certificates are base 64 string of the certificate file e.g. <code>cat ${CERT_FILE} | base64 -w 0</code></p>
<p>Code Blind recommends using <a href="https://cert-manager.io/">cert-manager.io</a> solution for generating client certificates.</p>
<p>2.Add client CA to the list of authorized client certificates by agones-allocator in the targeted cluster.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cat <span style="color:#4e9a06">&lt;&lt;EOF | kubectl apply -f -
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">apiVersion: v1
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">kind: Secret
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  name: allocator-client-ca
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  namespace: agones-system
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">type: Opaque
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">data:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  client1.crt: &lt;REDACTED&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  client2.crt: &lt;REDACTED&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  …
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  clientN.crt: &lt;REDACTED&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">EOF</span>
</span></span></code></pre></div><h2 id="allocate-multi-cluster">Allocate multi-cluster</h2>
<p>To enable multi-cluster allocation, set <code>multiClusterSetting.enabled</code> to <code>true</code> in 
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>allocation.proto</a> and send allocation requests. For more information visit <a href="/docs/advanced/allocator-service/">agones-allocator</a>. In the following, using 
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>allocator-client sample</a>, a multi-cluster allocation request is sent to the agones-allocator service. If the allocation succeeds, the AllocationResponse will contain a 
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>Source</a> field which indicates the endpoint of the remote agones-allocator.</p>
<p>Set the environment variables and store the client secrets before allocating using gRPC or REST APIs</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#000">NAMESPACE</span><span style="color:#ce5c00;font-weight:bold">=</span>default <span style="color:#8f5902;font-style:italic"># replace with any namespace</span>
</span></span><span style="display:flex;"><span><span style="color:#000">EXTERNAL_IP</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>kubectl get services agones-allocator -n agones-system -o <span style="color:#000">jsonpath</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;{.status.loadBalancer.ingress[0].ip}&#39;</span><span style="color:#204a87;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">KEY_FILE</span><span style="color:#ce5c00;font-weight:bold">=</span>client.key
</span></span><span style="display:flex;"><span><span style="color:#000">CERT_FILE</span><span style="color:#ce5c00;font-weight:bold">=</span>client.crt
</span></span><span style="display:flex;"><span><span style="color:#000">TLS_CA_FILE</span><span style="color:#ce5c00;font-weight:bold">=</span>ca.crt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># allocator-client.default secret is created only when using helm installation. Otherwise generate the client certificate and replace the following.</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># In case of MacOS replace &#34;base64 -d&#34; with &#34;base64 -D&#34;</span>
</span></span><span style="display:flex;"><span>kubectl get secret allocator-client.default -n <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">NAMESPACE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> -ojsonpath<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;{.data.tls\.crt}&#34;</span> <span style="color:#000;font-weight:bold">|</span> base64 -d &gt; <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">CERT_FILE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span>kubectl get secret allocator-client.default -n <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">NAMESPACE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> -ojsonpath<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;{.data.tls\.key}&#34;</span> <span style="color:#000;font-weight:bold">|</span> base64 -d &gt; <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">KEY_FILE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span>kubectl get secret allocator-tls-ca -n agones-system -ojsonpath<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;{.data.tls-ca\.crt}&#34;</span> <span style="color:#000;font-weight:bold">|</span> base64 -d &gt; <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">TLS_CA_FILE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>
</span></span><span style="display:flex;"><span>go run examples/allocator-client/main.go --ip <span style="color:#4e9a06">${</span><span style="color:#000">EXTERNAL_IP</span><span style="color:#4e9a06">}</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    --namespace <span style="color:#4e9a06">${</span><span style="color:#000">NAMESPACE</span><span style="color:#4e9a06">}</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    --key <span style="color:#4e9a06">${</span><span style="color:#000">KEY_FILE</span><span style="color:#4e9a06">}</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    --cert <span style="color:#4e9a06">${</span><span style="color:#000">CERT_FILE</span><span style="color:#4e9a06">}</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    --cacert <span style="color:#4e9a06">${</span><span style="color:#000">TLS_CA_FILE</span><span style="color:#4e9a06">}</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    --multicluster <span style="color:#204a87">true</span>
</span></span></code></pre></div><p>If using REST use</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>
</span></span><span style="display:flex;"><span>curl --key <span style="color:#4e9a06">${</span><span style="color:#000">KEY_FILE</span><span style="color:#4e9a06">}</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>     --cert <span style="color:#4e9a06">${</span><span style="color:#000">CERT_FILE</span><span style="color:#4e9a06">}</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>     --cacert <span style="color:#4e9a06">${</span><span style="color:#000">TLS_CA_FILE</span><span style="color:#4e9a06">}</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>     -H <span style="color:#4e9a06">&#34;Content-Type: application/json&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>     --data <span style="color:#4e9a06">&#39;{&#34;namespace&#34;:&#34;&#39;</span><span style="color:#4e9a06">${</span><span style="color:#000">NAMESPACE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#39;&#34;, &#34;multiClusterSetting&#34;:{&#34;enabled&#34;:true}}&#39;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>     https://<span style="color:#4e9a06">${</span><span style="color:#000">EXTERNAL_IP</span><span style="color:#4e9a06">}</span>/gameserverallocation <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>     -X POST
</span></span><span style="display:flex;"><span>     
</span></span></code></pre></div><h2 id="troubleshooting">Troubleshooting</h2>
<p>If you encounter problems, explore the following potential root causes:</p>
<ol>
<li>
<p>Make sure single cluster allocation works for each cluster using <a href="/docs/advanced/allocator-service/#troubleshooting">this troubleshooting</a>.</p>
</li>
<li>
<p>For each cluster, make sure there is a <code>GameServerAllocationPolicy</code> resource defined in the game server cluster.</p>
</li>
<li>
<p>Inspect the <code>.spec.connectionInfo</code> for <code>GameServerAllocationPolicy</code> for each cluster. Use the cluster connection information in that field to verify that single cluster allocation works. Use the information to verify the connection:</p>
</li>
</ol>
<pre tabindex="0"><code class="language-none" data-lang="none">POLICY_NAME=&lt;policy-name&gt;
POLICY_NAMESPACE=&lt;policy-namespace&gt;

NAMESPACE=$(kubectl get gameserverallocationpolicy ${POLICY_NAME} -n ${POLICY_NAMESPACE} -ojsonpath={.spec.connectionInfo.namespace})
EXTERNAL_IP=$(kubectl get gameserverallocationpolicy ${POLICY_NAME} -n ${POLICY_NAMESPACE} -ojsonpath={.spec.connectionInfo.allocationEndpoints\[0\]})
CLIENT_SECRET_NAME=$(kubectl get gameserverallocationpolicy ${POLICY_NAME} -n ${POLICY_NAMESPACE} -ojsonpath={.spec.connectionInfo.secretName})

KEY_FILE=client.key
CERT_FILE=client.crt
TLS_CA_FILE=ca.crt

# In case of MacOS replace &#34;base64 -d&#34; with &#34;base64 -D&#34;
kubectl get secret &#34;${CLIENT_SECRET_NAME}&#34; -n &#34;${POLICY_NAMESPACE}&#34; -ojsonpath=&#34;{.data.tls\.crt}&#34; | base64 -d &gt; &#34;${CERT_FILE}&#34;
kubectl get secret &#34;${CLIENT_SECRET_NAME}&#34; -n &#34;${POLICY_NAMESPACE}&#34; -ojsonpath=&#34;{.data.tls\.key}&#34; | base64 -d &gt; &#34;${KEY_FILE}&#34;
kubectl get secret &#34;${CLIENT_SECRET_NAME}&#34; -n &#34;${POLICY_NAMESPACE}&#34; -ojsonpath=&#34;{.data.ca\.crt}&#34; | base64 -d &gt; &#34;${TLS_CA_FILE}&#34;
</code></pre><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>
</span></span><span style="display:flex;"><span>go run examples/allocator-client/main.go --ip <span style="color:#4e9a06">${</span><span style="color:#000">EXTERNAL_IP</span><span style="color:#4e9a06">}</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    --port <span style="color:#0000cf;font-weight:bold">443</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    --namespace <span style="color:#4e9a06">${</span><span style="color:#000">NAMESPACE</span><span style="color:#4e9a06">}</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    --key <span style="color:#4e9a06">${</span><span style="color:#000">KEY_FILE</span><span style="color:#4e9a06">}</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    --cert <span style="color:#4e9a06">${</span><span style="color:#000">CERT_FILE</span><span style="color:#4e9a06">}</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    --cacert <span style="color:#4e9a06">${</span><span style="color:#000">TLS_CA_FILE</span><span style="color:#4e9a06">}</span>
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-cd42a2864dd477303091c6e62aeb3c51">10.8 - GameServer Pod Service Accounts</h1>
    <div class="lead">RBAC permissions and service accounts for the <code>GameServer</code> Pod.</div>
	<h2 id="default-settings">Default Settings</h2>
<p>By default, Code Blind sets up service accounts and sets them appropriately for the <code>Pods</code> that are created for <code>GameServers</code>.</p>
<p>Since Code Blind provides <code>GameServer</code> <code>Pods</code> with a sidecar container that needs access to Code Blind Custom Resource Definitions,
<code>Pods</code> are configured with a service account with extra RBAC permissions to ensure that it can read and modify the resources it needs.</p>
<p>Since service accounts apply to all containers in a <code>Pod</code>, Code Blind will automatically overwrite the mounted key for the
service account in the container that is running the dedicated game server in the backing <code>Pod</code>. This is done
since game server containers are exposed publicly, and generally don&rsquo;t require the extra permissions to access aspects
of the Kubernetes API.</p>
<h2 id="bringing-your-own-service-account">Bringing your own Service Account</h2>
<p>If needed, you can provide your own service account on the <code>Pod</code> specification in the <code>GameServer</code> configuration.</p>


<div class="alert alert-warning" role="alert">
<h4 class="alert-heading">Warning</h4>

    <p>If you bring your own Service Account, it&rsquo;s your responsibility to ensure it matches all the RBAC permissions
the <code>GameServer</code> <code>Pod</code> usually acquires from Code Blind by default, otherwise <code>GameServers</code> can fail.</p>
<p>The default RBAC permissions for can be found in the
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>installation
YAML on GitHub</a> and can be used for a reference.</p>


</div>

<p>For example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;agones.dev/v1&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">GameServer</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">generateName</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;simple-game-server-&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">ports</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">default</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">containerPort</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">7654</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">template</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">serviceAccountName</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">my-special-service-account</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># a custom service account</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">containers</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">simple-game-server</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">image</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">us-docker.pkg.dev/codeblind/examples/simple-server:0.27</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>If a service account is configured, the mounted key is not overwritten, as it assumed that you want to have full control
of the service account and underlying RBAC permissions.</p>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-1c91a59640f4d19bcf14ebed849a10e0">11 - Frequently Asked Questions</h1>
    
	<h2 id="architecture">Architecture</h2>
<h3 id="what-is-the-relationship-between-a-kubernetes-pod-and-an-code-blind-gameserver">What is the relationship between a Kubernetes Pod and an Code Blind GameServer?</h3>
<p>Code Blind creates a backing Pod with the appropriate configuration parameters for each GameServer that is configured in
the cluster. They both have the same name if you are ever looking to match one to the other.</p>
<h3 id="can-i-reuse-a-gameserver-for-multiple-game-sessions">Can I reuse a GameServer for multiple game sessions?</h3>
<p>Yes.</p>
<p>Code Blind is inherently un-opinionated about the lifecycle of your game.  When you call
<a href="https://codeblind.ai/docs/guides/client-sdks/#allocate">SDK.Allocate()</a> you are
protecting that GameServer instance from being scaled down for the duration of the Allocation.  Typically, you would
run one game session within a single allocation.  However, you could allocate, and run N sessions on a single
GameServer, and then de-allocate/shutdown at a later time.</p>
<h3 id="how-can-i-return-an-allocated-gameserver-to-the-ready-state">How can I return an <code>Allocated</code> GameServer to the <code>Ready</code> state?</h3>
<p>If you wish to return an <code>Allocated</code> GameServer to the <code>Ready</code> state, you can use the
<a href="https://codeblind.ai/docs/guides/client-sdks/#ready">SDK.Ready()</a> command whenever it
makes sense for your GameServer to return to the pool of potentially Allocatable and/or scaled down GameServers.</p>
<p>Have a look at the integration pattern
<a href="https://codeblind.ai/docs/integration-patterns/reusing-gameservers/">&ldquo;Reusing Allocated GameServers for more than one game session&rdquo;</a>
for more details.</p>
<h2 id="integration">Integration</h2>
<h3 id="what-steps-do-i-need-to-take-to-integrate-my-gameserver">What steps do I need to take to integrate my GameServer?</h3>
<ol>
<li>Integrate your game server binary with the <a href="https://codeblind.ai/docs/guides/client-sdks/">Code Blind SDK</a>,
calling the appropriate <a href="https://codeblind.ai/docs/guides/client-sdks/#lifecycle-management">lifecycle event</a>
hooks.</li>
<li>Containerize your game server binary with <a href="https://www.docker.com/">Docker</a></li>
<li>Publish your Docker image in a <a href="https://docs.docker.com/docker-hub/repos/">container registry/repository</a>.</li>
<li>Create a <a href="https://codeblind.ai/docs/reference/gameserver/">gameserver.yaml</a> file for your container image.</li>
<li>Test your gameserver.yaml file.</li>
<li>Consider utilizing <a href="https://codeblind.ai/docs/reference/fleet/">Fleets</a>.
and <a href="https://codeblind.ai/docs/reference/fleetautoscaler/">Autoscalers</a> for deploying at scale.</li>
</ol>
<h3 id="what-are-some-common-patterns-for-integrating-the-sdk-with-a-game-server-binary">What are some common patterns for integrating the SDK with a Game Server Binary?</h3>
<ul>
<li>In-Engine
<ul>
<li>Integrate the SDK directly with the dedicated game server, such that it is part of the same codebase.</li>
</ul>
</li>
<li>Sidecar
<ul>
<li>Use a Kubernetes <a href="https://blog.davemdavis.net/2018/03/13/the-sidecar-pattern/">sidecar pattern</a> to run the SDK
in a separate process that runs alongside your game server binary, and can share the disk and network namespace.
This game server binary could expose its own API, or write to a shared file, that the sidecar process
integrates with, and can then communicate back to Code Blind through the SDK.</li>
</ul>
</li>
<li>Wrapper
<ul>
<li>Write a process that wraps the game server binary, and intercepts aspects such as the foreground log output, and
use that information to react and communicate with Code Blind appropriately.
This can be particularly useful for legacy game servers or game server binaries wherein you do not have access to
the original source. You can see this in both the 
<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>Xonotic</a> and

<a href="https://github.com/josephbarnett/codeblind.ai/blob/release-1.38.0/" target="_blank" data-proofer-ignore>SuperTuxKart</a> examples.</li>
</ul>
</li>
</ul>
<h3 id="what-if-my-engine--language-of-choice-does-not-have-a-supported-sdk-what-can-i-do">What if my engine / language of choice does not have a supported SDK, what can I do?</h3>
<p>Either utilise the <a href="https://codeblind.ai/docs/guides/client-sdks/rest/">REST API</a>, which can be
<a href="https://codeblind.ai/docs/guides/client-sdks/rest/#generating-clients">generated from the Swagger specification</a>,
or <a href="https://codeblind.ai/docs/guides/client-sdks/">generate your own gRPC client from the proto file</a>.</p>
<p>Game Server SDKs are a thin wrapper around either REST or gRPC clients, depending on language or platform, and can be
used as examples.</p>
<h3 id="how-can-i-pass-data-to-my-game-server-binary-on-allocation">How can I pass data to my Game Server binary on Allocation?</h3>
<p>A <code>GameServerAllocation</code> has a <a href="https://codeblind.ai/docs/reference/gameserverallocation/">spec.metadata section</a>,
that will apply any configured <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/">Labels</a>
and/or <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/">Annotations</a> to a requested
GameServer at Allocation time.</p>
<p>The game server binary can watch for the state change to <code>Allocated</code>, as well as changes to the GameServer metadata,
through <a href="https://codeblind.ai/docs/guides/client-sdks/#watchgameserverfunctiongameserver">SDK.WatchGameServer()</a>.</p>
<p>Combining these two features allows you to pass information such as map data, gameplay metadata and more to a game
server binary at Allocation time, through Code Blind functionality.</p>
<p>Do note, that if you wish to have either the labels or annotations on the <code>GameServer</code> that are set via a<br>
<code>GameServerAllocation</code> to be editable by the game server binary with the Code Blind SDK, the label key will need to
be prefixed with <code>agones.dev/sdk-</code>.
See <a href="https://codeblind.ai/docs/guides/client-sdks/#setlabelkey-value">SDK.SetLabel()</a>
and <a href="https://codeblind.ai/docs/guides/client-sdks/#setannotationkey-value">SDK.SetAnnotation()</a> for more information.</p>
<h3 id="how-can-i-expose-information-from-my-game-server-binary-to-an-external-service">How can I expose information from my game server binary to an external service?</h3>
<p>The Code Blind game server SDK allows you to set custom
<a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/">Labels</a>
and <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/">Annotations</a> through
the <a href="https://codeblind.ai/docs/guides/client-sdks/#setlabelkey-value">SDK.SetLabel()</a>
and <a href="https://codeblind.ai/docs/guides/client-sdks/#setannotationkey-value">SDK.SetAnnotation()</a> functionality
respectively.</p>
<p>This information is then queryable via the <a href="https://codeblind.ai/docs/guides/access-api/">Kubernetes API</a>,
and can be used for game specific, custom integrations.</p>
<h3 id="if-my-game-server-requires-more-states-than-what-code-blind-provides-eg-ready-allocated-shutdown-etc-can-i-add-my-own">If my game server requires more states than what Code Blind provides (e.g. Ready, Allocated, Shutdown, etc), can I add my own?</h3>
<p>If you want to track custom game server states, then you can utilise the game server client SDK
<a href="https://codeblind.ai/docs/guides/client-sdks/#setlabelkey-value">SDK.SetLabel()</a>
and <a href="https://codeblind.ai/docs/guides/client-sdks/#setannotationkey-value">SDK.SetAnnotation()</a> functionality to
expose these custom states to outside systems via your own labels and annotations.</p>
<p>This information is then queryable via the <a href="https://codeblind.ai/docs/guides/access-api/">Kubernetes API</a>, and
can be used for game specific state integrations with systems like matchmakers and more.</p>
<p>Custom labels could also potentially be utilised with <a href="https://codeblind.ai/docs/reference/gameserverallocation/">GameServerAllocation required and/or preferred label
selectors</a>, to further refine <code>Ready</code> GameServer
selection on Allocation.</p>
<h2 id="scaling">Scaling</h2>
<h3 id="how-large-can-an-code-blind-cluster-be--how-many-gameservers-can-be-supported-in-a-single-cluster">How large can an Code Blind cluster be? / How many GameServers can be supported in a single cluster?</h3>
<p>The answer to this question is &ldquo;it depends&rdquo; 😁.</p>
<p>As a rule of thumb, we recommend clusters no larger than 500 nodes, based on production workloads.</p>
<p>That being said, this is highly dependent on Kubernetes hosting platform, control plane resources, node resources,
requirements of your game server, game server session length, node spin up time, etc, and therefore you
should run your own load tests against your hosting provider to determine the optimal cluster size for your game.</p>
<p>We recommend running multiple clusters for your production GameServer workloads, to spread the load and
provide extra redundancy across your entire game server fleet.</p>
<h2 id="network">Network</h2>
<h3 id="how-are-ip-addresses-allocated-to-gameservers">How are IP addresses allocated to GameServers?</h3>
<p>Each <code>GameServer</code> inherits the IP Address of the Node on which it resides. If it can find an <code>ExternalIP</code> address on
the Node (which it should if it&rsquo;s a publicly addressable Node), that it utilised, otherwise it falls back to using the
<code>InternalIP</code> address.</p>
<h3 id="how-do-i-use-the-dns-name-of-the-node">How do I use the DNS name of the Node?</h3>
<p>If the Kubernetes nodes have an <code>ExternalDNS</code> record, then it will be utilised as the <code>GameServer</code> address
preferentially over the <code>ExternalIP</code> node record.</p>
<h3 id="how-is-traffic-routed-from-the-allocated-port-to-the-gameserver-container">How is traffic routed from the allocated Port to the GameServer container?</h3>
<p>Traffic is routed to the GameServer Container utilising the <code>hostPort</code> field on a
<a href="https://v1-27.docs.kubernetes.io/docs/reference/generated/kubernetes-api/v1.27/#containerport-v1-core">Pod&rsquo;s Container specification</a>.</p>
<p>This opens a port on the host Node and routes traffic to the container
via <a href="https://en.wikipedia.org/wiki/Iptables">iptables</a> or
<a href="https://kubernetes.io/blog/2018/07/09/ipvs-based-in-cluster-load-balancing-deep-dive/">ipvs</a>, depending on host
provider and/or network overlay.</p>
<p>In worst case scenarios this routing can add an extra 0.5ms latency to UDP packets, but that is extremely rare.</p>
<h4 id="why-did-you-use-hostport-and-not-hostnetwork-for-your-networking">Why did you use hostPort and not hostNetwork for your networking?</h4>
<p>The decision was made not to use <code>hostNetwork</code>, as the benefits of having isolated network namespaces between
game server processes give us the ability to run
<a href="https://blog.davemdavis.net/2018/03/13/the-sidecar-pattern/">sidecar containers</a>, and provides an extra layer of
security to each game server process.</p>
<h2 id="performance">Performance</h2>
<h3 id="how-big-an-image-can-i-use-for-my-gameserver">How big an image can I use for my GameServer?</h3>
<p>We routinely see users running container images that are multiple GB in size.</p>
<p>The only downside to larger images, is that they can take longer to first load on a Kubernetes node, but that can be
managed by your
<a href="https://codeblind.ai/docs/reference/fleet/">Fleet</a> and
<a href="https://codeblind.ai/docs/reference/fleetautoscaler/">Fleet Autoscaling</a>
configuration to ensure this load time is taken into account on a new Node&rsquo;s container initial load.</p>
<h3 id="how-quickly-can-code-blind-spin-up-new-gameserver-instances">How quickly can Code Blind spin up new GameServer instances?</h3>
<p>When running Code Blind on GKE, we have verified that an Code Blind cluster can start up
to 10,000 GameServer instances per minute (not including node creation).</p>
<p>This number could vary depending on the underlying scaling capabilities
of your cloud provider, Kubernetes cluster configuration, and your GameServer Ready startup time, and
therefore we recommend you always run your own load tests for your specific game and game server containers.</p>
<h2 id="architecture-1">Architecture</h2>
<h3 id="cant-we-use-a-deployment-or-a-statefulset-for-game-server-workloads">Can&rsquo;t we use a Deployment or a StatefulSet for game server workloads?</h3>
<p>Kubernetes <a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/">Deployments</a> were built for
<em>unordered</em>, <em>stateless</em> workloads. That is, workloads that are essentially homogeneous
between each instance, and therefore it doesn&rsquo;t matter which order they are scaled up, or scaled down.</p>
<p>A set of web servers behind the same load balancer are a perfect example of this. The configuration and application
code between instances is the same, and as long as there are enough replicas to handle the requests coming through a
load balancer, if we scale from 10 to 5, it doesn&rsquo;t matter which ones are removed and in which order.</p>
<p>Kubernetes <a href="https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/">StatefulSets</a>
were built for <em>ordered</em>, <em>stateful</em> workloads. That is, workloads in which each instance is
essentially heterogeneous, and for reliability and predictability it&rsquo;s extremely important that scale up happens in
order (0 ,1, 2, 3) and scaling down happens in reverse (3, 2, 1, 0).</p>
<p>Databases are a great use case for a StatefulSet, since (depending on the database), instance 0 may be the primary,
and instances 1, 2, 3+ may be replicas. Knowing that the order of scale up and down is completely reliable to both
ensure that the correct disk image is in place, but also allow for appropriate synchronisation between a primaries
and/or replicas can occur, and no downtime occurs.</p>
<p>Dedicated, authoritative game server workloads are <em>sometimes stateful</em>, and while
not ordered/unordered, game servers are <em>prioritised</em> for both scale down and allocation for player usage.</p>
<p>Game servers are sometimes stateful, because their state only matters if players are playing on them. If no players
are playing on a game server, then it doesn&rsquo;t matter if it gets shut down, or replaced, since nobody will notice.
But they are stateful (most often in-memory state, for the game simulation) when players are playing on them, and
therefore can&rsquo;t be shutdown while that is going on.</p>
<p>Game Server workloads are also <em>prioritised</em>, in that the order of demarcating game servers for player connection
and also on game server scale down impact optimal usage of the hosting infrastructure.</p>
<p>For example, in Cloud based workloads, you will want to pack the game servers that have players on them as tightly
as possible across as few Nodes as possible, while on scale down, will want to prioritise removing game servers from<br>
Nodes that are the most empty to create empty Nodes that then can be deleted - thereby using the least amount of
infrastructure as possible.</p>
<p>So while one might be able to use Deployments and/or StatefulSets to run game server workloads, it will be extremely
hard (impossible? 🤔) to run as optimally as a tailored solution such as Code Blind.</p>
<h2 id="ecosystem">Ecosystem</h2>
<h3 id="is-there-an-example-of-code-blind-and-other-project-working-together">Is there an example of Code Blind and other project working together?</h3>
<p>Yes! There are several! Check out both our
<a href="https://codeblind.ai/docs/examples/#integrations-with-other-projects">official</a>
and <a href="https://codeblind.ai/docs/third-party-content/examples/#integrations-with-other-projects">third party</a> examples!</p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-fc0185d8c85360d88975558dab2d674f">12 - Third Party Content</h1>
    <div class="lead">Content created by our community</div>
	
</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-1f63813ee7821af50cf0a24cc3ebd3fa">12.1 - Third Party Videos and Presentations</h1>
    <div class="lead">Community contributed videos and presentations on Code Blind.</div>
	<h2 id="presentations">Presentations</h2>
<h3 id="large-scale-multiplayer-gaming-on-kubernetes-cloud-next-19">Large-Scale Multiplayer Gaming on Kubernetes (Cloud Next &lsquo;19)</h3>
<iframe width="640" height="360" class="p-2" src="https://www.youtube.com/embed/Imf_urBB7SI"
        frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

<h3 id="code-blind-scaling-multiplayer-game-servers-with-open-source-gdc-2019">Code Blind: Scaling Multiplayer Game Servers with Open Source (GDC 2019)</h3>
<iframe width="640" height="360" class="p-2" src="https://www.youtube.com/embed/XD1nuASFY3k"
        frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

<h3 id="intro-to-code-blind-scaling-multiplayer-game-servers-with-kubernetes-kubecon-2018">Intro to Code Blind: Scaling Multiplayer Game Servers with Kubernetes (Kubecon, 2018)</h3>
<iframe width="640" height="360" class="p-2" src="https://www.youtube.com/embed/Q4RZSHTeKCY"
        frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

<h3 id="google-cloud-next-18-london-carl-dionne-development-director-at-ubisoft-montreal">Google Cloud Next &lsquo;18 London: Carl Dionne, Development Director at Ubisoft Montreal</h3>
<iframe width="640" height="360" class="p-2" src="https://www.youtube.com/embed/5n-JlLA7bIc?start=835"
        frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

<h3 id="code-blind-scaling-multiplayer-dedicated-game-servers-with-kubernetes-cloud-next-18">Code Blind: Scaling Multiplayer Dedicated Game Servers with Kubernetes (Cloud Next &lsquo;18)</h3>
<iframe width="640" height="360" class="p-2" src="https://www.youtube.com/embed/CLNpkjolxYA"
        frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

<h2 id="screencasts">Screencasts</h2>
<h3 id="code-blind-how-do-i-docker-and-kubernetes-part-1--part-2">Code Blind: How Do I Docker and Kubernetes? (Part 1 &amp; Part 2)</h3>
<p><iframe width="640" height="360" class="p-2" src="https://www.youtube.com/embed/i4_zaztK6mE"
        frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

<iframe width="640" height="360" class="p-2" src="https://www.youtube.com/embed/ZZXLDnmO1TM"
        frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-06fac025c00dda3f2d462c83673bbc2a">12.2 - Third Party Examples</h1>
    <div class="lead">Community contributed Dedicated Game Server examples on Code Blind.</div>
	<h2 id="integrations-with-other-projects">Integrations with other projects</h2>
<ul>
<li><a href="https://github.com/Octops/agones-discover-openmatch">Octops/Code Blind x Open Match</a> - How to implement a matchmaking
system using Code Blind and Open Match</li>
</ul>
<h2 id="minetest">Minetest</h2>
<ul>
<li><a href="https://www.minetest.net/">Minetest</a> is a free and open-source sandbox video game available for Linux, FreeBSD,
Microsoft Windows, MacOS, and Android. Minetest game play is very similar to that of Minecraft. Players explore a blocky 3D world, discover and extract raw materials, craft tools and items, and build structures and landscapes.</li>
<li><a href="https://github.com/paulhkim80/agones-example-minetest">Minetest server for Code Blind</a> is an example of the Minetest
server hosted on Kubernetes using Code Blind. It wraps the Minetest server with a <a href="https://golang.org">Go</a> binary, and introspects stdout to provide the event hooks for the SDK integration. The wrapper is from <a href="https://github.com/googleforgames/agones/blob/main/examples/xonotic/main.go">Xonotic Example</a> with a few changes to look for the Minetest ready output message.</li>
</ul>
<p>You will need to download the Minetest client separately to play.</p>
<h2 id="quilkin">Quilkin</h2>
<ul>
<li><a href="https://github.com/googleforgames/quilkin">Quilkin</a> is a non-transparent UDP proxy specifically designed for use with large scale multiplayer dedicated game server deployments, to ensure security, access control, telemetry data, metrics and more.</li>
<li><a href="https://github.com/googleforgames/quilkin/tree/main/examples">Quilkin with Code Blind</a> is an example of running <a href="https://xonotic.org/">Xonotic</a> with Quilkin on an Code Blind cluster, utilising either <a href="https://github.com/googleforgames/quilkin/tree/main/examples/agones-xonotic-sidecar">the sidecar integration pattern</a> or via the the <a href="https://github.com/googleforgames/quilkin/tree/main/examples/agones-xonotic-xds">Quilkin xDS Code Blind provider</a> with a TokenRouter to provide routing and access control to the allocated GameServer instance.</li>
</ul>
<p>You will need to download the Xonotic client to interact with the demo.</p>
<h2 id="shulker">Shulker</h2>
<ul>
<li><a href="https://github.com/jeremylvln/Shulker">Shulker</a> is a Kubernetes operator for managing complex and dynamic Minecraft
infrastructure at scale, including game servers and proxies.</li>
<li>It builds on top Code Blind <code>GameServer</code> and <code>Fleet</code> primitives to provide simplified abstractions specifically tailored
to orchestrating Minecraft workloads.</li>
</ul>
<p>Shulker requires you to have a genuine Minecraft account. You&rsquo;ll need to <a href="https://www.minecraft.net/en-us/article/how-create-minecraft-account" data-proofer-ignore>purchase the game</a>
to test the &ldquo;Getting Started&rdquo; example.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-d529fc883ee4c6b16bf000a6a8fb11dc">12.3 - Third Party Podcasts</h1>
    <div class="lead">Community contributed podcasts on Code Blind.</div>
	<h2 id="2019">2019</h2>
<ul>
<li>Nov 6 - [Google Cloud Platform Podcast: Supersolid with Kami May]
(<a href="https://gcppodcast.com/post/episode-202-supersolid-with-kami-may/">https://gcppodcast.com/post/episode-202-supersolid-with-kami-may/</a>)</li>
</ul>
<h2 id="2018">2018</h2>
<ul>
<li>Oct 23 - [Kubernetes Podcast: Code Blind, with Cyril Tovena and Mark Mandel]
(<a href="https://kubernetespodcast.com/episode/026-agones/">https://kubernetespodcast.com/episode/026-agones/</a>)</li>
<li>Aug 15 - [Google Cloud Platform Podcast: Code Blind with Mark Mandel and Cyril Tovena]
(<a href="https://gcppodcast.com/post/episode-142-agones-with-mark-mandel-and-cyril-tovena/">https://gcppodcast.com/post/episode-142-agones-with-mark-mandel-and-cyril-tovena/</a>)</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-b8eeaf002eb51635e17ef91f4641a68b">12.4 - Third Party Libraries and Tools</h1>
    <div class="lead">Community contributed libraries and tools on Code Blind.</div>
	<h2 id="client-sdks">Client SDKs</h2>
<ul>
<li><a href="https://github.com/Cubxity/AgonesKt">Cubxity/AgonesKt</a> - Code Blind Client SDK for <strong>Kotlin</strong></li>
<li><a href="https://github.com/AndreMicheletti/godot-agones-sdk">AndreMicheletti/godot-agones-sdk</a> - Code Blind Client SDK for <strong>Godot Engine</strong></li>
<li><a href="https://github.com/infumia/agones4j">Infumia/agones4j</a> - Code Blind Client SDK for <strong>Java</strong></li>
</ul>
<h2 id="messaging">Messaging</h2>
<p>Libraries or applications that implement messaging systems.</p>
<ul>
<li><a href="https://github.com/Octops/agones-event-broadcaster">Octops/Code Blind Event Broadcaster</a> - Broadcast Code Blind events to the external world</li>
<li><a href="https://github.com/Octops/agones-broadcaster-http">Octops/Code Blind Broadcaster HTTP</a> - Expose Code Blind GameServers information via HTTP</li>
<li><a href="https://github.com/Octops/agones-relay-http">Octops/Code Blind Relay HTTP</a> - Publish Code Blind GameServers and Fleets details to HTTP endpoints</li>
</ul>
<h2 id="controllers">Controllers</h2>
<ul>
<li><a href="https://github.com/Octops/gameserver-ingress-controller">Octops/Game Server Ingress Controller</a> - Automatic Ingress configuration for Game Servers managed by Code Blind</li>
<li><a href="https://github.com/Octops/octops-image-syncer">Octops/Image Syncer</a> - Watch Fleets and pre-pull images of game servers on every node running in the cluster</li>
<li><a href="https://github.com/Octops/octops-fleet-gc">Octops/Fleet Garbage Collector</a> - Delete Fleets based on its TTL</li>
</ul>
<h2 id="allocation">Allocation</h2>
<ul>
<li><a href="https://github.com/FairwindsOps/agones-allocator-client">agones-allocator-client</a> - A client for testing allocation servers.
Made by <a href="https://fairwinds.com">Fairwinds</a></li>
<li><a href="https://github.com/aws-samples/multi-cluster-allocation-demo-for-agones-on-eks">Multi-cluster allocation demo</a> - A demo project for multi-cluster allocation on Amazon EKS with Terraform templates.</li>
</ul>
<h2 id="development-tools">Development Tools</h2>
<ul>
<li><a href="https://github.com/comerford/minikube-agones-cluster">Minikube Code Blind Cluster</a> - Automates the creation of a complete Kubernetes/Code Blind Cluster locally, using Xonotic as a sample gameserver. Intended to provide a local environment for developers which approximates a production Code Blind deployment.</li>
</ul>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-3f5467eebfda1972aea4244246084123">13 - Documentation Editing and Contribution</h1>
    <div class="lead">How to contribute to the docs</div>
	<h2 id="writing-documentation">Writing Documentation</h2>
<p>We welcome contributions to documentation!</p>
<h2 id="running-the-site">Running the site</h2>
<p>If you clone the repository and run <code>make site-server</code> from the <code>build</code> directory, this will run the live hugo server,
running as a showing the next version&rsquo;s content and upcoming <code>publishedDate</code>&rsquo;d content as well. This is likely to be
the next releases&rsquo; version of the website.</p>
<p>To show the current website&rsquo;s view, run it as <code>make site-server ENV=RELEASE_VERSION=1.38.0 ARGS=</code></p>
<h2 id="platform">Platform</h2>
<p>This site and documentation is built with a combination of Hugo, static site generator,
with the Docsy theme for open source documentation.</p>
<ul>
<li><a href="https://gohugo.io/documentation/">Hugo Documentation</a></li>
<li><a href="https://github.com/google/docsy">Docsy Guide</a></li>
<li><a href="https://github.com/wjdp/htmltest">Link Checker</a></li>
</ul>
<h2 id="documentation-for-upcoming-features">Documentation for upcoming features</h2>
<p>Since we may want to update the existing documentation for a given release, when writing documentation,
you will likely want to make sure it doesn&rsquo;t get published until the next release.</p>
<p>There are two approaches for hiding documentation for upcoming features, such that it only gets published when the
version is incremented on the release:</p>
<h3 id="at-the-page-level">At the Page Level</h3>
<p>Use <code>publishDate</code> and <code>expiryDate</code> in <a href="https://gohugo.io/content-management/front-matter/">Hugo Front Matter</a> to control
when the page is displayed (or hidden). You can look at the <a href="https://github.com/googleforgames/agones/blob/main/docs/governance/release_process.md#release-calendar">Release Calendar</a>
to align it with the next release
candidate release date - or whichever release is most relevant.</p>
<h3 id="within-a-page">Within a Page</h3>
<p>We have a <code>feature</code> shortcode that can be used to show, or hide sections of pages based on the current semantic version
(set in config.toml, and overwritable by env variable).</p>
<p>For example, to show a section only from 1.24.0 forwards:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-markdown" data-lang="markdown"><span style="display:flex;"><span>{{% feature publishVersion=&#34;1.24.0&#34; %}}
</span></span><span style="display:flex;"><span>  This is my special content that should only display &gt;= 1.24.0
</span></span><span style="display:flex;"><span>{{% /feature %}}
</span></span></code></pre></div><p>or to hide a section from 1.24.0 onward:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-markdown" data-lang="markdown"><span style="display:flex;"><span>{{% feature expiryVersion=&#34;1.24.0&#34; %}}
</span></span><span style="display:flex;"><span>  This is my special content that will be hidden &gt;= 1.24.0
</span></span><span style="display:flex;"><span>{{% /feature %}}
</span></span></code></pre></div><h2 id="regenerate-diagrams">Regenerate Diagrams</h2>
<p>To regenerate the <a href="http://plantuml.com/">PlantUML</a> or <a href="https://www.graphviz.org/doc/info/lang.html">Dot</a> diagrams,
delete the .png version of the file in question from <code>/static/diagrams/</code>, and run <code>make site-images</code>.</p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  



          </main>
        </div>
      </div>
      <footer class="td-footer row d-print-none">
  <div class="container-fluid">
    <div class="row mx-md-2">
      <div class="td-footer__left col-6 col-sm-4 order-sm-1">
        <ul class="td-footer__links-list">
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="Discord" aria-label="Discord">
    <a target="_blank" rel="noopener" href="https://join.discord.com/t/codeblind/shared_invite/12345" aria-label="Discord">
      <i class="fab fa-discord"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="User mailing list" aria-label="User mailing list">
    <a target="_blank" rel="noopener" href="https://groups.google.com/forum/#!forum/codeblind-discuss" aria-label="User mailing list">
      <i class="fa fa-envelope"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="X" aria-label="X">
    <a target="_blank" rel="noopener" href="https://twitter.com/codeblind" aria-label="X">
      <i class="fab fa-x-twitter"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="Community Meetings" aria-label="Community Meetings">
    <a target="_blank" rel="noopener" href="https://github.com/josephbarnett/" aria-label="Community Meetings">
      <i class="fab fa-youtube"></i>
    </a>
  </li>
  
</ul>

      </div><div class="td-footer__right col-6 col-sm-4 order-sm-3">
        <ul class="td-footer__links-list">
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="GitHub" aria-label="GitHub">
    <a target="_blank" rel="noopener" href="https://github.com/josephbarnett/" aria-label="GitHub">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="Resume" aria-label="Resume">
    <a target="_blank" rel="noopener" href="https://github.com/josephbarnett/" aria-label="Resume">
      <i class="fab fa-linkedin"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="Facebook" aria-label="Facebook">
    <a target="_blank" rel="noopener" href="https://github.com/josephbarnett/" aria-label="Facebook">
      <i class="fab fa-facebook"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="Contact" aria-label="Contact">
    <a target="_blank" rel="noopener" href="https://github.com/josephbarnett/codeblind.ai" aria-label="Contact">
      <i class="fab fa-whatsapp"></i>
    </a>
  </li>
  
</ul>

      </div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2">
        <span class="td-footer__copyright">&copy;
    2024
    <span class="td-footer__authors">Copyright Code Blind LLC</span></span><span class="td-footer__all_rights_reserved">All Rights Reserved</span><span class="ms-2"><a href="https://policies.google.com/privacy" target="_blank" rel="noopener">Privacy Policy</a></span>
      </div>
    </div>
  </div>
</footer>

    </div>
    <script src="/js/main.js"></script>
<script src='/js/prism.js'></script>
<script src='/js/tabpane-persist.js'></script>
<script src=https://codeblind.ai/js/asciinema-player.js></script>

  </body>
</html>
