<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.124.1"><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel=canonical type=text/html href=http://localhost:1313/blog/posts/><link rel=alternate type=application/rss+xml href=http://localhost:1313/blog/posts/index.xml><link rel="shortcut icon" href="/favicons/favicon.ico?v=1"><link rel=apple-touch-icon href="/favicons/apple-touch-icon-180x180.png?v=1" sizes=180x180><link rel=icon type=image/png href="/favicons/favicon-16x16.png?v=1" sizes=16x16><link rel=icon type=image/png href="/favicons/favicon-32x32.png?v=1" sizes=32x32><link rel=apple-touch-icon href="/favicons/apple-touch-icon-180x180.png?v=1" sizes=180x180><title>Engineering Blog | </title><meta property="og:title" content="Engineering Blog"><meta property="og:description" content="A Docsy example site"><meta property="og:type" content="website"><meta property="og:url" content="http://localhost:1313/blog/posts/"><meta property="og:site_name" content="Goldydocs"><meta itemprop=name content="Engineering Blog"><meta itemprop=description content="A Docsy example site"><meta name=twitter:card content="summary"><meta name=twitter:title content="Engineering Blog"><meta name=twitter:description content="A Docsy example site"><link rel=stylesheet href=/css/prism.css><link href=/scss/main.css rel=stylesheet><link rel=stylesheet type=text/css href=http://localhost:1313/css/asciinema-player.css><script src=https://code.jquery.com/jquery-3.3.1.min.js integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin=anonymous></script></head><body class="td-section td-blog"><header><nav class="js-navbar-scroll navbar navbar-expand navbar-light nav-shadow flex-column flex-md-row td-navbar"><a id=agones-top class=navbar-brand href=/><svg viewBox="0 -40 700 300" xmlns="http://www.w3.org/2000/svg"><g fill="#006298" fill-rule="none" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode:normal" transform="matrix(1, 0, 0, 1, 4.033676, -59.776756)"><g data-paper-data='{"isGlobalGroup":true,"bounds":{"x":65,"y":134.91096067769388,"width":420,"height":200.17807864461224}}'><g data-paper-data='{"isPrimaryText":true}' fill-rule="nonzero" transform="matrix(1.506311, 0, 0, 1.608315, -96.423798, -293.86853)" style=""><path d="M99.87138 315.5382c-1.20049 6.40261-6.57411 11.03307-12.97673 11.03307-7.14577.0-12.80523-6.00245-12.80523-13.49122.0-7.54594 5.65945-13.60555 12.80523-13.60555 4.4018.0 8.74643 2.22948 11.8334 6.80278l6.91711-4.91629c-3.83013-6.23111-10.86158-10.34708-18.80768-10.34708C74.71825 291.01391 65 300.90366 65 313.08006s9.71825 22.00898 21.89465 22.00898c11.31891.0 20.69416-8.63209 21.95182-19.55084z" data-paper-data='{"glyphName":"C","glyphIndex":0,"firstGlyphOfWord":true,"word":1}'/><path d="M134.79992 335.08904c12.1764.0 22.00898-9.88975 22.00898-22.06615s-9.83258-22.00898-22.06615-22.00898c-12.1764.0-22.00898 9.83258-22.00898 22.00898s9.83258 22.06615 22.06615 22.06615zM134.74275 299.4745c7.20294.0 12.97673 6.05962 12.97673 13.54839.0 7.6031-5.71662 13.54839-12.91956 13.54839-7.31727.0-12.97673-5.94528-12.97673-13.54839.0-7.48877 5.65945-13.54839 12.91956-13.54839z" data-paper-data='{"glyphName":"O","glyphIndex":1,"word":1}'/><path d="M163.15435 291.75707v42.58881h17.32136c12.23356.0 22.23765-9.08942 22.23765-21.32299.0-12.11923-10.00408-21.26582-22.29481-21.26582zm8.86076 34.58554v-26.58228h8.40343c7.4316.0 13.20539 5.54512 13.20539 13.26256.0 7.66027-5.77379 13.31972-13.14822 13.31972z" data-paper-data='{"glyphName":"D","glyphIndex":2,"word":1}'/><path d="M235.46958 334.34588v-8.00327h-17.55002V315.7097h16.00653v-8.00327h-16.00653v-7.9461h13.77705v-8.00327H209.0588v42.58881z" data-paper-data='{"glyphName":"E","glyphIndex":3,"word":1}'/><path d="M256.67824 334.34588c7.83177.0 15.09187-5.03062 15.09187-13.71989.0-4.11597-1.94365-7.7746-5.77379-10.40425 2.05798-1.88648 3.02981-4.2303 3.02981-7.20294.0-7.9461-5.65945-11.26174-13.54839-11.26174h-13.66272v42.58881zM250.67579 326.34261V315.3667h6.28828c3.65864.0 5.71662 2.11515 5.71662 5.54512.0 3.31564-2.05798 5.43079-5.71662 5.43079zm0-18.69334v-7.88893h4.45896c2.45815.0 4.80196.68599 4.80196 3.94447.0 1.77215-.5145 3.94447-4.80196 3.94447z" data-paper-data='{"glyphName":"B","glyphIndex":4,"word":1}'/><path d="M278.11556 291.75707v42.58881h26.01062v-8.00327h-17.14986v-34.58555z" data-paper-data='{"glyphName":"L","glyphIndex":5,"word":1}'/><path d="M317.90323 291.75707h-8.86076v42.58881h8.86076z" data-paper-data='{"glyphName":"I","glyphIndex":6,"word":1}'/><path d="M356.31891 316.3957l-30.29808-25.43895v43.38914h8.86076v-24.46713l30.29808 25.21029v-43.33197h-8.86076z" data-paper-data='{"glyphName":"N","glyphIndex":7,"word":1}'/><path d="M373.29726 291.75707v42.58881h17.32136c12.23356.0 22.23765-9.08942 22.23765-21.32299.0-12.11923-10.00408-21.26582-22.29481-21.26582zM382.15802 326.34261v-26.58228h8.40343c7.4316.0 13.20539 5.54512 13.20539 13.26256.0 7.66027-5.77379 13.31972-13.14822 13.31972z" data-paper-data='{"glyphName":"D","glyphIndex":8,"word":1}'/></g><g data-paper-data='{"fillRule":"evenodd","fillRuleOriginal":"evenodd","isIcon":true,"iconStyle":"standalone","selectedEffects":{"container":"triangle_simple_outline3","transformation":"","pattern":""},"bounds":{"x":200.4253260667158,"y":134.91096067769388,"width":149.1493478665684,"height":129.93559557606665},"widthRatioIconToContainer":0.46864262218011316,"heightRatioIconToContainer":0.5128464428206175,"relativeBoundsIconToContainer":{"top":0.1511909708697078,"left":0.00000405714571068623},"iconType":"icon","rawIconId":"22591","isDetailed":false,"blockLetter":"A","suitableAsStandaloneIcon":true}' fill-rule="evenodd" transform="matrix(0.857575, 0, 0, 0.832887, 371.420288, 37.764965)" style=""><path d="M240.08737 218.30866l-.03565-.03565.03565-.21459c0-3.26912.85904-7.02682 2.57713-11.2738 1.07363-2.36185 2.46949-4.70062 4.18758-7.01493.90657-1.24068 2.39819-2.85113 4.47346-4.83203 2.14726-1.81315 4.21134-3.26842 6.19154-4.36651 1.76562-.97857 3.99676-1.92079 6.69271-2.82736 2.19549-.71575 5.07038-1.21692 8.62538-1.5028l.85904-.03565v.03565l.07199-.03565h2.11161l.25024.03565.03565-.03565.21528.03565c2.95807.0 6.5613.69199 10.80829 2.07597 2.38631.88281 4.74815 2.02843 7.08694 3.43617 1.45527.85904 3.14959 2.11161 5.08226 3.75771 2.33878 2.21925 3.88911 3.93664 4.65239 5.15426 1.79008 2.43314 3.18594 5.04592 4.18758 7.83763 1.14562 3.4837 1.71809 6.52566 1.71809 9.12655l.03495.14259h-.03565l.03565.03565v2.2542l-.03565.03635.03565.03635c0 1.76492-.35788 4.3057-1.07363 7.62305-.66822 2.33808-1.39586 4.34205-2.18291 6.01261-.85904 1.69432-2.02773 3.51935-3.50816 5.47579-.9541 1.16939-2.19549 2.49326-3.72205 3.97299-2.4576 2.07597-4.53287 3.61511-6.22719 4.61675-.73952.38164-1.40774.57247-2.00397.57247-1.59856.0-2.67219-.78775-3.22089-2.36254-.09576-.42917-.14329-.79963-.14329-1.10928.0-1.36021 1.19316-2.66031 3.57947-3.90099.73952-.35788 1.92009-1.26515 3.54242-2.72042 2.07597-2.0522 3.51935-3.75771 4.33086-5.11791.93034-1.43151 1.70551-2.92313 2.3262-4.47346.85904-2.43314 1.28822-4.02051 1.28822-4.76003l.35858-2.29055-.07199-.03565.07199-.21528v-.32223l.03565-.03635-.03565-.03565.03565-.14329.03565-1.61045c0-7.11-2.63584-13.29036-7.90893-18.53898-1.95644-1.74185-3.39983-2.87489-4.33016-3.39983-4.86768-3.03007-10.00935-4.54545-15.42574-4.54545h-1.64609l-.21459.03565v-.03565l-.03565.03565h-.03635c-2.40937.0-5.32062.56058-8.73232 1.68244-1.81385.69199-3.63888 1.59856-5.47579 2.72042-1.16939.69199-2.79172 2.00397-4.86768 3.93664l-1.18127 1.28822c-4.55733 5.08226-6.836 10.90405-6.836 17.46535l.03565.39352h-.03635l.03565.03565v.03565c0 4.67686 1.95644 10.04501 5.86931 16.10584 3.17336 4.72439 5.51214 8.29127 7.01493 10.70135.52493.88351 1.03728 1.86068 1.53845 2.93501h-.03565c-3.19712-1.45527-6.17966-3.16147-8.94761-5.11791-2.09972-1.64609-3.80523-3.30546-5.11791-4.97462-1.5028-2.09972-2.61278-3.88911-3.32853-5.36885-.85904-1.67055-1.65868-3.75771-2.39819-6.26353-.42917-1.57479-.77517-3.2803-1.03798-5.11722l-.17894-1.96832h.03565l-.03565-.03635-.03495-1.82503v-1.00234l.03565-.03565-.03565-.03565v-.03565zm34.03601-22.7622h2.04032l.03565.07199.03635-.07199c1.59856.04753 3.65076.38164 6.15589 1.00234 2.17103.69199 3.97299 1.44339 5.40379 2.2549 1.33645.73952 2.86371 1.86138 4.58179 3.36418 2.14726 2.07597 3.53124 3.63888 4.15123 4.68874 1.16939 1.69432 2.07597 3.49558 2.72042 5.40449.52493 1.31198.89469 3.20901 1.10928 5.69038v.03565h-.03565l.03565.03565v1.32457c0 6.46554-2.67219 12.24049-8.01727 17.32206-2.4576 2.17103-4.0324 3.29288-4.72439 3.36418-.42917.19082-.89399.28588-1.39586.28588h-.07129c-1.5035.0-2.55336-.7514-3.14959-2.2549l-.17964-1.07363c0-1.57479 1.04986-2.82736 3.14959-3.75771.66822-.33481 1.44339-.93104 2.3262-1.79008 1.40844-1.47973 2.41007-2.83924 3.007-4.08063.5487-.9541 1.07363-2.28985 1.57479-4.00793.28588-1.40774.42917-2.42195.42917-3.04195h.03565l-.03565-.0727.03565-.17894v-1.93267l-.03565-.17894h.03565l-.03565-.14329c0-1.74185-.60811-3.84158-1.82503-6.29918-.59693-1.0974-1.46785-2.26679-2.61278-3.50747-1.21622-1.24068-2.24232-2.09972-3.0776-2.57713-3.38794-2.17103-6.76401-3.25724-10.12818-3.25724h-.10694l-.03635-.07199-.03565.07199h-.10764l-.03565-.07199-.03565.07199h-.39352l-.03635-.07199-.03565.07199h-.64446l-.21459.03565v-.03565c-1.5028.14329-2.67219.33411-3.50816.57247-4.00793 1.14492-7.13376 3.03007-9.37678 5.65473-1.28891 1.40774-2.29055 2.89866-3.0063 4.47346-.93034 2.17103-1.39586 4.21134-1.39586 6.12025v.7514l-.03565.03565.03565.03565v.07129c0 3.14959 1.19316 6.47812 3.57876 9.98559 6.06083 9.6389 10.72511 17.28641 13.99423 22.94114l-.03565.03565h-.03635c-4.17569-.38164-6.96741-.77517-8.37445-1.18057-5.55897-8.78056-8.67292-13.66012-9.34113-14.63729-2.95877-4.48604-4.79568-7.77892-5.51143-9.87865-.78775-2.36185-1.18127-4.80827-1.18127-7.33716.0-5.48767 1.80126-10.52241 5.40449-15.10351.5487-.71575 1.68174-1.8495 3.39983-3.39983 3.24536-2.57713 6.78777-4.28264 10.62935-5.11791 1.38467-.30685 3.0063-.52213 4.86768-.64096v.07199zM274.69654 205.06653h1.10998l.07199.07199.03565-.07199h.03565l.03635.07199.03565-.07199c1.04986.0 2.46949.25024 4.25957.7514 3.6263 1.28822 6.38236 3.67453 8.26751 7.15823 1.04986 2.17103 1.57479 4.29522 1.57479 6.37048v.21459c0 3.96111-1.7062 7.55175-5.11791 10.77264-1.43151 1.14562-2.7323 1.71809-3.90099 1.71809-1.45597.0-2.54148-.77517-3.25724-2.3262-.11883-.33411-.19012-.68011-.21459-1.03798.0-1.19246.88281-2.39749 2.64842-3.61441 1.26445-.85904 2.07597-1.8495 2.43314-2.97065.28658-.81151.42917-1.61045.42917-2.39819v-.14329c0-2.38631-1.04986-4.49792-3.14959-6.33484-1.38328-1.0261-3.10206-1.53915-5.15356-1.53915l-.28588.03565v-.03565l-.03635.03565h-.07199c-1.88444.0-3.69829.81081-5.43944 2.43314-1.40844 1.62233-2.11161 3.4837-2.11161 5.58343.0 1.78938 1.2288 4.42593 3.68641 7.90963 6.34672 9.99747 11.22628 17.88264 14.63729 23.65759-3.05383.81081-5.40379 1.21622-7.05059 1.21622-3.14959-4.5811-6.84788-10.4623-11.09487-17.64359-1.45527-2.43384-3.0776-4.95156-4.86698-7.55245-1.59856-2.48137-2.39889-5.07038-2.39889-7.76634.0-3.74582 1.37209-7.06247 4.11628-9.94925 1.47904-1.36021 2.82736-2.32689 4.04428-2.89866 2.17103-.90657 3.61511-1.36021 4.33016-1.36021.4061-.09506 1.19316-.19082 2.36254-.28588v.07199zm74.56087 55.60127c.0215.04174.0421.08398.06181.1267.01926.04277.0374.08599.05442.12966.01747.04366.03381.08771.04904.13215.01478.04448.02867.08926.04165.13436.01299.04515.02486.09058.0356.13631.0103.04573.0197.09168.02822.13785.00851.04618.0159.09253.02217.13907.00582.04653.01075.0932.01478.14001.00358.04676.00627.09361.00806.14054.00134.04694.00179.09385.00134.14074-89e-5.04694-.00291.09383-.00605.14068-.00313.04685-.00739.09358-.01277.14021-.00538.04667-.01186.09316-.01948.13947-.00761.04631-.01635.0924-.0262.13825-.00985.04591-.02083.09153-.03292.13684-.0121.04537-.0253.09038-.03964.13503-.01478.0447-.03023.08901-.04636.13295-.01657.04394-.03426.08745-.05307.13053-.01881.04304-.03852.08561-.05912.12771s-.04232.08369-.06516.12476c-.02284.04102-.0468.08147-.07188.12133-.02463.03986-.05038.07909-.07726.1177-.02642.03856-.05397.07648-.08263.11373-.02867.03722-.05822.07374-.08868.10957-.03046.03579-.06158.07081-.09338.10507-.03225.03426-.06516.06772-.09875.10037s-.06808.06445-.10346.0954c-.03538.03095-.07144.061-.10816.09015-.03673.0292-.07412.05746-.11219.08478-.03852.02736-.07748.05377-.1169.07921-.03941.02544-.0795.04989-.12025.07336-.21766.12585-.44809.22136-.69128.28652-.2432.06516-.49064.09775-.74234.09775H203.29356c-.04694.0-.09385-.00116-.14074-.00349-.04689-.00228-.0937-.00573-.14041-.01034-.04671-.00457-.09327-.0103-.13967-.0172-.04645-.0069-.09269-.01494-.13872-.02412-.04604-.00914-.09184-.01941-.13738-.03084-.04551-.01137-.09071-.02389-.13564-.03756-.04492-.01362-.08948-.02833-.13369-.04414-.04421-.01581-.08798-.03269-.13134-.05065-.0434-.01796-.08631-.03697-.12872-.05703-.04246-.02007-.08438-.04116-.12576-.06328-.04138-.02217-.0822-.0453-.12247-.0694-.04026-.02414-.07992-.04926-.11898-.07537-.03901-.02606-.07737-.05307-.11508-.08102-.03771-.028-.0747-.05686-.11098-.0866-.03628-.02979-.07182-.06044-.10661-.09197-.0348-.03153-.0688-.06389-.10198-.09707-.03319-.03319-.06554-.06718-.09707-.10198-.03153-.03475-.06217-.07029-.09191-.10661-.02979-.03628-.05867-.07327-.08666-.11098-.02795-.03771-.05495-.07607-.08102-.11508-.02611-.03905-.05121-.07871-.07531-.11898-.02414-.04022-.04727-.08104-.0694-.12247-.02213-.04138-.04324-.0833-.06335-.12576-.02007-.04241-.03908-.0853-.05703-.12865-.01796-.0434-.03484-.0872-.05065-.13141-.01581-.04416-.03052-.0887-.04414-.13362-.01366-.04492-.02618-.09015-.03756-.1357-.01142-.04555-.0217-.09134-.03084-.13738-.00918-.04604-.01722-.09226-.02412-.13866-.00685-.04645-.01259-.09302-.0172-.13974-.00462-.04671-.00806-.09352-.01034-.14041-.00233-.04689-.00349-.09381-.00349-.14074.0-.25175.03258-.4992.09775-.74234.06516-.2432.16067-.47378.28652-.69175l71.7064-124.19911c.02347-.04067.04792-.08073.07336-.12018.02544-.03946.05184-.07827.07921-.11643.02732-.03816.05558-.07563.08478-.11239.02916-.03677.0592-.0728.09015-.1081.03095-.03529.06275-.0698.0954-.10352.03265-.03372.0661-.06662.10037-.09868.03426-.03211.06929-.06335.10507-.09372.03579-.03037.07231-.05984.10957-.08841.03722-.02858.07513-.05623.11373-.08296.03861-.02669.07784-.05245.1177-.07726.03986-.02477.0803-.04855.12133-.07135.04102-.0228.08261-.04459.12476-.06536.0421-.02074.08467-.04044.12771-.05912.04308-.01867.0866-.03628.13053-.05281.04394-.01657.08823-.03202.13288-.04636.0447-.01438.08973-.02763.1351-.03977.04533-.01214.09094-.02318.13684-.03312.04586-.0099.09195-.01867.13825-.02633.04631-.00761.09278-.01411.1394-.01948.04667-.00538.09343-.00958.14027-.01263.0468-.00309.09367-.00502.14061-.00578.04694-76e-5.09387-38e-5.14081.00114.04689.00152.09374.00421.14054.00806.0468.00385.09347.00882.14001.01491.04653.00614.09289.01342.13907.02184.04618.00837.09213.01789.13785.02855.04573.01066.09116.02244.13631.03533.0451.0129.08988.02689.13436.04199.04443.01509.08848.03126.13215.0485.04366.01724.08686.03556.12959.05495.04277.01934.08503.03975.12677.0612.04178.02146.08299.04392.12361.06738.21802.1259.41604.27784.59408.45582.17798.17802.32993.37605.45582.59408l71.70627 124.19911c.02374.04062.04613.08182.06718.12361zM274.99998 143.5157l-66.73842 115.59433H341.7386z" data-paper-data='{"isPathIcon":true}'/></g></g></g></svg> <span class="text-uppercase fw-bold"></span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/docs/><span>Documentation</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/blog/><span class=active>Blog</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/community/><span>Community</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=https://github.com/josephbarnett/codeblind.ai>GitHub</a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=https://app.codeblind.ai>Login</a></li></ul></div><div class="navbar-nav mx-lg-2 d-none d-lg-block"></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"></div><main class="col-12 col-md-9 col-xl-8 ps-md-5 pe-md-4" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/blog/posts/>Return to the regular view of this page</a>.</p></div><h1 class=title>Engineering Blog</h1><ul><li><a href=#pg-d2907af4eee40b99185b37c862d14835>↩️ Securing communication in Transit</a></li><li><a href=#pg-9f83650680f911cdf1196dc7da645d63>Simplifying DNS Management with Cloudflare</a></li><li><a href=#pg-150760aa429cc1bbcace4b87b5543bb7>Pi goes Great with Kata 🥧</a></li><li><a href=#pg-b4a4329d01997b3d0ee04c80fb63a17b>Unlocking External Access: MetalLB Load Balancers</a></li><li><a href=#pg-f6aa6b81699a901d256e21c1d4aba12c>Mighty Pi PaaS: 🚀 Unleashing MicroK8s</a></li><li><a href=#pg-86e8fa0948914b07ec2afcbe918413fd>Becoming a Cloud Native 👽</a></li><li><a href=#pg-7cbcd0a5d05c6e088a6382ad13ca6576>🌩️ Idea Storm</a></li><li><a href=#pg-c63e62c03122896fb575e851bb4648b3>Cloud Scaffolding: The Mighty Pi 🍇</a></li><li><a href=#pg-17b6f6cbfdc05a3cfe10dc75cc790bbb>Comparing the Berries 🍓</a></li><li><a href=#pg-fd844991b634429166856789c0bb129a>Unlocking the Magic of SPAs, Static Sites, and Nuxt.js with OAuth</a></li><li><a href=#pg-b79909406be4c6c656da61022fa42743>Building a Landing Site</a></li><li><a href=#pg-28d7d6f6134801fc4c75f54f342fdb5f>What is a Cloud Anyway?</a></li></ul><div class=content></div></div><div class=td-content><h1 id=pg-d2907af4eee40b99185b37c862d14835>↩️ Securing communication in Transit</h1><div class="td-byline mb-4"><time datetime=2024-04-02 class=text-muted>Tuesday, April 02, 2024</time></div><p>Greetings tech enthusiasts and developers! Today, we continue our journey to secure services running on our Mighty Pi Cloud. This post digs into the details of ensuring we keep private communication private introducing CloudFlare using Let&rsquo;s Encrypt certificates into our setup.</p><style>aside{width:40%;padding-left:.5rem;margin-left:.5rem;float:right;box-shadow:inset 5px 0 5px -5px #29627e;font-style:italic;color:#29627e}aside>p{margin:.5rem}summary{font-weight:700;font-size:1.1em}details>summary{list-style-type:'ℹ️ ';color:#666}details[open]>summary{list-style-type:'ℹ️ ';color:#333}table{margin-left:30px}</style><img src=/images/blogs/11/eaves-dropping.jpeg alt="Home Lab" style=width:50%;display:block;margin-left:auto;margin-right:auto><br><p>The journey to secure our services running on our RPi5 MicroK8s cluster is both nostalgic and illuminating. Back in my college days, a group of us experimented with network sniffers using libpcap, a groundbreaking technology at the time. Security was a whimsical concept then — or should I say really nonexistent. Placing a computer Network Interface Card (NIC) in <a href="https://www.blumira.com/glossary/promiscuous-mode/#:~:text=Promiscuous%20mode%20is%20a%20type,adapters%20operating%20in%20this%20mode.">promiscuous mode</a> allowed us to listen to all traffic on the Local Area Network (LAN). If you can believe, most internet traffic traversed using Hypertext Transfer Protocol (HTTP), with sites often employing Basic Authentication for username and password login — essentially transmitting sensitive information in plain text across the network and around the globe! It was interesting times indeed! 😱</p><p>Fortunately, the landscape evolved, and HTTPS (Hypertext Transfer Protocol Secure) emerged as the de facto standard for web communication, with major pushes for its adoption beginning in the mid-2000s. In July of 2018 Google released <a href=https://www.thesslstore.com/blog/google-chrome-68-https-mandatory/>Chrome 68</a>, which marked all HTTP only sites as <code>"Not Secure"</code> in the browser&rsquo;s address bar. This embarrassment applied significant pressure on website owners to transition to HTTPS.</p><p>Today, ensuring that our services support HTTPS and Transport Layer Security (TLS) is monitory. HTTPS adds an essential layer of security to the standard HTTP protocol by encrypting data exchanged between clients (such as web browsers) and servers (such as websites), safeguarding sensitive information such as login credentials, credit card details, and personal healthcare information.</p><p>In this post, we explore how we enhance the CIA of our environment, but using Let&rsquo;s Encrypt certificates for TLS, and improve our security posture by adding Cloudflare in front our our platform.</p><h3 id=cloud-cia-confidentiality-integrity-and-availability>Cloud CIA: Confidentiality, Integrity, and Availability</h3><p>Before we proceed, let&rsquo;s touch on the fundamental principles of information security — <code>Confidentiality</code>, <code>Integrity</code>, and <code>Availability</code> (CIA). These principles guide the design, implementation, and maintenance of secure systems.</p><ul><li><strong>Confidentiality</strong>: focuses on ensuring that sensitive information remains accessible only to authorized individuals or systems, preventing unauthorized access or disclosure.</li><li><strong>Integrity</strong>: focuses on maintaining the accuracy and trustworthiness of data throughout its lifecycle, protecting it from unauthorized modification or corruption.</li><li><strong>Availability</strong>: focuses on ensuring that information and resources are accessible and usable when needed by authorized users, emphasizing system uptime, reliability, and recovery in the situation of massive disaster (like burning down the house).</li></ul><h3 id=transport-layer-security-tls-in-action>Transport Layer Security (TLS) in Action</h3><p>TLS is a cryptographic protocol at the heart of secure communication over networks, playing a pivotal role in keeping our data secret while in transit. It ensures privacy, data integrity, and authentication between communicating applications. Let&rsquo;s break down its key components and functionalities:</p><ul><li><strong>Encryption</strong>: TLS encrypts data exchanged between clients and servers, preventing unauthorized parties from intercepting and reading sensitive information.</li><li><strong>Data Integrity</strong>: It verifies that data remains unchanged during transmission, using cryptographic hash functions to detect any tampering attempts.</li><li><strong>Authentication</strong>: TLS allows both parties to authenticate each other&rsquo;s identities, mitigating the risk of man-in-the-middle attacks.</li><li><strong>Session Establishment</strong>: Before data exchange, TLS establishes a secure session, negotiating cryptographic algorithms and other parameters.</li></ul><h3 id=why-use-cloudflare>Why use Cloudflare?</h3><p>Using Cloudflare can significantly enhance the availability aspect of the CIA (Confidentiality, Integrity, and Availability) security triad in several ways:</p><ul><li><p><strong>DDoS Protection</strong>: Cloudflare provides robust Distributed Denial of Service (DDoS) protection, which helps ensure the availability of our services by mitigating large-scale attacks that could otherwise overwhelm your infrastructure. By leveraging Cloudflare, we can maintain the availability of our services even under heavy attack.</p></li><li><p><strong>DNS Management:</strong> Cloudflare&rsquo;s DNS management services provide advanced features such as DNSSEC (Domain Name System Security Extensions) and Anycast routing, which improve the availability and security of the DNS infrastructure. This helps us mitigate DNS-related attacks, such as DDoS attacks and DNS spoofing.</p></li></ul><p>Cloudflare&rsquo;s had a much larger, comprehensive suite of security and performance solutions - however for the purpose of this article, these two features help us achieve the CIA level protection we need.</p><h1 id=rpi5-cloud-saas-lab-design-overview>RPi5 Cloud SaaS Lab: Design Overview</h1><img src=/images/blogs/11/basic-overview.png alt="Home Lab" style=width:80%;display:block;margin-left:auto;margin-right:auto><p>Currently, our &ldquo;Might RPi Cloud Lab&rdquo; looks a lot like the diagram above. It is a cluster of Raspberry Pi5 nodes running Kubernetes - with Load Balancer support provided by MetalLB.</p><img src=/images/blogs/11/detailed-overview.png alt="Lab Design Plan" style=width:80%;display:block;margin-left:auto;margin-right:auto><p>In the diagram above, we define the plan of this blog - which is a little intimidating to look at - so lets break it down.</p><ul><li><strong>Users</strong> will gain access to the system by visiting a platform application at <code>app.codeblind.ai</code>.</li><li><strong>Cloudflare</strong> provides DNS resolution for the users, and provides the platform with DDoS protection, DNS management, Content Delivery Network (CDN), Web Application Firewall (WAF), SSL/TLS encryption, and analytics. This enables us to secure our communication and gain insights into our website traffic effortlessly.</li><li><strong>Github</strong> provides hosting for our frontend(s) which are designed as static SPA sites so they are fast, and don&rsquo;t require server side rendering.</li><li><strong>Home Router</strong> provides the cluster access to the internet, and provides a firewall for isolating the cluster network from the internet. We will configure a single port forwarding rule to allow HTTPS communications to hit any of our Kubernetes services hosted in our cluster.</li><li><strong>Let&rsquo;s Encrypt (LE)</strong> is used to provide us free x802.11 certificates for TLS encryption tied to our domain names.</li><li><strong>Certificate Issuer</strong> (or Issuers) are Kubernetes resources (CRD) that represent certificate authorities (CAs) that are able to generate signed certificates and honor certificate signing requests. Together with the <code>cert-manager</code> we can ensure the certificates are rotated automatically as we - saving us from performing the task manually.</li><li><strong>Acme</strong> is the LE extension to the Certificate Issuer which will handle the LE interaction for us.</li><li><strong>DSN-01</strong> is the extension in the Certificate Issuer which will add TXT records to the DNS management system in Cloudflare as we add new services with real domain names.</li><li><strong>Certificate</strong> is a persistent resource request for a certificate from one of the system Issuers (LE in this case). This certificate will be bound with our domain name.</li><li><strong>Ingress</strong> is point of incoming traffic, and the TLS termination endpoint for HTTPS requests. It decrypts the data and forwards it internally as HTTP traffic. In an ideal world, we would want the traffic encrypted until it reaches the target service (or musting mutual TLS between services). However that is a much more complicate setup which we will get to later.</li><li><strong>Service</strong> s a logical abstraction for a deployed group of pods in a cluster (which all perform the same function). Since pods are ephemeral, a service enables a group of pods, which provide specific functions (web services, image processing, etc.) to be assigned a name and unique IP address (Read IP in our case thanks to <a href=https://metallb.universe.tf/>MetalLB</a>).</li><li><strong>Deployment (Pods)</strong> A Deployment provides declarative updates for Pods and ReplicaSets. A ReplicaSet&rsquo;s purpose is to maintain a stable set (number) of Pods running at any given time. It is often used to guarantee the availability of a service. A Pod is a group of one or more containers, with shared storage and network resources, and a specification for how to run the containers.</li></ul><p>Putting this all together, we should be able to provide a secure and highly available API service for the frontend SPA. Let&rsquo;s get building.</p><h2 id=private-saas-cloud-lets-build-something>Private SaaS Cloud: Let&rsquo;s build something!</h2><h3 id=1-dns-provisioning>1. DNS Provisioning</h3><p>To realize the architecture above we first need to start at the CloudFlare and our Domain Name Provider.</p><p>If you don&rsquo;t have an account, create one - it is free for hobby projects (❤️ Thank you cloudflare). Next you need to configure CloudFlare to provide DNS resolution for your domain name. They have a <a href=https://developers.cloudflare.com/dns/zone-setups/full-setup/setup/>fantastic guide in their documentation</a> which has specialized instructions for most Domain Name Registrars; so I won&rsquo;t repeat it here.</p><p>Hurry and complete that configuration&mldr; I will wait 😊</p><blockquote><p><strong>Note</strong> this setup assumes you have already deployed a static site on github pages. During that process you mapped your DNS to point to your site at the registrar, and in github pages for a custom domain name (codeblind.ai in my case). When we configure SSL on Cloudflare - we would normally set <code>full or strict</code> mode to ensure no <a href="https://developers.cloudflare.com/ssl/troubleshooting/too-many-redirects/#:~:text=Redirect%20loops%20will%20occur%20if,configured%20at%20your%20origin%20server">routing loops</a>). However when using our private cloud we will run into a few issues which we resolve later. You have been warned&mldr;</p></blockquote><h3 id=2-define-port-forwarding-in-your-home-router>2. Define Port Forwarding in your Home Router</h3><p>Any guide I provide here is likely to not work for your specific case. I recommend looking at your router, and hopefully admin login information is available on a sticker on the router itself.</p><p>Once you login, with a bit of luck you will find two things:</p><ol><li>The Dynamic Host Configuration Protocol (<strong>DHCP</strong>) Classless Inter-Domain Routing (<strong>CIDR</strong>) <strong>range</strong>. Also known as the DHCP IP ranges assigned to your home network. In the earlier post when configuring metallb, you would have reduced the range so that metalLB can own a segment.</li></ol><blockquote><p><strong>Note</strong> this guide assume you have that configured correctly. Since this is our first service, metalLB will chose the first address in the reserved range.</p></blockquote><ol start=2><li><strong>Port forwarding or Firewall Configuration</strong>. Here you will make sure to port forward to the first expected IP address assigned by metalLB, and allow port 80 and 443 to pass through from any address.</li></ol><blockquote><p><strong>Note</strong> from a security standpoint, and operations standpoint this is not ideal. We don&rsquo;t want to have to isolate ranges of IPs, nor open up firewall rules for each service we deploy. In a later post we will remove this burden by using <code>Cloudflare Tunnels</code>. However that will have to wait, we are busy learning after all&mldr;</p></blockquote><h3 id=3-installing-cert-manager-on-microk8s-to-automate-certificate-management>3. Installing cert-manager on MicroK8s to automate certificate management</h3><p>Our MicroK8s cluster provides us the ability to start applications, but until now we have not needed to secure communication.</p><p>In Kubernetes, <a href=https://cert-manager.io/docs/>cert-manager</a> can be used to automate the creation of certificates for TLS workloads in our Kubernetes cluster <em>and renews the certificates before they expire.</em></p><p><code>cert-manager</code> setup on MicroK8s is a breeze, simple run:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>microk8s <span style=color:#204a87>enable</span> cert-manager
</span></span></code></pre></div><p>Alternatively (note I did this), you could use the official installation by running:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl apply -f https://github.com/jetstack/cert-manager/releases/download/v1.14.4/cert-manager.yaml
</span></span></code></pre></div><blockquote><p>This command fetches the YAML manifest for cert-manager from the official <a href=https://github.com/jetstack/cert-manager>Jetstack GitHub repository</a> and applies it to your Kubernetes cluster. Find the latest release version available, on the releases page, and replace it in URL (eg. <code>v1.14.4</code>) before running the command.This way you don&rsquo;t have to worry about an old version supplied by MicroK8S.</p></blockquote><h3 id=4-enabling-nginx-ingress-controller-for-routing-traffic-to-our-services>4. Enabling NGINX Ingress controller for routing traffic to our services.</h3><p>MicroK8s provides a ready to use NGINX <code>Ingress</code> controller. You can enable it by running:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>microk8s <span style=color:#204a87>enable</span> ingress
</span></span></code></pre></div><p>Using the built in <a href=https://kubernetes.io/docs/concepts/services-networking/ingress/>ingress</a> gives you a well configured NGINX ingress controller and a compatible internal dns configuration for network communication between pods. Note there are many different <a href=https://kubernetes.io/docs/concepts/services-networking/ingress-controllers/>ingress controllers available</a>, but NGINX will work find for what we need to accomplish today.</p><h3 id=5-configuring-a-clusterissuer-and-certificate-resource-for-lets-encrypt-integration>5. Configuring a ClusterIssuer and Certificate resource for Let&rsquo;s Encrypt integration.</h3><p><strong>So far, setup has hopefully been very easy. Now the fun begins</strong>. 🙈</p><p>We first need to create a <code>ClusterIssuer</code>. A ClusterIssuer is a microservice in the cluster which another service can use to <em>allocate</em> a certificate.</p><p>We will use Let&rsquo;s Encrypt (LE) so we get trusted certificates for free. There are two ways to get verified before a certificate is issued:</p><ol><li>HTTP challenge - which means LE must be able to hit the address requesting the certificate. We could use this since we have the github page, but I don&rsquo;t want to tie that to the backend.</li><li><a href=https://letsencrypt.org/docs/challenge-types/>DNS-01 challenge</a>. This challenge asks us to prove that we control the DNS for the domain name by putting a specific value in a TXT record under that domain name. With the correct configuration, we can have our Certificate Issuer add this TXT value itself - managing the DNS records at Cloudflare.</li></ol><h4 id=51-getting-your-cloudflare-api-token>5.1 Getting your CloudFlare API Token</h4><p>To allow the <code>ClusterIssuer</code> to modify records at Cloudflare, we must provide it with an API Key with enough permissions to modify the DNS records for the domain.</p><ol><li>Go to your <a href=https://dash.cloudflare.com/profile/api-tokens/>domain dashboard</a></li><li>Select Create Token.</li><li>Select &ldquo;Edit Zone DNS template&rdquo;
<img src=/images/blogs/11/token-creation-1.png></li><li>Configure <code>Zone:DNS:Edit</code> and <code>Include:Specific Zone:{your domain name}</code>
<img src=/images/blogs/11/token-creation-2.png></li><li>Select Continue to summary</li></ol><blockquote><p><strong>IMPORTANT</strong> save this token somewhere safe. You will need it in the next step</p></blockquote><h4 id=52-create-a-kubernetes-secret-for-the-certificateissuer>5.2 Create a Kubernetes Secret for the CertificateIssuer</h4><p>Assuming you are going to place the Certificate Issuer in the <code>cert-manager</code> namespace, do the following:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl create secret <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>        -n cert-manager <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>        generic cloudflare-api-key-secret <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>        --dry-run<span style=color:#ce5c00;font-weight:700>=</span>client <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>        -o yaml <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>        --from-literal<span style=color:#ce5c00;font-weight:700>=</span>api-key<span style=color:#ce5c00;font-weight:700>={</span>YOUR API KEY GOES HERE<span style=color:#ce5c00;font-weight:700>}</span> <span style=color:#000;font-weight:700>|</span> tee issuer-secret.yaml <span style=color:#000;font-weight:700>|</span> kubectl apply -f -
</span></span></code></pre></div><details><summary>Whats going on here</summary><ol><li><p><code>--dry-run</code> flag prepares the secret (encodes it to base64) and then the <code>-o yaml</code> outputs the yaml file configuration.</p></li><li><p>by piping to <code>tee</code> we are saving the secret for cleanup later.</p></li><li><p>by piping the output of <code>tee</code> to <code>kubectl apply</code>, we create the secret</p></li><li><p>Note, later we will reference the secret by the name <code>cloudflare-api-key-secret</code></p></li><li><p>Additionally, Notice it is added to <code>cert-manager</code> namespace. This is because _secrets are only accessible from the namespace that they are stored in. Since this is needed by the <code>cluster issuer</code>, and we place it in the <code>cert-manager</code> namespace. However you can place the secret and issuer in any namespace you like.</p></li></ol></details><details><summary>Troubleshooting Commands</summary><ol><li>To add the secret now, you can run:<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl apply -f cloudflare-secret.yaml
</span></span></code></pre></div></li><li>To list the secrets run:<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl -n cert-manager get secrets 
</span></span></code></pre></div></li><li>To list general configuration details of the secret run:<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl -n cert-manager describe secret cloudflare-api-key-secret
</span></span></code></pre></div></li><li>To decode or inspect the details of the secret run:<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl -n cert-manager get secret cloudflare-api-key-secret -o yaml
</span></span></code></pre></div></li></ol></details><h4 id=53-create-the-certificate-issuer>5.3 Create the Certificate Issuer</h4><p>Finally, we will create a <code>Certifcate Issuer</code>. Create a file called <code>cluster-issuer.yaml</code> with the following contents:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cert-manager.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterIssuer</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>letsencrypt-dns01-issuer   </span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># name for the issuer (for use when creating ingresses)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cert-manager          </span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># it will live in the cert-manager namespace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>acme</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>email</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>your.cert.registration.email@example.com</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># The email associated with allocated certificates</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>privateKeySecretRef</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>letsencrypt-dns01-private-key          </span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># key used to allow access to the issuer during certificate resource creation (used later)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>server: https://acme-staging-v02.api.letsencrypt.org/directory # NOTE: changeThis is staging - for production change to</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>https://acme-v02.api.letsencrypt.org/directory</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>solvers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>dns01</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>cloudflare</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>email</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>your.cloudflare.email@example.com </span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># the email address we use to login to cloudflare</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>apiTokenSecretRef</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cloudflare-api-key-secret          The secret we created earlier with our cloudflare API key</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>api-key</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><blockquote><p><strong>Make sure to update your <code>email addresses</code> as outlined.</strong></p></blockquote><p>Then apply the configuration to kubernetes:</p><pre tabindex=0><code>kubectl apply -f cluster-issuer.yaml
</code></pre><details><summary>Troubleshooting Commands</summary><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get clusterissuer -n cert-manager
</span></span><span style=display:flex><span>NAME                       READY   AGE
</span></span><span style=display:flex><span>letsencrypt-dns01-issuer   True    10h
</span></span></code></pre></div></details><h3 id=6-create-ou-certificate->6. Create ou Certificate 🎉</h3><p>Now for the moment of truth&mldr; Let&rsquo;s create a real certificate (resource) which we will use in our backend ingress for HTTPS and TLS.</p><p>Since our service <em>must</em> be tied to our domain name, in the Certificate definition, we must specify the domain and sub-domains for which we intend to use in the certificate. For my purposes, I am using <code>codeblind.ai</code>, and a few other sub-domains. Create a similar file names <code>certificate.yaml</code> using the guidance below:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cert-manager.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Certificate</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>codeblind-cert            </span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># some name you choose for the certificate</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>codeblind            </span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># the namespace where I want to use the certificate</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>secretName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>codeblind-tls-secret</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># Output secret location where the certificate will be places after creation</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>commonName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>codeblind.ai        </span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># our top level domain</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>dnsNames</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#000>backend.codeblind.ai        </span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># backend sub-domain</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#4e9a06>&#39;*.backend.codeblind.ai&#39;</span><span style=color:#f8f8f8;text-decoration:underline>     </span><span style=color:#8f5902;font-style:italic># wildcards for future endpoints. </span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>issuerRef</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>letsencrypt-dns01-issuer</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># the reference to the issuer we defined earlier</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterIssuer           </span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># and the issuers `kind`</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><blockquote><p>Note, if you don&rsquo;t have the namespace yet for your app, you can create it now by running:</p><p><code>kubectl create namespace &lt;add-namespace-here> --dry-run=client -o yaml | tee namespace.yaml | kubectl apply -f -</code></p></blockquote><p>Now create the certificate:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl apply -f certificate.yaml
</span></span></code></pre></div><details><summary>Troubleshooting Commands</summary><ol><li><p>Validate the certificate is created</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get certificate -n codeblind
</span></span><span style=display:flex><span>NAME             READY   SECRET                 AGE
</span></span><span style=display:flex><span>codeblind-cert   True    codeblind-tls-secret   9s
</span></span></code></pre></div></li><li><p>If <code>READY</code> is not true - we might have a configuration issue. What I normally do is look at the <code>cert-manager</code> logs:</p><ol><li><p>List the pods</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl -n cert-manager get pods
</span></span><span style=display:flex><span>NAME                                       READY   STATUS    RESTARTS      AGE
</span></span><span style=display:flex><span>cert-manager-webhook-7f9f8648b9-bz7vx      1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>             44h
</span></span><span style=display:flex><span>cert-manager-cainjector-5c5695d979-sx47r   1/1     Running   <span style=color:#0000cf;font-weight:700>6</span> <span style=color:#ce5c00;font-weight:700>(</span>26h ago<span style=color:#ce5c00;font-weight:700>)</span>   44h
</span></span><span style=display:flex><span>cert-manager-67c98b89c8-lhbbk              1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>             22h
</span></span></code></pre></div></li><li><p>Inspect the logs</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl -n cert-manager logs -f cert-manager-67c98b89c8-lhbbk
</span></span></code></pre></div></li></ol></li><li><p>Check the status of the certificate (describe):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl -n codeblind describe certificate codeblind-cert
</span></span><span style=display:flex><span>Name:         codeblind-cert
</span></span><span style=display:flex><span>Namespace:    codeblind
</span></span><span style=display:flex><span>Labels:       &lt;none&gt;
</span></span><span style=display:flex><span>Annotations:  &lt;none&gt;
</span></span><span style=display:flex><span>API Version:  cert-manager.io/v1
</span></span><span style=display:flex><span>Kind:         Certificate
</span></span><span style=display:flex><span>Metadata:
</span></span><span style=display:flex><span>  Creation Timestamp:  2024-04-02T14:51:08Z
</span></span><span style=display:flex><span>  Generation:          <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>  Resource Version:    <span style=color:#0000cf;font-weight:700>1383722</span>
</span></span><span style=display:flex><span>  UID:                 3721465a-8ca9-4480-8ef4-529b5f11437f
</span></span><span style=display:flex><span>Spec:
</span></span><span style=display:flex><span>  Common Name:  backend.codeblind.ai
</span></span><span style=display:flex><span>  Dns Names:
</span></span><span style=display:flex><span>    backend.codeblind.ai
</span></span><span style=display:flex><span>    *.backend.codeblind.ai
</span></span><span style=display:flex><span>  Issuer Ref:
</span></span><span style=display:flex><span>    Kind:       ClusterIssuer
</span></span><span style=display:flex><span>    Name:       letsencrypt-dns01-issuer
</span></span><span style=display:flex><span>  Secret Name:  codeblind-tls-secret
</span></span><span style=display:flex><span>Status:
</span></span><span style=display:flex><span>  Conditions:
</span></span><span style=display:flex><span>    Last Transition Time:  2024-04-02T14:51:08Z
</span></span><span style=display:flex><span>    Message:               Certificate is up to date and has not expired
</span></span><span style=display:flex><span>    Observed Generation:   <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>    Reason:                Ready
</span></span><span style=display:flex><span>    Status:                True
</span></span><span style=display:flex><span>    Type:                  Ready
</span></span><span style=display:flex><span>  Not After:               2024-07-01T02:54:35Z
</span></span><span style=display:flex><span>  Not Before:              2024-04-02T02:54:36Z
</span></span><span style=display:flex><span>  Renewal Time:            2024-06-01T02:54:35Z
</span></span><span style=display:flex><span>Events:                    &lt;none&gt;
</span></span></code></pre></div></li><li><p>Check the certificate key material is <strong><em>in the secret</em></strong>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl -n codeblind describe secret codeblind-tls-secret
</span></span><span style=display:flex><span>Name:         codeblind-tls-secret
</span></span><span style=display:flex><span>Namespace:    codeblind
</span></span><span style=display:flex><span>Labels:       controller.cert-manager.io/fao<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>true</span>
</span></span><span style=display:flex><span>Annotations:  cert-manager.io/alt-names: *.backend.codeblind.ai,backend.codeblind.ai
</span></span><span style=display:flex><span>              cert-manager.io/certificate-name: codeblind-cert
</span></span><span style=display:flex><span>              cert-manager.io/common-name: backend.codeblind.ai
</span></span><span style=display:flex><span>              cert-manager.io/ip-sans:
</span></span><span style=display:flex><span>              cert-manager.io/issuer-group:
</span></span><span style=display:flex><span>              cert-manager.io/issuer-kind: ClusterIssuer
</span></span><span style=display:flex><span>              cert-manager.io/issuer-name: letsencrypt-dns01-issuer
</span></span><span style=display:flex><span>              cert-manager.io/uri-sans:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Type:  kubernetes.io/tls
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>Data</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>====</span>
</span></span><span style=display:flex><span>tls.crt:  <span style=color:#0000cf;font-weight:700>3793</span> bytes
</span></span><span style=display:flex><span>tls.key:  <span style=color:#0000cf;font-weight:700>1675</span> bytes
</span></span></code></pre></div></li></ol></details><p>If all went well, you now have a certificate <code>READY</code> to use.</p><h3 id=8-setting-up-ssl-modes-on-cloudflare>8. Setting up SSL modes on Cloudflare</h3><p>Before we go further, we need to check out the <a href=https://developers.cloudflare.com/ssl/origin-configuration/ssl-modes/>SSL mode setting in cloudflare</a>.According to the documenation, we should be using either <code>full or strict</code>.</p><p>What you might notice once you enable <code>full or strict</code> is that when you open your github page in the browser (for example <a href=https://codeblind.ai>https://codeblind.ai</a>) - it will work just fine. However if you set it to <code>flexible</code> it will not render and in the debugger tab you might notice error <a href="https://developers.cloudflare.com/ssl/troubleshooting/too-many-redirects/#:~:text=Redirect%20loops%20will%20occur%20if,configured%20at%20your%20origin%20server">&ldquo;ERR_TOO_MANY_REDIRECTS&rdquo;</a>.). So we know we must have full or strict set for our site(s) to keep working.</p><p>However if you deploy the application, and try to send it a <code>curl</code> request - you will receive a 523 error. I am saying this early because we need (for now) to configure a special rule to allow <code>flexible mode</code> while taking to the backend. The backend will still be using HTTPS and the LetsEncrypt certificate, however cloudflare did not seem to work for me with strict mode. (I likely made a mistake, but let&rsquo;s move on).</p><ol><li>In the Cloudflare Domain console, goto <code>SSL</code> &ndash;> <code>Configuration Rules</code> page.
<img src=/images/blogs/11/ssl-config-rules.png></li><li>Next create a new rule
<img src=/images/blogs/11/config-rule-1.png></li><li>Give the rule a name
<img src=/images/blogs/11/config-rule-2.png></li><li>Configure a <code>custom filter</code> so that all SSL/HTTPS request destined for the backend domain name will activate this rule. Also turn on HTTPS rewrites to remove any HTTP from going to our backend.
<img src=/images/blogs/11/config-rule-3.png></li><li>Finally - and really importantly - set the SSL option to <code>flexible</code>. This is the setting which solves our 523 HTTP Error Code. Then click deploy.
<img src=/images/blogs/11/config-rule-4.png></li></ol><h3 id=9-deploying-a-service-with-tls-termination-at-the-ingress>9. Deploying a service with TLS termination at the Ingress</h3><p>Finally, we can now deploy our backend service. Below is an example service I use for testing which lives in my private repository (thus the secret). Below the manifest deployment, I will discuss the critical elements of the <code>Ingress</code> as that is the most important element which will terminate our HTTPS sessions.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Secret</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>kubernetes.io/dockerconfigjson</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ghcrcred</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>codeblind</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>data</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>.dockerconfigjson</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>YOUR-REDACTED-REPO-PRIVATE-KEY</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>---</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>apps/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Deployment</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>codeblind</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>codeblind</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>codeblind</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>selector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>codeblind</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>replicas</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>template</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>codeblind</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>runtimeClassName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>kata</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>imagePullSecrets</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ghcrcred</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>containers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>codeblind</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>image</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ghcr.io/codeblind-ai/echo:0.0.2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>ports</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#204a87;font-weight:700>containerPort</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>8080</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>---</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Service</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>codeblind-backend</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>codeblind</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>codeblind-backend</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>LoadBalancer</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>selector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>codeblind</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>ports</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>80</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>standard</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>targetPort</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>8080</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>protocol</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>TCP</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>---</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>networking.k8s.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Ingress</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>codeblind-ingress</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>codeblind</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>cert-manager.io/issuer</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>letsencrypt-dns01-issuer</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>tls</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>hosts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#000>backend.codeblind.ai</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>secretName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>codeblind-tls-secret</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># cert output of our certificate (resource) we created earlier</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>host</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>backend.codeblind.ai</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>http</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>paths</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span>- <span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>pathType</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Prefix</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>backend</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>service</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>codeblind-backend</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                  </span><span style=color:#204a87;font-weight:700>number</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>80</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>In the <code>Ingress</code> configuration I want you to notice a few things:</p><ol><li>the ingress TLS setting specifies the hostname which we are terminating.</li><li>the secret <code>codeblind-tls-secret</code> <strong>matches</strong> the name used in during the <strong>certificate creation</strong>. This is where the certificate material lives after a successful certificate creation.</li></ol><p>Let&rsquo;s deploy it!</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kube apply -f deployment.yaml
</span></span></code></pre></div><p>Once deployed, things should be working. Let&rsquo;s give it a test:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -X POST https://backend.codeblind.ai/hello -d <span style=color:#4e9a06>&#39;Mighty-Pi&#39;</span>
</span></span></code></pre></div><p>If everything worked, you should see a success response with <code>"Hello, Mighty-Pi"</code>.</p><p>I will skip the summary, as this was kind of a long an involved post - but I hope it all worked for you. In the next post - I will be establishing Tunnels and Origin Certificates to allow us to remove the special SSL configuration rules, remove the port forwarding on our router, and prevent IP based DDoS attacks on our infrastructure. Stay tuned!</p></div><div class=td-content style=page-break-before:always><h1 id=pg-9f83650680f911cdf1196dc7da645d63>Simplifying DNS Management with Cloudflare</h1><div class=lead>Cloudflare stands as a titan among internet networks, renowned for enhancing the security and performance of websites and online services. It tackles the challenges that once plagued website owners, offering a suite of features designed to make online content faster, safer, and more reliable.</div><div class="td-byline mb-4"><time datetime=2024-03-22 class=text-muted>Friday, March 22, 2024</time></div><p>In the early days of the internet, loading a website was a straightforward process: your request traveled to a server, which then delivered the requested page. However, when too many requests flooded a server, it could crash, leaving visitors stranded. Cloudflare emerged to tackle these issues head-on, leveraging a robust edge network to deliver content and services as swiftly as possible, ensuring users receive information without delay.</p><p>Moreover, Cloudflare provides robust security measures, safeguarding internet properties from various malicious activities, including DDoS attacks and intrusive bots. Additionally, features like SSL and content distribution are seamlessly integrated into Cloudflare&rsquo;s offerings, benefiting millions of internet properties worldwide.</p><h1 id=the-importance-of-dns-management>The Importance of DNS Management</h1><p>DNS (Domain Name System) management is crucial for directing internet traffic to the correct destinations. Cloudflare simplifies this process, offering a comprehensive DNS service that enhances security and performance.</p><h2 id=protecting-against-ddos-attacks>Protecting Against DDoS Attacks</h2><p>DDoS (<a href=https://www.cloudflare.com/learning/ddos/what-is-a-ddos-attack/>Distributed Denial of Service</a>) attacks pose a significant threat to online services, disrupting operations by overwhelming servers with malicious traffic. Cloudflare&rsquo;s DDoS mitigation operates in four stages:</p><ol><li><strong>Detection:</strong> Identifying and distinguishing legitimate traffic from attack traffic.</li><li><strong>Response:</strong> Intelligently dropping malicious bot traffic while absorbing the rest.</li><li><strong>Routing:</strong> Efficiently directing manageable traffic chunks to prevent denial of service.</li><li><strong>Adaptation:</strong> Analyzing traffic patterns to fortify against future attacks.</li></ol><h2 id=examples-of-ddos-attacks>Examples of DDoS Attacks</h2><ul><li><a href=https://www.cloudflare.com/learning/ddos/what-is-an-ack-flood/>ACK Flood DDoS Attack</a>: Overloads servers with TCP ACK packets, crippling their ability to serve legitimate users.</li><li><strong>DNS Amplification Attack</strong>: Exploits open DNS resolvers to inundate target servers with amplified traffic, rendering them inaccessible.</li></ul><h2 id=simplifying-dns-setup-with-cloudflare>Simplifying DNS Setup with Cloudflare</h2><p>Transitioning your domain&rsquo;s DNS management to Cloudflare is a straightforward process, offering enhanced security and performance benefits. Here&rsquo;s how to do it:</p><h3 id=1-sign-up-with-cloudflare>1. Sign Up with Cloudflare</h3><p>First you will need to <a href=https://www.cloudflare.com/plans/>create a Cloudflare account</a>. You will be presented with a set of plans to chose from. Since we are building a hobby project, I recommend starting with the <code>free</code> plan as show:
<img src=/images/blogs/10/cloudflare_01.png></p><h3 id=2-enable-cloudflare-for-your-domain>2. Enable Cloudflare for your domain</h3><p><img src=/images/blogs/10/cloudflare_02.png></p><p>Click the <code>Add a Site</code> button in Cloudflare to add your domain.</p><p><img src=/images/blogs/10/cloudflare_03.png>
Enter your site name, and click <code>Continue</code></p><h3 id=3-select-the-subscription-level>3. Select the subscription level</h3><p>Since we are building a hobby site - we will select the <code>free</code> option and <code>Continue</code>.</p><p><img src=/images/blogs/10/cloudflare_04.png></p><h3 id=4-record-the-name-server-entires-you-will-need-to-configure-namecheap>4. Record the name server entires you will need to configure Namecheap</h3><p><img src=/images/blogs/10/cloudflare_05.png></p><h3 id=5-update-the-registrar-dns-settings>5. Update the Registrar DNS settings</h3><p>We are using namecheap, so we can login and go to the management dashboard for our domain.
<img src=/images/blogs/10/namecheap_01.png></p><p>Here we will update the <code>NAMESERVERS</code> configuration, selecting <code>Custom DNS</code>.</p><p><img src=/images/blogs/10/namecheap_02.png></p><p>Here we will update the <code>NAMESERVERS</code> configuration, selecting <code>Custom DNS</code>.</p><p><img src=/images/blogs/10/namecheap_03.png></p><p>Next we enter the data we collected in step 4.
<img src=/images/blogs/10/namecheap_04.png></p><p>Then click save - and we should see a success banner.
<img src=/images/blogs/10/namecheap_05.png></p><h3 id=6-update-dns-in-cloudflare>6. Update DNS in Cloudflare</h3><p>By now, we should see a success banner in Cloudflare as well.</p><p><img src=/images/blogs/10/cloudflare_06.png></p><p>Navigate to the DNS settings, and add two <code>CNAME</code> records for your github pages site as shown:</p><p><img src=/images/blogs/10/cloudflare_07.png></p><p>Thats it! We are all done. The site should be working as it was before!</p><h1 id=summary>Summary</h1><p>We learned how to quickly add strong DDoS protection to our site using Cloudflare. Next we will setup TLS for our services using Let&rsquo;s Encrypt and Cloudflare. Stay tuned!</p></div><div class=td-content style=page-break-before:always><h1 id=pg-150760aa429cc1bbcace4b87b5543bb7>Pi goes Great with Kata 🥧</h1><div class=lead>Previously we built a Kubernetes cluster on Raspberry Pi 5. Now we will unlock security and efficiency with Kata Containers on Kubernetes.</div><div class="td-byline mb-4"><time datetime=2024-03-18 class=text-muted>Monday, March 18, 2024</time></div><style>aside{width:40%;padding-left:.5rem;margin-left:.5rem;float:right;box-shadow:inset 5px 0 5px -5px #29627e;font-style:italic;color:#29627e}aside>p{margin:.5rem}summary{font-weight:700;font-size:1.1em}details>summary{list-style-type:'✅ ';color:#666}details[open]>summary{list-style-type:'🟩 ';color:#333}table{margin-left:30px}</style><p>Kata Containers offers a game-changing solution to the security and performance challenges faced in containerized environments. By seamlessly integrating lightweight VMs with Kubernetes, Kata Containers empowers developers to achieve unprecedented levels of security and efficiency.</p><p>Key Features include:</p><ol><li>Enhanced isolation and security through lightweight VMs</li><li>Sub-second boot times</li><li>Hardware virtualization</li><li>Support for multiple hypervisors</li><li>GPU passthrough</li></ol><p>In this post, we provide a step-by-step configuring of <a href=https://katacontainers.io/docs/getting-started/kubernetes/>Kata Containers on Kubernetes</a>.</p><h2 id=prerequisites>Prerequisites</h2><p>Previously in the series we&rsquo;ve creates a Kubernetes cluster on Raspberry Pi 5. If you haven&rsquo;t done so, please refer to the previous posts.</p><h2 id=adding-kata-containers-to-kubernetes>Adding Kata Containers to Kubernetes</h2><details open><summary>1. Install Kata Containers</summary><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>wget https://raw.githubusercontent.com/kata-containers/kata-containers/main/utils/kata-manager.sh
</span></span><span style=display:flex><span>chmod +x kata-manager.sh
</span></span><span style=display:flex><span>./kata-manager.sh -o
</span></span></code></pre></div></details><details open><summary>2. Determine the available HyperVisor</summary><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./kata-manager.sh -L
</span></span></code></pre></div><p>You should expect the following output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>clh	-	packaged	golang
</span></span><span style=display:flex><span>dragonball	-	packaged	golang
</span></span><span style=display:flex><span><span style=color:#204a87>fc</span>	-	packaged	golang
</span></span><span style=display:flex><span>qemu	default	packaged	golang
</span></span><span style=display:flex><span>qemu-nvidia-gpu	-	packaged	golang
</span></span><span style=display:flex><span>qemu-sev	-	packaged	golang
</span></span><span style=display:flex><span>qemu-snp	-	packaged	golang
</span></span><span style=display:flex><span>qemu-tdx	-	packaged	golang
</span></span></code></pre></div><blockquote><p>Notice by default we have <code>qemu</code> as the default hypervisor</p></blockquote></details><details open><summary>3. Install QEMU</summary><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt install qemu-system
</span></span></code></pre></div></details><details open><summary>4. Update the containerd configuration</summary><h4 id=we-are-overwriting-the-current-containerd-configuration>We are <strong>overwriting</strong> the current containerd configuration</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo cat <span style=color:#4e9a06>&lt;&lt;EOF &gt; /etc/containerd/config.toml
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>version = 2
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>[plugins]
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  [plugins.&#34;io.containerd.grpc.v1.cri&#34;]
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    [plugins.&#34;io.containerd.grpc.v1.cri&#34;.containerd]
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      no_pivot = false
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      [plugins.&#34;io.containerd.grpc.v1.cri&#34;.containerd.runtimes]
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        [plugins.&#34;io.containerd.grpc.v1.cri&#34;.containerd.runtimes.runc]
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          privileged_without_host_devices = false
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          runtime_type = &#34;io.containerd.runc.v2&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          [plugins.&#34;io.containerd.grpc.v1.cri&#34;.containerd.runtimes.runc.options]
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            BinaryName = &#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            CriuImagePath = &#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            CriuPath = &#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            CriuWorkPath = &#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            IoGid = 0
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        [plugins.&#34;io.containerd.grpc.v1.cri&#34;.containerd.runtimes.kata]
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          runtime_type = &#34;io.containerd.kata.v2&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          privileged_without_host_devices = true
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          pod_annotations = [&#34;io.katacontainers.*&#34;]
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          container_annotations = [&#34;io.katacontainers.*&#34;]
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          [plugins.&#34;io.containerd.grpc.v1.cri&#34;.containerd.runtimes.kata.options]
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            ConfigPath = &#34;/opt/kata/share/defaults/kata-containers/configuration.toml&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    [plugins.&#34;io.containerd.grpc.v1.cri&#34;.cni]
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      conf_dir = &#34;/etc/cni/net.d&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span></code></pre></div><h4 id=now-restart-containerd>Now restart containerd</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo systemctl stop containerd
</span></span><span style=display:flex><span>sudo systemctl daemon-reload
</span></span><span style=display:flex><span>sudo systemctl start containerd
</span></span><span style=display:flex><span>sudo systemctl status containerd
</span></span></code></pre></div></details><details open><summary>5. Enable Kata Containers Runtime Class</summary><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat <span style=color:#4e9a06>&lt;&lt;EOF &gt; runtime.yaml
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>apiVersion: node.k8s.io/v1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>kind: RuntimeClass
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  name: kata
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>handler: kata
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubectl apply -f runtime.yaml
</span></span></code></pre></div></details><details open><summary>6. Redeploy PingPong using kata containers and QEMU</summary><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat <span style=color:#4e9a06>&lt;&lt;EOF &gt; pingpong-service.yaml
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>apiVersion: v1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>kind: Namespace
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  name: ping
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>---
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>apiVersion: apps/v1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>kind: Deployment
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  name: ping
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  namespace: ping
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  labels:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    app: ping
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>spec:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  selector:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    matchLabels:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      app: ping
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  replicas: 2
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  template:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      labels:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        app: ping
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    spec:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      runtimeClassName: kata
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      containers:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        - name: ping
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          image: dasralph/ping:arm64_0.0.5
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          ports:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            - containerPort: 8080
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>---
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>apiVersion: v1
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>kind: Service
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>metadata:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  name: ping
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  namespace: ping
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  labels:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    app: ping
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>spec:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  type: LoadBalancer
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  selector:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    app: ping
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  ports:
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    - port: 80
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      targetPort: 8080
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      protocol: TCP
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>---
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubectl apply -f pingpong-service.yaml
</span></span></code></pre></div><p>Check that the nodes are running:</p><pre tabindex=0><code>kubectl get pods -n ping -o wide
</code></pre></details><details open><summary>7. Check hypervisor is running</summary><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ps aux <span style=color:#000;font-weight:700>|</span> grep qemu
</span></span></code></pre></div><p>Expected output looks similar to the following:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ps aux <span style=color:#000;font-weight:700>|</span> grep qemu
</span></span><span style=display:flex><span>root       <span style=color:#0000cf;font-weight:700>83180</span>  6.3  1.6 <span style=color:#0000cf;font-weight:700>2730640</span> <span style=color:#0000cf;font-weight:700>135824</span> ?      Sl   02:16   0:02 /opt/kata/bin/qemu-system-aarch64 -name sandbox-26519d5f8744b3d582b81dd8986b591d055bf3debcd2e498e5947efb4abe60d7 -uuid...
</span></span></code></pre></div></details><h3 id=conclusion>Conclusion</h3><p>Enabling Kata Containers is a game-changer for security and performance; not to mention not terribly hard. We&rsquo;ve seen how to install Kata Containers, determine the available hypervisor, install QEMU, update the containerd configuration, enable Kata Containers Runtime Class, and redeploy PingPong using Kata Containers and QEMU.</p><p>Stay tuned for more on how to leverage Kata Containers using Firecracker as the VM hypervisor.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-b4a4329d01997b3d0ee04c80fb63a17b>Unlocking External Access: MetalLB Load Balancers</h1><div class=lead>In our Kubernetes journey, we&rsquo;ve ventured into the realm of deploying services within our Mighty Raspberry Pi 5 cluster. However, we encountered a common challenge: the inability to access these services externally. Kubernetes, by default, provides internal cluster IPs for services, but this doesn&rsquo;t facilitate external accessibility.
Metallb is a solution to implement kubernetes services of type <strong>LoadBalancer</strong> when there is no cloud provider to do that for you.
Are you ready? I know, I am! Let&rsquo;s dive in!</div><div class="td-byline mb-4"><time datetime=2024-03-16 class=text-muted>Saturday, March 16, 2024</time></div><p>Kubernetes <em>does</em> provide internal cluster IPs for services, but these IPs are only accessible within the cluster itself. When you deploy a service of type <code>LoadBalancer</code> in Kubernetes, it typically relies on a cloud provider&rsquo;s load balancer to expose the service externally. However, in environments like our Mighty Raspberry Pi 5 cluster where there is no built-in cloud infrastructure, you need an alternative solution to expose services externally.</p><p>This is where MetalLB comes in. MetalLB serves as a load balancer for Kubernetes clusters, bridging the gap between internal and external accessibility. It seamlessly assigns external IP addresses to services of type LoadBalancer, enabling external traffic to reach our cluster and be directed to the appropriate pods. But how do we unleash the power of MetalLB in our non-cloud environment?</p><h2 id=ip-addresses>IP Addresses</h2><p>MetalLB doesn&rsquo;t create IP addresses out of thin air. You must give it pools of IP addresses that it can manage. MetalLB will take care of assigning and recycling individual addresses as services come and go, but it will only ever hand out IPs that are part of its configured pools.</p><p>How - or where - you get IP address pools for MetalLB depends on your environment. If you’re running a bare-metal cluster in a collocation facility, your hosting provider probably offers IP addresses for lease. In our case, we have a home router, so we must login to the administrative console an restrict the DHCP address range assigned by our router - to create a pool which can be managed by MetalLB.</p><h2 id=does-this-cause-problems-routing-problems>Does this cause problems routing problems?</h2><p>That is a great question reader! Typically your home router router acts as the DHCP server for your home LAN, assigning IP addresses to authorized devices, and advertise that assignment of IP to MAC using a Layer 2 mode (ARP/NDP) protocol.</p><p>MetalLB supports both <code>BGP</code> and <code>Layer 2 ARP</code> Advertisement so our PaaS plays nice with out home network.</p><p>If you had a larger environment, such as in a co-location, you might consider BGP. But for our purposes that is overkill.</p><h2 id=does-layer-2-cause-bottlenecks-in-routing>Does Layer 2 cause bottlenecks in routing?</h2><p>Astute networking question! Layer 2 mode has two main limitations you should be aware of when it comes to Kubernetes.</p><ol><li>In layer 2 mode, a <strong>single leader-elected node</strong> handles all traffic for a service IP. This means that the ingress bandwidth of your service is restricted to the capacity of a single node, which can become a bottleneck.</li><li><strong>Failover</strong> between nodes in layer 2 mode relies on client cooperation. When failover occurs, MetalLB sends out &ldquo;gratuitous&rdquo; layer 2 packets to inform clients of the change in MAC address associated with the service IP.</li></ol><p>During unplanned failover, service IPs may become unreachable until problematic clients update their cache entries.</p><pre class=mermaid>sequenceDiagram
    participant MetalLB
    participant Node1
    participant Node2
    participant Client
    MetalLB-&gt;&gt;Node1: Single-node bottlenecking
    MetalLB-&gt;&gt;Node2: Single-node bottlenecking
    MetalLB-&gt;&gt;Client: Potentially slow failover
    Client-&gt;&gt;Node1: Delayed cache update
    Node1-&gt;&gt;Client: Forward traffic
    Client-&gt;&gt;Node2: Updated cache
    Node2-&gt;&gt;Client: Forward traffic</pre><p>Hopefully this background information is enlightening, let&rsquo;s setup Metal LB and see how it work!</p><h1 id=metal-lb-quick-start>Metal LB Quick Start</h1><h2 id=1-home-router-preparation>1. Home Router Preparation</h2><p>Before diving into MetalLB configuration, it&rsquo;s essential to ensure we have a pool of IP addresses available. In our home network scenario, this involves tweaking the DHCP settings on our router to reserve a block of addresses for MetalLB management.</p><h2 id=11-log-into-your-router>1.1. Log into your Router</h2><p>Login to your Router as <code>admin</code>. This information is typically listed on a sticker on your router. If not, you may need to read the documentation for your router, or contact your ISP for help.
<img src=/images/blogs/9/router-1.png></p><h2 id=12-update-the-dhcp-settings>1.2. Update the DHCP Settings</h2><p>Navigate to the DHCP settings, typically found under Advanced -> IP Addresses -> DHCP Settings on most routers.</p><p>We will configure the DHCP to reserve a block of addresses within the <code>192.168.1.X</code> range, which falls under Class-C private IP addresses as defined by RFC 1918 for private network use.</p><p>In a standard IPv4 network, with one IP address reserved for the network identifier and another for broadcast, it leaves 254 IP addresses available for devices. Thus, the subnet can accommodate a maximum of 254 devices.</p><p>To ensure efficient IP address allocation, we&rsquo;ll limit the router to assigning addresses between <code>192.168.1.2</code> and <code>192.168.1.64</code>, allowing for up to 62 devices.</p><p>This allocation strategy frees up addresses from <code>192.168.1.65</code> to <code>192.168.1.250</code>, which we&rsquo;ll assign to MetalLB for managing addresses in our cluster.</p><p><img src=/images/blogs/9/router-2.png></p><p>From a security perspective, it&rsquo;s crucial to implement LAN segmentation to isolate devices within a network. However at this time we will <code>Keep it Simple</code> - and visit that topic in another post.</p><h2 id=2-metallb-installation>2. MetalLB Installation</h2><p>With our IP pool secured, it&rsquo;s time to install MetalLB. A simple command on our master node - microk8s enable metallb - sets the stage for MetalLB&rsquo;s magic.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>microk8s <span style=color:#204a87>enable</span> metallb
</span></span></code></pre></div><h2 id=3-address-allocation>3. Address Allocation</h2><p>MetalLB requires explicit instructions on IP address allocation. By creating a YAML file specifying our IP address range and applying it to our platform, we empower MetalLB to manage these addresses effectively.</p><p>Create a file named <code>metallb-address-pool.yaml</code> as follows:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># addresspool.yaml</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>---</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>metallb.io/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>IPAddressPool</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>custom-addresspool</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>metallb-system</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>addresses</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#0000cf;font-weight:700>192.168.1.65-192.168.1.254</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><blockquote><p><strong>IMPORTANT:</strong> don&rsquo;t forget to use the IP address range you reserved on your router!</p></blockquote><p>Now apply this using to your platform:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl apply -f metallb-address-pool.yaml
</span></span></code></pre></div><h2 id=5-network-advertisement-mode>5. Network Advertisement Mode</h2><p>In our discussion, we explored the nuances of Layer 2 mode and its implications for our network environment. We ensured smooth integration by addressing potential bottlenecks and failover challenges.</p><p>Luckily for us we installed Microk8s which has already configured everything for us! So there is nothing to do! 🎉</p><blockquote><p>For everyone else, I will direct you to the <a href=https://metallb.org/installation/>documentation</a>.</p></blockquote><h2 id=6-validation-witnessing-metallb-in-action>6. Validation: Witnessing MetalLB in Action</h2><p>With MetalLB configured, it&rsquo;s time to put it to the test. We will deploy a sample service and marveled as MetalLB seamlessly assigned an external IP address to it. Through meticulous validation steps, from checking service assignments to verifying ARP advertisements, we confirmed the robustness of our setup.</p><h3 id=61-defined-a-service>6.1 Defined a service</h3><p>Create a file named <code>hello-deployment.yaml</code> with the following content:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>apps/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Deployment</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>echo-deployment</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>replicas</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>selector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>echo-server</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>template</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>echo-server</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>containers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>echo-server</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>image</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hashicorp/http-echo</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>ports</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>http-port</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>containerPort</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>5678</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>---</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Service</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>echo-service</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>LoadBalancer</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>ports</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>http-port</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>80</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>targetPort</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>http-port</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>protocol</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>TCP</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>selector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>echo-server</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Notice the <code>type: LoadBalancer</code> specified in the service? This activates MetalLB to assign a new IP address to the service externally!</p><p>We can apply this and do some validation.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl apply -f hello-deployment.yaml
</span></span><span style=display:flex><span>deployment.apps/echo-deployment created
</span></span></code></pre></div><h3 id=62-check-the-service-was-assigned-an-ip-address>6.2 Check the service was assigned an IP address</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get services
</span></span><span style=display:flex><span>NAME               TYPE           CLUSTER-IP       EXTERNAL-IP    PORT<span style=color:#ce5c00;font-weight:700>(</span>S<span style=color:#ce5c00;font-weight:700>)</span>                      AGE
</span></span><span style=display:flex><span>echo-service       LoadBalancer   10.152.183.167   192.168.1.66   80:31136/TCP                 7s
</span></span></code></pre></div><p>Notice we got an External IP address of <code>192.168.1.66</code>!</p><h3 id=63-verify-the-advertisement>6.3 Verify the Advertisement</h3><p>We can verify the ARP advertisement by running the following:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ arp -a
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>? <span style=color:#ce5c00;font-weight:700>(</span>192.168.1.66<span style=color:#ce5c00;font-weight:700>)</span> at 2c:cf:67:19:72:6e on en0 ifscope <span style=color:#ce5c00;font-weight:700>[</span>ethernet<span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><h3 id=63-now-lets-check-the-service-is-accessible>6.3 Now let&rsquo;s check the service is accessible</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ curl http://192.168.1.66
</span></span><span style=display:flex><span>hello-world
</span></span></code></pre></div><p>Great - it is all working! 🎉🎉🎉</p><h1 id=conclusion-a-new-frontier>Conclusion: A New Frontier</h1><p>Armed with MetalLB, we&rsquo;ve unlocked a new frontier in our Kubernetes journey. External accessibility is no longer a barrier, and our cluster stands ready to face new challenges. As we bid farewell to this chapter, we look forward to the next leg of our adventure, armed with newfound knowledge and determination.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-f6aa6b81699a901d256e21c1d4aba12c>Mighty Pi PaaS: 🚀 Unleashing MicroK8s</h1><div class=lead>Let&rsquo;s embarking on an exhilarating journey to transform our RPi 5 private cloud infrastructure into an operational PaaS using Kubernetes; or canning the cloud as I like to call it. We will be setting up a Kubernetes version named MicroK8s. MicroK8s is a powerful and lightweight Kubernetes cluster for all your container orchestration needs.
Are you ready? I know, I am! Let&rsquo;s dive in!</div><div class="td-byline mb-4"><time datetime=2024-03-15 class=text-muted>Friday, March 15, 2024</time></div><p>Infrastructure as a Service (IaaS) is a cloud computing model that provides users with virtualized computing resources such as servers, storage, networking, and virtualization on-demand over the internet.</p><p>Platform as a Service (PaaS) is a cloud computing model that offers a complete development and deployment environment in the cloud. It provides developers with tools and resources to build, deploy, and manage applications without having to worry about underlying infrastructure management.</p><p>At this stage, we are setting up a working Kubernetes cluster on our Raspberry Pi 5, which serves as our IaaS foundation. Kubernetes enables us to access computing resources such as servers, networking, and compute (containers) on our Pi cluster.</p><p>With Kubernetes installed, we can deploy and manage containers and services on our cluster. Additionally, we can access these services from our home network, laying the groundwork for our IaaS infrastructure.</p><p>MicroK8s is a lightweight and easy-to-use Kubernetes distribution that is perfect for running on resource-constrained environments like Raspberry Pi. In this guide, we&rsquo;ll walk through the process of setting up a MicroK8s cluster on Raspberry Pi devices, enabling you to harness the power of Kubernetes for your projects.</p><h2 id=prerequisites>Prerequisites</h2><p>Before we begin, ensure you have the following:</p><ul><li>Raspberry Pi devices (at least two for setting up a cluster)</li><li>Ubuntu 23.04 LTS installed and configured</li><li>Internet connectivity on Raspberry Pi devices</li><li>Basic familiarity with the command line interface</li></ul><h2 id=1-update-the-operating-system-packages>1. Update the Operating System Packages</h2><p>Ensure your Raspberry Pi devices are up to date and have necessary packages installed:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt update
</span></span><span style=display:flex><span>sudo apt upgrade
</span></span><span style=display:flex><span>sudo apt install linux-modules-extra-raspi
</span></span></code></pre></div><h2 id=2-configure-network-settings>2. Configure Network Settings</h2><p>Use <a href=https://netplan.io/>Netplan</a> to configure network settings to ensure connectivity.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Set up Ethernet connection (if not already enabled)</span>
</span></span><span style=display:flex><span>sudo ip link <span style=color:#204a87>set</span> dev eth0 up
</span></span><span style=display:flex><span>sudo dhclient eth0 -v
</span></span><span style=display:flex><span>sudo vi /etc/netplan/50-cloud-init.yaml
</span></span><span style=display:flex><span>sudo netplan apply
</span></span></code></pre></div><h2 id=2-disable-swap>2. Disable Swap</h2><p>Disabling swap in Kubernetes environments is crucial for maintaining performance, stability, and effective resource management by preventing unnecessary swapping of memory to disk..</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo dphys-swapfile swapoff
</span></span><span style=display:flex><span>sudo dphys-swapfile uninstall
</span></span><span style=display:flex><span>sudo apt purge -y dphys-swapfile
</span></span><span style=display:flex><span>sudo apt autoremove -y
</span></span></code></pre></div><h2 id=3-configuring-the-kernel-cgroup-support>3. Configuring the Kernel CGroup Support</h2><ol><li><p>enable cgroups in the kernel by running the following command:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo sed -i <span style=color:#4e9a06>&#39;/^console.*=BL/s/$/ cgroup_enable=cpuset cgroup_enable=memory cgroup_memory=1/&#39;</span> /boot/firmware/cmdline.txt
</span></span></code></pre></div></li><li><p>now reboot the RPi to activate these settings:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo reboot
</span></span></code></pre></div></li></ol><h2 id=4-installing-microk8s>4. Installing MicroK8s</h2><p>Install MicroK8s using Snap:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo snap install microk8s --classic
</span></span></code></pre></div><h2 id=5-configure-the-microk8s-user-without-requiring-sudo>5. Configure the MicroK8s user without requiring sudo:</h2><p>After navigating to the home directory and creating the <code>.kube</code> directory, use the microk8s config command to configure the MicroK8s user settings.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>cd</span> <span style=color:#000>$HOME</span>
</span></span><span style=display:flex><span>mkdir .kube
</span></span><span style=display:flex><span><span style=color:#204a87>cd</span> .kube
</span></span><span style=display:flex><span>sudo microk8s config &gt; config
</span></span></code></pre></div><h2 id=6-configure-the-user-for-microk8s>6. Configure the User for MicroK8s</h2><p>Configure the a microk8s group so sudo is not required by the user:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo usermod -aG microk8s <span style=color:#4e9a06>&#34;</span><span style=color:#000>$USER</span><span style=color:#4e9a06>&#34;</span>
</span></span></code></pre></div><blockquote><p>If you are provisioning more than one RPi 5 to be part of the cluster, such as in my case I have five, you will want to repeat steps 1 through 6 on each RPi.</p></blockquote><h2 id=7-clustering-workers>7. Clustering Workers</h2><p>Decide which Raspberry Pi will be the master and which ones will be workers. Add worker nodes to the cluster.</p><ol><li><p>On the master node run the following command to identify the worker join command:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>microk8s add-node
</span></span></code></pre></div><p>Example output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>From the node you wish to join to this cluster, run the following:
</span></span><span style=display:flex><span>microk8s join 192.168.1.56:25000/0f112c22f3bbdb062abaab9a3d65c0a2f/421deadbeef
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Use the <span style=color:#4e9a06>&#39;--worker&#39;</span> flag to join a node as a worker not running the control plane, eg:
</span></span><span style=display:flex><span>microk8s join 192.168.1.56:25000/0f112c22f3bbdb062abaab9a3d65c0a2f/421deadbeef --worker
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>If the node you are adding is not reachable through the default interface you can use one of the following:
</span></span><span style=display:flex><span>microk8s join 192.168.1.56:25000/0f112c22f3bbdb062abaab9a3d65c0a2f/baddeadbeef
</span></span><span style=display:flex><span>microk8s join 192.168.1.57:25000/0f112c22f3bbdb062abaab9a3d65c0a2f/421deadbeef
</span></span></code></pre></div></li><li><p>Since we are only adding workers, and don&rsquo;t plan to add more controller nodes, we only want to run the following command from above on each worker:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>microk8s join 192.168.1.56:25000/0f112c22f3bbdb062abaab9a3d65c0a2f/421deadbeef --worker
</span></span></code></pre></div><blockquote><p>note you will get a different value for <code>microk8s join &lt;master-ip>:25000/&lt;token>/&lt;hash> --worker</code></p></blockquote></li><li><p>Validate the nodes have joined the cluster</p><pre tabindex=0><code>$ microk8s kubectl get nodes
 NAME    STATUS     ROLES    AGE   VERSION
 pi5p0   Ready      &lt;none&gt;   18d   v1.28.7
 pi5p1   Ready      &lt;none&gt;   18d   v1.28.7
 pi5p2   Ready      &lt;none&gt;   18d   v1.28.7
 pi5p3   Ready      &lt;none&gt;   18d   v1.28.7
 pi5p4   Ready      &lt;none&gt;   18d   v1.28.7
</code></pre></li></ol><blockquote><p>Each node should be listed and ready</p></blockquote><h2 id=7-configuring-aliases>7. Configuring Aliases</h2><p>Set up aliases for easier command-line usage.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;alias kubectl=&#39;microk8s kubectl&#39;&#34;</span> &gt;&gt; ~/.bashrc
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;alias ctr=&#39;ctr kubectl&#39;&#34;&#34; &gt;&gt; ~/.bashrc
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>source ~/.bashrc
</span></span></span></code></pre></div><blockquote><p>I recommend doing this on all nodes.</p></blockquote><h2 id=enabling-add-ons>Enabling Add-ons</h2><p>Enable essential add-ons for your MicroK8s cluster, such as the dashboard, DNS, and community.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo microk8s <span style=color:#204a87>enable</span> dashboard dns community
</span></span></code></pre></div><h2 id=test-your-deployment>Test your deployment</h2><p>Deploy a hello world application and verify its status.</p><ol><li><p>Deploy a hello world application</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl create deployment hello-node --image<span style=color:#ce5c00;font-weight:700>=</span>registry.k8s.io/e2e-test-images/agnhost:2.39 -- /agnhost netexec --http-port<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>8080</span>
</span></span></code></pre></div></li><li><p>Check to see if the pod is ready</p><pre tabindex=0><code>kubectl get deployments
</code></pre></li></ol><blockquote><p>note sometimes it may take a second to pull the image</p></blockquote><ol start=3><li>Inspect the pods<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get pods
</span></span></code></pre></div></li><li>Check the events of the deployment<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get events
</span></span></code></pre></div></li></ol><h1 id=summary>Summary</h1><p>In this guide, we&rsquo;ve successfully transformed our Raspberry Pi 5 devices into a powerful Kubernetes cluster using MicroK8s. By following the step-by-step instructions, we&rsquo;ve laid the foundation for our PaaS infrastructure, enabling us to deploy and manage containerized applications with ease. We&rsquo;ve learned how to configure network settings, install MicroK8s, add worker nodes, and enable essential add-ons.</p><p>Next, we&rsquo;ll explore adding the MetalLB add-on and configuring our Home Router to expose our services to our LAN, taking our PaaS infrastructure to the next level. Stay tuned for more exciting developments in our journey to canning clouds with Raspberry Pi!</p></div><div class=td-content style=page-break-before:always><h1 id=pg-86e8fa0948914b07ec2afcbe918413fd>Becoming a Cloud Native 👽</h1><div class=lead>This is the first installment of building a private cloud, in your home, using Raspberry Pi 5s. Together we will learn the value of cloud native technologies, and how to build a cloud from the ground up. I also want to dedicate this to the amazing team at NetPlane who taught me so much about networking and virtualization (see dedication below).</div><div class="td-byline mb-4"><time datetime=2024-03-10 class=text-muted>Sunday, March 10, 2024</time></div><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><style>aside{width:40%;padding-left:.5rem;margin-left:.5rem;float:right;box-shadow:inset 5px 0 5px -5px #29627e;font-style:italic;color:#29627e}aside>p{margin:.5rem}summary{font-weight:700;font-size:1.1em}details>summary{list-style-type:'✅ ';color:#666}details[open]>summary{list-style-type:'🟩 ';color:#333}table{margin-left:30px}</style><p>💡 My journey to Cloud Native started over 24 years. In the early days, I built backbone networking protocols, switch and router virtualization software for Netplane systems right out of college. This was before <a href=https://en.wikipedia.org/wiki/Software-defined_networking>SDN</a> was a thing. Later we built blade server and rack hardware. This gave me a keep at the hardware level of Datacenters - which is the foundation of this blog series.</p><p>Later I was lucky enough to work on both hardware and cloud infrastructure virtualization software enabling multi-tenancy of racks and data centers at a little company called Egenera. Goldman Sachs funded us, and if not for our virtualization technology - a lot of data would have been lost in Sept of 2001. <em>Note this was way before AWS was even on the map!</em></p><p>These days, I spend most of my time working with cloud native technologies. To achieve these deep learnings, earned in nearly a quarter century, came at great cost. There was no ChatGPT or Google like we know them today. Everything was in books or in the minds of my peers. I had to work for every bit (pun intended).</p><p>Lucky for you&mldr; I am going to share my secrets over the course of a few blog posts, so you can be a cloud native too. Let&rsquo;s Go! 🚀</p><hr><h1 id=engineering-by-the-numbers->Engineering by the Numbers 🧮</h1><p><i>Before we jump off, let&rsquo;s talk a little about money.</i> 🤑</p><p>As an Engineer, it is important to understand the costs of my designs. A bad design is expensive, or hard to own. Depending on what the market is willing to pay for my service, makes the difference between being profitable, or looking for a new job.</p><p>When I worked Cisco, my role was Product & Security Architecture. I enjoyed doing system level design work, and spreading knowledge to engineers across 63 teams! That is no light task! I will take a start-up over that any day! 😅 But that is another topic.</p><p>📣 <i><u><b>The goal, of any product, is to generate a 90% margin at a minimum; hopefully much more.</b></u> This base number is designed to cover all development, marketing, administrative, sales, and delivery costs. If the market is willing to pay $10 per-user per-year for our service; as an engineer I must do everything possible to ensure running the service costs less than $1 per-user per-year to run.</i> This is not including people costs, but a bad design which causes a lot in people hours to own is a similar story.</p><p>This sounds way easier than it really is 🙈, and unfortunately <em>most young engineers</em> don&rsquo;t think this way. Dazzled by the shiny new tech, they forget the incremental additional costs and find themselves surprised when the business if failing and cutting jobs.</p><p>I always try to keep the 90% rule in mind when designing a system, and remember to measure&mldr; everything. Because after all, if you are not making money&mldr; it is just a hobby.</p><p>Thus research the market, identify the value of your service, and engineer accordingly. It guarantees Uncle Sam gets his slice of your heaven, and you can innovate with your pals keeping everyone gainfully employed. 🚀</p><h2 id=what-we-are-building>What we are Building</h2><p>We will be making a <a href="https://aws.amazon.com/compare/the-difference-between-public-cloud-and-private-cloud/#:~:text=In%20a%20private%20cloud%2C%20a,%2C%20data%20storage%2C%20and%20CPU.">Private Cloud</a> in our office (aka the living room). The diagram below shows the base foundation of our &ldquo;data center&rdquo;. Although we start with a single node, which is not much of a cloud, we will expand it over the course of the coming blog posts.</p><img src=/images/blogs/7/rpi5-cloud.png style=width:90%;display:block;margin-left:auto;margin-right:auto><p>Before building anything, let&rsquo;s start by looking at the cost analysis of running a private cloud (at home).</p><details open><summary>1. Identify the cost of Electricity</summary><p>I looked at my power bill, and can quickly identify a the cost of electricity per kWh:</p><table><thead><tr><th>Description</th><th>Rate</th></tr></thead><tbody><tr><td>Power Generation Cost</td><td>0.39924/kW</td></tr><tr><td>Power Distribution Cost</td><td>0.59444/kW</td></tr><tr><td>Total Charge per kWh</td><td>0.99368/kW</td></tr></tbody></table><blockquote><p><em>Expectedly these values will vary depending on where you live, and in some cases, the time of the day. I live in Brasil, and these are the local rates in the NE. Note all calculations unless specified are in Brasilain Real, which is 1/5 the value of the USD. However $5 Real here buys what $5 USD buys in the US. So all thing being equal&mldr;You can find your rates on your power bill.</em></p></blockquote></details><details open><summary>2. Computing the cost of running a single machine</summary><br><p><strong>Calculate Power Requirement using the formula:</strong></p><p>$$
\begin{flalign*}
& \text{kWh} = \frac{\text{Power (Watts)} \times \text{Time (hours)}}{1000} &
\end{flalign*}
$$</p><blockquote><p>Given that the <code>RPi5 has a 27W power supply requirement</code> and we will use it for 24 hours a day, the calculation would be:</p></blockquote><p>$$
\begin{flalign*}
& \text{kWh} = \frac{27 \text{ Watts} \times 24 \text{ hours}}{1000} = 0.648 \text{ kW/day } &
\end{flalign*}
$$</p><br><p><strong>Calculate Total Cost using the formula:</strong></p><p>$$
\begin{flalign*}
& \text{Total Cost} = \text{kWh} \times \text{Price per kWh} &
\end{flalign*}
$$</p><blockquote><p>Let&rsquo;s say the price per kWh is $0.99368 as in my case, then:</p></blockquote><p>$$
\begin{flalign*}
& \text{Total Cost} = 0.648 \text{ kWh } \times $0.99368R = $0.64354R \text{ per day } &
\end{flalign*}
$$</p><p><strong>SUMMARY</strong></p><table><thead><tr><th>Description</th><th>Charge</th></tr></thead><tbody><tr><td>⚡ per Node(hr)</td><td>$0.0027R/hr</td></tr><tr><td>⚡ per Node(day)</td><td>$0.0648R/day</td></tr><tr><td>⚡ per Node(month)</td><td>$1.971R/month</td></tr><tr><td>⚡ per Node(year)</td><td>$23.652R/year</td></tr><tr><td>⚡ kWh/day</td><td>0.65 kWh/day</td></tr></tbody></table><p>Thus, if we wanted to create a Cloud using 15 machines, we are looking at the following costs:</p><ul><li><p>$$
\begin{flalign*}
& \text{Total Cost} = 15 \text{ nodes } \times $0.0648\text{ day} = $0.772\text{ day } &
\end{flalign*}
$$</p></li><li><p>$$
\begin{flalign*}
& \text{Total Cost} = 15 \text{ nodes } \times $1.9\text{ mo } = $29.55\text{ mo } &
\end{flalign*}
$$</p></li><li><p>$$
\begin{flalign*}
& \text{Total Cost} = 15 \text{ nodes } \times $23.65\text{ mo } = $354.75\text{ mo } &
\end{flalign*}
$$</p></li></ul><blockquote><p>Are we done? Heck No! We have other costs too which should be accounted for! We need to calculate the bootstrapping costs (sunken costs) of various hardware and services.</p></blockquote></details><details open><summary>3. The internet is a series of Pipes</summary><p>No cloud would be possible without the internet&mldr; and we need to provide access to our cloud.</p><p>Here in Brasil, the average internet service costs around $100 Real per month, which is approximately $20 USD, for nearly a 1Gbs service. The nice thing about this is, it is a fixed cost and does not change with the number of nodes unlike running in a public cloud provider. We will just hit the QoS wall, and slow down to allowed rates.</p><p>I have a 900 Mega download and 450 Mega upload connection for $109.99 Real. Incoming traffic is limited to 900Mbps (ingress), and outgoing traffic is limited to 450Mbps (egress). Thus, like any good PaaS, we must calculate the cost of bandwidth &ndash; focusing on egress costs &ndash; in our bandwidth cost calculations:</p><ul><li><p>$$
\begin{flalign*}
& \text{Seconds in a year} = 24 \times 60 \times 60 \times 365 = 31,536,000\text{ sec per year } &
\end{flalign*}
$$</p></li><li><p>$$
\begin{flalign*}
& \text{Total Gb per year} = 0.45 \text{ Gbps } \times 31,536,000\text{s} = 14,191,200 \text{ Gb per year } &
\end{flalign*}
$$</p></li><li><p>$$
\begin{flalign*}
& \text{Total Gb per mo} = 14,191,200 \text{ Gby } / 12 = 1,182,600 \text{ Gb per mo } &
\end{flalign*}
$$</p></li><li><p>$$
\begin{flalign*}
& \text{Total GB per mo} = 1,182,600 \text{ Gbm } / 8 = 148,325 \text{ GB per mo } &
\end{flalign*}
$$</p></li><li><p>$$
\begin{flalign*}
& \text{Cost per Gb} = \frac{$109.99 \text{ per mo }}{1,182,600 \text{ Gb/mo}} = $0.0000930069 \text{ per Gb } &
\end{flalign*}
$$</p></li><li><p>$$
\begin{flalign*}
& \text{Cost Per GBh} = 0.0000930069 \text{ cost per GB} \times 3600 \text{ seconds in hour} = $0.33455448 \text{ per GBh} &
\end{flalign*}
$$</p></li></ul><p><strong>SUMMARY</strong></p><table><thead><tr><th>Description</th><th>Rate</th></tr></thead><tbody><tr><td>Cost per Gb</td><td>$0.0000930069</td></tr><tr><td>Cost per GB (x8)</td><td>$0.0007440535</td></tr><tr><td>Bandwidth Gb/hour possible</td><td>1620</td></tr><tr><td>Bandwidth GB/hour possible</td><td>202.5</td></tr><tr><td>Cost per hour @ max speed</td><td>$0.1506708378</td></tr></tbody></table><p>Thus, the cost of traffic alone is cheap when compared to a public cloud provider! Albeit if we did this at scale we&rsquo;d need a bigger pipe! Especially because traffic is typically spiky.</p><p>To put this in perspective, the cost of traffic <em>using AWS&rsquo;s pricing calculator &ndash; as of March 2024&ndash; AWS’s monthly data transfer costs for outbound data to the public internet in Sõa Paulo region are $0.15 per GB for the first 10 TB.</em></p><blockquote><p>Thus for the same 1620Gbh, is 202.5GBh (which his how AWS calculates) costing:</p></blockquote><p>$$202.5 \text{GB} \times 0.15\text{USD per GB} = $30.275 \text{USD per hour!}$$</p><p>Converting to Real, this is approximately $151.88 Real per hour. <em>This is a significant cost savings for the same amount of bits!</em></p><p>Our savings using local internet, theoretically, is saving us $121.88 Real per hour, or $2,925.12R per day, or $1,067,668.8R per year. 🤯🤯🤯 Especially since we have a fixed cost of <code>$109.99 * 12 = $1319.99 per year</code>. We blow past that in a few hours on AWS at max capacity!</p><blockquote><p>Obviously these calculations are theoretical; and unlikely to mirror reality. Operate at max capacity all the time on our local ISP provided internet may attract unwanted attention. But the idea is sound, and more importantly the take away is that the cost of traffic is significant. <em>As we design services, we need to be conscious of the cost of traffic; crafting our APIs to deliver the most value at the least amount of traffic as these costs add up quickly.</em></p></blockquote></details><details open><summary>4. Hosting Domain and Routing Costs</summary><p>With any cloud, we want a hosting domain (eg. <code>app.domain.com</code>) where we can reach any of our services.</p><p>I have a domain name that I use for my personal website. I pay $70 per year for it, since it is a <code>.ai</code> domain, but one can be acquired for much lower.</p><p>This is a fixed yearly cost. So amortizing this over 365 days * 24 hours, the costs about $0.008 per hour. This is a fixed cost and does not change with the number of nodes. Furthermore, depending on the domain provider, you can get DNS routing for free. Thus for DNS (unlike Route53) we will not have a cost to wire in our domain names.:</p><p><strong>SUMMARY</strong></p><table><thead><tr><th>Description</th><th>Rate</th></tr></thead><tbody><tr><td>Cost/Domain(hr)</td><td>$0.008/hr</td></tr></tbody></table></details><details open><summary>5. Sunken hardware costs</summary><p>Hardware is a sunken cost. However the cost can be amortized over the life of the hardware. The RPi5 is expected to last 5 years - but we are likely to replace it as soon at the RPi6 comes out.</p><p><strong>SUMMARY</strong></p><table><thead><tr><th>Description</th><th>Features</th><th>Cost</th></tr></thead><tbody><tr><td>1 RPi5 w/ 8GB kit</td><td>* Raspberry Pi 5<br>* Quad-Core Arm Cortex-A76 processor at 2.4GHz<br>* Samsung EVO+ 128GB MicroSD Card pre-loaded with Raspberry Pi OS<br>* CanaKit Turbine Case for the Pi 5<br>* CanaKit MEGA Heat Sink for the Pi 5<br>* CanaKit Low-Noise PWM Fan for the Pi 5<br>* USB-C PD Power Supply (Black or White)<br>* Set of 2 Micro HDMI to HDMI Cables (6-foot each)<br></td><td>$159</td></tr><tr><td>1TB MicroSDxC upgrade</td><td>more memory for disk (since we will use containers)</td><td>$139.99</td></tr><tr><td>Tax</td><td>10% in Washington state (for Uncle Sam)</td><td>$29.99</td></tr><tr><td>Total</td><td>Expected cost for 1 node</td><td>$328.98 USD</td></tr><tr><td>Total R</td><td>Expected cost for 1 node in Real</td><td>$1644.90R</td></tr><tr><td>Cost per month</td><td>2 years duty cycle</td><td>$13.7075 USD/month</td></tr><tr><td>Cost per month</td><td>2 years duty cycle</td><td>$68.5375 R/month</td></tr><tr><td>Cost per day</td><td>2 years duty cycle</td><td>$2.65947802 R/day</td></tr><tr><td>Cost per day</td><td>2 years duty cycle</td><td>$0.09414492 R/hr</td></tr></tbody></table></details><h2 id=cost-summary>COST SUMMARY</h2><p>All of these little things add up. Here is a summary of our operational costs</p><table><thead><tr><th>Cost Bucket</th><th>Description</th><th>Rate/mo (in real)</th><th>Rate/mo (in USD)</th></tr></thead><tbody><tr><td>Machine ($/mo)</td><td>hardware ($68.54R) and power ($1.97R)</td><td>$70.51R per mo</td><td>$14.102 per mo</td></tr><tr><td>Bandwidth ($/mo)</td><td>internet ($109.99R)</td><td>$109.99R per mo</td><td>$21.998 per mo</td></tr><tr><td>Domain ($/mo)</td><td>domain ($0.008R/hr)</td><td>$5.824R per mo</td><td>$1.1648 per mo</td></tr><tr><td><strong>Total ($/mo)</strong></td><td></td><td><strong>$186.324R per mo</strong></td><td><strong>$37.2648 per mo</strong></td></tr></tbody></table><hr><h1 id=now-lets-compare-against-aws>Now, let&rsquo;s compare against AWS</h1><p>The diagram below outlines the simplest of AWS deployments. We will compare the costs of running a similar service in AWS. However like any comparison, it is not apples to apples. We are comparing a single node to a shared instance. We are also comparing a local ISP to AWS&rsquo;s hyperplane network. But it is a good starting point to understand the costs of running a cloud in your home.</p><img src=/images/blogs/7/aws-cloud.png style=width:90%;display:block;margin-left:auto;margin-right:auto><details open><summary>1. EC2 Compute Costs</summary><p>The hardest part of AWS is finding the comparison of ec2 instance with the RPi5. The RPi5 is a 4 core 1.8GHz processor with 8GB of memory. The following AWS EC2 in Sõa Paulo region are available:</p><table><thead><tr><th>Instance name</th><th>On-Demand hourly rate</th><th>vCPU</th><th>Memory</th><th>Storage</th><th>Network performance</th></tr></thead><tbody><tr><td>c4.xlarge</td><td>$0.309 USD/hr</td><td>4</td><td>7.5 GiB</td><td>EBS Only</td><td>High</td></tr><tr><td>c6in.xlarge</td><td>$0.3486 USD/hr</td><td>4</td><td>8 GiB</td><td>EBS Only</td><td>Up to 30000 Megabit</td></tr><tr><td>c6g.xlarge</td><td>$0.2096 USD/hr</td><td>4</td><td>8 GiB</td><td>EBS Only</td><td>Up to 10 Gigabit</td></tr><tr><td>inf1.xlarge</td><td>$0.377 USD/hr</td><td>4</td><td>8 GiB</td><td>EBS Only</td><td>Up to 25 Gigabit</td></tr><tr><td>c5d.xlarge</td><td>$0.298 USD/hr</td><td>4</td><td>8 GiB</td><td>1 x 100 NVMe SSD</td><td>Up to 10 Gigabit</td></tr><tr><td>c6gn.xlarge</td><td>$0.266 USD/hr</td><td>4</td><td>8 GiB</td><td>EBS Only</td><td>Up to 25 Gigabit</td></tr><tr><td>c5ad.xlarge</td><td>$0.268 USD/hr</td><td>4</td><td>8 GiB</td><td>1 x 150 NVMe SSD</td><td>Up to 10 Gigabit</td></tr><tr><td>c6a.xlarge</td><td>$0.2358 USD/hr</td><td>4</td><td>8 GiB</td><td>EBS Only</td><td>Up to 12500 Megabit</td></tr><tr><td>c7i.xlarge</td><td>$0.2751 USD/hr</td><td>4</td><td>8 GiB</td><td>EBS Only</td><td>Up to 12500 Megabit</td></tr><tr><td>c6i.xlarge</td><td>$0.262 USD/hr</td><td>4</td><td>8 GiB</td><td>EBS Only</td><td>Up to 12500 Megabit</td></tr><tr><td>c6gd.xlarge</td><td>$0.238 USD/hr</td><td>4</td><td>8 GiB</td><td>1 x 237 NVMe SSD</td><td>Up to 10 Gigabit</td></tr><tr><td>c5a.xlarge</td><td>$0.236 USD/hr</td><td>4</td><td>8 GiB</td><td>EBS Only</td><td>Up to 10 Gigabit</td></tr><tr><td>c5.xlarge</td><td>$0.262 USD/hr</td><td>4</td><td>8 GiB</td><td>EBS Only</td><td>Up to 10 Gigabit</td></tr></tbody></table><blockquote><p>Note 1: These are on demand pricing, and we could get a better rate for a commitment.</p><p>Note 2: These are shared instances, not dedicated hardware. Dedicated instance pricing is MUCH higher.</p><p>Note 3: Since the RPi5 is a 4 core 1.8GHz processor with 8GB of memory and the closest/cheapest match is the <code>c6g.xlarge</code>; I am using for the comparison for lack of a better ability to match one-to-one for equal performance per cost.</p></blockquote><p><strong>Doing the math using the calculator, the monthly cost of our ec2 instance for the month is: $153.01 USD</strong>.</p></details><details open><summary>2. EBS Storage Cost (1TB)</summary><p>We allocated 1TB of storage per node. The cost of 1TB of EBS storage in Sõa Paulo region for SSD is as follows:</p><ul><li><strong>Storage amount:</strong> <code>1 TB x 1024 GB in a TB = 1024 GB</code></li><li><code>1 volumes x 730 instance hours = 730.00 total instance hours</code></li><li><code>730.00 instance hours / 730 hours in a month = 1.00 instance months</code></li><li><code>1,024 GB x 1.00 instance months x 0.19 USD = 194.56 USD (EBS Storage Cost)</code></li></ul><p>Holy Mary, Mother of God! That is expensive! And worse we are dealing with Network attached storage which is slower (even at AWS hyperplane speeds). We will use the SD card storage. This is a significant savings! 🤯</p></details><details open><summary>3. Data Transfer Costs</summary>Here is where things get really spicy. No matter what we will be paying $0.15USD per GB egress in SP. _Using AWS pricing calculator -- as of March 2024-- AWS’s monthly data transfer costs for outbound data to the public internet in Sõa Paulo region for 148325GB/mo:<ul><li>Internet: Tiered pricing for 148325 GB:</li><li>10240 GB x 0.15 USD per GB = 1536.00 USD</li><li>40960 GB x 0.138 USD per GB = 5652.48 USD</li><li>97125 GB x 0.126 USD per GB = 12237.75 USD</li><li><strong>Data Transfer cost (monthly): 19,426.23 USD</strong></li></ul><p>I just died a little inside. 😭 But this is not strange, <a href=https://medium.com/life-at-chime/how-we-reduced-our-aws-bill-by-seven-figures-5144206399cb>others experience this problem too</a>! So much so, there are <a href=https://fck-nat.dev/v1.3.0/>entire projects dedicates</a> to working the egress costs as low as possible.</p><blockquote><p>Note, we are not likely to fill the entire pipe of our local ISP, and it is unlikely we will use this much egress traffic costs from our AWS account. However it is important to pay attention to this problem. It is a significant cost, and it is a cost that is not present in our local ISP provided internet.</p></blockquote></details><details open><summary>4. IP Address Costs</summary><p>Assuming we have exactly 1 and use a reverse proxy to handle all of our traffic, the cost of 1 in-use public IPv4 address in Sõa Paulo region is as follows:</p><ul><li><code>1 in-use public IPv4 address x 730 hours in a month x 0.005 USD = 3.65 USD (Total In-use public IPv4 address charge)</code></li></ul></details><h2 id=summary>Summary</h2><p>The theoretical cost per month to run our AWS environment is: <code>$19,777.44 USD</code>.
The theoretical cost per month to run our Pi5 environment is: <code>$37.26 USD</code>.</p><aside><img src=/images/blogs/7/wasted.gif style=width:45%;display:block;margin-left:auto;margin-right:auto></aside><p>Even if we ignore the egress costs and disk costs of AWS completely, the cost of running a single node in AWS is 530 times more expensive than running a single node in our home. We&rsquo;d be shelling out <code>$153.01 USD per month</code> for <code>1 ec2 instance</code>.</p><p>Where as our entire setup at this time only costs us $37.26 USD per month.</p><p>This signifies a savings of $115.75 USD per month, or $1,389 USD per year. 🤯 I can buy my kid a bike with that kind of loot!</p><hr><h3 id=special-dedication>Special Dedication</h3><hr><img src=/images/blogs/7/netplane.jpeg style=width:75%;display:block;margin-left:auto;margin-right:auto><hr><p>I have fond memories of my time at Netplane. Those years grew my skills - but not without the help of many mentors along the way. Working with my colleges were transformational in my skills and approach to life.</p><p><strong>We were changing the world &ndash; without even knowing it.</strong></p><ol><li>All those years ago making networking stacks, which were reused over and over again, and I bet, are still in use today.</li><li>We virtualized networking stacks with our PowerCode (java script engine) which allowed us to virtualize routers and control & data plane switching on 800MHz pentiums when everyone else was doing it on bare metal. For the audience, this was back in 2001 when such things didn&rsquo;t really exist yet.</li><li>Those experiments lead to what I believe was the first of it&rsquo;s kind Video streaming (RTSP) over MPLS for NTT DoCoMo.</li></ol><p>To all my friends <a href=https://www.linkedin.com/in/deepak-shahane-2a588212/>Deepak</a>, <a href=https://www.linkedin.com/in/grovor/>Anil</a>, <a href=https://www.linkedin.com/in/stephen-atkinson/>Steve #1</a> and <a href=https://www.linkedin.com/in/stephen-mills-bb286915/>Steve #2</a>, <a href=https://www.linkedin.com/in/bill-herbst-8b61498/>Bill #1</a> and <a href=https://www.linkedin.com/in/bill-friedeborn-64100a12/>Bill #2</a>, <a href=https://www.linkedin.com/in/alan-kullberg-3054148/>Alan</a>, <a href=https://www.linkedin.com/in/brucemayer/>Bruce</a>, <a href=https://www.linkedin.com/in/debileach/>Debi</a>, <a href=https://www.linkedin.com/in/nancy-stoddard-guardione-30b9ab9/>Nancy</a>, <a href=https://www.linkedin.com/in/mark-monet-396a9710/>Mark</a>, <a href=https://www.linkedin.com/in/seth-miller-8247063/>Seth</a>, and the rest of the gang; I want to say <em><strong>Thank You</strong></em>. <em><strong>Your mentorship and friendship meant the world to me. Thanks for taking a chance on a kid from the sticks of Washington state. Because of you, here I am.</strong></em></p></div><div class=td-content style=page-break-before:always><h1 id=pg-7cbcd0a5d05c6e088a6382ad13ca6576>🌩️ Idea Storm</h1><div class=lead>After preparing my RPi5 for use, I had an idea&mldr;</div><div class="td-byline mb-4"><time datetime=2024-03-06 class=text-muted>Wednesday, March 06, 2024</time></div><p><img src=/images/blogs/6/pi-cloud-overview.png></p><p>As I set up my new RPi5s, a bolt of inspiration struck me — what if I could create a real-ish cloud lab using only Raspberry Pi 5s and free resources? The possibilities are endless!</p><p>Imagine the thrill of building your own cloud infrastructure from scratch, all while saving a ton in cloud costs. Picture the hands-on learning opportunities as we delve into security best practices and platform building techniques. This is not just a project; it&rsquo;s an adventure waiting to unfold!</p><p>The diagram above is just a glimpse of what&rsquo;s to come as we embark on this journey together. But I need your help to make it happen! Join me as we push the boundaries of what&rsquo;s possible with Raspberry Pi and free resources. Together, we&rsquo;ll build something truly extraordinary.</p><h2 id=could-we-make-our-own-paas-using-kubernetes>Could We Make Our Own PaaS using Kubernetes?</h2><p><img src=/images/blogs/6/paas-overview.png></p><p>As we embark on our journey to build a Raspberry Pi cloud lab, the idea of creating our own Platform as a Service (PaaS) using Kubernetes is both thrilling and ambitious.</p><p>Imagine having the power to deploy, manage, and scale applications effortlessly, all within the confines of our Raspberry Pi cluster. Kubernetes, with its robust orchestration capabilities, provides the perfect foundation for such an endeavor.</p><p>By harnessing the capabilities of Kubernetes, we can transform our Raspberry Pi cluster into a fully functional PaaS, offering developers the tools they need to deploy their applications seamlessly. From containerized workloads to automated scaling, our PaaS built on Kubernetes will empower developers to focus on building great software without worrying about the underlying infrastructure.</p><p>But how exactly might this work? Stay tuned as we explore the intricacies of deploying Kubernetes on Raspberry Pi and configuring it to function as a PaaS. Together, we&rsquo;ll uncover the possibilities and challenges of building our own PaaS solution from scratch.</p><p>Get ready to dive deeper into the world of cloud-native technologies and unlock the full potential of our Raspberry Pi cloud lab. The journey ahead promises to be both exhilarating and enlightening—let&rsquo;s make it happen!</p></div><div class=td-content style=page-break-before:always><h1 id=pg-c63e62c03122896fb575e851bb4648b3>Cloud Scaffolding: The Mighty Pi 🍇</h1><div class=lead>The new Raspberry Pi 5 is a powerful little computer. I purchased a few for local development purposes, and to help me maintain my lower level skills, as well as for building bigger things. It&rsquo;s a great platform for learning about cloud native technologies. In this post, we&rsquo;ll set up a Raspberry Pi 5 for the first time. Let&rsquo;s get started!</div><div class="td-byline mb-4"><time datetime=2024-03-05 class=text-muted>Tuesday, March 05, 2024</time></div><style>aside{width:40%;padding-left:.5rem;margin-left:.5rem;float:right;box-shadow:inset 5px 0 5px -5px #29627e;font-style:italic;color:#29627e}aside>p{margin:.5rem}summary{font-weight:700;font-size:1.1em}details>summary{list-style-type:'✅ ';color:#666}details[open]>summary{list-style-type:'🟩 ';color:#333}table{margin-left:30px}</style><h2 id=prerequisites>Prerequisites</h2><p>Before we begin, make sure you have the following:</p><ul><li><input disabled type=checkbox> A laptop or workstation</li><li><input disabled type=checkbox> 1 - Raspberry Pi 5 (I recommend the 8G version)</li><li><input disabled type=checkbox> 1 - Micro SD card (at least 128GB)</li><li><input disabled type=checkbox> 1 - Micro SW card reader/writer</li><li><input disabled type=checkbox> 1 - 27W USB-C power supply</li><li><input disabled type=checkbox> 1 - 40mm fan</li><li><input disabled type=checkbox> 1 - RPi5 case</li><li><input disabled type=checkbox> 1 - Active Head Sink</li><li><input disabled type=checkbox> An internet connection (hopefully a reasonable speed)</li><li><input disabled type=checkbox> Admin login access to your router</li></ul><h2 id=raspberry-pi-5-assembly>Raspberry Pi 5 Assembly</h2><details open><summary>1. Unbox the Raspberry Pi 5</summary><p>This is the exciting part. Unbox the Raspberry Pi 5 and take a moment to appreciate the beauty of this tiny computer.</p><img src=/images/blogs/5/rp5-board-1.png alt="Raspberry Pi 5" style=width:70%;display:block;margin-left:auto;margin-right:auto></details><details open><summary>2. Attach the heat sink to the board</summary><p>This is an important step. The new RPi5 can get very hot. It&rsquo;s important to keep it cool.</p><img src=/images/blogs/5/rp5-board-2.png alt="Raspberry Pi 5" style=width:70%;display:block;margin-left:auto;margin-right:auto></details><details open><summary>3. Attach fan and place the board in the case!</summary><img src=/images/blogs/5/rp5-board-3.png alt="Raspberry Pi 5" style=width:70%;display:block;margin-left:auto;margin-right:auto></details><details open><summary>4. Download an install the Raspberry PI OS Installer</summary><p>The installer is available on the <a href=https://www.raspberrypi.com/software/>Raspberry Pi website</a>. Download the installer and install it onto your laptop or work station.</p></details><h2 id=flashing-raspberry-pi-os>Flashing Raspberry Pi OS</h2><details open><summary>1. Open the Raspberry Pi OS Installer</summary><img src=/images/blogs/5/rpi5-os-install-1.png alt="Raspberry Pi 5" style=width:70%;display:block;margin-left:auto;margin-right:auto></details><details open><summary>2. Select the Raspberry Pi Device</summary><p>This is an important step. The new RPi5 can get very hot. It&rsquo;s important to keep it cool.</p><img src=/images/blogs/5/rpi5-os-install-2.png alt="Raspberry Pi 5" style=width:70%;display:block;margin-left:auto;margin-right:auto></details><details open><summary>3. Select the Operating System</summary>**For Raspberry Pi 4 or 5 I recommend the current Ubuntu 23.04 LTS.** This will allow us to deploy Canonical's MicroK8s which is much simpler to use than a Kubeadm installed Kubernetes.</details><details open><summary>4. Select the Storage Media</summary><img src=/images/blogs/5/rpi5-os-install-4.png alt="Raspberry Pi 5" style=width:70%;display:block;margin-left:auto;margin-right:auto></details><details open><summary>4. Click Next, then `Edit Settings`</summary><img src=/images/blogs/5/rpi5-os-install-5-edit-1.png alt="Raspberry Pi 5" style=width:70%;display:block;margin-left:auto;margin-right:auto></details><details open><summary>5. Configure the default values for first Boot</summary><img src=/images/blogs/5/rpi5-os-install-5-edit-2.png alt="Raspberry Pi 5" style=width:70%;display:block;margin-left:auto;margin-right:auto><ol><li>Make sure you set the hostname</li><li>Make sure to configure the <code>user</code> with a <code>strong</code> password</li><li>Configure the <code>WiFi</code> settings to your local network. This allows you to find and access the RPi5 on your network without needing to connect a monitor and keyboard.</li><li>Set the locale settings to your local settings</li></ol><blockquote><p><i class="fa fa-exclamation-triangle" aria-hidden=true style=color:orange> </i> Don&rsquo;t click save yet. We need to configure the <code>SSH</code> settings.</p></blockquote></details><details open><summary>5. Customize Services (SSH)</summary><img src=/images/blogs/5/rpi5-os-install-5-edit-3.png alt="Raspberry Pi 5" style=width:70%;display:block;margin-left:auto;margin-right:auto><ol><li>Select <code>Enable SSH</code></li><li>Add your public key. If you don&rsquo;t have an SSH Key, you can generate one using the <code>ssh-keygen</code> command. <a href=https://docs.github.com/en/authentication/connecting-to-github-with-ssh/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent>Follow the github instructions</a>. I think they are the clearest.</li><li>Click <code>Save</code></li></ol></details><details open><summary>5. Apply the settings changes</summary><img src=/images/blogs/5/rpi5-os-install-5-edit-4.png alt="Raspberry Pi 5" style=width:70%;display:block;margin-left:auto;margin-right:auto></details><details open><summary>5. Confirm the updates</summary><img src=/images/blogs/5/rpi5-os-install-5-edit-5.png alt="Raspberry Pi 5" style=width:70%;display:block;margin-left:auto;margin-right:auto></details><details open><summary>5. Wait...</summary><img src=/images/blogs/5/rpi5-os-install-5-edit-6.png alt="Raspberry Pi 5" style=width:70%;display:block;margin-left:auto;margin-right:auto></details><p>At the end of this process, you can install the SD card into the RPi5 and power it up. You should be able to find it on your network and SSH into it.</p><h2 id=first-access>First Access</h2><details open><summary>1. Discover the IP address of your machine</summary>After the RPi5 boots up, you should be able to find it on your network. You can use the `arp` command to find it.<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>arp -a
</span></span></code></pre></div><img src=/images/blogs/5/rpi5-discovery.png alt="Raspberry Pi 5" style=width:70%;display:block;margin-left:auto;margin-right:auto></details><details open><summary>2. SSH to the machine</summary>Once you have the IP address, you can SSH into the machine using the SSH certificate you provisioned, you can SSH into the machine.<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ssh -i ~/.ssh/id_&lt;your key&gt; &lt;user&gt;@&lt;ip address&gt;
</span></span></code></pre></div><blockquote><p><i class="fa fa-exclamation-triangle" aria-hidden=true style=color:orange> </i>Replace the <code>&lt;your key></code> with the name of your SSH key, <code>&lt;user></code> with the user you configured, and <code>&lt;ip address></code> with the IP address you discovered.</p></blockquote><img src=/images/blogs/5/rpi5-login.png alt="Raspberry Pi 5" style=width:70%;display:block;margin-left:auto;margin-right:auto></details><h2 id=summary>Summary</h2><p>🎉🎉🎉 Congratulations! You&rsquo;ve successfully set up your Raspberry Pi 5 for the first time. You can now start exploring the world of cloud native technologies on this powerful little computer. Enjoy your journey into the world of cloud computing and container orchestration!</p><h2 id=next-steps>Next Steps</h2><p>Now that you have your Raspberry Pi 5 set up, you can start exploring various cloud native technologies such as Kubernetes, Containerd, ctr, nerdctl, and more. You can also start deploying and managing containers using Kubernetes. Enjoy your journey into the world of cloud computing and container orchestration!</p></div><div class=td-content style=page-break-before:always><h1 id=pg-17b6f6cbfdc05a3cfe10dc75cc790bbb>Comparing the Berries 🍓</h1><div class=lead>I am in love with making things, and want to buy a Raspberry Pi 5 to use for local development. This blog takes a quick look at processors used in Raspberry Pi models and how they compare to processors used in IaaS machine instances.</div><div class="td-byline mb-4"><time datetime=2024-03-03 class=text-muted>Sunday, March 03, 2024</time></div><h1 id=bcm2711>BCM2711</h1><p>This is the Broadcom chip used in the Raspberry Pi 4 Model B, the Raspberry Pi 400, and the Raspberry Pi Compute Module 4. The architecture of the BCM2711 is a considerable upgrade on that used by the SoCs in earlier Raspberry Pi models. It continues the quad-core CPU design of the BCM2837, but uses the more powerful ARM A72 core. It has a greatly improved GPU feature set with much faster input/output, due to the incorporation of a PCIe link that connects the USB 2 and USB 3 ports, and a natively attached Ethernet controller. It is also capable of addressing more memory than the SoCs used before.</p><p>The ARM cores are capable of running at up to 1.5 GHz, making the Raspberry Pi 4 about 50% faster than the Raspberry Pi 3B+. The new VideoCore VI 3D unit now runs at up to 500 MHz. The ARM cores are 64-bit, and while the VideoCore is 32-bit, there is a new Memory Management Unit, which means it can access more memory than previous versions.</p><p>The BCM2711 chip continues to use the heat spreading technology started with the BCM2837B0, which provides better thermal management.</p><p><em>Processor:</em> Quad-core <a href=https://en.wikipedia.org/wiki/ARM_Cortex-A72[Cortex-A72]>https://en.wikipedia.org/wiki/ARM_Cortex-A72[Cortex-A72]</a> (ARM v8) 64-bit SoC @ 1.5 GHz.</p><p><em>Memory:</em> Accesses up to 8GB LPDDR4-2400 SDRAM (depending on model)</p><p><em>Caches:</em> 32kB data + 48kB instruction L1 cache per core. 1MB L2 cache.</p><p><em>Multimedia:</em> H.265 (4Kp60 decode); H.264 (1080p60 decode, 1080p30 encode); OpenGL ES, 3.0 graphics</p><p><em>I/O:</em> PCIe bus, onboard Ethernet port, 2 × DSI ports (only one exposed on Raspberry Pi 4B), 2 × CSI ports (only one exposed on Raspberry Pi 4B), up to 6 × I2C, up to 6 × UART (muxed with I2C), up to 6 × SPI (only five exposed on Raspberry Pi 4B), dual HDMI video output, composite video output.</p><p>The <a href=https://datasheets.raspberrypi.com/bcm2711/bcm2711-peripherals.pdf[datasheet>https://datasheets.raspberrypi.com/bcm2711/bcm2711-peripherals.pdf[datasheet</a> for the BCM2711] contains further details.</p><h1 id=bcm2712>BCM2712</h1><p>Broadcom BCM2712 is the 16nm application processor at the heart of Raspberry Pi 5. It is the successor to the BCM2711 device used in Raspberry Pi 4, and shares many common architectural features with other devices in the BCM27xx family, used on earlier Raspberry Pi products.</p><p>Built around a quad-core Arm Cortex-A76 CPU cluster, clocked at up to 2.4GHz, with 512KB per-core L2 caches and a 2MB shared L3 cache, it integrates an improved 12-core VideoCore VII GPU; a hardware video scaler and HDMI controller capable of driving dual 4kp60 displays; and a Raspberry Pi-developed HEVC decoder and Image Signal Processor. A 32-bit LPDDR4X memory interface provides up to 17GB/s of memory bandwidth, while x1 and x4 PCI Express interfaces support high-bandwidth external peripherals; on Raspberry Pi 5 the latter is used to connect to the Raspberry Pi RP1 south bridge, which provides the bulk of the external-facing I/O functionality on the platform.</p><p>Headline features include:</p><ul><li>Quad-core Arm Cortex-A76 @ 2.4GHz
** ARMv8-A ISA
** 64KByte I and D caches
** 512KB L2 per core, 2MB shared L3</li><li>New Raspberry Pi-developed ISP
** 1 gigapixel/sec</li><li>Improved HVS and display pipeline
** Dual 4Kp60 support</li><li>VideoCore V3D VII
** ~2-2.5× faster (more hardware, 1GHz versus 600MHz on Pi 4)
** OpenGL ES 3.1, Vulkan 1.3</li><li>4Kp60 HEVC hardware decode
** Other CODECs run in software
** H264 1080p24 decode ~10–20% of CPU
** H264 1080p60 decode ~50–60% of CPU
** H264 1080p30 encode (from ISP) ~30–40% CPU</li></ul><p>In aggregate, the new features present in BCM2712 deliver a performance uplift of 2-3x over Raspberry Pi 4 for common CPU or I/O-intensive use cases.</p><hr><h1 id=whats-in-the-cloud>Whats in the Cloud</h1><p>Previously we looked at Cloud provider costs. We blindly selected the cheapest instance type (c6g.xlarge) and went with it. But what is really running on those instances? What is the processor? How does it compare to the Raspberry Pi?</p><p>The c6g instance family provides the Graviton2 processor, featuring 64 ARM Neoverse N1 cores and a clock speed of 2.5 GHz, is designed for scalable cloud computing. In the case of the c6g.xlarge instance type, which typically provides access to four virtual CPUs, the allocation of cache resources plays a significant role in determining overall performance.</p><p>Here&rsquo;s the breakdown of cache allocation for each c6g.xlarge instance:</p><ul><li><p>L1 Cache: The Graviton2 processor has 32 KB of L1 cache per core. With four cores allocated to each instance, the total L1 cache available per instance is 32 KB * 4 = 128 KB. In comparison, the RPi5 gives us 128 KiB (64 KiB I-cache with parity, 64 KiB D-cache) per core of L1 cache. This is the same as the c6g.xlarge instance!</p></li><li><p>L2 Cache: Each core of the Graviton2 processor is equipped with 1 MB of L2 cache. With four cores per instance, the total L2 cache available per instance is 1 MB * 4 = 4 MB. In comparison, the RPi5 gives us 512 KiB per core of L2 cache. So the c6g.xlarge instance has 8x more L2 cache than the RPi5. This would make a big difference in compute performance for memory or IO intense workloads.</p></li><li><p>L3 Cache: The Graviton2 processor features a shared L3 cache of 32 MB. Allocating this cache across multiple instances requires careful consideration. Assuming equal distribution, if we divide the total L3 cache equally among, for example, 10 c6g.xlarge instances, each instance would receive 32 MB / 10 = 3.2 MB of L3 cache. The RPi5 has a 2MB shared L3 cache. So the c6g.xlarge instance has more L3 cache than the RPi5 - but not a whole lot more.</p></li></ul><p>It&rsquo;s essential to note that this allocation is simplified and theoretical. In practice, cloud providers dynamically manage resource allocation based on workload demands and system optimization strategies. Understanding these allocation principles enables users to make informed decisions when configuring and optimizing their cloud deployments.</p><p>By contrast, Raspberry Pi&rsquo;s BCM2711 and BCM2712 chips offer dedicated cache resources for standalone computing tasks, emphasizing performance in single-board computing and hobbyist projects. While these chips provide consistent performance within their designated environments, the shared infrastructure of cloud instances like the c6g.xlarge demands a nuanced understanding of resource allocation for optimal utilization.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-fd844991b634429166856789c0bb129a>Unlocking the Magic of SPAs, Static Sites, and Nuxt.js with OAuth</h1><div class=lead>Learn how to create dynamic landing pages using Nuxt.js, Vue.js, and Auth0 for authentication.</div><div class="td-byline mb-4"><time datetime=2024-03-01 class=text-muted>Friday, March 01, 2024</time></div><p>In our previous blog post, we showcased the simplicity and speed of creating static landing sites with Hugo. However, when the need for dynamic and interactive web experiences arises, Nuxt.js and Vue.js step in to offer powerful solutions.</p><p>Nuxt.js and Vue.js provide a versatile approach for building dynamic web applications, offering benefits such as server-side rendering (SSR) or Single Page Application (SPA) behavior akin to static sites. This hybrid approach ensures better performance, SEO optimization, and enhanced user experience compared to purely static sites. Additionally, Vue.js&rsquo;s component-based architecture and intuitive syntax make development straightforward and enjoyable.</p><p>Let&rsquo;s dive into building a Nuxt.js demo application, complete with login capabilities integrated using Auth0, to unlock the full potential of dynamic web experiences.</p><h1 id=what-is-the-difference-between-a-static-site-vs-spa>What is the Difference between a Static Site vs SPA?</h1><p>Single Page Applications (SPAs) have transformed web development, ushering in an era of seamless user experiences through dynamic content loading sans full-page refreshes. By fetching data asynchronously, SPAs deliver lightning-fast load times and fluid interactions, captivating users with their responsiveness.</p><p>In contrast, static sites pre-render content during build time, serving up crisp, pre-generated files directly to users. This approach bypasses server-side processing, unleashing unrivaled speed and scalability upon the digital landscape.</p><p>Now, imagine a fusion of these two paradigms—SPAs and static sites—ushering in a new era of web development innovation. Enter frameworks like Nuxt.js, seamlessly blending the dynamic prowess of SPAs with the rapid deployment capabilities of static site generation. With features like server-side rendering (SSR), static site generation (SSG), and effortless plugin integration, Nuxt.js empowers developers to craft web experiences that are as dynamic as they are efficient.</p><h1 id=what-is-oauth-protocol-about>What is OAuth Protocol About?</h1><p>OAuth has become the de facto standard for secure authentication and authorization on the web. It enables users to leverage login credentials from third-party applications (such as GitHub, Google, etc.) without sharing their credentials directly.</p><p>These systems provide limited access to user contact information or resources without sharing their credentials.</p><p>OAuth&rsquo;s protocol flow involves authentication servers, authorization grants, and access tokens, ensuring secure communication between the user, client application, and resource server.</p><p>The following diagram outlines the typical flow of implementing a web app that supports OAuth.</p><pre class=mermaid>sequenceDiagram
    participant Browser as SPA
    participant Auth0 as Auth0
    participant Backend as Backend Service

    Browser-&gt;&gt;Auth0: User clicks &#34;Login with Auth0&#34;
    Auth0-&gt;&gt;Browser: Redirect to Auth0 login page
    Browser-&gt;&gt;Auth0: User enters credentials
    Auth0-&gt;&gt;Browser: Redirect to callback URL with authorization code
    Browser-&gt;&gt;Backend: Send authorization code
    Backend-&gt;&gt;Auth0: Exchange code for access token
    Auth0-&gt;&gt;Backend: Provide access token
    Backend-&gt;&gt;Browser: Deliver requested data</pre><p><strong>Flow Explanation:</strong></p><ol><li>The user clicks on the &ldquo;Login with Auth0&rdquo; button in the browser (SPA).</li><li>The browser initiates a request to Auth0.</li><li>Auth0 redirects the browser to its login page.</li><li>The user enters their credentials.</li><li>Auth0 verifies the credentials and redirects the browser back to the SPA with an authorization code.</li><li>The browser sends the authorization code to the backend service.</li><li>The backend service exchanges the authorization code for an access token by making a request to Auth0.</li><li>mAuth0 validates the authorization code and issues an access token to the backend service.</li><li>The backend service uses the access token to request the required data from Auth0.</li><li>Auth0 verifies the access token and provides the requested data to the backend service.</li><li>Finally, the backend service delivers the requested data to the browser.</li></ol><h2 id=what-is-auth0>What is Auth0?</h2><p>Implementing OAuth authentication for every web application can indeed be cumbersome and intricate. Fortunately, authentication aggregation services like Auth0 exist to alleviate these challenges. They not only handle the complexities of authentication protocols and security measures but also simplify the integration process into your application with just a few lines of code.</p><p>With Auth0, developers can leverage a comprehensive suite of authentication and authorization features, including user management, social login integrations, multi-factor authentication, and more. By abstracting away the intricacies of OAuth implementation and providing a user-friendly dashboard for configuration, Auth0 empowers developers to focus on building their applications&rsquo; core functionality without compromising on security or user experience.</p><hr><h1 id=step-by-step-guide-for-oauth-authentication-with-auth0>Step-by-Step Guide for OAuth Authentication with Auth0</h1><h2 id=1-create-or-login-to-auth0>1. Create or Login to Auth0</h2><h2 id=2-create-a-new-application>2. Create a New Application</h2><p><img src=/images/blogs/3/auth0-01-creating-application.png></p><h2 id=2-select-the-application-type>2. Select the Application Type</h2><p><img src=/images/blogs/3/auth0-02-app-type-selection.png></p><ol><li>Fill out the name for the new application</li><li>Ensure you select <code>Single Page App</code></li><li>Select <code>Vue</code> (or your favorite framework)</li><li>Click the <code>Continue</code> Button</li></ol><h2 id=3-download-the-generated-sample>3. Download the Generated Sample</h2><p>Next Auth0 will allow you to download a ready to use application for that framework!</p><p><img src=/images/blogs/3/auth0-03-download-sample.png></p><h2 id=4-update-your-application-settings>4. Update your Application Settings</h2><p>In this next screen, you will see getting started information for running the application locally.</p><p><img src=/images/blogs/3/auth0-04-getting-started.png></p><p>To make this work, you must configure your settings for:</p><ol><li><code>Allowed Calledback URLs</code></li><li><code>Allowed Logout URLs</code></li><li>and <code>Allowed Web Origins</code></li></ol><p>Notice the link in the screen shot above, open a tab so that you can update the settings as shown below.</p><p><img src=/images/blogs/3/auth0-05-local-config.png></p><p>Once done, save the settings.</p><h2 id=5-select-your-login-support>5. Select your Login Support</h2><p>Next navigate to the Connections Tab. Here you can enable the &ldquo;Connection&rdquo; types, such as:</p><ol><li>Google oauth2 authentication</li><li>Github OAuth2 authentication</li><li>and even &lsquo;username and password&rsquo; base authentication</li></ol><p>Make you selection and save your settings.</p><p><img src=/images/blogs/3/auth0-06-config-access-types.png></p><h2 id=5-configure-and-run-the-application-locally>5. Configure and Run the Application Locally</h2><p>Now with all the configuration out of the way, we can start working with the downloaded project from our previous step.</p><ol><li><p>Unpack the downloaded application archive, and open the code in an IDE of your choice.
<img src=/images/blogs/3/unzip.png></p></li><li><p>The project <em>may</em> needs to be configured with your Auth0 domain and client ID in order for the authentication flow to work. However generally the zip is pre-configured with the application identity. Let&rsquo;s look at them. Open <code>auth_config.json</code>, and verify the application verification domain, and client ID are correct:</p></li></ol><p><img src=/images/blogs/3/auth0-07-client-id-02.png></p><p>They should match the values from the application listing in Auth0 application settings:</p><p><img src=/images/blogs/3/auth0-07-client-id-01.png></p><h2 id=5-verifying-the-configuration>5. Verifying the Configuration</h2><ol><li>In a console, navigate to the root of the project and run:</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sh exec.sh
</span></span></code></pre></div><p><img src=/images/blogs/3/auth0-08-starting-the-app.png></p><ol start=2><li>Open your browser to http://localhost:1313. You should expect to see something as below.</li></ol><p><img src=/images/blogs/3/auth0-09-open-browser.png></p><ol start=3><li>Click the login button and select a login method to test.</li></ol><p><img src=/images/blogs/3/auth0-10-select-a-login-method.png></p><p>For example below is an example of what one might see if they clicked the github login method. Once you have reviewed and accepted the permissions - it will grant access in the users account to profile (name, email, userId).</p><p><img src=/images/blogs/3/auth0-11-accept-permission-grant.png></p><p>Once this has successfully completed, we can click the drop down next to your user avatar and select <code>profile</code>. This will show you what data was captured from the user account on the provider (github, google, etc).</p><p><img src=/images/blogs/3/user-details.png></p><h2 id=6-deploying-to-github-pages>6. Deploying to Github Pages</h2><p>Now that the first steps are successfully working, it is time to get this into source control, enable github pages, configure it to use DNS, update the settings on the application listing in Auth0.</p><p>Many of these steps will be very similar to the steps we took in the previous post - when deploying our hugo blog to Github pages.</p><ol><li>Create a github repository
<img src=/images/blogs/3/create-new-repo.png></li><li>In github pages settings of the new repository, enable deployment with 1Github Actions`:
<img src=/images/blogs/3/setting-github-action.png></li><li>Next create a new file in the repository under the path <code>.github/workflows/deploy.yaml</code> and paste in the following content:</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Simple workflow for deploying static content to GitHub Pages</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Deploy static content to Pages</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>on</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># Runs on pushes targeting the default branch</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>push</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>branches</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;main&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># Allows you to run this workflow manually from the Actions tab</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>workflow_dispatch</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># Sets the GITHUB_TOKEN permissions to allow deployment to GitHub Pages</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>permissions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>contents</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>read</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>pages</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>write</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>id-token</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>write</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic># Allow one concurrent deployment</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>concurrency</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;pages&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>cancel-in-progress</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>jobs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># Single deploy job since we&#39;re just deploying</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>deploy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>environment</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>github-pages</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>url</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>${{ steps.deployment.outputs.page_url }}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>runs-on</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ubuntu-latest</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>steps</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Checkout</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>uses</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>actions/checkout@v4</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Set up Node</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>uses</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>actions/setup-node@v3</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>with</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>node-version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>18</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>cache</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;npm&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Install dependencies</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>run</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>npm install</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Build</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>run</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>npm run build</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Setup Pages</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>uses</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>actions/configure-pages@v3</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Upload artifact</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>uses</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>actions/upload-pages-artifact@v2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>with</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#8f5902;font-style:italic># Upload dist repository</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;./dist&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Deploy to GitHub Pages</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>id</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>deployment</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>uses</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>actions/deploy-pages@v2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Commit this change.
<img src=/images/blogs/3/deploy-automation-1.png></p><ol><li>Navigate to the <code>Actions</code> tab in your repository. You should see the deployment job successfully complete.</li></ol><p><img src=/images/blogs/3/deploy-automation-2.png></p><ol start=5><li>Navigate to the <code>Github Pages</code> settings once more, and you will expect to see the link to your read to use site hosted on github pages.</li></ol><p>From this point, I will leave the exercise of configuring a real domain name to you as a learning exercise. Here are a few hints:</p><ol><li>You will need to update your application listing to set the <code>domain</code> of the application.</li><li>There are 4 settings you will make there; the 3 settings we provided above and the <code>Application Login URL</code>.</li><li>If you have a custom domain, configure your DNS records - as we did in the previous post, and update the github pages settings.</li></ol><h1 id=summary>Summary</h1><p>In summary, we created a static (SPA) site - that has the ability to dynamically call backend services using Vue, NuxtJS and Auth0. From here one could easily add new backend services.</p><p>One interesting enhancement we could might is to complete the login flow. This would entail sending the Users <code>authorization code</code> provided from Auth0 to a backend API. The backend API would validate the <code>authorization code</code> and obtain a <code>access token</code>. Using this access token it would be possible to lookup user information and generate a JWT or grant document using <a href=https://paseto.io/>PASETO grant</a>. I may provide a guide for doing this in an upcoming post. For now, check out my finished demo at <a href=https://app.codeblind.ai>https://app.codeblind.ai</a>. Cheers and happy coding!</p></div><div class=td-content style=page-break-before:always><h1 id=pg-b79909406be4c6c656da61022fa42743>Building a Landing Site</h1><div class=lead>Learn how to host a static site on Github Pages and automate the deployment process using Github Actions. Explore the benefits of static sites and their suitability for various purposes such as blogs, portfolios, landing pages, and documentation sites.</div><div class="td-byline mb-4"><time datetime=2024-02-28 class=text-muted>Wednesday, February 28, 2024</time></div><h2 id=discover-why-static-sites-are-valuable-to-learn-whether-you-want-to-share-your-thoughts-bootstrap-a-startup-or-build-an-open-source-project>Discover why static sites are valuable to learn, whether you want to share your thoughts, bootstrap a startup, or build an open-source project.</h2><p>This post explores the process of building a landing site using static site hosting on Github Pages and automating deployment with Github Actions. We&rsquo;ll delve into the benefits of static sites and build one together for a personal blogs, or possibly a startup landing pages.</p><p>This site will approach build a set of sites and applications designed to bootstrap a startup on a budget, where &ldquo;free&rdquo; is the magic word.</p><p>When undertaking such a task, it&rsquo;s crucial to build a landing site using a real, branded domain to foster engagement and adoption. The front door to such a site should be secure, fast, and open. Publish news, an engineering or market based blog, and including product documentation increase the likelihood of search engines indexing the site, thereby improving SEO and attracting and growing a community.</p><p>Let&rsquo;s explore the characteristics of this static sites:</p><ul><li><strong>Simplicity:</strong> Static sites are often simpler to build and maintain compared to dynamic sites, as there is no complex business logic, or server side rending. One can add more complex CSS styling, or animations, but generally pages are written in a familiar language such as markdown, making it easier to publish new content.</li><li><strong>Easier to Own and Maintain:</strong> because there are no server-side components, databases, or access controls to manage, the site is generally simpler to own and operate beyond building CI/CD publishing automation.</li><li><strong>Faster:</strong> because there is no server processing, or database queries involved. The web server serves the pre-built, minified HTML, CSS, and JavaScript files directly to the browser. Additionally, content delivery networks (CDNs) caching is possible and effective - making the site perform even better.</li><li><strong>Secure by default:</strong> because there is no backend to worry about. This means the security concerns lay in exploit vectors such as the occasional contact form - and in the supply chain; components you use to build the pages.</li></ul><p>Thus, static sites are commonly used for blogs, portfolios, landing pages, documentation, and marketing websites where simplicity and speed are priorities.</p><h3 id=what-is-seo>What is SEO?</h3><p>Search Engine Optimization (SEO) plays a critical role in driving adoption and expanding market reach for websites. This is particularly important for startups and businesses operating on a budget. By ensuring that your site ranks well in search engine results, you can attract organic traffic, increase visibility, and ultimately, reach a wider audience.</p><p>Because the entire site is static, search engine crawlers typically can consume can easily index and rank the content without encountering any barriers.</p><h2 id=static-site-generators>Static Site Generators</h2><p>Static site generators (SSGs) streamline website development by transforming structured content into static HTML, CSS, and JavaScript files. <a href=https://gohugo.io/>Hugo</a> is well known for its speed and flexibility. It converts Markdown or other formats into static pages - and is written in golang - making it my top choice.</p><p>There are other popular options - which deliver more flexible power - such as Gatsby, Next.js, and Nuxt.js. I hope to write a post soon to contract the differences of those. However today, we want to build a site. Let&rsquo;s get started!</p><hr><h1 id=1-register-a-domain-name>1. Register a Domain Name</h1><p>Registering a <em>&ldquo;good&rdquo;</em> domain name is maybe the hardest part of the process. The name becomes your brand, and depending on what you are making, can become a house hold name.</p><p>In this post, I use <a href=https://www.namecheap.com/>Namecheap</a>, however there are pros and cons of each registrar.</p><h1 id=2-create-a-hugo-site>2. Create a hugo site</h1><p>The <a href=https://gohugo.io/>Hugo</a> project has a great <a href=https://gohugo.io/getting-started/quick-start/>Quick Start Guide</a> to bootstrap your site, and help you find a theme.</p><p>For this post, I am going to take a shortcut since I know I want a landing site with multi-language support, blog and documentation support.</p><p><a href=https://www.docsy.dev/>Docsy</a> provides those exact features and has an amazing look and feel. The fastest way to boot strap the site, is to <code>fork</code> or <code>clone</code> the <a href=https://github.com/sprydevl/sprydevl.github.io>my example site repository</a>.</p><p>My favorite way of doing this is:</p><ol><li><p>Click the <code>"Use This Template"</code> button in the repository and select <code>Create a new repository</code>.</p></li><li><p>Fill out the repository name to be <code>USERNAME.github.io</code> where <code>USERNAME</code> is your github username. Leave the other settings default - then click <code>Create</code></p></li></ol><p><img src=/images/blogs/2/create-new-repo-1.png></p><h1 id=3-update-the-baseurl-for-your-new-site>3. Update the <code>baseURL</code> for your new site</h1><p>In either a local clone, or from within the github itself, change the <code>baseURL</code> in the <code>hugo.toml</code> to have your new domain name. For my PoC I will be using <code>blindcoder.com</code>.</p><ol><li>click on the <code>hugo.toml</code> file link</li><li>click the edit this file button on the upper left hand corner of the file window.</li><li>Update the <code>baseURL</code> setting:</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#c4a000>baseURL</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;https://blindcoder.com/&#34;</span>
</span></span></code></pre></div><p>To your domain name. For example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#c4a000>baseURL</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;https://YOUR_DOMAIN/&#34;</span>
</span></span></code></pre></div><blockquote><p><strong>Note:</strong> update <code>YOUR_DOMAIN</code> in the statement above leave the trailing slash.</p></blockquote><ol start=4><li>Click the <code>Commit Changes</code> button and commit the changes.</li></ol><h1 id=4-setting-up-github-pages>4. Setting up Github Pages</h1><ol><li><p>Click the <code>Settings</code> tab at the top of the repository page
<img src=/images/blogs/2/pages-1.png></p></li><li><p>Click the <code>Pages</code> settings menu option on the left panel
<img src=/images/blogs/2/pages-2.png></p></li><li><p>In the <code>Pages</code> settings, ensure <code>Source</code> is set to
In the <code>Pages</code> section of the repository settings, ensure the <code>Source</code> is set to Github Actions.
<img src=/images/blogs/2/pages-3.png></p></li></ol><h1 id=5-github-actions-build-and-deployment-automation>5. Github Actions: Build and Deployment Automation</h1><p>Github Actions is a powerful tool that allows you to automate your software development workflows. We will use it to build and deploy our site to Github Pages.</p><p>If you&rsquo;ve forked my repository, you will already have a actions configuration in <code>.github/workflows/hugo.yaml</code>. Note there are a number of prebuilt <a href=https://github.com/actions/starter-workflows/tree/main/pages>action templates</a> depending on the technology you are using. Check them out!</p><h1 id=6-validate-the-site-is-working>6. Validate the site is working.</h1><p>Shortly after updating the <code>Pages</code> settings, the site was already published. You should verify it is all working but visiting the site <a href=https://USERNAME.github.io>https://USERNAME.github.io</a> where <code>USERNAME</code> is your Github username or organization name. You should expect something similar as below:</p><p><img src=/images/blogs/2/demo-site.png></p><h1 id=6-customizing-your-domain>6. Customizing your Domain</h1><p>Now that we have validated everything is working as expected. Let&rsquo;s setup our custom domain to our branded domain.</p><p>This work will happen in two parts, one phase on <a href=https://www.namecheap.com/>Namecheap</a> and the other on Github.</p><h2 id=61-update-the-dns-settings-on-your-registrar>6.1 Update the DNS settings on your Registrar</h2><p>As mentioned earlier, I use Namecheap, so I will provide those instructions. However the DNS settings could be applied to the DNS management of your domain on any of the registrar. Some steps may differ slightly.</p><ol><li><p><strong><a href=https://www.namecheap.com/myaccount/login.aspx>Sign in</a> to your Namecheap account.</strong></p></li><li><p><strong>Select Domain List from the left sidebar and click on the Manage button next to your domain name:</strong></p></li></ol><p><img src=/images/blogs/2/nc_manage.png></p><ol start=3><li><strong>Navigate to the Advanced DNS tab and click on the Add New Record button:</strong></li></ol><p><img src=/images/blogs/2/nc_addnewrecord.png></p><ol start=4><li><strong>Add the following records to your domain:</strong></li></ol><table><tr><th>Type</th><th>Host</th><th>Value</th><th>TTL</th><th>Notes</th></tr><tr><td>A</td><td>@</td><td>185.199.108.153</td><td>Automatic</td><td>Github IP</td></tr><tr><td>A</td><td>@</td><td>185.199.109.153</td><td>Automatic</td><td>Github IP</td></tr><tr><td>A</td><td>@</td><td>185.199.110.153</td><td>Automatic</td><td>Github IP</td></tr><tr><td>A</td><td>@</td><td>185.199.111.153</td><td>Automatic</td><td>Github IP</td></tr><tr><td>CNAME</td><td>www</td><td><code>username</code>.github.io</td><td>Automatic</td><td>Replace <code>username</code> with your actual GitHub account username</td></table><blockquote><p><em><strong>Note 1:</strong></em> delete the other records that are there by default. We only need the records above for now. 🗑️</p><p><em><strong>Note 2:</strong></em> you may have to wait for DNS to update. It can take up to 30 minutes - so now is a great time to brew a cup of tea. ☕</p></blockquote><h2 id=62-defining-the-custom-domain-on-github>6.2 Defining the Custom Domain on Github</h2><p>Now that the DNS is setup, we need to tell Github to use the custom domain.</p><ol><li><strong>Navigate to the repository settings and scroll down to the <code>Github Pages</code> section.</strong></li><li><strong>Add your custom domain to the <code>Custom domain</code> input.</strong> This should be in the form of <code>yourdomain.com</code> or <code>www.yourdomain.com</code> depending on your preference.</li><li><strong>Click <code>Save</code> to save the changes.</strong></li></ol><p>At this point Github will validate the domain and if everything is setup correctly, your site will be available at your custom domain.</p><p>There is a small context text area that will show you the status of the domain validation. If there are any issues, may want to look back at your Namecheap DNS configuration.</p><h1 id=7-verify-your-new-domain>7. Verify your new Domain</h1><p><img src=/images/blogs/2/demo-final.png></p><h1 id=summary>Summary</h1><p><strong>That&rsquo;s it! It should now be live and visible at your custom domain.</strong> 🎉</p><p>In this post, we have setup a site for our startup. We have used free services to keep costs low and automated the deployment process to ensure we can focus on the product.</p><p>In upcoming posts, I hope to share a similar approach using Nuxt.js and Vue creating a SPA (similar to a static site) which can call backend services - and still be hosted on github pages for free! At least the SPA side anyway.</p><p>Follow my blog for more exciting posts. Be excellent, and happy coding! 🚀</p></div><div class=td-content style=page-break-before:always><h1 id=pg-28d7d6f6134801fc4c75f54f342fdb5f>What is a Cloud Anyway?</h1><div class=lead>In the pursuit of knowledge and innovation, let&rsquo;s embark on a journey to build a private cloud sanctuary. This endeavor will empower those who seek to explore the depths of technology and security with the freedom to learn and experiment, shielded from the constraints and risks of public platforms.</div><div class="td-byline mb-4"><time datetime=2024-02-27 class=text-muted>Tuesday, February 27, 2024</time></div><p><img src=/images/blogs/1/cloud-naut.jpg></p><p>In modern development, the concept of the Cloud is intrinsic to the daily role of most engineers. Cloud Native development involves designing, building, owning, and operating applications running on a Cloud.</p><p>But what exactly is the Cloud? If you&rsquo;ve worked on cloud-native applications, platforms like <a href=alibaba>Alibaba Cloud</a>, <a href=aws>AWS</a>, <a href=azure>Azure</a>, <a href=do>DigitalOcean</a>, <a href=fly>Fly.io</a>, <a href=gcp>GCP</a>, or <a href=hetzner>Hetzner</a> to mind.</p><p>Before delving deeper, let&rsquo;s establish a clear understanding of the various types of Cloud environments:</p><ul><li><p><strong>Private Cloud:</strong> A private cloud is a dedicated computing environment reserved exclusively for a single organization. It can be housed on-premises within the organization&rsquo;s data center or off-premises at a third-party provider&rsquo;s facility. The defining feature of a private cloud is its operation solely for the benefit of the organization, offering enhanced control, security, and customization compared to public cloud services.</p></li><li><p><strong>Public Cloud:</strong> In contrast, a public cloud operates as a computing model where resources such as virtual machines, storage, and applications are hosted and managed by third-party providers. These resources are made available to the general public via the internet. Public cloud services typically follow a pay-as-you-go model, enabling organizations to rapidly scale their infrastructure without requiring significant upfront capital investment. Prominent examples of public cloud providers include Amazon Web Services (AWS), Microsoft Azure, and Google Cloud Platform (GCP).</p></li><li><p><strong>Hybrid Cloud:</strong> A hybrid cloud combines aspects of both private and public clouds, offering organizations the opportunity to leverage the strengths of each model. Workloads can be dynamically distributed between on-premises infrastructure and public cloud services based on factors such as cost-effectiveness, performance requirements, and security considerations. The inherent flexibility of a hybrid cloud empowers organizations to optimize their IT resources, retain control over sensitive data, and harness the scalability and agility inherent in public cloud platforms.</p></li></ul><h2 id=cloud-liberties-security-exploration-in-the-cloud>Cloud Liberties: Security Exploration in the Cloud</h2><p>Exploring security in public clouds presents three fundamental challenges:</p><ol><li>Cloud resources become expensive once beyond the free tier many providers offer.</li><li>Debugging lower layer behavior can be challenging or even impossible.</li><li>Security exploration with cloud infrastructure can pose risks, potentially leading to unintended consequences, legal ramifications, or account bans.</li></ol><h2 id=embracing-a-private-cloud>Embracing a Private Cloud:</h2><p><em>So, how can we find the freedom to learn and explore in a safe environment shielded from external scrutiny?</em></p><p>The answer may lie in building our own private cloud! Contrary to common belief, constructing a private cloud for security and technology research isn&rsquo;t as daunting as it sounds. Today, with affordable and powerful hardware like the Raspberry Pi 5, coupled with numerous &ldquo;free&rdquo; services, we can create an infrastructure that rivals those of major cloud providers.</p><p>In the upcoming posts - or perhaps many posts - I&rsquo;ll guide you through the process. Moreover, I&rsquo;ll demonstrate how to accomplish this on a shoestring budget!</p><p><strong>Stick with me, and let&rsquo;s embark on this exciting journey together!</strong></p></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=Discord aria-label=Discord><a target=_blank rel=noopener href=https://discord.gg/XCuWVReewp aria-label=Discord><i class="fab fa-discord"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="User mailing list" aria-label="User mailing list"><a target=_blank rel=noopener href=https://groups.google.com/forum/#!forum/codeblind-discuss aria-label="User mailing list"><i class="fa fa-envelope"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=X aria-label=X><a target=_blank rel=noopener href=https://twitter.com/codeblind aria-label=X><i class="fab fa-x-twitter"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="Community Meetings" aria-label="Community Meetings"><a target=_blank rel=noopener href=https://github.com/josephbarnett/ aria-label="Community Meetings"><i class="fab fa-youtube"></i></a></li></ul></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/josephbarnett/ aria-label=GitHub><i class="fab fa-github"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Resume aria-label=Resume><a target=_blank rel=noopener href=https://github.com/josephbarnett/ aria-label=Resume><i class="fab fa-linkedin"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Facebook aria-label=Facebook><a target=_blank rel=noopener href=https://github.com/josephbarnett/ aria-label=Facebook><i class="fab fa-facebook"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Contact aria-label=Contact><a target=_blank rel=noopener href=https://github.com/josephbarnett/codeblind.ai aria-label=Contact><i class="fab fa-whatsapp"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2024
<span class=td-footer__authors>Copyright Code Blind LLC</span></span><span class=td-footer__all_rights_reserved>All Rights Reserved</span><span class=ms-2><a href=https://policies.google.com/privacy target=_blank rel=noopener>Privacy Policy</a></span></div></div></div></footer></div><script src=/js/main.js></script><script src=/js/prism.js></script><script src=/js/tabpane-persist.js></script><script src=http://localhost:1313/js/asciinema-player.js></script></body></html>